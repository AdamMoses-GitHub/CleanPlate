const DAPI=parent.DIGIOH_API,UTIL=parent.DIGIOH_API.UTIL,DUTIL=parent.DIGIOH_API.DUTIL,DLOG=parent.DIGIOH_API.DLOG,LBOX=parent.DIGIOH_API.LIGHTBOX,BOX_BASE_URL=DAPI.CONFIG.BOX_BASE_URL,SUBMIT_BASE_URL=DAPI.CONFIG.SUBMIT_BASE_URL,SUBMITCUS_BASE_URL=DAPI.CONFIG.SUBMITCUS_BASE_URL,API_BASE_URL=DAPI.CONFIG.API_BASE_URL,JSAPI_BASE_URL=DAPI.CONFIG.JSAPI_BASE_URL,COUPON_BASE_URL=DAPI.CONFIG.COUPON_BASE_URL,S3_BASE_URL=DAPI.CONFIG.S3_BASE_URL,customFieldsLimit=DAPI.CONFIG.CUSTOM_FIELDS_LIMIT;let DIGIOH_CACHE_VERSION="",PROTOCOL_USER_OVERRIDE="https://",PROTOCOL="https://",WIDGET_TYPE="",PARENT_URL="",FULL_URL="",IS_PRODUCTION=!1,IS_PREVIEW=!1,IS_QA=!1,SHOW_ERRORS=!1,IS_IE_9_OR_LESS=!1,VENDOR_GUID="",VENDOR_SHORT_ID="",CLIENT_GUID="",LIGHTBOX_GUID="",LIGHTBOX_SHORT_ID="",LIGHTBOX_NAME="",VARIATION_GUID="",VARIATION_SHORT_ID="",VARIATION_NAME="",IS_VARIATION=!1,AB_TEST_GUID="",AB_TEST_SHORT_ID="",AB_TEST_NAME="",IS_DESKTOP=!1,IS_PHONE=!1,IS_TABLET=!1,IS_MOBILE=!1,DIGIOH_USE_RESPONSIVE=!1,DIGIOH_USE_BUGSNAG=!1,DIGIOH_USE_PRQ=!1;var bodInsert="<div id='layout'></div>";bodInsert+="<div id='modal_loading'><div id='modal_loading_spinner'></div></div>",bodInsert+="<div class='bubble-container' id='bubble_container'>",bodInsert+="<span style='display: none;' class='error-bubble' id='error_bubble'>",bodInsert+="<span class='error-message' id='error_message'></span>",bodInsert+="<span id='error_close'>x</span>",bodInsert+="</span>",bodInsert+="<span style='display: none;' class='success-bubble' id='success_bubble'>",bodInsert+="<span class='success-message' id='success_message'></span>",bodInsert+="<span id='success_close'>x</span>",bodInsert+="</span>",bodInsert+="<span style='display: none;' class='warning-bubble' id='warning_bubble'>",bodInsert+="<span class='warning-message' id='warning_message'></span>",bodInsert+="<span id='warning_close'>x</span>",bodInsert+="</span>",bodInsert+="</div>";var ie9="\x3c!--[if lte IE 9]>";ie9+="<scr",ie9+="ipt type='text/javascript'>",ie9+="IS_IE_9_OR_LESS = true;",ie9+="<",ie9+="/script>",ie9+="<![endif]--\x3e";var loaderBg="#modal_loading{display:none;position:fixed;z-index:90000;top:0;left:0;height:100%;width:100%;background:rgba(255,255,255,.8)}",loaderCss="#modal_loading_spinner{position:fixed;z-index:90001;color:#0078d7;font-size:15px;margin:0;width:1em;height:1em;border-radius:50%;text-indent:-9999em;-webkit-animation:load4 1.3s infinite linear;animation:load4 1.3s infinite linear;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0)}@-webkit-keyframes load4{0%,100%{box-shadow:0 -3em 0 .2em,2em -2em 0 0,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 0}12.5%{box-shadow:0 -3em 0 0,2em -2em 0 .2em,3em 0 0 0,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}25%{box-shadow:0 -3em 0 -.5em,2em -2em 0 0,3em 0 0 .2em,2em 2em 0 0,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}37.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 0,2em 2em 0 .2em,0 3em 0 0,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}50%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 0,0 3em 0 .2em,-2em 2em 0 0,-3em 0 0 -1em,-2em -2em 0 -1em}62.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 0,-2em 2em 0 .2em,-3em 0 0 0,-2em -2em 0 -1em}75%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 0,-3em 0 0 .2em,-2em -2em 0 0}87.5%{box-shadow:0 -3em 0 0,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 0,-3em 0 0 0,-2em -2em 0 .2em}}@keyframes load4{0%,100%{box-shadow:0 -3em 0 .2em,2em -2em 0 0,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 0}12.5%{box-shadow:0 -3em 0 0,2em -2em 0 .2em,3em 0 0 0,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}25%{box-shadow:0 -3em 0 -.5em,2em -2em 0 0,3em 0 0 .2em,2em 2em 0 0,0 3em 0 -1em,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}37.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 0,2em 2em 0 .2em,0 3em 0 0,-2em 2em 0 -1em,-3em 0 0 -1em,-2em -2em 0 -1em}50%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 0,0 3em 0 .2em,-2em 2em 0 0,-3em 0 0 -1em,-2em -2em 0 -1em}62.5%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 0,-2em 2em 0 .2em,-3em 0 0 0,-2em -2em 0 -1em}75%{box-shadow:0 -3em 0 -1em,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 0,-3em 0 0 .2em,-2em -2em 0 0}87.5%{box-shadow:0 -3em 0 0,2em -2em 0 -1em,3em 0 0 -1em,2em 2em 0 -1em,0 3em 0 -1em,-2em 2em 0 0,-3em 0 0 0,-2em -2em 0 .2em}}",loaderImg="#modal_loading{display:none;position:fixed;z-index:90000;top:0;left:0;height:100%;width:100%;background:url("+BOX_BASE_URL+"/static/loading_animation.gif) 50% 50% no-repeat rgba(255,255,255,.8)}",pgStyle="<style type='text/css'>.hidden_until_loaded, .hidden_until_loaded body, .hidden_until_loaded div {visibility: hidden !important;} body{margin:0;padding:0;border:none;}#bubble_container{position: fixed;top: 30px;left: 30px;z-index: 100001 !important}.error-bubble, .success-bubble, .warning-bubble{-webkit-border-radius: 3px;-moz-border-radius: 3px;-ms-border-radius: 3px;-o-border-radius: 3px;border-radius: 3px;padding: 12px 15px;margin: 0;text-align: left;color: red;background-color: #fff4f4;border: 1px solid #d58a8a;font-size: 13px;line-height: 18px;font-family: 'Open Sans', 'lucida grande', 'Segoe UI', arial, verdana, 'lucida sans unicode', tahoma, sans-serif;white-space: nowrap;font-weight: 400;display: block;margin-bottom:5px}.error-bubble .error-message{color: #d58a8a;font-size: inherit;line-height: inherit}.error-message {color: #dd3b38;font-size: 10px}.success-bubble {color: #000;background-color: #ddffdd;border: 1px solid #2dbe60 }.success-bubble .success-message, .warning-bubble .warning-message {color: #000;font-size: inherit;line-height: inherit}.success-message, .warning-message {color: #000;font-size: 10px;} .warning-bubble {color: #000;background-color: #ffeb3b;border: 1px solid #ff9800}#error_close, #success_close, #warning_close{color: #dd3b38;font-size: 18px;font-weight: 700;display: inline-block;float: right;cursor: pointer;margin-top: -2px}#success_close {color: #2dbe60}#warning_close {color: #ff9800}.error-bubble .error-bubble-arrow-border{display: block;border-color: #d58a8a transparent transparent;border-style: solid;border-width: 6px;height: 0;width: 0;position: absolute;bottom: -13px;left: 10px}"+loaderCss+loaderBg+"body.loading{overflow:hidden}body.loading #modal_loading{display:block}</style>";pgStyle+="<style id='element_styles' type='text/css'></style>";var html_ele=document.getElementsByTagName("html")[0];"object"==typeof html_ele.classList&&null!==html_ele.classList&&html_ele.classList.add("hidden_until_loaded");var basic_fonts=["Arial, Helvetica, sans-serif","'Comic Sans MS', cursive, sans-serif","'lucida sans unicode', 'Lucida Grande', sans-serif","Tahoma, Geneva, sans-serif","Verdana, Geneva, sans-serif","'Courier New', Courier, monospace","'Lucida Console', Monaco, monospace","'Trebuchet MS', Helvetica, sans-serif","Impact, Charcoal, sans-serif"],google_fonts=[],custom_fonts=[];let postSubmissionResolution=[],submissionPromises=[],quizPromises=[];var TIME_OF_OPEN=(new Date).getTime(),KEEN_CLIENT,EVENT_GUID="",IS_SETTINGS_LOADED=!1,IS_SCRIPTS_LOADED=!1,BOX_CUSTOM_JS={},LIGHTBOX_OR_VARIATION_GUID="",STANDARD_OBJ={},CUSTOM_JS_GUIDS_ARR=[],CUSTOM_JS_BOX_EMBED={},CJSAPPS_ARR=[],CJSAPPS_BOXES={},COUPONS_FOR_SUBMIT={},COUPONS_FOR_DISPLAY={},CURRENT_PAGE="main";function getCurrentPage(){return CURRENT_PAGE}var CURRENT_WIDTH=0,CURRENT_HEIGHT=0,PageAnswers=[];function getPageAnswers(){return PageAnswers}function setPageAnswers(arr){PageAnswers=arr}var PageViewSequence=[""];function getPageViewSequence(){return PageViewSequence}function setPageViewSequence(arr){}var SELECTED_BUTTON_FORM_VALUES={},wasErrorBubbleAlreadyClosed=!1,BugsnagInitAttempts=0,processSubmitLock=!1,hasAfterDomReadyJsFinished=!1,settings,body,modal_loading,error_bubble,error_message,success_bubble,success_message,warning_bubble,warning_message;function getSettings(){return settings}var image_dims={},form_wrapper,form,thx_form_wrapper,thx_form,ep1_form_wrapper,ep1_form,ep2_form_wrapper,ep2_form,ep3_form_wrapper,ep3_form,ep4_form_wrapper,ep4_form,form_input_obj={},pref_form_input_full_name=!1,pref_form_input_first_name=!1,pref_form_input_last_name=!1,pref_form_input_email=!1,pref_form_input_phone=!1,pref_form_input_opt_in=!1,pref_form_input_customN=!1,form_input_full_name,form_input_first_name,form_input_last_name,form_input_email,form_input_phone,form_input_opt_in,thx_form_input_full_name,thx_form_input_first_name,thx_form_input_last_name,thx_form_input_email,thx_form_input_phone,thx_form_input_opt_in,ep1_form_input_full_name,ep1_form_input_first_name,ep1_form_input_last_name,ep1_form_input_email,ep1_form_input_phone,ep1_form_input_opt_in,ep2_form_input_full_name,ep2_form_input_first_name,ep2_form_input_last_name,ep2_form_input_email,ep2_form_input_phone,ep2_form_input_opt_in,ep3_form_input_full_name,ep3_form_input_first_name,ep3_form_input_last_name,ep3_form_input_email,ep3_form_input_phone,ep3_form_input_opt_in,ep4_form_input_full_name,ep4_form_input_first_name,ep4_form_input_last_name,ep4_form_input_email,ep4_form_input_phone,ep4_form_input_opt_in,using_form=!1,using_form_thx=!1,using_form_ep1=!1,using_form_ep2=!1,using_form_ep3=!1,using_form_ep4=!1,IsDatepickerScriptLoaded=!1,IsDatepickerScriptLoading=!1,AfterDomLoadedHasRun=!1,BuiltExtraPageStyles={},LoadedCustomFonts={},LoadedPageImages={},ImageSrcMap={},boxapi={},jQuery={},$={};function logger(msg,isJson){DAPI.log(msg,"JS_BOXES_INTERNAL")}function clearFormData(){try{LBOX.hasOwnProperty("SINGLE_PAGE_FORM_DATA")&&LBOX.SINGLE_PAGE_FORM_DATA&&LBOX.SINGLE_PAGE_FORM_DATA.hasOwnProperty(LIGHTBOX_SHORT_ID.toString())&&delete LBOX.SINGLE_PAGE_FORM_DATA[LIGHTBOX_SHORT_ID.toString()]}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"clearFormData")}}function resetBox(){for(var p=0;p<PageViewSequence.length;p++)removePageFromPageAnswers(PageViewSequence[p]),deselectButtonsOnPage(PageViewSequence[p]),clearFieldsSetByPage(PageViewSequence[p]),removeFocusFromButtonsOnPage(PageViewSequence[p]);localStorage.removeItem("prq_results"),localStorage.removeItem(`digioh_local_quiz_results_${boxapi.getId()}`),SELECTED_BUTTON_FORM_VALUES={},PageAnswers=[],PageViewSequence=[""]}function resetPage(pageName,deselectButtons=!0){var skipPageReset=boxapi.getWidgetMetadata("skip_page_reset");!1===deselectButtons&&("true"==skipPageReset||1==skipPageReset)||(removePageFromPageAnswers(pageName),deselectButtonsOnPage(pageName),clearFieldsSetByPage(pageName),clearButtonValuesSetByPage(pageName)),removeFocusFromButtonsOnPage(pageName),resetPRQOrginalMergeTags(pageName)}function checkJqLoaded(){onJqLoaded()}function onScriptsLoaded(){IS_SCRIPTS_LOADED=!0,tryInitScripts()}function onJqLoaded(){void 0===LIGHTBOX_GUID?window.setTimeout(onJqLoaded,100):onVarsLoaded()}function checkDocumentReadyState(){try{"complete"===document.readyState||"loaded"===document.readyState||"interactive"===document.readyState?afterDomLoaded():setTimeout(checkDocumentReadyState,250)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"checkDocumentReadyState")}}function afterDomLoaded(){try{if(!AfterDomLoadedHasRun){AfterDomLoadedHasRun=!0,$("html").attr("lang","en"),body=$("body"),$("head").append(ie9),$("head").append(pgStyle),body.append(bodInsert),modal_loading=$("#modal_loading"),error_bubble=$("#error_bubble"),error_message=$("#error_message"),success_bubble=$("#success_bubble"),success_message=$("#success_message"),warning_bubble=$("#warning_bubble"),warning_message=$("#warning_message"),$("#error_close, #success_close, #warning_close").on(IS_MOBILE?"click":"mousedown",(function(e){let currentTarget=$(e.currentTarget),message_bubble=error_bubble,wasMessageBubbleAlreadyClosed=wasErrorBubbleAlreadyClosed,message=error_message;"success_close"==currentTarget.attr("id")&&(message_bubble=success_bubble,wasMessageBubbleAlreadyClosed=wasSuccessBubbleAlreadyClosed,message=success_message),"warning_close"==currentTarget.attr("id")&&(message_bubble=warning_bubble,wasMessageBubbleAlreadyClosed=wasWarningBubbleAlreadyClosed,message=warning_message),message_bubble.hide(),wasMessageBubbleAlreadyClosed||(wasMessageBubbleAlreadyClosed=!0,message_bubble===error_bubble&&$(document).trigger("BOX_CLOSE_ERROR",["","",""]),message.removeAttr("role"))}));try{LBOX.JQUERY_DIGIOH(top).keyup((function(e){27==(e.keyCode?e.keyCode:e.which)&&WIDGET_TYPE&&"inline"!==WIDGET_TYPE&&postMessageCloseBox("button_click")}))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e))}$(window).keyup((function(e){var code=e.keyCode?e.keyCode:e.which;if(27==code&&WIDGET_TYPE&&"inline"!==WIDGET_TYPE&&postMessageCloseBox("button_click"),13==code){var pref=CURRENT_PAGE;"main"==pref&&(pref="");var foundMatch=!1;$("#"+pref+"layout .button_focus_tab_submit").each((function(){if(!foundMatch){foundMatch=!0;var pr=pref;pref&&pref.length>1&&-1===pref.indexOf("_")&&(pr=pref+"_");var btnId=$(this).attr("id");btnId.indexOf("button")>=0&&settings.hasOwnProperty(btnId)&&(setButtonMetaDataLayer(settings[btnId]),addButtonToPageAnswers(pref,btnId)),btnId.indexOf("button")>=0&&settings.hasOwnProperty(btnId)&&settings[btnId].hasOwnProperty("override_form_submit_action")&&settings[btnId].override_form_submit_action?processSubmitObj({pageName:pr,overrideFormSubmitAction:settings[btnId].override_form_submit_action}):processSubmit(pr,!1,!1,!0)}})),$("#"+pref+"layout .button_focus_tab_close").each((function(){foundMatch||(foundMatch=!0,postMessageCloseBox("button_click"))})),$("#"+pref+"layout .button_focus_tab_redirect").each((function(){if(!foundMatch){foundMatch=!0;var ptn=$(this).attr("id");if(ptn&&settings.hasOwnProperty(ptn)){var prop=settings[ptn];prop.url&&(0!==prop.url.toLowerCase().trim().indexOf("http")&&0!==prop.url.toLowerCase().trim().indexOf("mailto")&&(prop.url="http://"+prop.url),prop.hasOwnProperty("redirect_type")&&prop.redirect_type||(prop.redirect_type="current"),postMessageRedirectParent(prop,"button"))}}})),$("#"+pref+"layout .button_focus_tab_lightbox_open").each((function(){if(!foundMatch){foundMatch=!0;var ptn=$(this).attr("id");if(ptn&&settings.hasOwnProperty(ptn)){var prop=settings[ptn];prop.lightbox_open&&prop.lightbox_open.length>0&&postMessageOpenAnotherBox(prop,"button")}}})),$("#"+pref+"layout .button_focus_tab_change_pages").each((function(){if(!foundMatch){foundMatch=!0;var ptn=$(this).attr("id");if(addButtonToPageAnswers(pref,ptn),ptn&&settings.hasOwnProperty(ptn)){var prop=settings[ptn];if("main_page"==prop.action)changePages("",ptn,prop,"button");else if("thank_you_page"==prop.action)changePages("thx_",ptn,prop,"button");else if(0==prop.action.indexOf("extra_page_")){changePages("ep"+prop.action.replace("extra_page_","")+"_",ptn,prop,"button")}else if("next_page"==prop.action){var nextPagePref=getNextPage(pref);(nextPagePref=DUTIL.getUnfriendlyPagePrefix(nextPagePref))&&changePages(nextPagePref,ptn,prop,"button")}}}}))}})),tryApplySettings()}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"afterDomLoaded")}}function onVarsLoaded(){LIGHTBOX_OR_VARIATION_GUID=IS_VARIATION?VARIATION_GUID:LIGHTBOX_GUID,STANDARD_OBJ.protocol=PROTOCOL,STANDARD_OBJ.protocol_user_override=PROTOCOL_USER_OVERRIDE,STANDARD_OBJ.widget_type=WIDGET_TYPE,STANDARD_OBJ.cache_version=DIGIOH_CACHE_VERSION,STANDARD_OBJ.parent_url=PARENT_URL,STANDARD_OBJ.full_url=FULL_URL||"",STANDARD_OBJ.use_bugsnag=DIGIOH_USE_BUGSNAG,STANDARD_OBJ.use_prq=DIGIOH_PRQ.USE,STANDARD_OBJ.use_console=SHOW_ERRORS,STANDARD_OBJ.is_preview=IS_PREVIEW,STANDARD_OBJ.is_responsive=!1,STANDARD_OBJ.is_variation=IS_VARIATION,STANDARD_OBJ.user_id=VENDOR_GUID,STANDARD_OBJ.user_guid=VENDOR_GUID,STANDARD_OBJ.user_short_id=VENDOR_SHORT_ID,STANDARD_OBJ.vendor_id=VENDOR_GUID,STANDARD_OBJ.vendor_guid=VENDOR_GUID,STANDARD_OBJ.vendor_short_id=VENDOR_SHORT_ID,STANDARD_OBJ.client_id=CLIENT_GUID,STANDARD_OBJ.client_guid=CLIENT_GUID,STANDARD_OBJ.lightbox_id=LIGHTBOX_GUID,STANDARD_OBJ.lightbox_guid=LIGHTBOX_GUID,STANDARD_OBJ.lightbox_short_id=LIGHTBOX_SHORT_ID,STANDARD_OBJ.lightbox_name=LIGHTBOX_NAME,STANDARD_OBJ.variation_id=VARIATION_GUID,STANDARD_OBJ.variation_guid=VARIATION_GUID,STANDARD_OBJ.variation_short_id=VARIATION_SHORT_ID,STANDARD_OBJ.variation_name=VARIATION_NAME,STANDARD_OBJ.ab_test_id=AB_TEST_GUID,STANDARD_OBJ.ab_test_guid=AB_TEST_GUID,STANDARD_OBJ.ab_test_short_id=AB_TEST_SHORT_ID,STANDARD_OBJ.ab_test_name=AB_TEST_NAME,STANDARD_OBJ.lightbox_or_variation_id=LIGHTBOX_OR_VARIATION_GUID,STANDARD_OBJ.lightbox_or_variation_guid=LIGHTBOX_OR_VARIATION_GUID,STANDARD_OBJ.lightbox_or_variation_short_id=IS_VARIATION?VARIATION_SHORT_ID:LIGHTBOX_SHORT_ID,STANDARD_OBJ.lightbox_or_variation_name=IS_VARIATION?VARIATION_NAME:LIGHTBOX_NAME,STANDARD_OBJ.is_desktop=IS_DESKTOP,STANDARD_OBJ.is_phone=IS_PHONE,STANDARD_OBJ.is_tablet=IS_TABLET,STANDARD_OBJ.is_mobile=IS_MOBILE,registerParentToBoxComm();var cjsRes=BOX_CUSTOM_JS.runCustomJsBeforeDOMReady();"boolean"==typeof cjsRes&&!1===cjsRes?sendMessageToParent({sender:"lightbox",parent_action:"terminate_lightbox",lightbox_id:LIGHTBOX_OR_VARIATION_GUID}):(onScriptsLoaded(),$(document).ready((function(){afterDomLoaded()})),checkDocumentReadyState())}function getEffectsProp(path){try{var eSettings=path.split("."),val="",effects=DAPI.GET_EFFECTS(LIGHTBOX_OR_VARIATION_GUID);return null==effects||null==effects?"":(8==eSettings.length?val=effects[eSettings[1]][eSettings[2]][eSettings[3]][eSettings[4]][eSettings[5]][eSettings[6]][eSettings[7]]:7==eSettings.length?val=effects[eSettings[1]][eSettings[2]][eSettings[3]][eSettings[4]][eSettings[5]][eSettings[6]]:6==eSettings.length?val=effects[eSettings[1]][eSettings[2]][eSettings[3]][eSettings[4]][eSettings[5]]:5==eSettings.length?val=effects[eSettings[1]][eSettings[2]][eSettings[3]][eSettings[4]]:4==eSettings.length?val=effects[eSettings[1]][eSettings[2]][eSettings[3]]:3==eSettings.length?val=effects[eSettings[1]][eSettings[2]]:2==eSettings.length&&(val=effects[eSettings[1]]),null==val||null==val?"":val)}catch(e){return""}}function existsEffectsProp(path){try{var eSettings=path.split("."),val="",effects=DAPI.GET_EFFECTS(LIGHTBOX_OR_VARIATION_GUID);return null==effects||null==effects?"":(8==eSettings.length?val=effects[eSettings[1]][eSettings[2]][eSettings[3]][eSettings[4]][eSettings[5]][eSettings[6]].hasOwnProperty(eSettings[7]):7==eSettings.length?val=effects[eSettings[1]][eSettings[2]][eSettings[3]][eSettings[4]][eSettings[5]].hasOwnProperty(eSettings[6]):6==eSettings.length?val=effects[eSettings[1]][eSettings[2]][eSettings[3]][eSettings[4]].hasOwnProperty(eSettings[5]):5==eSettings.length?val=effects[eSettings[1]][eSettings[2]][eSettings[3]].hasOwnProperty(eSettings[4]):4==eSettings.length?val=effects[eSettings[1]][eSettings[2]].hasOwnProperty(eSettings[3]):3==eSettings.length?val=effects[eSettings[1]].hasOwnProperty(eSettings[2]):2==eSettings.length&&(val=effects.hasOwnProperty(eSettings[1])),val)}catch(e){return BOX_CUSTOM_JS.logError(e,"existsEffectsProp("+path+")"),!1}}function registerParentToBoxComm(){try{if(DAPI)return DAPI.hasOwnProperty("BOXCOMM")||(DAPI.BOXCOMM={}),DAPI.BOXCOMM.hasOwnProperty(LIGHTBOX_SHORT_ID.toString())||(DAPI.BOXCOMM[LIGHTBOX_SHORT_ID.toString()]={hasAfterDomReadyJsFinished:hasAfterDomReadyJsFinished,applyBreakpoint:function(obj){onPixelVersionChange(obj.page),onResponsiveDimensionChange(obj)},runCustomJsBeforeDisplay:function(obj){return BOX_CUSTOM_JS.runCustomJsBeforeDisplay()}}),!0;setTimeout(registerParentToBoxComm,50)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"registerParentToBoxComm")}}function onResponsiveDimensionChange(obj){try{var pref="";if(CURRENT_PAGE&&"main"!==CURRENT_PAGE&&(pref=CURRENT_PAGE),IS_SETTINGS_LOADED&&IS_SCRIPTS_LOADED){if(settings.hasOwnProperty("edge_to_edge")&&settings.edge_to_edge.use||settings.hasOwnProperty("responsive")&&settings.responsive.use){var width=obj.width,height=obj.height;CURRENT_WIDTH=width,CURRENT_HEIGHT=height;var origBoxWidth=700,origBoxHeight=500;settings.hasOwnProperty(pref+"layout")&&settings[pref+"layout"].hasOwnProperty("width")&&settings[pref+"layout"].hasOwnProperty("height")?(origBoxWidth=settings[pref+"layout"].width,origBoxHeight=settings[pref+"layout"].height):(origBoxWidth=settings.layout.width,origBoxHeight=settings.layout.height);var newBoxWidth=obj.width,newBoxHeight=obj.height;newBoxWidth=obj.width,newBoxHeight=origBoxHeight,"none"===settings[pref+"layout"].border.style||"0"===settings[pref+"layout"].border.width||0===settings[pref+"layout"].border.width||(newBoxWidth-=2*settings[pref+"layout"].border.width,newBoxHeight-=2*settings[pref+"layout"].border.width);$("#"+pref+"layout").width(newBoxWidth),$("#"+pref+"layout").height(newBoxHeight);for(var j=0;j<=4;j++){var ele_type="";0===j&&(ele_type="html"),1===j&&(ele_type="text"),2===j&&(ele_type="button"),3===j&&(ele_type="image"),4===j&&(ele_type="form");for(var idx=1;idx<=50;idx++){var i=idx;if("form"===ele_type){if(idx<50)continue;i="",""!==pref&&(pref+="_")}if(settings.hasOwnProperty(pref+ele_type+i)&&settings[pref+ele_type+i].display){var origElementWidth=settings[pref+ele_type+i].width,origElementHeight=settings[pref+ele_type+i].height,origElementLeft=settings[pref+ele_type+i].x,origElementTop=settings[pref+ele_type+i].y,newElementWidth=origElementWidth,newElementHeight=origElementHeight,newElementLeft=getNewElementLeft(origElementLeft,origElementWidth,newElementWidth,origBoxWidth,newBoxWidth),newElementTop=getNewElementTop(origElementTop,origElementHeight,newElementHeight,origBoxHeight,newBoxHeight);$("#"+pref+ele_type+i+"_wrapper").css({left:newElementLeft+"px",top:newElementTop+"px",width:newElementWidth+"px",height:newElementHeight+"px"})}}}}}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"onResponsiveDimensionChange")}}function getNewElementLeft(origElementLeft,origElementWidth,newElementWidth,origBoxWidth,newBoxWidth){var contentAlignmentX=settings.edge_to_edge?.content_alignment_x??settings.responsive?.content_alignment_x??"center",newElementLeft=origElementLeft;if("left"===contentAlignmentX)newElementLeft=origElementLeft;else if("center"===contentAlignmentX){var diffBoxWidth=newBoxWidth-origBoxWidth,diffElementWidth=newElementWidth-origElementWidth;newElementLeft=Math.round(origElementLeft+.5*diffBoxWidth-.5*diffElementWidth)}else"right"===contentAlignmentX&&(newElementLeft=newBoxWidth-(origBoxWidth-origElementWidth-origElementLeft)-newElementWidth);return newElementLeft}function getNewElementTop(origElementTop,origElementHeight,newElementHeight,origBoxHeight,newBoxHeight){var contentAlignmentY=settings.edge_to_edge?.content_alignment_y??settings.responsive?.content_alignment_y??"top",newElementTop=origElementTop;if("top"===contentAlignmentY)newElementTop=origElementTop;else if("center"===contentAlignmentY){var diffBoxHeight=newBoxHeight-origBoxHeight,diffElementHeight=newElementHeight-origElementHeight;newElementTop=Math.round(origElementTop+.5*diffBoxHeight-.5*diffElementHeight)}else"bottom"===contentAlignmentY&&(newElementTop=newBoxHeight-(origBoxHeight-origElementHeight-origElementTop)-newElementHeight);return newElementTop}function sendMessageToParent(obj){try{LBOX.receiveMessageFromIframe(obj,LIGHTBOX_OR_VARIATION_GUID)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"sendMessageToParent")}}function receiveMessageFromParent(obj){if(!obj||"main.js"!==obj.sender&&"box-iframe-init.js"!==obj.sender||"load vars"!==obj.message||(DIGIOH_CACHE_VERSION=obj.CACHE_VERSION,PROTOCOL_USER_OVERRIDE=obj.PROTOCOL_USER_OVERRIDE,PROTOCOL=obj.PROTOCOL,WIDGET_TYPE=obj.WIDGET_TYPE,PARENT_URL=obj.PARENT_URL,FULL_URL=obj.FULL_URL,IS_PRODUCTION=obj.IS_PRODUCTION,IS_PREVIEW=obj.IS_PREVIEW,IS_QA=obj.IS_QA,SHOW_ERRORS=obj.SHOW_ERRORS,IS_IE_9_OR_LESS=obj.IS_IE_9_OR_LESS,VENDOR_GUID=obj.VENDOR_GUID,VENDOR_SHORT_ID=obj.VENDOR_SHORT_ID,CLIENT_GUID=obj.CLIENT_GUID,LIGHTBOX_GUID=obj.LIGHTBOX_GUID,LIGHTBOX_SHORT_ID=obj.LIGHTBOX_SHORT_ID,LIGHTBOX_NAME=obj.LIGHTBOX_NAME,VARIATION_GUID=obj.VARIATION_GUID,VARIATION_SHORT_ID=obj.VARIATION_SHORT_ID,VARIATION_NAME=obj.VARIATION_NAME,IS_VARIATION=obj.IS_VARIATION,AB_TEST_GUID=obj.AB_TEST_GUID,AB_TEST_SHORT_ID=obj.AB_TEST_SHORT_ID,AB_TEST_NAME=obj.AB_TEST_NAME,IS_DESKTOP=obj.IS_DESKTOP,IS_PHONE=obj.IS_PHONE,IS_TABLET=obj.IS_TABLET,IS_MOBILE=obj.IS_MOBILE,DIGIOH_USE_RESPONSIVE=obj.DIGIOH_USE_RESPONSIVE,DIGIOH_USE_BUGSNAG=obj.DIGIOH_USE_BUGSNAG,DIGIOH_USE_PRQ=obj.DIGIOH_USE_PRQ,loadUserScript("custom_box.js",DAPI.CONFIG.CACHE_VALUES.custom_box).then(checkJqLoaded),logger("(BOX #"+window.LIGHTBOX_SHORT_ID+") - Initialized with data from main.js")),obj&&obj.hasOwnProperty("message")&&logger("(BOX #"+LIGHTBOX_SHORT_ID+") - receiveMessageFromParent: "+obj.message),obj&&obj.hasOwnProperty("sender")&&"lightbox"===obj.sender&&obj.hasOwnProperty("action"))if("dimensions_changed"===obj.action)IS_SCRIPTS_LOADED?onResponsiveDimensionChange(obj):setTimeout((function(){onResponsiveDimensionChange(obj)}),100);else if("pixel_version_changed"===obj.action){var pg="";obj.hasOwnProperty("page")&&(pg=obj.page),onPixelVersionChange(pg)}else if("before_lightbox_display"===obj.action);else if("after_lightbox_display"===obj.action)obj.auto_focus&&setTimeout((function(){$("#form_input_first_name").length?$("#form_input_first_name").focus():$("#form_input_full_name").length?$("#form_input_full_name").focus():$("#form_input_email").length?$("#form_input_email").focus():$("#form_input_phone").length&&$("#form_input_phone").focus()}),100),runCustomJsAfterDisplayRetry();else if("after_lightbox_submit_success"===obj.action){(submitRes=postSubmissionResolution.pop())&&"function"==typeof submitRes.resolve&&submitRes.resolve(!0)}else if("after_lightbox_submit_failure"===obj.action){var submitRes;(submitRes=postSubmissionResolution.pop())&&"function"==typeof submitRes.reject&&postSubmissionResolution.reject("submission to keen server error")}else"before_lightbox_close"===obj.action?BOX_CUSTOM_JS.runCustomJsBeforeClose():"after_lightbox_close"===obj.action&&BOX_CUSTOM_JS.runCustomJsAfterClose()}function runCustomJsAfterDisplayRetry(){hasAfterDomReadyJsFinished?(BOX_CUSTOM_JS.runCustomJsAfterDisplay(),DIGIOH_PRQ.USE&&DIGIOH_PRQ.isBoxPRQ()&&DIGIOH_PRQ.tryShowPreservedResultsPage()):setTimeout(runCustomJsAfterDisplayRetry,50)}function runCustomJsLinkedApps(trigger){if(null!=CJSAPPS_BOXES&&null!=CJSAPPS_ARR&&CJSAPPS_ARR.length>0){for(var i=0;i<CJSAPPS_ARR.length;i++){var appId=CJSAPPS_ARR[i];if(CJSAPPS_BOXES.hasOwnProperty(appId)&&CJSAPPS_BOXES[appId].hasOwnProperty(trigger)){var res=!1;if(res="Before DOM Ready"==trigger?CJSAPPS_BOXES[appId][trigger](DAPI,STANDARD_OBJ):CJSAPPS_BOXES[appId][trigger](DAPI,STANDARD_OBJ,x),logger("CJSAPPS_BOXES: "+appId+", "+trigger),logger(res),!1===res)return!1}}return!0}}function sendMessageToIframe(obj,lid_target){LBOX.relayMessageToIframe(obj,LIGHTBOX_OR_VARIATION_GUID,lid_target)}function receiveMessageFromIframe(obj,lid_source,lid_target){obj&&obj.hasOwnProperty("message")&&logger("(BOX #"+LIGHTBOX_SHORT_ID+") -"+obj.message)}function onPixelVersionChange(page){tryInitScripts(),clearSettings(),applySettings(!1,page,!0)}function tryInitScripts(){LBOX.PixelThresholdSettings&&LBOX.PixelThresholdSettings.hasOwnProperty(LIGHTBOX_OR_VARIATION_GUID)&&"object"==typeof LBOX.PixelThresholdSettings[LIGHTBOX_OR_VARIATION_GUID]?(settings=LBOX.PixelThresholdSettings[LIGHTBOX_OR_VARIATION_GUID],IS_SETTINGS_LOADED=!0):DAPI.DIGIOH_LIGHTBOX_SETTINGS&&DAPI.DIGIOH_LIGHTBOX_SETTINGS.hasOwnProperty(LIGHTBOX_OR_VARIATION_GUID)&&LBOX.LZString?("object"==typeof DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID]&&null!==DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID]?settings=DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID]:"string"==typeof DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID]&&DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID].length>50&&DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID].indexOf("{")<0?settings=JSON.parse(LBOX.LZString.decompressFromBase64(DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID])):"string"==typeof DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID]&&DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID].length>50&&DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID].indexOf("{")>=0&&(settings=JSON.parse(DAPI.DIGIOH_LIGHTBOX_SETTINGS[LIGHTBOX_OR_VARIATION_GUID])),IS_SETTINGS_LOADED=!0):setTimeout(tryInitScripts,200)}function tryApplySettings(){IS_SETTINGS_LOADED&&IS_SCRIPTS_LOADED?applySettings(!0,""):setTimeout(tryApplySettings,100)}function clearSettings(){if($("#layout").length&&$("#layout").empty(),$("#thxlayout").length&&$("#thxlayout").empty(),$("#ep1layout").length&&$("#ep1layout").empty(),$("#ep2layout").length&&$("#ep2layout").empty(),$("#ep3layout").length&&$("#ep3layout").empty(),$("#ep4layout").length&&$("#ep4layout").empty(),settings.hasOwnProperty("extra_pages")&&settings.extra_pages)for(var x=1;x<=settings.extra_pages.length;x++)settings.extra_pages[x-1]&&1==settings.extra_pages[x-1].on&&$("#ep"+x+"layout").length&&$("#ep"+x+"layout").empty()}function getFormMergeTagsFromString(str){try{var tags=[],mergeParts=str.split("[FORM_");if(mergeParts.length>1)for(var j=1;j<mergeParts.length;j++)UTIL.stringOrArrayContains(mergeParts[j],"]")&&tags.push("[FORM_"+mergeParts[j].split("]")[0]+"]");return tags}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"getFormMergeTagsFromString")}return[]}function getFormMergeTagReplacementValue(mergeTag){try{var ls=LBOX.DIGIOH_LOCAL_STORAGE.getManual("fsdbx"),localStorageVal="",fallback="";(mergeTag=mergeTag.replace("[","").replace("]","")).indexOf("{BOXID}")>0&&(mergeTag=mergeTag.split("{BOXID}").join(LIGHTBOX_SHORT_ID.toString())),mergeTag.indexOf("_{FALLBACK}")>0&&(mergeTag=mergeTag.split("_{FALLBACK}").join(""));var mergeTagParts=mergeTag.split("_");if(mergeTagParts.length>=3){if("object"==typeof ls&&null!==ls&&"GLOBAL"===mergeTagParts[1]?localStorageVal="FIRST"===mergeTagParts[2]&&mergeTagParts.length>3&&"NAME"===mergeTagParts[3]?ls.hasOwnProperty("first_name")?ls.first_name:"":"LAST"===mergeTagParts[2]&&mergeTagParts.length>3&&"NAME"===mergeTagParts[3]?ls.hasOwnProperty("last_name")?ls.last_name:"":"OPT"===mergeTagParts[2]&&mergeTagParts.length>3&&"IN"===mergeTagParts[3]?ls.hasOwnProperty("opt_in")?ls.opt_in:"":"CUSTOM"===mergeTagParts[2]&&mergeTagParts.length>3?ls.hasOwnProperty("custom_"+mergeTagParts[3])?ls["custom_"+mergeTagParts[3]]:"":ls.hasOwnProperty(mergeTagParts[2].toLowerCase())?ls[mergeTagParts[2].toLowerCase()]:"":"object"==typeof ls&&null!==ls&&ls.hasOwnProperty(mergeTagParts[1])&&"object"==typeof ls[mergeTagParts[1]]&&null!==ls[mergeTagParts[1]]&&(localStorageVal="FIRST"===mergeTagParts[2]&&mergeTagParts.length>3&&"NAME"===mergeTagParts[3]?ls[mergeTagParts[1]].hasOwnProperty("first_name")?ls[mergeTagParts[1]].first_name:"":"LAST"===mergeTagParts[2]&&mergeTagParts.length>3&&"NAME"===mergeTagParts[3]?ls[mergeTagParts[1]].hasOwnProperty("last_name")?ls[mergeTagParts[1]].last_name:"":"OPT"===mergeTagParts[2]&&mergeTagParts.length>3&&"IN"===mergeTagParts[3]?ls[mergeTagParts[1]].hasOwnProperty("opt_in")?ls[mergeTagParts[1]].opt_in:"":"CUSTOM"===mergeTagParts[2]&&mergeTagParts.length>3?ls[mergeTagParts[1]].hasOwnProperty("custom_"+mergeTagParts[3])?ls[mergeTagParts[1]]["custom_"+mergeTagParts[3]]:"":ls[mergeTagParts[1]].hasOwnProperty(mergeTagParts[2].toLowerCase())?ls[mergeTagParts[1]][mergeTagParts[2].toLowerCase()]:""),mergeTagParts.length>4&&(mergeTag.indexOf("_FIRST_NAME")>0||mergeTag.indexOf("_LAST_NAME")>0||mergeTag.indexOf("_OPT_IN")>0||mergeTag.indexOf("_CUSTOM_")>0))for(var k=4;k<mergeTagParts.length;k++)fallback+=mergeTagParts[k]+"_";else if(mergeTagParts.length>3&&(mergeTag.indexOf("_EMAIL")>0||mergeTag.indexOf("_PHONE")>0||mergeTag.indexOf("_NAME")>0)&&-1===mergeTag.indexOf("_FIRST_NAME")&&-1===mergeTag.indexOf("_LAST_NAME"))for(k=3;k<mergeTagParts.length;k++)fallback+=mergeTagParts[k]+"_";return fallback.length>0&&(fallback=fallback.substr(0,fallback.length-1)),[localStorageVal,fallback]}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"getFormMergeTagReplacementValue")}return[]}function replaceSettingsObjFormMergeTags(settingsProp,pref){try{for(var keys=Object.keys(settingsProp),i=0;i<keys.length;i++)if("object"==typeof settingsProp[keys[i]]&&(""===pref&&0!==keys[i].indexOf("thx")&&0!==keys[i].indexOf("ep")||""!==pref&&0===keys[i].indexOf(pref)))replaceSettingsObjFormMergeTags(settingsProp[keys[i]],pref);else if("string"==typeof settingsProp[keys[i]]&&settingsProp[keys[i]].indexOf("[FORM_")>=0&&(""===pref&&0!==keys[i].indexOf("thx")&&0!==keys[i].indexOf("ep")||""!==pref&&0===keys[i].indexOf(pref)))for(var tags=getFormMergeTagsFromString(settingsProp[keys[i]]),j=0;j<tags.length;j++){var mergeTag=tags[j],replacementValues=getFormMergeTagReplacementValue(mergeTag);if(2===replacementValues.length){var localStorageVal=replacementValues[0],fallback=replacementValues[1];settingsProp[keys[i]]=""!==localStorageVal?settingsProp[keys[i]].split(mergeTag).join(localStorageVal):""!==fallback?settingsProp[keys[i]].split(mergeTag).join(fallback):settingsProp[keys[i]].split(mergeTag).join("")}}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"replaceSettingsObjFormMergeTags")}}function replaceSettingsObjFormMergeTagsAfterChangePages(pref){try{$("#"+pref+'layout div:contains("[FORM_"), #'+pref+'layout span:contains("[FORM_"), #'+pref+'layout p:contains("[FORM_"),#'+pref+'layout button:contains("[FORM_")').each((function(){if($(this).children().length<1||$(this).children("a").length+$(this).children("br").length===$(this).children().length||$(this).children().length<2&&0===$(this).find("a").length&&0===$(this).find("button").length&&$(this).find("*").length<2)for(var tags=getFormMergeTagsFromString($(this).html()),i=0;i<tags.length;i++){var replacementValues=getFormMergeTagReplacementValue(tags[i]);if(2===replacementValues.length){var localStorageVal=replacementValues[0],fallback=replacementValues[1];""!==localStorageVal?$(this).html($(this).html().split(tags[i]).join(localStorageVal)):""!==fallback?$(this).html($(this).html().split(tags[i]).join(fallback)):$(this).html($(this).html().split(tags[i]).join(""))}}})),$("#"+pref+"layout img").each((function(){if($(this).attr("src")&&UTIL.stringOrArrayContains($(this).attr("src"),"[FORM_"))for(var tags=getFormMergeTagsFromString($(this).attr("src")),i=0;i<tags.length;i++){var replacementValues=getFormMergeTagReplacementValue(tags[i]);if(2===replacementValues.length){var localStorageVal=replacementValues[0],fallback=replacementValues[1];""!==localStorageVal?$(this).attr("src",$(this).attr("src").split(tags[i]).join(localStorageVal)):""!==fallback?$(this).attr("src",$(this).attr("src").split(tags[i]).join(fallback)):$(this).attr("src",$(this).attr("src").split(tags[i]).join(""))}}})),$("#"+pref+"layout input, #"+pref+"layout textarea,#"+pref+"layout select option").each((function(){if($(this).val()&&UTIL.stringOrArrayContains($(this).val(),"[FORM_"))for(var tags=getFormMergeTagsFromString($(this).val()),i=0;i<tags.length;i++){if(2===(replacementValues=getFormMergeTagReplacementValue(tags[i])).length){var localStorageVal=replacementValues[0],fallback=replacementValues[1];""!==localStorageVal?$(this).val($(this).val().split(tags[i]).join(localStorageVal)):""!==fallback?$(this).val($(this).val().split(tags[i]).join(fallback)):$(this).val($(this).val().split(tags[i]).join(""))}}if("string"==typeof $(this).attr("placeholder")&&UTIL.stringOrArrayContains($(this).attr("placeholder"),"[FORM_"))for(tags=getFormMergeTagsFromString($(this).attr("placeholder")),i=0;i<tags.length;i++){if(2===(replacementValues=getFormMergeTagReplacementValue(tags[i])).length){localStorageVal=replacementValues[0],fallback=replacementValues[1];""!==localStorageVal?$(this).attr("placeholder",$(this).attr("placeholder").split(tags[i]).join(localStorageVal)):""!==fallback?$(this).attr("placeholder",$(this).attr("placeholder").split(tags[i]).join(fallback)):$(this).attr("placeholder",$(this).attr("placeholder").split(tags[i]).join(""))}}if("string"==typeof $(this).text()&&UTIL.stringOrArrayContains($(this).text(),"[FORM_"))for(tags=getFormMergeTagsFromString($(this).text()),i=0;i<tags.length;i++){var replacementValues;if(2===(replacementValues=getFormMergeTagReplacementValue(tags[i])).length){localStorageVal=replacementValues[0],fallback=replacementValues[1];""!==localStorageVal?$(this).text($(this).text().split(tags[i]).join(localStorageVal)):""!==fallback?$(this).text($(this).text().split(tags[i]).join(fallback)):$(this).text($(this).text().split(tags[i]).join(""))}}})),replaceSettingsObjFormMergeTags(settings,pref)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"replaceSettingsObjFormMergeTagsAfterChangePages")}}function applySettings(is_first_render,page,is_pixel_version){try{if("string"==typeof settings&&settings.length>50&&settings.indexOf("{")<0&&(settings=JSON.parse(LBOX.LZString.decompressFromBase64(settings))),is_first_render)for(var f=1;f<=customFieldsLimit;f++)if(form_input_obj["pref_form_input_custom"+f]=!1,form_input_obj["form_input_custom"+f]=!1,form_input_obj["thx_form_input_custom"+f]=!1,form_input_obj["ep1_form_input_custom"+f]=!1,form_input_obj["ep2_form_input_custom"+f]=!1,form_input_obj["ep3_form_input_custom"+f]=!1,form_input_obj["ep4_form_input_custom"+f]=!1,settings.hasOwnProperty("extra_pages")&&settings.extra_pages)for(var j=5;j<=settings.extra_pages.length;j++)settings.extra_pages[j-1]&&1===settings.extra_pages[j-1].on&&(form_input_obj["ep"+j+"_form_input_custom"+f]=!1);for(var x=1,y=1;y<=102;y++){var pr="";if(1===y)pr="";else if(2===y)pr="thx";else if(y>=3&&y<=6)pr="ep"+(y-2);else if(y>=7){if(!settings.hasOwnProperty("extra_pages")||settings.extra_pages.length<=y-3||!settings.extra_pages[y-3]||1!==settings.extra_pages[y-3].on)continue;pr="ep"+(y-2)}if(""!==pr&&!$("#"+pr+"layout").length&&($("#layout").after("<div id='"+pr+"layout' style='display: none;'></div>"),settings.hasOwnProperty(pr+"layout")&&settings[pr+"layout"].hasOwnProperty("metadata_kvps")))for(var k=0;k<settings[pr+"layout"].metadata_kvps.length;k++)settings[pr+"layout"].metadata_kvps[k].k&&settings[pr+"layout"].metadata_kvps[k].v&&UTIL.trySetAttribute(pr+"layout",settings[pr+"layout"].metadata_kvps[k],$);for(x=1;x<=50;x++)settings.hasOwnProperty(pr+"text"+x)&&settings[pr+"text"+x].display||x<=4?$("#"+pr+"layout").append("<div id='"+pr+"text"+x+"_wrapper'><div id='"+pr+"text"+x+"'></div></div>"):x<=4&&$("#"+pr+"layout").append("<div id='"+pr+"text"+x+"_wrapper' style='display:none;'><div id='"+pr+"text"+x+"'></div></div>");for(""===pr?$("#"+pr+"layout").append("<div id='form_wrapper'><div id='form'></div></div>"):$("#"+pr+"layout").append("<div id='"+pr+"_form_wrapper'><div id='"+pr+"_form'></div></div>"),x=1;x<=50;x++)settings.hasOwnProperty(pr+"button"+x)&&settings[pr+"button"+x].display?$("#"+pr+"layout").append("<div id='"+pr+"button"+x+"_wrapper'><button id='"+pr+"button"+x+"' class='"+pr+"button"+x+"'></button></div>"):x<=4&&$("#"+pr+"layout").append("<div id='"+pr+"button"+x+"_wrapper' style='display:none;'><button id='"+pr+"button"+x+"' class='"+pr+"button"+x+"'></button></div>");for(x=1;x<=50;x++)settings.hasOwnProperty(pr+"image"+x)&&settings[pr+"image"+x].display?$("#"+pr+"layout").append("<div id='"+pr+"image"+x+"_wrapper'><img id='"+pr+"image"+x+"' /></div>"):x<=4&&$("#"+pr+"layout").append("<div id='"+pr+"image"+x+"_wrapper' style='display:none;'><img id='"+pr+"image"+x+"' /></div>");for(x=1;x<=50;x++)settings.hasOwnProperty(pr+"html"+x)&&settings[pr+"html"+x].display?$("#"+pr+"layout").append("<div id='"+pr+"html"+x+"_wrapper'><div id='"+pr+"html"+x+"'></div></div>"):x<=4&&$("#"+pr+"layout").append("<div id='"+pr+"html"+x+"_wrapper' style='display:none;'><div id='"+pr+"html"+x+"'></div></div>");for(x=1;x<=customFieldsLimit;x++)""!==pr||settings.hasOwnProperty("custom"+x)?""===pr||settings.hasOwnProperty(pr+"_custom"+x)||(settings[pr+"_custom"+x]={display:!1}):settings["custom"+x]={display:!1}}if(form_wrapper=$("#form_wrapper"),form=$("#form"),thx_form_wrapper=$("#thx_form_wrapper"),thx_form=$("#thx_form"),ep1_form_wrapper=$("#ep1_form_wrapper"),ep1_form=$("#ep1_form"),ep2_form_wrapper=$("#ep2_form_wrapper"),ep2_form=$("#ep2_form"),ep3_form_wrapper=$("#ep3_form_wrapper"),ep3_form=$("#ep3_form"),ep4_form_wrapper=$("#ep4_form_wrapper"),ep4_form=$("#ep4_form"),CURRENT_WIDTH=settings.layout.width,CURRENT_HEIGHT=settings.layout.height,determineGoogleFonts(),loadExternalFonts(""),replaceSettingsObjFormMergeTags(settings,""),buildStyles(page,is_pixel_version),buildText(),buildForm(),buildButtons(),buildImages(),loadImages(page,is_pixel_version),buildHTML(),buildDynamicItems(),buildCouponsDisplay(),replaceHrefMergeTags(),replaceBrMergeTags(),is_first_render){if(DIGIOH_PRQ.init(),preloadImages(),"object"==typeof html_ele.classList&&null!==html_ele.classList&&html_ele.classList.remove("hidden_until_loaded"),$("input").focus((function(){sendMessageToParent({sender:"lightbox",event:"input_focus",lightbox_id:LIGHTBOX_OR_VARIATION_GUID})})),""===pr&&$("#layout").length&&settings.layout.hasOwnProperty("metadata_kvps"))for(k=0;k<settings.layout.metadata_kvps.length;k++)settings.layout.metadata_kvps[k].k&&settings.layout.metadata_kvps[k].v&&UTIL.trySetAttribute("layout",settings.layout.metadata_kvps[k],$);var effects=DAPI.GET_EFFECTS(LIGHTBOX_OR_VARIATION_GUID);if("object"==typeof effects&&null!==effects&&effects.hasOwnProperty("widget_type")&&"string"==typeof effects.widget_type&&effects.hasOwnProperty(effects.widget_type)&&effects[effects.widget_type].hasOwnProperty("metadata_kvps")){var kvps=effects[effects.widget_type].metadata_kvps;for(k=0;k<kvps.length;k++)kvps[k].k&&kvps[k].v&&UTIL.trySetAttribute("body",kvps[k],$)}sendMessageToParent({sender:"lightbox",status:"child_messaging_ready",lightbox_id:LIGHTBOX_OR_VARIATION_GUID}),sendMessageToParent({sender:"lightbox",loading_status:"settings_applied",lightbox_id:LIGHTBOX_OR_VARIATION_GUID,widget_type:WIDGET_TYPE})}else page&&(page.indexOf("_")<0&&(page+="_"),changePages(page,page+"form",settings[page+"form"],"form"));BOX_CUSTOM_JS.runCustomJsAfterDOMReady(),hasAfterDomReadyJsFinished=!0,DAPI.BOXCOMM[LIGHTBOX_SHORT_ID.toString()].hasAfterDomReadyJsFinished=!0}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"applySettings")}}function preloadImages(){try{var preload=boxapi.getWidgetMetadata("box_preload_images");if(preload&&("true"==preload||"1"==preload||"yes"==preload))for(var pr="",j=1;j<=102;j++){if(1==j)pr="";else if(2==j)pr="thx";else if(j>=3&&(pr="ep"+(j-2),!settings.hasOwnProperty("extra_pages")||settings.extra_pages.length<=j-3||!settings.extra_pages[j-3]||1!==settings.extra_pages[j-3].on))continue;var imgStr="||||";if(settings.hasOwnProperty(pr+"layout")&&settings[pr+"layout"].hasOwnProperty("background")&&settings[pr+"layout"].background.use_image&&settings[pr+"layout"].background.image.length>20&&imgStr.indexOf("||||"+settings[pr+"layout"].background.image+"||||")<0){var imgSrc=buildAssetUrl(settings[pr+"layout"].background.image);$("body").append("<img src='"+imgSrc+"' style='display: none;'>"),imgStr+=imgSrc+"||||",logger("(BOX #"+LIGHTBOX_SHORT_ID+") - preloadImages: "+pr+"layout, "+imgSrc)}for(var x=1;x<=50;x++){if(settings.hasOwnProperty(pr+"button"+x)&&settings[pr+"button"+x].display){if(settings[pr+"button"+x].hasOwnProperty("background")&&settings[pr+"button"+x].background.use_image&&settings[pr+"button"+x].background.image.length>20&&imgStr.indexOf("||||"+settings[pr+"button"+x].background.image+"||||")<0){imgSrc=buildAssetUrl(settings[pr+"button"+x].background.image);$("body").append("<img src='"+imgSrc+"' style='display: none;'>"),imgStr+=imgSrc+"||||",logger("(BOX #"+LIGHTBOX_SHORT_ID+") - preloadImages: "+pr+"button"+x+", "+imgSrc)}if(settings[pr+"button"+x].hasOwnProperty("background_hover")&&settings[pr+"button"+x].background_hover.use_image&&settings[pr+"button"+x].background_hover.image.length>20&&imgStr.indexOf("||||"+settings[pr+"button"+x].background_hover.image+"||||")<0){imgSrc=buildAssetUrl(settings[pr+"button"+x].background_hover.image);$("body").append("<img src='"+imgSrc+"' style='display: none;'>"),imgStr+=imgSrc+"||||",logger("(BOX #"+LIGHTBOX_SHORT_ID+") - preloadImages: "+pr+"button"+x+", "+imgSrc)}if(settings[pr+"button"+x].hasOwnProperty("background_focus")&&settings[pr+"button"+x].background_focus.use_image&&settings[pr+"button"+x].background_focus.image.length>20&&imgStr.indexOf("||||"+settings[pr+"button"+x].background_focus.image+"||||")<0){imgSrc=buildAssetUrl(settings[pr+"button"+x].background_focus.image);$("body").append("<img src='"+imgSrc+"' style='display: none;'>"),imgStr+=imgSrc+"||||",logger("(BOX #"+LIGHTBOX_SHORT_ID+") - preloadImages: "+pr+"button"+x+", "+imgSrc)}if(settings[pr+"button"+x].hasOwnProperty("background_focus_hover")&&settings[pr+"button"+x].background_focus_hover.use_image&&settings[pr+"button"+x].background_focus_hover.image.length>20&&imgStr.indexOf("||||"+settings[pr+"button"+x].background_focus_hover.image+"||||")<0){imgSrc=buildAssetUrl(settings[pr+"button"+x].background_focus_hover.image);$("body").append("<img src='"+imgSrc+"' style='display: none;'>"),imgStr+=imgSrc+"||||",logger("(BOX #"+LIGHTBOX_SHORT_ID+") - preloadImages: "+pr+"button"+x+", "+imgSrc)}}if(settings.hasOwnProperty(pr+"image"+x)&&settings[pr+"image"+x].display&&settings[pr+"image"+x].src.length>20&&imgStr.indexOf("||||"+settings[pr+"image"+x].src+"||||")<0){imgSrc=buildAssetUrl(settings[pr+"image"+x].src);$("body").append("<img src='"+imgSrc+"' style='display: none;'>"),imgStr+=imgSrc+"||||",logger("(BOX #"+LIGHTBOX_SHORT_ID+") - preloadImages: "+pr+"image"+x+", "+imgSrc)}}}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"preloadImages")}}function buildDynamicItems(){try{if(DAPI.DIGIOH_DYNAMIC_BOXES)for(var i=0;i<DAPI.DIGIOH_DYNAMIC_BOXES.length;i++)if(DAPI.DIGIOH_DYNAMIC_BOXES[i].BoxID===LIGHTBOX_SHORT_ID){var item=DAPI.DIGIOH_DYNAMIC_BOXES[i];if("jquery"===item.SourceType)if(LBOX.JQUERY_DIGIOH(item.SourceSelector).length){var sourceValFound="[DTMP]";item.hasOwnProperty("JqueryMethod")&&item.hasOwnProperty("JqueryMethodParam")&&item.JqueryMethodParam&&("attr"===item.JqueryMethod?sourceValFound=LBOX.JQUERY_DIGIOH(item.SourceSelector).attr(item.JqueryMethodParam):"prop"===item.JqueryMethod?sourceValFound=LBOX.JQUERY_DIGIOH(item.SourceSelector).prop(item.JqueryMethodParam):"is"===item.JqueryMethod?sourceValFound=LBOX.JQUERY_DIGIOH(item.SourceSelector).is(item.JqueryMethodParam):"css"===item.JqueryMethod?sourceValFound=LBOX.JQUERY_DIGIOH(item.SourceSelector).css(item.JqueryMethodParam):"hasClass"===item.JqueryMethod&&(sourceValFound=LBOX.JQUERY_DIGIOH(item.SourceSelector).hasClass(item.JqueryMethodParam))),item.hasOwnProperty("JqueryMethod")&&("text"===item.JqueryMethod?sourceValFound=LBOX.JQUERY_DIGIOH(item.SourceSelector).text():"val"===item.JqueryMethod?sourceValFound=LBOX.JQUERY_DIGIOH(item.SourceSelector).val():"length"===item.JqueryMethod&&(sourceValFound=LBOX.JQUERY_DIGIOH(item.SourceSelector).length.toString())),"[DTMP]"===sourceValFound&&(sourceValFound=LBOX.JQUERY_DIGIOH(item.SourceSelector).html()),runDynamicSourceComparison(item,sourceValFound)}else""!==item.TargetDefault&&replaceDynamicTarget(item,item.TargetDefault);else if("url"===item.SourceType){"string"!=typeof(sourceValFound=(DAPI.DIGIOH_USE_FRAME_COMPATIBILITY?DAPI.DIGIOH_TOP_WINDOW_CONTEXT:window.parent).location.href)&&(sourceValFound=""),runDynamicSourceComparison(item,sourceValFound)}else if("url_param"===item.SourceType){"string"!=typeof(sourceValFound=DAPI.UTIL.getUrlParam(item.SourceSelector))&&(sourceValFound=""),runDynamicSourceComparison(item,sourceValFound)}}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"buildDynamicItems")}}function runDynamicSourceComparison(item,sourceValFound){try{if("[ANYTHING]"===item.SourceValue)replaceDynamicTarget(item,sourceValFound,item.TargetDefault);else if("string"==typeof sourceValFound){var compareVal1=sourceValFound,compareVal2=item.SourceValue;item.CaseSensitive||(compareVal1=compareVal1.toLowerCase(),compareVal2=compareVal2.toLowerCase());var compareValArr=[];if(UTIL.stringOrArrayContains(compareVal2,",")||UTIL.stringOrArrayContains(compareVal2,"|")?compareValArr=compareVal2.split(",").length>compareVal2.split("|").length?compareVal2.split(","):compareVal2.split("|"):compareValArr.push(compareVal2),"equals"===item.SourceOperator||"contains"===item.SourceOperator||"starts_with"===item.SourceOperator||"ends_with"===item.SourceOperator){for(var foundMatch=!1,i=0;i<compareValArr.length;i++)if(""!==compareValArr[i].trim()){if("equals"===item.SourceOperator&&compareVal1===compareValArr[i].trim()){replaceDynamicTarget(item,sourceValFound,item.TargetDefault),foundMatch=!0;break}if("contains"===item.SourceOperator&&compareVal1.indexOf(compareValArr[i].trim())>=0){replaceDynamicTarget(item,sourceValFound,item.TargetDefault),foundMatch=!0;break}if("starts_with"===item.SourceOperator&&0===compareVal1.indexOf(compareValArr[i].trim())){replaceDynamicTarget(item,sourceValFound,item.TargetDefault),foundMatch=!0;break}if("ends_with"===item.SourceOperator&&-1!==compareVal1.indexOf(compareValArr[i].trim(),compareVal1.length-compareValArr[i].trim().length)){replaceDynamicTarget(item,sourceValFound,item.TargetDefault),foundMatch=!0;break}}foundMatch||""===item.TargetDefault||replaceDynamicTarget(item,"",item.TargetDefault)}else if(0===item.SourceOperator.indexOf("not_")){for(foundMatch=!1,i=0;i<compareValArr.length;i++)if(""!==compareValArr[i].trim()){if("not_equals"===item.SourceOperator&&compareVal1===compareValArr[i].trim()){foundMatch=!0;break}if("not_contains"===item.SourceOperator&&UTIL.stringOrArrayContains(compareVal1,compareValArr[i].trim())){foundMatch=!0;break}if("not_starts_with"===item.SourceOperator&&0===compareVal1.indexOf(compareValArr[i].trim())){foundMatch=!0;break}if("not_ends_with"===item.SourceOperator&&-1!==compareVal1.indexOf(compareValArr[i].trim(),compareVal1.length-compareValArr[i].trim().length)){foundMatch=!0;break}}foundMatch||replaceDynamicTarget(item,sourceValFound,item.TargetDefault),foundMatch&&""!==item.TargetDefault&&replaceDynamicTarget(item,"",item.TargetDefault)}}else""!==item.TargetDefault&&replaceDynamicTarget(item,"",item.TargetDefault)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runDynamicSourceComparison")}}function replaceDynamicTarget(item,srcval,target_default){try{"merge"===item.TargetType?replaceDynamicTargetMerge(item,srcval,target_default):UTIL.stringOrArrayContains(item.TargetType,"_custom")?replaceDynamicTargetCustomField(item,srcval,target_default):replaceDynamicTargetElement(item,srcval,target_default)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"replaceDynamicTarget")}}function replaceDynamicTargetMerge(item,srcval,target_default){try{var val=item.TargetValue||"";if("[SOURCE]"===val&&"string"==typeof srcval&&""!==srcval?val=srcval:("[SOURCE]"!==val||"string"==typeof srcval&&""!==srcval)&&srcval&&val||(val=target_default||""),!val)return;$('div:contains("'+item.TargetMerge+'")').each((function(){($(this).children().length<1||$(this).children("a").length+$(this).children("br").length===$(this).children().length||$(this).children().length<2&&0===$(this).find("a").length&&0===$(this).find("button").length&&$(this).find("*").length<2)&&$(this).html($(this).html().split(item.TargetMerge).join(val))})),$('span:contains("'+item.TargetMerge+'")').each((function(){($(this).children().length<1||$(this).children("a").length+$(this).children("br").length===$(this).children().length)&&$(this).html($(this).html().split(item.TargetMerge).join(val))})),$('p:contains("'+item.TargetMerge+'")').each((function(){($(this).children().length<1||$(this).children("a").length+$(this).children("br").length===$(this).children().length)&&$(this).html($(this).html().split(item.TargetMerge).join(val))})),$('style:contains("'+item.TargetMerge+'")').each((function(){$(this).children().length<1&&$(this).html($(this).html().split(item.TargetMerge).join(val))})),$('button:contains("'+item.TargetMerge+'")').each((function(){$(this).children().length<1&&$(this).html($(this).html().split(item.TargetMerge).join(val))})),$("img").each((function(){$(this).attr("src")&&UTIL.stringOrArrayContains($(this).attr("src"),item.TargetMerge)&&$(this).attr("src",$(this).attr("src").split(item.TargetMerge).join(val))})),$("input,textarea").each((function(){$(this).val()&&UTIL.stringOrArrayContains($(this).val(),item.TargetMerge)&&$(this).val($(this).val().split(item.TargetMerge).join(val)),"string"==typeof $(this).attr("placeholder")&&UTIL.stringOrArrayContains($(this).attr("placeholder"),item.TargetMerge)&&$(this).attr("placeholder",$(this).attr("placeholder").split(item.TargetMerge).join(val))})),$("select option").each((function(){$(this).val()&&UTIL.stringOrArrayContains($(this).val(),item.TargetMerge)&&$(this).val($(this).val().split(item.TargetMerge).join(val)),$(this).text()&&UTIL.stringOrArrayContains($(this).text(),item.TargetMerge)&&$(this).text($(this).text().split(item.TargetMerge).join(val))}));for(var j=1;j<=102;j++){var pref="";if(1==j)pref="";else if(2==j)pref="thx_";else if(j>=3&&j<=6)pref="ep"+(j-2)+"_";else if(j>=7&&(pref="ep"+(j-2)+"_",!settings.hasOwnProperty("extra_pages")||settings.extra_pages.length<=j-3||!settings.extra_pages[j-3]||1!==settings.extra_pages[j-3].on))continue;settings.hasOwnProperty(pref+"form")&&settings[pref+"form"].redirect_url&&UTIL.stringOrArrayContains(settings[pref+"form"].redirect_url,item.TargetMerge)&&(settings[pref+"form"].redirect_url=settings[pref+"form"].redirect_url.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"name")&&settings[pref+"name"].hasOwnProperty("error_text")&&settings[pref+"name"].error_text&&UTIL.stringOrArrayContains(settings[pref+"name"].error_text,item.TargetMerge)&&(settings[pref+"name"].error_text=settings[pref+"name"].error_text.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"name")&&settings[pref+"name"].label&&UTIL.stringOrArrayContains(settings[pref+"name"].label,item.TargetMerge)&&(settings[pref+"name"].label=settings[pref+"name"].label.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"name")&&settings[pref+"name"].placeholder_full&&UTIL.stringOrArrayContains(settings[pref+"name"].placeholder_full,item.TargetMerge)&&(settings[pref+"name"].placeholder_full=settings[pref+"name"].placeholder_full.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"name")&&settings[pref+"name"].placeholder_first&&UTIL.stringOrArrayContains(settings[pref+"name"].placeholder_first,item.TargetMerge)&&(settings[pref+"name"].placeholder_first=settings[pref+"name"].placeholder_first.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"name")&&settings[pref+"name"].placeholder_last&&UTIL.stringOrArrayContains(settings[pref+"name"].placeholder_last,item.TargetMerge)&&(settings[pref+"name"].placeholder_last=settings[pref+"name"].placeholder_last.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"name")&&settings[pref+"name"].help_full&&UTIL.stringOrArrayContains(settings[pref+"name"].help_full,item.TargetMerge)&&(settings[pref+"name"].help_full=settings[pref+"name"].help_full.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"name")&&settings[pref+"name"].help_first&&UTIL.stringOrArrayContains(settings[pref+"name"].help_first,item.TargetMerge)&&(settings[pref+"name"].help_first=settings[pref+"name"].help_first.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"name")&&settings[pref+"name"].help_last&&UTIL.stringOrArrayContains(settings[pref+"name"].help_last,item.TargetMerge)&&(settings[pref+"name"].help_last=settings[pref+"name"].help_last.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"name")&&settings[pref+"name"].default_full&&UTIL.stringOrArrayContains(settings[pref+"name"].default_full,item.TargetMerge)&&(settings[pref+"name"].default_full=settings[pref+"name"].default_full.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"name")&&settings[pref+"name"].default_first&&UTIL.stringOrArrayContains(settings[pref+"name"].default_first,item.TargetMerge)&&(settings[pref+"name"].default_first=settings[pref+"name"].default_first.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"name")&&settings[pref+"name"].default_last&&UTIL.stringOrArrayContains(settings[pref+"name"].default_last,item.TargetMerge)&&(settings[pref+"name"].default_last=settings[pref+"name"].default_last.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"email")&&settings[pref+"email"].hasOwnProperty("error_text")&&settings[pref+"email"].error_text&&UTIL.stringOrArrayContains(settings[pref+"email"].error_text,item.TargetMerge)&&(settings[pref+"email"].error_text=settings[pref+"email"].error_text.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"email")&&settings[pref+"email"].label&&UTIL.stringOrArrayContains(settings[pref+"email"].label,item.TargetMerge)&&(settings[pref+"email"].label=settings[pref+"email"].label.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"email")&&settings[pref+"email"].placeholder&&UTIL.stringOrArrayContains(settings[pref+"email"].placeholder,item.TargetMerge)&&(settings[pref+"email"].placeholder=settings[pref+"email"].placeholder.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"email")&&settings[pref+"email"].help&&UTIL.stringOrArrayContains(settings[pref+"email"].help,item.TargetMerge)&&(settings[pref+"email"].help=settings[pref+"email"].help.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"email")&&settings[pref+"email"].default&&UTIL.stringOrArrayContains(settings[pref+"email"].default,item.TargetMerge)&&(settings[pref+"email"].default=settings[pref+"email"].default.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"phone")&&settings[pref+"phone"].hasOwnProperty("error_text")&&settings[pref+"phone"].error_text&&UTIL.stringOrArrayContains(settings[pref+"phone"].error_text,item.TargetMerge)&&(settings[pref+"phone"].error_text=settings[pref+"phone"].error_text.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"phone")&&settings[pref+"phone"].label&&UTIL.stringOrArrayContains(settings[pref+"phone"].label,item.TargetMerge)&&(settings[pref+"phone"].label=settings[pref+"phone"].label.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"phone")&&settings[pref+"phone"].placeholder&&UTIL.stringOrArrayContains(settings[pref+"phone"].placeholder,item.TargetMerge)&&(settings[pref+"phone"].placeholder=settings[pref+"phone"].placeholder.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"phone")&&settings[pref+"phone"].help&&UTIL.stringOrArrayContains(settings[pref+"phone"].help,item.TargetMerge)&&(settings[pref+"phone"].help=settings[pref+"phone"].help.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"phone")&&settings[pref+"phone"].default&&UTIL.stringOrArrayContains(settings[pref+"phone"].default,item.TargetMerge)&&(settings[pref+"phone"].default=settings[pref+"phone"].default.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"opt_in")&&settings[pref+"opt_in"].hasOwnProperty("error_text")&&settings[pref+"opt_in"].error_text&&UTIL.stringOrArrayContains(settings[pref+"opt_in"].error_text,item.TargetMerge)&&(settings[pref+"opt_in"].error_text=settings[pref+"opt_in"].error_text.split(item.TargetMerge).join(val)),settings.hasOwnProperty(pref+"opt_in")&&settings[pref+"opt_in"].text&&UTIL.stringOrArrayContains(settings[pref+"opt_in"].text,item.TargetMerge)&&(settings[pref+"opt_in"].text=settings[pref+"opt_in"].text.split(item.TargetMerge).join(val));for(var i=1;i<=50;i++){var pr=pref;pr.indexOf("_")>0&&(pr=pr.split("_")[0]),settings.hasOwnProperty(pr+"button"+i)&&settings[pr+"button"+i].url&&UTIL.stringOrArrayContains(settings[pr+"button"+i].url,item.TargetMerge)&&(settings[pr+"button"+i].url=settings[pr+"button"+i].url.split(item.TargetMerge).join(val))}for(i=1;i<=customFieldsLimit;i++){var propName=pref+"custom"+i;settings.hasOwnProperty(propName)&&(settings[propName].hasOwnProperty("error_text")&&settings[propName].error_text&&UTIL.stringOrArrayContains(settings[propName].error_text,item.TargetMerge)&&(settings[propName].error_text=settings[propName].error_text.split(item.TargetMerge).join(val)),settings[propName].label&&UTIL.stringOrArrayContains(settings[propName].label,item.TargetMerge)&&(settings[propName].label=settings[propName].label.split(item.TargetMerge).join(val)),settings[propName].placeholder&&UTIL.stringOrArrayContains(settings[propName].placeholder,item.TargetMerge)&&(settings[propName].placeholder=settings[propName].placeholder.split(item.TargetMerge).join(val)),settings[propName].help&&UTIL.stringOrArrayContains(settings[propName].help,item.TargetMerge)&&(settings[propName].help=settings[propName].help.split(item.TargetMerge).join(val)),settings[propName].default&&UTIL.stringOrArrayContains(settings[propName].default,item.TargetMerge)&&(settings[propName].default=settings[propName].default.split(item.TargetMerge).join(val)))}}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"replaceDynamicTargetMerge")}}function replaceDynamicTargetElement(item,srcval,target_default){try{var val=item.TargetValue||"";if("[SOURCE]"===val&&"string"==typeof srcval&&""!==srcval?val=srcval:("[SOURCE]"!==val||"string"==typeof srcval&&""!==srcval)&&srcval&&val||(val=target_default||""),!val)return;var ele=item.TargetType;ele=0===ele.indexOf("main_")?ele.split("_")[1]:ele.split("_").join("");var ptn=$("#"+ele).attr("id");if(settings.hasOwnProperty(ptn)&&settings[ptn].display)if(ele.indexOf("image")>=0){if("string"==typeof val&&val.indexOf("://")>0){image_dims[ptn+"_dynamic"]={width:100,height:100};var img=new Image;img.onload=function(){image_dims[ptn+"_dynamic"].width=this.width,image_dims[ptn+"_dynamic"].height=this.height,resizeImage(image_dims[ptn+"_dynamic"],$("#"+ptn+"_wrapper"),$("#"+ptn),ptn,settings[ptn].width,settings[ptn].height,!0),$("#"+ptn+"_wrapper").show()},ImageSrcMap[ptn+"_dynamic"]={img_obj:img,img_src:val,img_element:$("#"+ptn)},ImageSrcMap[ptn+"_dynamic"].img_element.attr("src",ImageSrcMap[ptn+"_dynamic"].img_src),ImageSrcMap[ptn+"_dynamic"].img_obj.src=ImageSrcMap[ptn+"_dynamic"].img_src}}else $("#"+ele).html(val)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"replaceDynamicTargetElement")}}function replaceDynamicTargetCustomField(item,srcval,target_default){try{var val=item.TargetValue||"";if("[SOURCE]"===val&&"string"==typeof srcval&&""!==srcval?val=srcval:("[SOURCE]"!==val||"string"==typeof srcval&&""!==srcval)&&srcval&&val||(val=target_default||""),!val)return;var field=item.TargetType;field=0===field.indexOf("main_")?"form_input_"+field.split("_")[1]:field.split("_")[0]+"_form_input_"+field.split("_")[1],$("#"+field).val(val)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"replaceDynamicTargetCustomField")}}function buildCouponsDisplay(){findAndInsertCouponsOnPages("display")}function checkCouponsOnSubmit(sobj){return new Promise(((resolve,reject)=>{"object"==typeof COUPONS_FOR_SUBMIT&&0!=Object.keys(COUPONS_FOR_SUBMIT).length?"boolean"==typeof bypassCoupons&&bypassCoupons?resolve():findAndInsertCouponsOnPages("submit").then(resolve).catch(reject):resolve()}))}function findAndInsertCouponsOnPages(couponPopulateOn){return new Promise(((resolve,reject)=>{try{var mtags=[];let pushMergeTags=function(cgidParts){if(cgidParts.length>1)for(var i=1;i<cgidParts.length;i++)if(UTIL.stringOrArrayContains(cgidParts[i],"]")){var cgid=cgidParts[i].split("]")[0];cgid&&!UTIL.stringOrArrayContains(mtags,cgid)&&mtags.push(cgid)}};$('div:contains("[COUPON_")').each((function(){if($(this).children().length<1||$(this).children("a").length+$(this).children("br").length===$(this).children().length){var cgidParts=$(this).html().split("[COUPON_");pushMergeTags(cgidParts)}})),$('button:contains("[COUPON_")').each((function(){if($(this).children().length<1){var cgidParts=$(this).html().split("[COUPON_");pushMergeTags(cgidParts)}})),$("input,select,textarea").each((function(){if(UTIL.stringOrArrayContains($(this).val(),"[COUPON_")){var cgidParts=$(this).val().split("[COUPON_");pushMergeTags(cgidParts)}})),logger("(BOX #"+LIGHTBOX_SHORT_ID+") - findCouponsOnPages: "+couponPopulateOn),logger("mtags ==>"),logger(mtags);var insertCouponPromises=[];if(mtags.length>0)for(var i=0;i<mtags.length;i++){"display"===couponPopulateOn&&(DAPI.hasOwnProperty("COUPON_GROUP_POPULATE_OBJ")&&DAPI.COUPON_GROUP_POPULATE_OBJ.hasOwnProperty(mtags[i])&&"submit"===DAPI.COUPON_GROUP_POPULATE_OBJ[mtags[i]]&&!COUPONS_FOR_SUBMIT.hasOwnProperty(mtags[i])?COUPONS_FOR_SUBMIT[mtags[i]]=!1:DAPI.hasOwnProperty("COUPON_GROUP_POPULATE_OBJ")&&DAPI.COUPON_GROUP_POPULATE_OBJ.hasOwnProperty(mtags[i])||(COUPONS_FOR_SUBMIT[mtags[i]]=!1));var section="";DAPI.hasOwnProperty("COUPON_GROUP_POPULATE_OBJ")?DAPI.COUPON_GROUP_POPULATE_OBJ.hasOwnProperty(mtags[i])?DAPI.COUPON_GROUP_POPULATE_OBJ[mtags[i]]===couponPopulateOn&&(insertCouponPromises.push(insertCouponCodeAsync(mtags[i],couponPopulateOn,"1")),section=" 1"):"submit"===couponPopulateOn&&(insertCouponPromises.push(insertCouponCodeAsync(mtags[i],couponPopulateOn,"2")),section=" 2"):"submit"===couponPopulateOn?(insertCouponPromises.push(insertCouponCodeAsync(mtags[i],couponPopulateOn,"3")),section=" 3"):section=" 4 no match",logger("(BOX #"+LIGHTBOX_SHORT_ID+") - findCouponsOnPages: "+couponPopulateOn+" ("+mtags[i]+") section"+section)}logger("COUPONS_FOR_SUBMIT ==>"),logger(COUPONS_FOR_SUBMIT),setTimeout((()=>reject("rejecting submission after waiting 10 secs")),1e4),Promise.allSettled(insertCouponPromises).then(resolve)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"findCouponsOnPages"),reject("findCouponsOnPages "+e.message)}}))}function insertCouponCodeAsync(coupon_group_id,populate_on,code_section_trigger){return new Promise(((resolve,reject)=>{try{var couponApiUrl=COUPON_BASE_URL+"/Coupon/GetCoupon?user_id="+VENDOR_SHORT_ID+"&coupon_group_id="+coupon_group_id+"&client_id="+CLIENT_GUID;if(couponApiUrl+="&goat="+LBOX.LZString.compressToBase64(VENDOR_SHORT_ID+CLIENT_GUID).substr(0,32)+LBOX.LZString.compressToBase64((new Date).getTime().toString()),COUPONS_FOR_DISPLAY.hasOwnProperty(coupon_group_id)&&COUPONS_FOR_DISPLAY[coupon_group_id]){var couponText=COUPONS_FOR_DISPLAY[coupon_group_id];$('div:contains("[COUPON_'+coupon_group_id+']")').each((function(){($(this).children().length<1||$(this).children("a").length+$(this).children("br").length===$(this).children().length)&&$(this).html($(this).html().split("[COUPON_"+coupon_group_id+"]").join(couponText))})),$('button:contains("[COUPON_'+coupon_group_id+']")').each((function(){$(this).children().length<1&&$(this).html($(this).html().split("[COUPON_"+coupon_group_id+"]").join(couponText))})),$("input,select,textarea").each((function(){UTIL.stringOrArrayContains($(this).val(),"[COUPON_"+coupon_group_id+"]")&&$(this).val($(this).val().split("[COUPON_"+coupon_group_id+"]").join(couponText))})),resolve()}else $.ajax({dataType:"jsonp",url:couponApiUrl,success:function(data){if(data&&"object"==typeof data&&null!==data&&data.hasOwnProperty("success")&&data.success)if(data.hasOwnProperty("payload")){logger("(BOX #"+LIGHTBOX_SHORT_ID+") - GetCoupon: SUCCESS ==>"),logger(data);var couponText=data.payload;COUPONS_FOR_DISPLAY[coupon_group_id]=couponText,$('div:contains("[COUPON_'+coupon_group_id+']")').each((function(){($(this).children().length<1||$(this).children("a").length+$(this).children("br").length===$(this).children().length)&&$(this).html($(this).html().split("[COUPON_"+coupon_group_id+"]").join(couponText))})),$('button:contains("[COUPON_'+coupon_group_id+']")').each((function(){$(this).children().length<1&&$(this).html($(this).html().split("[COUPON_"+coupon_group_id+"]").join(couponText))})),$("input,select,textarea").each((function(){UTIL.stringOrArrayContains($(this).val(),"[COUPON_"+coupon_group_id+"]")&&$(this).val($(this).val().split("[COUPON_"+coupon_group_id+"]").join(couponText))})),postMessageCouponUsed(coupon_group_id,data,"success",populate_on,code_section_trigger,"1",CURRENT_PAGE),resolve()}else postMessageCouponUsed(coupon_group_id,data,"failure",populate_on,code_section_trigger,"2",CURRENT_PAGE),logger("(BOX #"+LIGHTBOX_SHORT_ID+") - GetCoupon: FAILURE 2 ==>"),logger(data),reject("insertCouponCodeAsync GetCoupon: FAILURE 2");else data&&"object"==typeof data&&null!==data?(postMessageCouponUsed(coupon_group_id,data,"failure",populate_on,code_section_trigger,"3",CURRENT_PAGE),logger("(BOX #"+LIGHTBOX_SHORT_ID+") - GetCoupon: FAILURE 3 ==>"),logger(data),reject("insertCouponCodeAsync GetCoupon: FAILURE 3")):(postMessageCouponUsed(coupon_group_id,"null","failure",populate_on,code_section_trigger,"4",CURRENT_PAGE),logger("(BOX #"+LIGHTBOX_SHORT_ID+") - GetCoupon: FAILURE 4 ==>"),logger(data),reject("insertCouponCodeAsync GetCoupon: FAILURE 4"));COUPONS_FOR_SUBMIT.hasOwnProperty(coupon_group_id)&&(COUPONS_FOR_SUBMIT[coupon_group_id]=!0)},error:function(htmltext,textStatus,errorThrown){COUPONS_FOR_SUBMIT.hasOwnProperty(coupon_group_id)&&(COUPONS_FOR_SUBMIT[coupon_group_id]=!0),postMessageCouponUsed(coupon_group_id,{textStatus:textStatus},"error",populate_on,code_section_trigger,"5",CURRENT_PAGE),logger("(BOX #"+LIGHTBOX_SHORT_ID+") - GetCoupon: FAILURE 5 ==>"),logger(textStatus),DLOG.tryShowError(errorThrown)&&(errorThrown.message="DIGIOH_ERROR: lightbox_builder.js : insertCouponCodeAsync : couponId :"+coupon_group_id+"-- "+errorThrown.message,console.error(errorThrown)),BOX_CUSTOM_JS.logError(errorThrown,"insertCouponCodeAsync"),reject("insertCouponCodeAsync "+textStatus)}})}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"insertCouponCodeAsync"),reject("insertCouponCodeAsync "+e.message)}}))}function replaceHrefMergeTags(){try{$('div:contains("[[LINK|"),p:contains("[[LINK|"),span:contains("[[LINK|")').each((function(){if($(this).children().length<1||$(this).children("a").length+$(this).children("br").length===$(this).children().length){var divParts=$(this).html().split("[[LINK|");if(divParts.length>1)for(var i=1;i<divParts.length;i++)if(UTIL.stringOrArrayContains(divParts[i],"]]")){var divLink=divParts[i].split("]]")[0].split("|")[0],divText="",divStyle="",divReplace="[[LINK|"+divLink+"]]";divParts[i].split("]]")[0].split("|").length>1&&(divReplace="[[LINK|"+divLink+"|"+(divText=divParts[i].split("]]")[0].split("|")[1])+"]]"),divParts[i].split("]]")[0].split("|").length>2&&(divReplace="[[LINK|"+divLink+"|"+divText+"|"+(divStyle=divParts[i].split("]]")[0].split("|")[2])+"]]"),divText.length<1&&(divText=divLink),UTIL.stringOrArrayContains(divLink,"://")||(divLink="https://"+divLink),$(this).html($(this).html().split(divReplace).join("<a target='_blank' href='"+divLink+"' style='"+divStyle+"'>"+divText+"</a>"))}}}))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"replaceHrefMergeTags")}}function replaceBrMergeTags(){try{$('div:contains("[[BR]]"),p:contains("[[BR]]"),span:contains("[[BR]]")').each((function(){if($(this).children().length<1||$(this).children("a").length+$(this).children("br").length===$(this).children().length){var divParts=$(this).html().split("[[BR]]");divParts.length>1&&$(this).html(divParts.join("<br>"))}}))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"replaceBrMergeTags")}}function showLoading(pref){var modal_width=0,modal_height=0;if(pref=DUTIL.getUnfriendlyPagePrefix(pref),CURRENT_WIDTH&&CURRENT_HEIGHT)modal_width=CURRENT_WIDTH,modal_height=CURRENT_HEIGHT;else if("thx_"===pref&&settings.hasOwnProperty("thxlayout"))modal_width=settings.thxlayout.width,modal_height=settings.thxlayout.height;else if(0===pref.indexOf("ep")){var pNum=DUTIL.getExtraPageNumberFromEPString(pref);settings.hasOwnProperty("ep"+pNum+"layout")?(modal_width=settings["ep"+pNum+"layout"].width,modal_height=settings["ep"+pNum+"layout"].height):(modal_width=settings.layout.width,modal_height=settings.layout.height)}else modal_width=settings.layout.width,modal_height=settings.layout.height;var foundLoadingOverride=!1;settings.hasOwnProperty(pref+"form")&&settings[pref+"form"].hasOwnProperty("loading_image")&&settings[pref+"form"].loading_image?"hide"===settings[pref+"form"].loading_image?(body.removeClass("loading"),foundLoadingOverride=!0):"other"===settings[pref+"form"].loading_image&&settings[pref+"form"].hasOwnProperty("loading_image_custom")&&settings[pref+"form"].loading_image_custom&&($("#modal_loading_custom").length?$("#modal_loading_custom").attr("style","position:fixed;z-index:90000;top:0;left:0;height:100%;width:100%;background:url("+S3_BASE_URL+"/vendors/"+VENDOR_GUID+"/uploads/"+settings[pref+"form"].loading_image_custom+") 50% 50% no-repeat rgba(255,255,255,.1)"):$("#modal_loading").append("<div id='modal_loading_custom' style='position:fixed;z-index:90000;top:0;left:0;height:100%;width:100%;background:url("+S3_BASE_URL+"/vendors/"+VENDOR_GUID+"/uploads/"+settings[pref+"form"].loading_image_custom+") 50% 50% no-repeat rgba(255,255,255,.1)'></div>"),$("#modal_loading_spinner").hide(),body.addClass("loading"),foundLoadingOverride=!0):settings.hasOwnProperty(pref+"form")&&settings[pref+"form"].display&&settings[pref+"form"].hasOwnProperty("loading_image")||!DIGIOH_PRQ.USE||!DIGIOH_PRQ.isBoxPRQ()||(body.removeClass("loading"),foundLoadingOverride=!0),foundLoadingOverride||($("#modal_loading_custom").length&&$("#modal_loading_custom").hide(),$("#modal_loading_spinner").css("left",Math.round(modal_width/2)-10+"px"),$("#modal_loading_spinner").css("top",Math.round(modal_height/2)-10+"px"),$("#modal_loading_spinner").show(),body.addClass("loading"))}function showLoadingDigioh(){$("#modal_loading_custom").length?$("#modal_loading_custom").attr("style","position:fixed;z-index:90000;top:0;left:0;height:100%;width:100%;background:url(https://forms.allrecipes.com/w37htfhcq2/static/Digioh_Loading_Spinner_Black.gif) 50% 50% no-repeat rgba(255,255,255,.1);background-size: 125px 130px;"):$("#modal_loading").append("<div id='modal_loading_custom' style='position:fixed;z-index:90000;top:0;left:0;height:100%;width:100%;background:url(https://forms.allrecipes.com/w37htfhcq2/static/Digioh_Loading_Spinner_Black.gif) 50% 50% no-repeat rgba(255, 255, 255, .1);background-size: 125px 130px;'></div>"),$("#modal_loading_spinner").hide(),body.addClass("loading")}function showLoadingCustomOrDefault(){for(var pref="",i=-1;i<100;i++){pref=-1==i?"":0==i?"thx":"ep"+i;var pref_form=DUTIL.getUnfriendlyPagePrefix(pref);if((""==pref||settings.hasOwnProperty(pref+"layout"))&&settings.hasOwnProperty(pref_form+"form")&&settings[pref_form+"form"].display&&settings[pref_form+"form"].hasOwnProperty("loading_image")&&"other"===settings[pref_form+"form"].loading_image&&settings[pref_form+"form"].hasOwnProperty("loading_image_custom")&&settings[pref_form+"form"].loading_image_custom)return $("#modal_loading_custom").length?$("#modal_loading_custom").attr("style","position:fixed;z-index:90000;top:0;left:0;height:100%;width:100%;background:url("+S3_BASE_URL+"/vendors/"+VENDOR_GUID+"/uploads/"+settings[pref_form+"form"].loading_image_custom+") 50% 50% no-repeat rgba(255,255,255,.1)"):$("#modal_loading").append("<div id='modal_loading_custom' style='position:fixed;z-index:90000;top:0;left:0;height:100%;width:100%;background:url("+S3_BASE_URL+"/vendors/"+VENDOR_GUID+"/uploads/"+settings[pref_form+"form"].loading_image_custom+") 50% 50% no-repeat rgba(255,255,255,.1)'></div>"),$("#modal_loading_spinner").hide(),void body.addClass("loading")}showLoadingDigioh()}function hideLoading(){body.removeClass("loading")}function determineGoogleFonts(){for(var pref="",j=1;j<=102;j++){if(1==j)pref="";else if(2==j)pref="thx";else if(j>=3&&j<=6)pref="ep"+(j-2);else if(j>=7&&(pref="ep"+(j-2),!settings.hasOwnProperty("extra_pages")||settings.extra_pages.length<=j-3||!settings.extra_pages[j-3]||1!==settings.extra_pages[j-3].on))continue;for(var x=1;x<=50;x++)settings.hasOwnProperty(pref+"text"+x)&&settings[pref+"text"+x].display&&addGoogleFontToStack(settings[pref+"text"+x].font.family),settings.hasOwnProperty(pref+"button"+x)&&settings[pref+"button"+x].display&&addGoogleFontToStack(settings[pref+"button"+x].font.family),settings.hasOwnProperty(pref+"button"+x)&&settings[pref+"button"+x].display&&addGoogleFontToStack(settings[pref+"button"+x].font_hover.family),settings.hasOwnProperty(pref+"button"+x)&&settings[pref+"button"+x].display&&addGoogleFontToStack(settings[pref+"button"+x].font_focus.family)}loadGoogleFontsFromStack()}function loadExternalFonts(pref,force){try{if("string"==typeof pref&&"main"!==pref||(pref=""),UTIL.stringOrArrayContains(pref,"_")&&(pref=pref.split("_")[0]),!force)if(""===pref||LoadedCustomFonts.hasOwnProperty(pref)){if(LoadedCustomFonts.hasOwnProperty(pref)&&!0===LoadedCustomFonts[pref])return}else LoadedCustomFonts[pref]=!0;logger("loadExternalFonts("+pref+")");for(var x=1;x<=50;x++)settings.hasOwnProperty(pref+"text"+x)&&settings[pref+"text"+x].display&&addCustomFontToStack(settings[pref+"text"+x].font.family),settings.hasOwnProperty(pref+"button"+x)&&settings[pref+"button"+x].display&&addCustomFontToStack(settings[pref+"button"+x].font.family),settings.hasOwnProperty(pref+"button"+x)&&settings[pref+"button"+x].display&&addCustomFontToStack(settings[pref+"button"+x].font_hover.family),settings.hasOwnProperty(pref+"button"+x)&&settings[pref+"button"+x].display&&addCustomFontToStack(settings[pref+"button"+x].font_focus.family);var pr=pref;""!==pr&&(pr+="_"),settings.hasOwnProperty(pr+"labels")&&addCustomFontToStack(settings[pr+"labels"].font.family),settings.hasOwnProperty(pr+"inputs")&&addCustomFontToStack(settings[pr+"inputs"].font.family)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"loadExternalFonts")}}function addCustomFontToStack(f){try{if(f.indexOf("__custom__")>=0&&f.indexOf("||||")>=0){var font_parts=f.split("||||"),font_name=font_parts[1],font_guid=font_parts[2],font_url=S3_BASE_URL+"/custom_fonts/"+font_guid+".css?cb="+DIGIOH_CACHE_VERSION;if(-1===$.inArray(font_name,basic_fonts)&&-1===$.inArray(font_name,custom_fonts)){custom_fonts.push(font_name);var h=document.head||document.getElementsByTagName("head")[0],l=document.createElement("link");l.type="text/css",l.rel="stylesheet",l.href=font_url,h.appendChild(l)}}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"addCustomFontToStack")}}function addGoogleFontToStack(f){try{var font_name="";f.indexOf("__google__")>=0?font_name=f.replace("__google__","").split("'")[1]:f&&-1===f.indexOf("__custom__")&&f.length>10&&-1===$.inArray(f,basic_fonts)&&(font_name=f.split("'")[1]),font_name&&font_name.length>1&&-1===$.inArray(font_name,google_fonts)&&google_fonts.push(font_name)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"addGoogleFontToStack")}}function loadGoogleFontsFromStack(){try{if(google_fonts.length>0){for(var font_builder="https://fonts.googleapis.com/css?family=",font_fam="",i=0;i<google_fonts.length;i++)(font_fam=google_fonts[i]).indexOf(" ")>0&&(font_fam=font_fam.split(" ").join("+")),font_builder+=font_fam,font_builder+=":400,700",i<google_fonts.length-1&&(font_builder+="|");var h=document.head||document.getElementsByTagName("head")[0],l=document.createElement("link");l.type="text/css",l.rel="stylesheet",l.href=font_builder+"&display=fallback",h.appendChild(l)}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"loadGoogleFontsFromStack")}}function buildText(){try{for(var pr="",j=1;j<=102;j++){if(1==j)pr="";else if(2==j)pr="thx";else if(j>=3&&j<=6)pr="ep"+(j-2);else if(j>=7&&(pr="ep"+(j-2),!settings.hasOwnProperty("extra_pages")||settings.extra_pages.length<=j-3||!settings.extra_pages[j-3]||1!==settings.extra_pages[j-3].on))continue;for(var x=1;x<=50;x++)if(settings.hasOwnProperty(pr+"text"+x)&&settings[pr+"text"+x].display&&($("#"+pr+"text"+x).html(settings[pr+"text"+x].text),settings[pr+"text"+x].hasOwnProperty("metadata_kvps")))for(var k=0;k<settings[pr+"text"+x].metadata_kvps.length;k++)settings[pr+"text"+x].metadata_kvps[k].k&&settings[pr+"text"+x].metadata_kvps[k].v&&UTIL.trySetAttribute(pr+"text"+x,settings[pr+"text"+x].metadata_kvps[k],$)}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"buildText")}}function buildHTMLItemAndEvalJSFromHtml(htmlEle,htmlId){try{if(!(settings.hasOwnProperty(htmlId)&&settings[htmlId]&&settings[htmlId].hasOwnProperty("display")&&settings[htmlId].hasOwnProperty("html")&&settings[htmlId].display&&settings[htmlId].html))return;if(-1===settings[htmlId].html.indexOf("script"))htmlEle.html(settings[htmlId].html);else{var htmlElement=document.getElementById(htmlId);htmlElement.innerHTML=settings[htmlId].html;for(var scripts=htmlElement.getElementsByTagName("script"),i=0;i<scripts.length;++i){var script=scripts[i];if(script.innerHTML&&script.innerHTML.length>0)eval(script.innerHTML);else if(script.hasAttribute("src")){var elSrc=script.getAttribute("src");if("string"==typeof elSrc&&elSrc.indexOf("//")>=0){const existingScript=Array.from(document.head.getElementsByTagName("script")).find((script=>script.src.includes(elSrc)));if(existingScript)continue;var elRef=document.createElement("script");elRef.setAttribute("type","text/javascript"),elRef.setAttribute("src",elSrc),elRef.async=!0,document.getElementsByTagName("head")[0].appendChild(elRef)}}}}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"buildHTMLItemAndEvalJSFromHtml")}}function buildHTML(){try{for(var pr="",j=1;j<=102;j++){if(1==j)pr="";else if(2==j)pr="thx";else if(j>=3&&j<=6)pr="ep"+(j-2);else if(j>=7&&(pr="ep"+(j-2),!settings.hasOwnProperty("extra_pages")||settings.extra_pages.length<=j-3||!settings.extra_pages[j-3]||1!==settings.extra_pages[j-3].on))continue;for(var x=1;x<=50;x++)if(settings.hasOwnProperty(pr+"html"+x)&&settings[pr+"html"+x].display&&(buildHTMLItemAndEvalJSFromHtml($("#"+pr+"html"+x),pr+"html"+x),settings[pr+"html"+x]&&settings[pr+"html"+x].custom_widget&&settings[pr+"html"+x].custom_widget.widget_configuration&&settings[pr+"html"+x].custom_widget.enabled&&loadWidget(settings[pr+"html"+x].custom_widget.widget_configuration),settings[pr+"html"+x].hasOwnProperty("metadata_kvps")))for(var k=0;k<settings[pr+"html"+x].metadata_kvps.length;k++)settings[pr+"html"+x].metadata_kvps[k].k&&settings[pr+"html"+x].metadata_kvps[k].v&&UTIL.trySetAttribute(pr+"html"+x,settings[pr+"html"+x].metadata_kvps[k],$)}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"buildHTML")}}function buildForm(){try{if(using_form=settings.hasOwnProperty("form")&&settings.form.display,using_form_thx=settings.hasOwnProperty("thxlayout")&&settings.hasOwnProperty("thx_form")&&settings.thx_form.display,using_form_ep1=settings.hasOwnProperty("ep1layout")&&settings.hasOwnProperty("ep1_form")&&settings.ep1_form.display,using_form_ep2=settings.hasOwnProperty("ep2layout")&&settings.hasOwnProperty("ep2_form")&&settings.ep2_form.display,using_form_ep3=settings.hasOwnProperty("ep3layout")&&settings.hasOwnProperty("ep3_form")&&settings.ep3_form.display,using_form_ep4=settings.hasOwnProperty("ep4layout")&&settings.hasOwnProperty("ep4_form")&&settings.ep4_form.display,using_form){form.empty(),buildFormName("",form),buildFormEmail("",form),buildFormPhone("",form);for(var i=1;i<=customFieldsLimit;i++)buildFormCustomN("","custom"+i,form);buildFormOptIn("",form)}if(using_form_thx){thx_form.empty(),buildFormName("thx",thx_form),buildFormEmail("thx",thx_form),buildFormPhone("thx",thx_form);for(i=1;i<=customFieldsLimit;i++)buildFormCustomN("thx","thx_custom"+i,thx_form);buildFormOptIn("thx",thx_form)}if(using_form_ep1){ep1_form.empty(),buildFormName("ep1",ep1_form),buildFormEmail("ep1",ep1_form),buildFormPhone("ep1",ep1_form);for(i=1;i<=customFieldsLimit;i++)buildFormCustomN("ep1","ep1_custom"+i,ep1_form);buildFormOptIn("ep1",ep1_form)}if(using_form_ep2){ep2_form.empty(),buildFormName("ep2",ep2_form),buildFormEmail("ep2",ep2_form),buildFormPhone("ep2",ep2_form);for(i=1;i<=customFieldsLimit;i++)buildFormCustomN("ep2","ep2_custom"+i,ep2_form);buildFormOptIn("ep2",ep2_form)}if(using_form_ep3){ep3_form.empty(),buildFormName("ep3",ep3_form),buildFormEmail("ep3",ep3_form),buildFormPhone("ep3",ep3_form);for(i=1;i<=customFieldsLimit;i++)buildFormCustomN("ep3","ep3_custom"+i,ep3_form);buildFormOptIn("ep3",ep3_form)}if(using_form_ep4){ep4_form.empty(),buildFormName("ep4",ep4_form),buildFormEmail("ep4",ep4_form),buildFormPhone("ep4",ep4_form);for(i=1;i<=customFieldsLimit;i++)buildFormCustomN("ep4","ep4_custom"+i,ep4_form);buildFormOptIn("ep4",ep4_form)}if(!using_form&&$("#form_wrapper").length&&(form_wrapper.hide(),form.hide()),!using_form_thx&&$("#thx_form_wrapper").length&&(thx_form_wrapper.hide(),thx_form.hide()),!using_form_ep1&&$("#ep1_form_wrapper").length&&(ep1_form_wrapper.hide(),ep1_form.hide()),!using_form_ep2&&$("#ep2_form_wrapper").length&&(ep2_form_wrapper.hide(),ep2_form.hide()),!using_form_ep3&&$("#ep3_form_wrapper").length&&(ep3_form_wrapper.hide(),ep3_form.hide()),!using_form_ep4&&$("#ep4_form_wrapper").length&&(ep4_form_wrapper.hide(),ep4_form.hide()),settings.hasOwnProperty("extra_pages"))for(var j=5;j<=100;j++){if(!(settings.extra_pages.length<j)&&settings.extra_pages[j-1]&&1===settings.extra_pages[j-1].on)if(settings.hasOwnProperty("ep"+j+"layout")&&settings.hasOwnProperty("ep"+j+"_form")&&settings["ep"+j+"_form"].display){$("#ep"+j+"_form").length&&$("#ep"+j+"_form").empty(),buildFormName("ep"+j,$("#ep"+j+"_form")),buildFormEmail("ep"+j,$("#ep"+j+"_form")),buildFormPhone("ep"+j,$("#ep"+j+"_form"));for(i=1;i<=customFieldsLimit;i++)buildFormCustomN("ep"+j,"ep"+j+"_custom"+i,$("#ep"+j+"_form"));buildFormOptIn("ep"+j,$("#ep"+j+"_form"))}else $("#ep"+j+"_form_wrapper").length&&($("#ep"+j+"_form_wrapper").hide(),$("#ep"+j+"_form").hide())}initFormInputs()}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"buildForm")}}function buildButtons(){try{for(var pr="",j=1;j<=102;j++){if(1==j)pr="";else if(2==j)pr="thx";else if(j>=3&&j<=6)pr="ep"+(j-2);else if(j>=7&&(pr="ep"+(j-2),!settings.hasOwnProperty("extra_pages")||settings.extra_pages.length<=j-3||!settings.extra_pages[j-3]||1!==settings.extra_pages[j-3].on))continue;for(var x=1;x<=50;x++)if(settings.hasOwnProperty(pr+"button"+x)&&settings[pr+"button"+x].display){if(buildButtonN($("#"+pr+"button"+x),$("#"+pr+"button"+x+"_wrapper"),pr+"button"+x,settings[pr+"button"+x],""===pr?"":pr+"_"),settings[pr+"button"+x].hasOwnProperty("metadata_kvps"))for(var k=0;k<settings[pr+"button"+x].metadata_kvps.length;k++)settings[pr+"button"+x].metadata_kvps[k].k&&settings[pr+"button"+x].metadata_kvps[k].v&&-1===settings[pr+"button"+x].metadata_kvps[k].k.indexOf("[")&&UTIL.trySetAttribute(pr+"button"+x,settings[pr+"button"+x].metadata_kvps[k],$);("string"!=typeof $("#"+pr+"button"+x).attr("aria-label")||$("#"+pr+"button"+x).attr("aria-label").length<1)&&("submit"==settings[pr+"button"+x].action?$("#"+pr+"button"+x).attr("aria-label","Submit Modal Form"):"close"==settings[pr+"button"+x].action?$("#"+pr+"button"+x).attr("aria-label","Close Modal"):"url"==settings[pr+"button"+x].action?$("#"+pr+"button"+x).attr("aria-label","Redirect to URL"):"download"==settings[pr+"button"+x].action?$("#"+pr+"button"+x).attr("aria-label","Download File"):"lightbox_open"==settings[pr+"button"+x].action?$("#"+pr+"button"+x).attr("aria-label","Open Another Modal"):settings[pr+"button"+x].action.indexOf("_page")>0&&$("#"+pr+"button"+x).attr("aria-label","Open Next Modal Page"))}}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"buildButtons")}}function initFormInputs(){try{$("#form_input_full_name").length&&(form_input_full_name=$("#form_input_full_name")),$("#form_input_first_name").length&&(form_input_first_name=$("#form_input_first_name")),$("#form_input_last_name").length&&(form_input_last_name=$("#form_input_last_name")),$("#form_input_email").length&&(form_input_email=$("#form_input_email")),$("#form_input_phone").length&&(form_input_phone=$("#form_input_phone")),$("#form_input_opt_in").length&&(form_input_opt_in=$("#form_input_opt_in")),$("#thx_form_input_full_name").length&&(thx_form_input_full_name=$("#thx_form_input_full_name")),$("#thx_form_input_first_name").length&&(thx_form_input_first_name=$("#thx_form_input_first_name")),$("#thx_form_input_last_name").length&&(thx_form_input_last_name=$("#thx_form_input_last_name")),$("#thx_form_input_email").length&&(thx_form_input_email=$("#thx_form_input_email")),$("#thx_form_input_phone").length&&(thx_form_input_phone=$("#thx_form_input_phone")),$("#thx_form_input_opt_in").length&&(thx_form_input_opt_in=$("#thx_form_input_opt_in")),$("#ep1_form_input_full_name").length&&(ep1_form_input_full_name=$("#ep1_form_input_full_name")),$("#ep1_form_input_first_name").length&&(ep1_form_input_first_name=$("#ep1_form_input_first_name")),$("#ep1_form_input_last_name").length&&(ep1_form_input_last_name=$("#ep1_form_input_last_name")),$("#ep1_form_input_email").length&&(ep1_form_input_email=$("#ep1_form_input_email")),$("#ep1_form_input_phone").length&&(ep1_form_input_phone=$("#ep1_form_input_phone")),$("#ep1_form_input_opt_in").length&&(ep1_form_input_opt_in=$("#ep1_form_input_opt_in")),$("#ep2_form_input_full_name").length&&(ep2_form_input_full_name=$("#ep2_form_input_full_name")),$("#ep2_form_input_first_name").length&&(ep2_form_input_first_name=$("#ep2_form_input_first_name")),$("#ep2_form_input_last_name").length&&(ep2_form_input_last_name=$("#ep2_form_input_last_name")),$("#ep2_form_input_email").length&&(ep2_form_input_email=$("#ep2_form_input_email")),$("#ep2_form_input_phone").length&&(ep2_form_input_phone=$("#ep2_form_input_phone")),$("#ep2_form_input_opt_in").length&&(ep2_form_input_opt_in=$("#ep2_form_input_opt_in")),$("#ep3_form_input_full_name").length&&(ep3_form_input_full_name=$("#ep3_form_input_full_name")),$("#ep3_form_input_first_name").length&&(ep3_form_input_first_name=$("#ep3_form_input_first_name")),$("#ep3_form_input_last_name").length&&(ep3_form_input_last_name=$("#ep3_form_input_last_name")),$("#ep3_form_input_email").length&&(ep3_form_input_email=$("#ep3_form_input_email")),$("#ep3_form_input_phone").length&&(ep3_form_input_phone=$("#ep3_form_input_phone")),$("#ep3_form_input_opt_in").length&&(ep3_form_input_opt_in=$("#ep3_form_input_opt_in")),$("#ep4_form_input_full_name").length&&(ep4_form_input_full_name=$("#ep4_form_input_full_name")),$("#ep4_form_input_first_name").length&&(ep4_form_input_first_name=$("#ep4_form_input_first_name")),$("#ep4_form_input_last_name").length&&(ep4_form_input_last_name=$("#ep4_form_input_last_name")),$("#ep4_form_input_email").length&&(ep4_form_input_email=$("#ep4_form_input_email")),$("#ep4_form_input_phone").length&&(ep4_form_input_phone=$("#ep4_form_input_phone")),$("#ep4_form_input_opt_in").length&&(ep4_form_input_opt_in=$("#ep4_form_input_opt_in"));for(var f=1;f<=customFieldsLimit;f++)if($("#form_input_custom"+f).length&&(form_input_obj["form_input_custom"+f]=$("#form_input_custom"+f)),$("#thx_form_input_custom"+f).length&&(form_input_obj["thx_form_input_custom"+f]=$("#thx_form_input_custom"+f)),$("#ep1_form_input_custom"+f).length&&(form_input_obj["ep1_form_input_custom"+f]=$("#ep1_form_input_custom"+f)),$("#ep2_form_input_custom"+f).length&&(form_input_obj["ep2_form_input_custom"+f]=$("#ep2_form_input_custom"+f)),$("#ep3_form_input_custom"+f).length&&(form_input_obj["ep3_form_input_custom"+f]=$("#ep3_form_input_custom"+f)),$("#ep4_form_input_custom"+f).length&&(form_input_obj["ep4_form_input_custom"+f]=$("#ep4_form_input_custom"+f)),settings.hasOwnProperty("extra_pages"))for(var j=5;j<=100;j++)settings.extra_pages.length>=j&&settings.extra_pages[j-1]&&1===settings.extra_pages[j-1].on&&$("#ep"+j+"_form_input_custom"+f).length&&(form_input_obj["ep"+j+"_form_input_custom"+f]=$("#ep"+j+"_form_input_custom"+f))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"initFormInputs")}}function getFirstLastNames(fullName){try{if(UTIL.isNullOrWhitespace(fullName))return["",""];var parts=(fullName=fullName.trim()).split(" ");if(0==parts.length)return["",""];if(1==parts.length)return[parts[0],""];if(2==parts.length)return[parts[0],parts[1]];for(var first=parts[0],last="",x=1;x<parts.length;x++)UTIL.isNullOrWhitespace(parts[x])||(last+=parts[x].trim()+" ");return last.length>0&&(last=last.trim()),[first,last]}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"getFirstLastNames"),["",""]}}function getFullName(first,last){try{if(first=UTIL.isNullOrWhitespace(first)?"":first.trim(),last=UTIL.isNullOrWhitespace(last)?"":last.trim(),first.length>0&&last.length>0)return first+" "+last;if(first.length>0)return first;if(last.length>0)return last}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"getFullName"),first+" "+last}}function formatPhoneString(inputString,formatString,submitFormatString="",pref){try{let currentFormat=formatString;""!=submitFormatString&&(currentFormat=submitFormatString);const displayFormatFirstXIndex=parseInt(formatString.indexOf("x")),displayFormatIndexAfterX=parseInt(formatString.lastIndexOf("x"))+1,displayFormatLastIndex=parseInt(formatString.length),formatBeginning=formatString.substring(0,displayFormatFirstXIndex),formatEnding=formatString.substring(displayFormatIndexAfterX,displayFormatLastIndex);let stringToReturn=currentFormat,inputStringDigits="",numberOfInputDigits=0;if(formatBeginning&&inputString.indexOf(formatBeginning)>-1&&(inputString=inputString.replace(formatBeginning,"")),formatEnding&&inputString.indexOf(formatEnding)>-1&&(inputString=inputString.replace(formatEnding,"")),inputStringDigits=inputString.replace(/[^0-9]/gi,""),numberOfInputDigits=inputStringDigits.length,""===inputStringDigits&&""==submitFormatString)return numberOfInputDigits="0",stringToReturn="",stringToReturn;settings[pref+"phone"].enable_country_code&&settings[pref+"phone"].country_code&&displayFormatFirstXIndex<0&&stringToReturn.includes("1")&&(stringToReturn=stringToReturn.replace("1","x"));for(let i=0;i<stringToReturn.length;++i)"x"===stringToReturn.charAt(i)&&inputStringDigits.length>0&&(stringToReturn=stringToReturn.substring(0,i)+inputStringDigits[0]+stringToReturn.substring(i+1),inputStringDigits=inputStringDigits.substring(1));return stringToReturn}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"formatPhoneString."),""}}function formatPhoneDisplay(jqElem,displayFormat,pref){try{let newInput=formatPhoneString(jqElem.val(),displayFormat,"",pref);newInput=newInput.split("x")[0],newInput.length<displayFormat.length&&!$.isNumeric(newInput[newInput.length-1])&&(newInput=newInput.endsWith(") ")?newInput.slice(0,-2):newInput.slice(0,-1)),jqElem.val(newInput)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"formatPhoneDisplay")}}function formatPhoneSubmit(inputValue,displayFormat,submitDisplayFormat,pref){try{let inputVal=inputValue;if(!displayFormat&&!submitDisplayFormat)return{success:!0,message:inputValue};const maxLengthBase=(displayFormat?displayFormat.match(/x/g):submitDisplayFormat.match(/x/g)||[]).length;let ignoreUSCountryCodeWithDefaultDisplayFormat=!1;const hasOnePrefix=displayFormat&&displayFormat.includes("1")||submitDisplayFormat&&submitDisplayFormat.includes("1");displayFormat&&!submitDisplayFormat&&settings[pref+"phone"].enable_country_code&&"+1"===$("#"+pref+"form_input_country_code").val().trim()&&(inputVal=inputVal.replace("+1",""),ignoreUSCountryCodeWithDefaultDisplayFormat=!0);const maxLength=maxLengthBase+(hasOnePrefix?1:0);if(!inputVal)return{success:!1,message:"Phone number input is required."};if((inputVal?inputVal.replace(/[^0-9]/g,""):"").length>maxLength)return{success:!1,message:`Must enter ${maxLengthBase}-digit phone number.`};let formattedPhone=formatPhoneString(inputVal,displayFormat,submitDisplayFormat,pref);return formattedPhone.includes("x")?{success:!1,message:`Must enter a complete ${maxLengthBase}-digit phone number.`}:(ignoreUSCountryCodeWithDefaultDisplayFormat&&(formattedPhone="+1"+(formattedPhone?.replace(/\D/g,"")||"")),{success:!0,message:formattedPhone})}catch(e){const errorMsg=`DIGIOH_ERROR: lightbox_builder.js -- ${e.message}`;return DLOG.tryShowError(e)&&(e.message=errorMsg,console.error(e)),BOX_CUSTOM_JS.logError(e,"formatPhoneSubmit"),{success:!1,message:"There was an internal error. Please try again later."}}}function setPrefFormInputs(pref){try{if("thx_"===pref){pref_form_input_full_name=thx_form_input_full_name,pref_form_input_first_name=thx_form_input_first_name,pref_form_input_last_name=thx_form_input_last_name,pref_form_input_email=thx_form_input_email,pref_form_input_phone=thx_form_input_phone,pref_form_input_opt_in=thx_form_input_opt_in;for(var f=1;f<=customFieldsLimit;f++)form_input_obj["pref_form_input_custom"+f]=form_input_obj["thx_form_input_custom"+f]}else if("ep1_"===pref){pref_form_input_full_name=ep1_form_input_full_name,pref_form_input_first_name=ep1_form_input_first_name,pref_form_input_last_name=ep1_form_input_last_name,pref_form_input_email=ep1_form_input_email,pref_form_input_phone=ep1_form_input_phone,pref_form_input_opt_in=ep1_form_input_opt_in;for(f=1;f<=customFieldsLimit;f++)form_input_obj["pref_form_input_custom"+f]=form_input_obj["ep1_form_input_custom"+f]}else if("ep2_"===pref){pref_form_input_full_name=ep2_form_input_full_name,pref_form_input_first_name=ep2_form_input_first_name,pref_form_input_last_name=ep2_form_input_last_name,pref_form_input_email=ep2_form_input_email,pref_form_input_phone=ep2_form_input_phone,pref_form_input_opt_in=ep2_form_input_opt_in;for(f=1;f<=customFieldsLimit;f++)form_input_obj["pref_form_input_custom"+f]=form_input_obj["ep2_form_input_custom"+f]}else if("ep3_"===pref){pref_form_input_full_name=ep3_form_input_full_name,pref_form_input_first_name=ep3_form_input_first_name,pref_form_input_last_name=ep3_form_input_last_name,pref_form_input_email=ep3_form_input_email,pref_form_input_phone=ep3_form_input_phone,pref_form_input_opt_in=ep3_form_input_opt_in;for(f=1;f<=customFieldsLimit;f++)form_input_obj["pref_form_input_custom"+f]=form_input_obj["ep3_form_input_custom"+f]}else if("ep4_"===pref){pref_form_input_full_name=ep4_form_input_full_name,pref_form_input_first_name=ep4_form_input_first_name,pref_form_input_last_name=ep4_form_input_last_name,pref_form_input_email=ep4_form_input_email,pref_form_input_phone=ep4_form_input_phone,pref_form_input_opt_in=ep4_form_input_opt_in;for(f=1;f<=customFieldsLimit;f++)form_input_obj["pref_form_input_custom"+f]=form_input_obj["ep4_form_input_custom"+f]}else if(0===pref.indexOf("ep")){var pNum=DUTIL.getExtraPageNumberFromEPString(pref);$("#ep"+pNum+"_form_input_full_name").length&&(pref_form_input_full_name=$("#ep"+pNum+"_form_input_full_name")),$("#ep"+pNum+"_form_input_first_name").length&&(pref_form_input_first_name=$("#ep"+pNum+"_form_input_first_name")),$("#ep"+pNum+"_form_input_last_name").length&&(pref_form_input_last_name=$("#ep"+pNum+"_form_input_last_name")),$("#ep"+pNum+"_form_input_email").length&&(pref_form_input_email=$("#ep"+pNum+"_form_input_email")),$("#ep"+pNum+"_form_input_phone").length&&(pref_form_input_phone=$("#ep"+pNum+"_form_input_phone")),$("#ep"+pNum+"_form_input_opt_in").length&&(pref_form_input_opt_in=$("#ep"+pNum+"_form_input_opt_in"));for(f=1;f<=customFieldsLimit;f++)form_input_obj.hasOwnProperty("ep"+pNum+"_form_input_custom"+f)&&(form_input_obj["pref_form_input_custom"+f]=form_input_obj["ep"+pNum+"_form_input_custom"+f])}else{pref_form_input_full_name=form_input_full_name,pref_form_input_first_name=form_input_first_name,pref_form_input_last_name=form_input_last_name,pref_form_input_email=form_input_email,pref_form_input_phone=form_input_phone,pref_form_input_opt_in=form_input_opt_in;for(f=1;f<=customFieldsLimit;f++)form_input_obj["pref_form_input_custom"+f]=form_input_obj["form_input_custom"+f]}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"setPrefFormInputs")}}function validateForm(data,page_pref,get_data_only,override_data){try{var pref="";if("object"==typeof data&&null!==data||(data={}),"boolean"!=typeof get_data_only&&(get_data_only=!1),"boolean"!=typeof override_data&&(override_data=!1),logger("(BOX #"+LIGHTBOX_SHORT_ID+") - validateForm("+(pref=null===page_pref||"string"!=typeof page_pref||"main"===page_pref?"":page_pref)+", "+get_data_only+")"),setPrefFormInputs(pref),settings.hasOwnProperty(pref+"name")&&settings[pref+"name"].display)if("full"==settings[pref+"name"].mode){if(data.hasOwnProperty("name")&&!override_data||(data.name=pref_form_input_full_name.val().trim()),!get_data_only){if(settings[pref+"name"].require&&0==data.name.length)return settings[pref+"name"].hasOwnProperty("error_text")&&settings[pref+"name"].error_text?showError(pref,"name",settings[pref+"name"].error_text):showError(pref,"name",settings[pref+"name"].label+" is required."),!1;if(data.name.length>100)return settings[pref+"name"].hasOwnProperty("error_text")&&settings[pref+"name"].error_text?showError(pref,"name",settings[pref+"name"].error_text):showError(pref,"name",settings[pref+"name"].label+" must be less than 100 characters."),!1}var fl=getFirstLastNames(data.name);data.hasOwnProperty("first_name")&&!override_data||(data.first_name=fl[0]),data.hasOwnProperty("last_name")&&!override_data||(data.last_name=fl[1])}else if("first"==settings[pref+"name"].mode){if(data.hasOwnProperty("first_name")&&!override_data||(data.first_name=pref_form_input_first_name.val().trim()),!get_data_only){if(settings[pref+"name"].require&&0==data.first_name.length)return settings[pref+"name"].hasOwnProperty("error_text")&&settings[pref+"name"].error_text?showError(pref,"name",settings[pref+"name"].error_text):showError(pref,"name",settings[pref+"name"].label+" is required."),!1;if(data.first_name.length>100)return settings[pref+"name"].hasOwnProperty("error_text")&&settings[pref+"name"].error_text?showError(pref,"name",settings[pref+"name"].error_text):showError(pref,"name",settings[pref+"name"].label+" must be less than 100 characters."),!1}data.hasOwnProperty("name")&&!override_data||(data.name=data.first_name),data.hasOwnProperty("last_name")&&!override_data||(data.last_name="")}else if("both"==settings[pref+"name"].mode){if(data.hasOwnProperty("first_name")&&!override_data||(data.first_name=pref_form_input_first_name.val().trim()),data.hasOwnProperty("last_name")&&!override_data||(data.last_name=pref_form_input_last_name.val().trim()),!get_data_only){if(settings[pref+"name"].require&&(0==data.first_name.length||0==data.last_name.length))return settings[pref+"name"].hasOwnProperty("error_text")&&settings[pref+"name"].error_text?showError(pref,"name",settings[pref+"name"].error_text):showError(pref,"name","First Name and Last Name are both required."),!1;if(data.first_name.length>100)return settings[pref+"name"].hasOwnProperty("error_text")&&settings[pref+"name"].error_text?showError(pref,"name",settings[pref+"name"].error_text):showError(pref,"name","First Name must be less than 100 characters."),!1;if(data.last_name.length>100)return settings[pref+"name"].hasOwnProperty("error_text")&&settings[pref+"name"].error_text?showError(pref,"name",settings[pref+"name"].error_text):showError(pref,"name","Last Name must be less than 100 characters."),!1}data.hasOwnProperty("name")&&!override_data||(data.name=getFullName(data.first_name,data.last_name))}if(settings.hasOwnProperty(pref+"email")&&settings[pref+"email"].display&&(data.hasOwnProperty("email")&&!override_data||(data.email=pref_form_input_email.val().trim()),!get_data_only)){if(settings[pref+"email"].require&&0==data.email.length)return settings[pref+"email"].hasOwnProperty("error_text")&&settings[pref+"email"].error_text?showError(pref,"email",settings[pref+"email"].error_text):showError(pref,"email",settings[pref+"email"].label+" is required."),!1;if(data.email.length>200)return settings[pref+"email"].hasOwnProperty("error_text")&&settings[pref+"email"].error_text?showError(pref,"email",settings[pref+"email"].error_text):showError(pref,"email",settings[pref+"email"].label+" must be less than 100 characters."),!1;if(!DAPI.isValidEmail(data.email)&&(data.email.length>0||0==data.email.length&&settings[pref+"email"].require))return settings[pref+"email"].hasOwnProperty("error_text")&&settings[pref+"email"].error_text?showError(pref,"email",settings[pref+"email"].error_text):showError(pref,"email",settings[pref+"email"].label+" is in an invalid format."),!1}if(settings.hasOwnProperty(pref+"phone")&&settings[pref+"phone"].display){var phoneInputVal=pref_form_input_phone.val().trim(),ignoreSubmitFormatFor_US_Phone=!1;if(data.hasOwnProperty("phone")&&!override_data||(settings[pref+"phone"].enable_country_code&&settings[pref+"phone"].country_code&&phoneInputVal?(data.phone=$("#"+pref+"form_input_country_code").val()+phoneInputVal,"+1"===$("#"+pref+"form_input_country_code").val()&&(ignoreSubmitFormatFor_US_Phone=!0)):phoneInputVal&&(data.phone=phoneInputVal)),!boxapi.getFieldMetadata(pref,"phone","phone_submit")&&settings[pref+"phone"].hasOwnProperty("submit_format")&&settings[pref+"phone"].submit_format||settings[pref+"phone"].hasOwnProperty("display_format")&&settings[pref+"phone"].display_format||settings[pref+"phone"].enable_country_code){let phone_format=formatPhoneSubmit(settings[pref+"phone"].enable_country_code?data.phone:phoneInputVal,ignoreSubmitFormatFor_US_Phone?"(xxx) xxx-xxxx":settings[pref+"phone"].display_format,ignoreSubmitFormatFor_US_Phone?"":settings[pref+"phone"].submit_format,pref);if(!phone_format.success&&!get_data_only&&settings[pref+"phone"].require&&settings[pref+"phone"].error_text)return showError(pref,"phone",settings[pref+"phone"].error_text),!1;if(!(phone_format.success||get_data_only&&!settings[pref+"phone"].require||!settings[pref+"phone"].require&&!phoneInputVal))return showError(pref,"phone",phone_format.message),!1;phone_format.success&&phone_format.message&&(data.phone=phone_format.message)}if(!get_data_only){const phoneLength="string"==typeof data.phone&&data.phone.replace("+","").length;if(settings[pref+"phone"].require&&0==phoneLength)return settings[pref+"phone"].hasOwnProperty("error_text")&&settings[pref+"phone"].error_text?showError(pref,"phone",settings[pref+"phone"].error_text):showError(pref,"phone",settings[pref+"phone"].label+" is required."),!1;if(settings[pref+"phone"].require&&!settings[pref+"phone"].submit_format&&settings[pref+"phone"].enable_country_code&&settings[pref+"phone"].country_code&&(phoneLength<8||phoneLength>15))return settings[pref+"phone"].hasOwnProperty("error_text")&&settings[pref+"phone"].error_text?showError(pref,"phone",settings[pref+"phone"].error_text):showError(pref,"phone",settings[pref+"phone"].label+" must be between 8 to 15 characters."),!1;if(phoneLength>20)return settings[pref+"phone"].hasOwnProperty("error_text")&&settings[pref+"phone"].error_text?showError(pref,"phone",settings[pref+"phone"].error_text):showError(pref,"phone",settings[pref+"phone"].label+" must be less than 20 characters."),!1;if(settings[pref+"phone"].require&&settings[pref+"phone"].hasOwnProperty("validation")&&settings[pref+"phone"].validation&&phoneLength>0){if(data.phone=data.phone.replace(/\D/g,""),"phone_10"===settings[pref+"phone"].validation&&10!==phoneLength)return settings[pref+"phone"].hasOwnProperty("error_text")&&settings[pref+"phone"].error_text?showError(pref,"phone",settings[pref+"phone"].error_text):showError(pref,"phone",settings[pref+"phone"].label+" must be 10 digits."),!1;if("phone_usa"===settings[pref+"phone"].validation){if(10===phoneLength&&(data.phone="1"+data.phone),11!==phoneLength||0!==data.phone.indexOf("1"))return settings[pref+"phone"].hasOwnProperty("error_text")&&settings[pref+"phone"].error_text?showError(pref,"phone",settings[pref+"phone"].error_text):showError(pref,"phone",settings[pref+"phone"].label+" must be 11 digits and start with 1."),!1}else{if("phone_any"===settings[pref+"phone"].validation&&11!==phoneLength)return settings[pref+"phone"].hasOwnProperty("error_text")&&settings[pref+"phone"].error_text?showError(pref,"phone",settings[pref+"phone"].error_text):showError(pref,"phone",settings[pref+"phone"].label+" must be 11 digits."),!1;if("phone_eu"===settings[pref+"phone"].validation){var count_x=(settings[pref+"phone"].submit_format.match(/x/g)||[]).length;if(phoneLength!==count_x)return settings[pref+"phone"].hasOwnProperty("error_text")&&settings[pref+"phone"].error_text?showError(pref,"phone",settings[pref+"phone"].error_text):showError(pref,"phone",settings[pref+"phone"].label+" must be "+count_x+" digits."),!1}else if("phone_i8n"===settings[pref+"phone"].validation&&(phoneLength<8||phoneLength>15))return settings[pref+"phone"].hasOwnProperty("error_text")&&settings[pref+"phone"].error_text?showError(pref,"phone",settings[pref+"phone"].error_text):showError(pref,"phone",settings[pref+"phone"].label+"  must be min 8 to max 15 digits."),!1}}}}for(var n=1;n<=customFieldsLimit;n++)if(pref_form_input_customN=form_input_obj["pref_form_input_custom"+n],settings.hasOwnProperty(pref+"custom"+n)&&settings[pref+"custom"+n].display){if((!data.hasOwnProperty("custom_"+n)||override_data)&&settings[pref+"custom"+n].hasOwnProperty("field_type")&&"datedrop"!==settings[pref+"custom"+n].field_type&&"radio"!==settings[pref+"custom"+n].field_type&&pref_form_input_customN&&pref_form_input_customN.length)pref_form_input_customN.val()&&"object"==typeof pref_form_input_customN.val()?(data["custom_"+n]=pref_form_input_customN.val().join(","),0===data["custom_"+n].indexOf(",")&&(data["custom_"+n]=data["custom_"+n].substr(1))):data["custom_"+n]=pref_form_input_customN.val()||"";else if((!data.hasOwnProperty("custom_"+n)||override_data)&&settings[pref+"custom"+n].hasOwnProperty("field_type")&&"radio"==settings[pref+"custom"+n].field_type&&($("input[name="+pref+"form_input_custom"+n+"]:checked").length?data["custom_"+n]=$("input[name="+pref+"form_input_custom"+n+"]:checked").val():data["custom_"+n]="",!get_data_only&&settings[pref+"custom"+n].require&&!data["custom_"+n]))return settings[pref+"custom"+n].hasOwnProperty("error_text")&&settings[pref+"custom"+n].error_text?showError(pref,"custom"+n,settings[pref+"custom"+n].error_text):showError(pref,"custom"+n,settings[pref+"custom"+n].label+" is required."),!1;if(!evaluateCustomNCheckbox(data,pref,""+n,get_data_only,LBOX.INTEGRATION_MAP,LIGHTBOX_OR_VARIATION_GUID))return!1;if(!evalCustomNDatedrop(data,pref,""+n,get_data_only))return!1;if(!get_data_only){if(settings[pref+"custom"+n].hasOwnProperty("field_type")&&"hidden"!==settings[pref+"custom"+n].field_type&&"checkbox"!==settings[pref+"custom"+n].field_type&&"radio"!==settings[pref+"custom"+n].field_type&&"datedrop"!==settings[pref+"custom"+n].field_type&&settings[pref+"custom"+n].require&&0==data["custom_"+n].length)return settings[pref+"custom"+n].hasOwnProperty("error_text")&&settings[pref+"custom"+n].error_text?showError(pref,"custom"+n,settings[pref+"custom"+n].error_text):showError(pref,"custom"+n,settings[pref+"custom"+n].label+" is required."),!1;if(data["custom_"+n]&&data["custom_"+n].length>0&&"textarea"===settings[pref+"custom"+n].field_type&&settings[pref+"custom"+n].hasOwnProperty("textarea_max_length")&&settings[pref+"custom"+n].textarea_max_length){let textarea_max_length=parseInt(settings[pref+"custom"+n].textarea_max_length);if((textarea_max_length<=0||textarea_max_length>1e4)&&(textarea_max_length=1e3),data["custom_"+n].length>textarea_max_length)return showError(pref,"custom"+n,settings[pref+"custom"+n].label+" must be less than "+textarea_max_length+" characters."),!1}else if(data["custom_"+n]&&data["custom_"+n].length>5e3)return settings[pref+"custom"+n].hasOwnProperty("error_text")&&settings[pref+"custom"+n].error_text?showError(pref,"custom"+n,settings[pref+"custom"+n].error_text):showError(pref,"custom"+n,settings[pref+"custom"+n].label+" must be less than 5000 characters."),!1;if(settings[pref+"custom"+n].hasOwnProperty("validation")&&settings[pref+"custom"+n].validation&&data["custom_"+n].length>0&&"textbox"===settings[pref+"custom"+n].field_type)if("email_basic"===settings[pref+"custom"+n].validation){if(!DAPI.isValidEmail(data["custom_"+n]))return settings[pref+"custom"+n].hasOwnProperty("error_text")&&settings[pref+"custom"+n].error_text?showError(pref,"custom"+n,settings[pref+"custom"+n].error_text):showError(pref,"custom"+n,settings[pref+"custom"+n].label+" is not a valid Email."),!1}else if("phone_10"===settings[pref+"custom"+n].validation){if(data["custom_"+n]=data["custom_"+n].replace(/\D/g,""),10!==data["custom_"+n].length)return settings[pref+"custom"+n].hasOwnProperty("error_text")&&settings[pref+"custom"+n].error_text?showError(pref,"custom"+n,settings[pref+"custom"+n].error_text):showError(pref,"custom"+n,settings[pref+"custom"+n].label+" must be 10 digits."),!1}else if("phone_usa"===settings[pref+"custom"+n].validation){if(data["custom_"+n]=data["custom_"+n].replace(/\D/g,""),10===data["custom_"+n].length&&0!==data["custom_"+n].indexOf("1")&&(data["custom_"+n]="1"+data["custom_"+n]),11!==data["custom_"+n].length||0!==data["custom_"+n].indexOf("1"))return settings[pref+"custom"+n].hasOwnProperty("error_text")&&settings[pref+"custom"+n].error_text?showError(pref,"custom"+n,settings[pref+"custom"+n].error_text):showError(pref,"custom"+n,settings[pref+"custom"+n].label+" must be 11 digits and start with 1."),!1}else if("phone_any"===settings[pref+"custom"+n].validation){if(data["custom_"+n]=data["custom_"+n].replace(/\D/g,""),11!==data["custom_"+n].length)return settings[pref+"custom"+n].hasOwnProperty("error_text")&&settings[pref+"custom"+n].error_text?showError(pref,"custom"+n,settings[pref+"custom"+n].error_text):showError(pref,"custom"+n,settings[pref+"custom"+n].label+" must be 11 digits."),!1}else if("phone_eu"===settings[pref+"custom"+n].validation){if(data["custom_"+n]=data["custom_"+n].replace(/\D/g,""),data["custom_"+n].length<12||data["custom_"+n].length>13)return settings[pref+"custom"+n].hasOwnProperty("error_text")&&settings[pref+"custom"+n].error_text?showError(pref,"custom"+n,settings[pref+"custom"+n].error_text):showError(pref,"custom"+n,settings[pref+"custom"+n].label+" must be 12 or 13 digits."),!1}else if("phone_i8n"===settings[pref+"custom"+n].validation&&(data["custom_"+n]=data["custom_"+n].replace(/\D/g,""),data["custom_"+n].length<8||data["custom_"+n].length>15))return settings[pref+"custom"+n].hasOwnProperty("error_text")&&settings[pref+"custom"+n].error_text?showError(pref,"custom"+n,settings[pref+"custom"+n].error_text):showError(pref,"custom"+n,settings[pref+"custom"+n].label+" must be min 8 to max 15 digits."),!1}}else settings.hasOwnProperty(pref+"custom"+n)&&!data.hasOwnProperty("custom_"+n)&&pref_form_input_customN&&pref_form_input_customN.length?pref_form_input_customN.val()&&"object"==typeof pref_form_input_customN.val()?(data["custom_"+n]=pref_form_input_customN.val().join(","),0===data["custom_"+n].indexOf(",")&&(data["custom_"+n]=data["custom_"+n].substr(1))):data["custom_"+n]=pref_form_input_customN.val():settings.hasOwnProperty(pref+"custom"+n)&&!data.hasOwnProperty("custom_"+n)&&settings[pref+"custom"+n].hasOwnProperty("field_type")&&"datedrop"===settings[pref+"custom"+n].field_type&&$("#"+pref+"form_input_custom"+n+"_datedrop_yyyy").length&&evalCustomNDatedrop(data,pref,""+n,!0);if(settings.hasOwnProperty(pref+"opt_in")&&settings[pref+"opt_in"].display&&(data.hasOwnProperty("opt_in")&&!override_data||(data.opt_in=pref_form_input_opt_in[0].checked?"true":"false"),!get_data_only&&settings[pref+"opt_in"].require&&"false"==data.opt_in))return settings[pref+"opt_in"].hasOwnProperty("error_text")&&settings[pref+"opt_in"].error_text?showError(pref,"opt_in",settings[pref+"opt_in"].error_text):showError(pref,"opt_in","Checkbox is required."),!1;if(boxapi.setFormData(data),data=setFormDataLayer(pref,data),DIGIOH_PRQ.isResultsPagePRQ(pref))for(var prop in data)data.hasOwnProperty(prop)&&"string"==typeof data[prop]&&data[prop].indexOf("[PRQ:")>=0&&(logger("replaceCustomFieldMergeTagPRQ: "+prop+"="+data[prop]),data[prop]=DIGIOH_PRQ.replaceMergeTagsPRQ(data[prop]),logger("replaceCustomFieldMergeTagPRQ: "+prop+"="+data[prop]));return data}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"validateForm"),data}}function setFormDataLayer(pref,data){try{var pref_fsdbx=pref;""!==pref&&pref||(pref_fsdbx="main_"),pref_fsdbx.indexOf("_")<0&&(pref_fsdbx+="_"),data.hasOwnProperty("name")&&(data[pref_fsdbx+"name"]=data.name),data.hasOwnProperty("first_name")&&(data[pref_fsdbx+"first_name"]=data.first_name),data.hasOwnProperty("last_name")&&(data[pref_fsdbx+"last_name"]=data.last_name),data.hasOwnProperty("email")&&(data[pref_fsdbx+"email"]=data.email),data.hasOwnProperty("phone")&&(data[pref_fsdbx+"phone"]=data.phone),data.hasOwnProperty("opt_in")&&(data[pref_fsdbx+"opt_in"]=data.opt_in);for(var n=1;n<=customFieldsLimit;n++)data.hasOwnProperty("custom_"+n)&&""!==data["custom_"+n]&&null!==data["custom_"+n]&&void 0!==data["custom_"+n]&&(data[pref_fsdbx+"custom_"+n]=data["custom_"+n]),data.hasOwnProperty("custom_"+n)&&null!==data["custom_"+n]&&void 0!==data["custom_"+n]&&data["custom_"+n].toString().length>0?addCustomFieldToPageAnswers(pref,pref+"custom_"+n,data["custom_"+n].toString(),"form"):removeCustomFieldFromPageAnswers(pref,pref+"custom_"+n,"form");var data_fsdbx=LBOX.DIGIOH_LOCAL_STORAGE.getManual("fsdbx");if("object"!=typeof data_fsdbx||!data_fsdbx)return data;for(var pr="",x=1;x<=102;x++)if(x<=100?pr="ep"+x+"_":101===x?pr="thx_":102===x&&(pr="main_"),pr!==pref_fsdbx){data_fsdbx.hasOwnProperty(pr+"name")&&(data[pr+"name"]=data_fsdbx[pr+"name"]),data_fsdbx.hasOwnProperty(pr+"first_name")&&(data[pr+"first_name"]=data_fsdbx[pr+"first_name"]),data_fsdbx.hasOwnProperty(pr+"last_name")&&(data[pr+"last_name"]=data_fsdbx[pr+"last_name"]),data_fsdbx.hasOwnProperty(pr+"email")&&(data[pr+"email"]=data_fsdbx[pr+"email"]),data_fsdbx.hasOwnProperty(pr+"phone")&&(data[pr+"phone"]=data_fsdbx[pr+"phone"]),data_fsdbx.hasOwnProperty(pr+"opt_in")&&(data[pr+"opt_in"]=data_fsdbx[pr+"opt_in"]);for(n=1;n<=customFieldsLimit;n++)data_fsdbx.hasOwnProperty(pr+"custom_"+n)&&(data[pr+"custom_"+n]=data_fsdbx[pr+"custom_"+n])}else{!data_fsdbx.hasOwnProperty(pr+"name")||!data_fsdbx[pr+"name"]||data.hasOwnProperty(pr+"name")&&data[pr+"name"]||(data[pr+"name"]=data_fsdbx[pr+"name"]),!data_fsdbx.hasOwnProperty(pr+"first_name")||!data_fsdbx[pr+"first_name"]||data.hasOwnProperty(pr+"first_name")&&data[pr+"first_name"]||(data[pr+"first_name"]=data_fsdbx[pr+"first_name"]),!data_fsdbx.hasOwnProperty(pr+"last_name")||!data_fsdbx[pr+"last_name"]||data.hasOwnProperty(pr+"last_name")&&data[pr+"last_name"]||(data[pr+"last_name"]=data_fsdbx[pr+"last_name"]),!data_fsdbx.hasOwnProperty(pr+"email")||!data_fsdbx[pr+"email"]||data.hasOwnProperty(pr+"email")&&data[pr+"email"]||(data[pr+"email"]=data_fsdbx[pr+"email"]),!data_fsdbx.hasOwnProperty(pr+"phone")||!data_fsdbx[pr+"phone"]||data.hasOwnProperty(pr+"phone")&&data[pr+"phone"]||(data[pr+"phone"]=data_fsdbx[pr+"phone"]),!data_fsdbx.hasOwnProperty(pr+"opt_in")||""===data_fsdbx[pr+"opt_in"]||data.hasOwnProperty(pr+"opt_in")&&""!=data[pr+"opt_in"]||(data[pr+"opt_in"]=data_fsdbx[pr+"opt_in"]);for(n=1;n<=customFieldsLimit;n++)!data_fsdbx.hasOwnProperty(pr+"custom_"+n)||""===data_fsdbx[pr+"custom_"+n]||data.hasOwnProperty(pr+"custom_"+n)&&""!=data[pr+"custom_"+n]||(data[pr+"custom_"+n]=data_fsdbx[pr+"custom_"+n])}!data_fsdbx.hasOwnProperty("name")||!data_fsdbx.name||data.hasOwnProperty("name")&&data.name||(data.name=data_fsdbx.name),!data_fsdbx.hasOwnProperty("first_name")||!data_fsdbx.first_name||data.hasOwnProperty("first_name")&&data.first_name||(data.first_name=data_fsdbx.first_name),!data_fsdbx.hasOwnProperty("last_name")||!data_fsdbx.last_name||data.hasOwnProperty("last_name")&&data.last_name||(data.last_name=data_fsdbx.last_name),!data_fsdbx.hasOwnProperty("email")||!data_fsdbx.email||data.hasOwnProperty("email")&&data.email||(data.email=data_fsdbx.email),!data_fsdbx.hasOwnProperty("phone")||!data_fsdbx.phone||data.hasOwnProperty("phone")&&data.phone||(data.phone=data_fsdbx.phone),!data_fsdbx.hasOwnProperty("opt_in")||""===data_fsdbx.opt_in||data.hasOwnProperty("opt_in")&&""!=data.opt_in||(data.opt_in=data_fsdbx.opt_in);for(n=1;n<=customFieldsLimit;n++)!data_fsdbx.hasOwnProperty("custom_"+n)||""===data_fsdbx["custom_"+n]||data.hasOwnProperty("custom_"+n)&&""!=data["custom_"+n]||(data["custom_"+n]=data_fsdbx["custom_"+n]);return data}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"setFormDataLayer"),data}}function evalCustomNDatedrop(data,pref,n,get_data_only){try{function getCurrentAgeFromDateOfBirth(year,month,day){var curr_date=new Date,birth_date=new Date(year,month-1,day),age=curr_date.getFullYear()-birth_date.getFullYear(),monthDiff=curr_date.getMonth()-birth_date.getMonth();return(monthDiff<0||0===monthDiff&&curr_date.getDate()<birth_date.getDate())&&age--,age}var propName=pref+"custom"+n;if(settings[propName].hasOwnProperty("field_type")&&"datedrop"===settings[propName].field_type){var dropdown_yyyy=$("#"+pref+"form_input_custom"+n+"_datedrop_yyyy").val(),dropdown_mm=$("#"+pref+"form_input_custom"+n+"_datedrop_mm").val(),dropdown_dd=$("#"+pref+"form_input_custom"+n+"_datedrop_dd").val(),output_format="";output_format=settings[propName].datedrop.custom_format&&!UTIL.isNullOrWhitespace(settings[propName].datedrop.custom_format)?settings[propName].datedrop.custom_format:settings[propName].datedrop.output_format?settings[propName].datedrop.output_format:"MM-dd-yyyy";var sep="";output_format.indexOf("-")>0&&output_format.indexOf("-")<=7?sep="-":output_format.indexOf("/")>0&&output_format.indexOf("/")<=7?sep="/":output_format.indexOf(".")>0&&output_format.indexOf(".")<=7&&(sep=".");for(var mm_format="MM",dd_format="dd",yyyy_format="yyyy",output_parts=output_format.split(sep),i=0;i<output_parts.length;i++)UTIL.stringOrArrayContains(output_parts[i],"M")?mm_format=output_parts[i]:UTIL.stringOrArrayContains(output_parts[i],"d")?dd_format=output_parts[i]:UTIL.stringOrArrayContains(output_parts[i],"y")&&(yyyy_format=output_parts[i]);UTIL.stringOrArrayContains(output_format,"MM")&&1==dropdown_mm.length?dropdown_mm="0"+dropdown_mm:!UTIL.stringOrArrayContains(output_format,"MM")&&UTIL.stringOrArrayContains(output_format,"M")&&2==dropdown_mm.length&&0===dropdown_mm.indexOf("0")?dropdown_mm=dropdown_mm.substring(1):0==dropdown_mm.length&&(dropdown_mm="MM"),UTIL.stringOrArrayContains(output_format,"dd")&&1==dropdown_dd.length?dropdown_dd="0"+dropdown_dd:!UTIL.stringOrArrayContains(output_format,"dd")&&UTIL.stringOrArrayContains(output_format,"d")&&2==dropdown_dd.length&&0===dropdown_dd.indexOf("0")?dropdown_dd=dropdown_dd.substring(1):0==dropdown_dd.length&&(dropdown_dd="dd"),!UTIL.stringOrArrayContains(output_format,"yyyy")&&UTIL.stringOrArrayContains(output_format,"yy")&&(4==dropdown_yyyy.length&&(dropdown_yyyy=dropdown_yyyy.substring(2)),0==dropdown_yyyy.length&&(dropdown_yyyy="yy"));var isValidDateSelected=!1;""!==dropdown_mm&&"mm"!==dropdown_mm.toLowerCase()&&"m"!==!dropdown_mm.toLowerCase()&&""!==dropdown_dd&&"dd"!==dropdown_dd.toLowerCase()&&"d"!==!dropdown_dd.toLowerCase()&&""!==dropdown_yyyy&&"yyyy"!==dropdown_yyyy.toLowerCase()&&"yy"!==dropdown_yyyy.toLowerCase()&&"y"!==dropdown_yyyy.toLowerCase()&&(isValidDateSelected=!0);var caseN="";if(isValidDateSelected||settings[propName].require?output_format==mm_format+sep+dd_format+sep+yyyy_format?(data["custom_"+n]=dropdown_mm+sep+dropdown_dd+sep+dropdown_yyyy,caseN="1"):output_format==dd_format+sep+mm_format+sep+yyyy_format?(data["custom_"+n]=dropdown_dd+sep+dropdown_mm+sep+dropdown_yyyy,caseN="2"):output_format==yyyy_format+sep+mm_format+sep+dd_format?(data["custom_"+n]=dropdown_yyyy+sep+dropdown_mm+sep+dropdown_dd,caseN="3"):(data["custom_"+n]=$("#"+pref+"form_input_custom"+n+"_datedrop_mm").val()+"-"+$("#"+pref+"form_input_custom"+n+"_datedrop_dd").val()+"-"+$("#"+pref+"form_input_custom"+n+"_datedrop_yyyy").val(),caseN="4"):(data["custom_"+n]="",caseN="0"),logger("(BOX #"+LIGHTBOX_SHORT_ID+") - evalCustomNDatedrop: "+data["custom_"+n]+" (case "+caseN+")"),logger("(BOX #"+LIGHTBOX_SHORT_ID+") - output_format="+output_format+", mm_format="+mm_format+", dd_format="+dd_format+", yyyy_format="+yyyy_format+", sep="+sep),!get_data_only){if(settings[propName].require&&(!dropdown_mm||"mm"==dropdown_mm.toLowerCase()||"m"==dropdown_mm.toLowerCase()))return settings[propName].require?settings[propName].hasOwnProperty("error_text")&&settings[propName].error_text?showError(pref,"custom"+n,settings[propName].error_text):showError(pref,"custom"+n,settings[propName].label+" is required."):settings[propName].hasOwnProperty("error_text")&&settings[propName].error_text?showError(pref,"custom"+n,settings[propName].error_text):showError(pref,"custom"+n,settings[propName].label+" invalid date."),!1;if(settings[propName].require&&(!dropdown_dd||"dd"==dropdown_dd.toLowerCase()||"d"==dropdown_dd.toLowerCase()))return settings[propName].require?settings[propName].hasOwnProperty("error_text")&&settings[propName].error_text?showError(pref,"custom"+n,settings[propName].error_text):showError(pref,"custom"+n,settings[propName].label+" is required."):settings[propName].hasOwnProperty("error_text")&&settings[propName].error_text?showError(pref,"custom"+n,settings[propName].error_text):showError(pref,"custom"+n,settings[propName].label+" invalid date."),!1;if(settings[propName].require&&(!dropdown_yyyy||"yyyy"==dropdown_yyyy.toLowerCase()||"yy"==dropdown_yyyy.toLowerCase()||"y"==dropdown_yyyy.toLowerCase()))return settings[propName].require?settings[propName].hasOwnProperty("error_text")&&settings[propName].error_text?showError(pref,"custom"+n,settings[propName].error_text):showError(pref,"custom"+n,settings[propName].label+" is required."):settings[propName].hasOwnProperty("error_text")&&settings[propName].error_text?showError(pref,"custom"+n,settings[propName].error_text):showError(pref,"custom"+n,settings[propName].label+" invalid date."),!1;if(isValidDateSelected){if(settings[propName].datedrop.min_age){var sel_mm=parseInt(dropdown_mm),sel_dd=parseInt(dropdown_dd),sel_yyyy=parseInt(dropdown_yyyy),min_age=parseInt(settings[propName].datedrop.min_age);if(getCurrentAgeFromDateOfBirth(sel_yyyy,sel_mm,sel_dd)<min_age)return settings[propName].hasOwnProperty("error_text")&&settings[propName].error_text?showError(pref,"custom"+n,settings[propName].error_text):showError(pref,"custom"+n,"You must be "+min_age+" years old."),!1}if(settings[propName].datedrop.max_age){sel_mm=parseInt(dropdown_mm),sel_dd=parseInt(dropdown_dd),sel_yyyy=parseInt(dropdown_yyyy);var max_age=parseInt(settings[propName].datedrop.max_age);if(getCurrentAgeFromDateOfBirth(sel_yyyy,sel_mm,sel_dd)>max_age)return settings[propName].hasOwnProperty("error_text")&&settings[propName].error_text?showError(pref,"custom"+n,settings[propName].error_text):showError(pref,"custom"+n,"You are over "+max_age+" years old."),!1}}}}return!0}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"evalCustomNDatedrop"),!1}}function evaluateCustomNCheckbox(data,pref,n,get_data_only,integration_map,lbguid){try{var propName=pref+"custom"+n;if(settings[propName].hasOwnProperty("field_type")&&"checkbox"===settings[propName].field_type){var cb=document.getElementById(pref+"form_input_custom"+n);if(cb&&cb.checked?("string"==typeof settings[propName].checkbox.checkedval?"[BLANK]"===settings[propName].checkbox.checkedval?data["custom_"+n]="":""===settings[propName].checkbox.checkedval?data["custom_"+n]="true":data["custom_"+n]=settings[propName].checkbox.checkedval:data["custom_"+n]="true",settings[propName].checkbox.integration_id&&boxapi.addBoxIntegration(settings[propName].checkbox.integration_id)):("string"==typeof settings[propName].checkbox.uncheckedval?"[BLANK]"===settings[propName].checkbox.uncheckedval?data["custom_"+n]="":""===settings[propName].checkbox.uncheckedval?data["custom_"+n]="false":data["custom_"+n]=settings[propName].checkbox.uncheckedval:data["custom_"+n]="false",settings[propName].checkbox.integration_id&&boxapi.removeBoxIntegration(settings[propName].checkbox.integration_id)),logger("(BOX #"+LIGHTBOX_SHORT_ID+") - evaluateCustomNCheckbox(custom_"+n+") ==> "+data["custom_"+n]),!get_data_only&&settings[propName].require&&!cb.checked)return settings[propName].hasOwnProperty("error_text")&&settings[propName].error_text?showError(pref,"custom"+n,settings[propName].error_text):showError(pref,"custom"+n,settings[propName].label+" is required."),!1}return!0}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"evaluateCustomNCheckbox"),!1}}function showError(pref,propName,msg){if(autoClose=!0,boxapi.findMetadata){var autoCloseControl=boxapi.findMetadata("auto_close_error_message");if(autoCloseControl.length>0)for(var i=0;i<autoCloseControl.length&&(autoClose=autoCloseControl[i].mdVal,"box"!=autoCloseControl[i].mdLevel);i++);}if("string"==typeof pref&&void 0===propName&&void 0===msg){settings.layout.width;if(settings.fullscreen&&settings.fullscreen.use){var width=window.innerWidth-90;error_bubble.css("width",width+"px")}else CURRENT_WIDTH&&error_bubble.width(CURRENT_WIDTH-90);if(error_message.html(pref),error_bubble.show(),$(document).trigger("BOX_SHOW_ERROR",[pref,propName,msg]),$("#error_message").attr("role","status"),wasErrorBubbleAlreadyClosed=!1,autoClose&&window.setTimeout((function(){error_bubble.hide(),wasErrorBubbleAlreadyClosed||(wasErrorBubbleAlreadyClosed=!0,$(document).trigger("BOX_CLOSE_ERROR",[pref,propName,msg]),$("#error_message").removeAttr("role"))}),4e3),!settings[pref+"inputs"]||settings[pref+"inputs"].error_position.indexOf("top_and_inline")<0)return}if(pref=DUTIL.getUnfriendlyPagePrefix(pref),!propName||""===propName||!settings.hasOwnProperty(pref+propName)||!settings[pref+"inputs"].hasOwnProperty("error_position")||settings[pref+"inputs"].error_position.indexOf("top")>=0||settings[pref+"inputs"].error_position.indexOf("top_and_inline")>=0){settings.layout.width;if(settings.fullscreen&&settings.fullscreen.use){width=window.innerWidth-90;error_bubble.css("width",width+"px")}else CURRENT_WIDTH&&error_bubble.width(CURRENT_WIDTH-90);if(error_message.html(msg),error_bubble.show(),$(document).trigger("BOX_SHOW_ERROR",[pref,propName,msg]),$("#error_message").attr("role","status"),wasErrorBubbleAlreadyClosed=!1,autoClose&&window.setTimeout((function(){error_bubble.hide(),wasErrorBubbleAlreadyClosed||(wasErrorBubbleAlreadyClosed=!0,$(document).trigger("BOX_CLOSE_ERROR",[pref,propName,msg]),$("#error_message").removeAttr("role"))}),4e3),!settings[pref+"inputs"]||settings[pref+"inputs"].error_position.indexOf("top_and_inline")<0)return}(""!==propName&&settings[pref+"inputs"].hasOwnProperty("error_position")&&settings[pref+"inputs"].error_position.indexOf("inline")>=0||settings[pref+"inputs"].error_position.indexOf("top_and_inline"))&&(showInlineError(pref,propName,msg),$(document).trigger("BOX_SHOW_ERROR",[pref,propName,msg]),$("#error_message").attr("role","status"),wasErrorBubbleAlreadyClosed=!1)}function showSuccess(msg){if(autoClose=!0,"string"==typeof msg){if(settings.fullscreen&&settings.fullscreen.use){var width=window.innerWidth-90;success_bubble.css("width",width+"px")}else CURRENT_WIDTH&&success_bubble.width(CURRENT_WIDTH-90);return success_message.html(msg),success_bubble.show(),success_message.attr("role","status"),wasSuccessBubbleAlreadyClosed=!1,void(autoClose&&window.setTimeout((function(){success_bubble.hide(),wasSuccessBubbleAlreadyClosed||(wasSuccessBubbleAlreadyClosed=!0,success_message.removeAttr("role"))}),4e3))}}function showWarning(msg){if(autoClose=!0,"string"==typeof msg){if(settings.fullscreen&&settings.fullscreen.use){var width=window.innerWidth-90;warning_bubble.css("width",width+"px")}else CURRENT_WIDTH&&warning_bubble.width(CURRENT_WIDTH-90);return warning_message.html(msg),warning_bubble.show(),warning_message.attr("role","status"),wasWarningBubbleAlreadyClosed=!1,void(autoClose&&window.setTimeout((function(){warning_bubble.hide(),wasWarningBubbleAlreadyClosed||(wasWarningBubbleAlreadyClosed=!0,warning_message.removeAttr("role"))}),4e3))}}function showInlineError(pref,propName,msg){pref=DUTIL.getUnfriendlyPagePrefix(pref),"name"===propName||propName.indexOf("_name")>0?($("#"+pref+"form_input_full_name_help").length&&$("#"+pref+"form_input_full_name_help").hide(),$("#"+pref+"form_input_first_name_help").length&&$("#"+pref+"form_input_first_name_help").hide(),$("#"+pref+"form_input_last_name_help").length&&$("#"+pref+"form_input_last_name_help").hide(),$("#"+pref+"form_input_name_error_text").html(msg).show(),$("#"+pref+"form_input_full_name,#"+pref+"form_input_first_name,#"+pref+"form_input_last_name").addClass(pref+"form_inputs_error"),$("#"+pref+"form_input_full_name,#"+pref+"form_input_first_name,#"+pref+"form_input_last_name").focus((function(){$("#"+pref+"form_input_name_error_text").hide(),$("#"+pref+"form_input_full_name,#"+pref+"form_input_first_name,#"+pref+"form_input_last_name").removeClass(pref+"form_inputs_error"),settings[pref+"name"].display_help&&($("#"+pref+"form_input_full_name_help").length&&$("#"+pref+"form_input_full_name_help").show(),$("#"+pref+"form_input_first_name_help").length&&$("#"+pref+"form_input_first_name_help").show(),$("#"+pref+"form_input_last_name_help").length&&$("#"+pref+"form_input_last_name_help").show())}))):"email"===propName?($("#"+pref+"form_input_email_help").length&&$("#"+pref+"form_input_email_help").hide(),$("#"+pref+"form_input_email_error_text").html(msg).show(),$("#"+pref+"form_input_email").addClass(pref+"form_inputs_error"),$("#"+pref+"form_input_email").focus((function(){$("#"+pref+"form_input_email_error_text").hide(),$("#"+pref+"form_input_email").removeClass(pref+"form_inputs_error"),settings[pref+"email"].display_help&&$("#"+pref+"form_input_email_help").length&&$("#"+pref+"form_input_email_help").show()}))):"phone"===propName?($("#"+pref+"form_input_phone_help").length&&$("#"+pref+"form_input_phone_help").hide(),$("#"+pref+"form_input_phone_error_text").html(msg).show(),$("#"+pref+"form_input_phone").addClass(pref+"form_inputs_error"),$("#"+pref+"form_input_country_code").addClass(pref+"form_inputs_error"),$("#"+pref+"form_input_phone").focus((function(){$("#"+pref+"form_input_phone_error_text").hide(),$("#"+pref+"form_input_phone").removeClass(pref+"form_inputs_error"),$("#"+pref+"form_input_country_code").removeClass(pref+"form_inputs_error"),settings[pref+"phone"].display_help&&$("#"+pref+"form_input_phone_help").length&&$("#"+pref+"form_input_phone_help").show()}))):"opt_in"===propName?($("#"+pref+"form_input_opt_in_error_text").html(msg).show(),$("#"+pref+"form_input_opt_in").change((function(){$("#"+pref+"form_input_opt_in_error_text").hide()}))):0===propName.indexOf("custom")&&($("#"+pref+"form_input_"+propName+"_help").length&&$("#"+pref+"form_input_"+propName+"_help").hide(),$("#"+pref+"form_input_"+propName+"_error_text").html(msg).show(),"checkbox"===settings[pref+propName].field_type?$("#"+pref+"form_input_"+propName).change((function(){$("#"+pref+"form_input_"+propName+"_error_text").hide()})):"radio"===settings[pref+propName].field_type?$("#"+pref+"form_input_"+propName+"_radio_wrapper input[type=radio]").change((function(){$("#"+pref+"form_input_"+propName+"_error_text").hide()})):"datedrop"===settings[pref+propName].field_type?($("#"+pref+"form_input_"+propName+"_wrapper ."+pref+"form_inputs").addClass(pref+"form_inputs_error"),$("#"+pref+"form_input_"+propName+"_wrapper ."+pref+"form_inputs").focus((function(){$("#"+pref+"form_input_"+propName+"_error_text").hide(),$("#"+pref+"form_input_"+propName+"_wrapper ."+pref+"form_inputs").removeClass(pref+"form_inputs_error"),settings[pref+propName].display_help&&$("#"+pref+"form_input_"+propName+"_wrapper ."+pref+"form_inputs_help").show()}))):($("#"+pref+"form_input_"+propName).addClass(pref+"form_inputs_error"),$("#"+pref+"form_input_"+propName).focus((function(){$("#"+pref+"form_input_"+propName+"_error_text").hide(),$("#"+pref+"form_input_"+propName).removeClass(pref+"form_inputs_error"),settings[pref+propName].display_help&&$("#"+pref+"form_input_"+propName+"_help").length&&$("#"+pref+"form_input_"+propName+"_help").show()}))))}function checkReCaptchaOnSubmit(sobj){return new Promise(((resolve,reject)=>{if(DAPI.isCaptchaEnabled(LIGHTBOX_GUID))if(DAPI.isReCaptchaSolved){if(DAPI.isReCaptchaTested)return DAPI.isReCaptchaValid&&DAPI.isReCaptchaSolved&&resolve(),void reject("Captcha is not valid");try{$.ajax({dataType:"json",url:SUBMIT_BASE_URL+"/Keen/ReCaptchaCheck",success:function(data){data&&"object"==typeof data&&null!==data&&data.hasOwnProperty("success")&&data.success?(logger("(BOX #"+LIGHTBOX_SHORT_ID+") - checkReCaptchaOnSubmit: SUCCESS ==>"),logger(data),DAPI.isReCaptchaTested=!0,DAPI.isReCaptchaValid=!0,resolve()):(logger("(BOX #"+LIGHTBOX_SHORT_ID+") - checkReCaptchaOnSubmit: FAILURE 1 ==>"),logger(data),DAPI.isReCaptchaTested=!0,DAPI.isReCaptchaValid=!1,reject("checkReCaptchaOnSubmit: FAILURE 1"))},error:function(htmltext,textStatus,errorThrown){logger("(BOX #"+LIGHTBOX_SHORT_ID+") - checkReCaptchaOnSubmit: FAILURE 2 ==>"),logger(textStatus),DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(errorThrown,"checkReCaptchaOnSubmit"),DAPI.isReCaptchaTested=!0,DAPI.isReCaptchaValid=!1,reject("checkReCaptchaOnSubmit: FAILURE 2")}})}catch(e){logger("(BOX #"+LIGHTBOX_SHORT_ID+") - checkReCaptchaOnSubmit: FAILURE 3 ==>"),logger(e.message),DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"checkReCaptchaOnSubmit"),DAPI.isReCaptchaTested=!0,DAPI.isReCaptchaValid=!1,reject("checkReCaptchaOnSubmit: FAILURE 3")}}else reject("Captcha not checked");else resolve()}))}function processSubmit(pref,hideLoadingSpinner,bypassCoupons,useSubmitLock){try{"string"!=typeof pref&&(pref=CURRENT_PAGE),"boolean"!=typeof hideLoadingSpinner&&(hideLoadingSpinner=!1),"boolean"!=typeof bypassCoupons&&(bypassCoupons=!1),"boolean"!=typeof useSubmitLock&&(useSubmitLock=!0)}catch(e){pref=CURRENT_PAGE,hideLoadingSpinner=!1,bypassCoupons=!1,useSubmitLock=!0}return processSubmitObj({pageName:pref,hideLoadingSpinner:hideLoadingSpinner,bypassCoupons:bypassCoupons,useSubmitLock:useSubmitLock})}function processSubmitObj(sobj){var pref=CURRENT_PAGE;"object"==typeof sobj&&null!==sobj||(sobj={}),sobj&&sobj.hasOwnProperty("pageName")&&"string"==typeof sobj.pageName&&(pref=sobj.pageName);var hideLoadingSpinner=!1;sobj&&sobj.hasOwnProperty("hideLoadingSpinner")&&"boolean"==typeof sobj.hideLoadingSpinner&&(hideLoadingSpinner=sobj.hideLoadingSpinner);sobj&&sobj.hasOwnProperty("bypassCoupons")&&"boolean"==typeof sobj.bypassCoupons&&sobj.bypassCoupons;var useSubmitLock=!0;sobj&&sobj.hasOwnProperty("useSubmitLock")&&"boolean"==typeof sobj.useSubmitLock&&(useSubmitLock=sobj.useSubmitLock);var overrideFormSubmitAction="";sobj&&sobj.hasOwnProperty("overrideFormSubmitAction")&&"string"==typeof sobj.overrideFormSubmitAction&&(overrideFormSubmitAction=sobj.overrideFormSubmitAction),!pref.startsWith("ep")&&"thx"!==pref||pref.endsWith("_")?"main"===pref&&(pref=""):pref+="_";var form=settings[pref+"form"],submitAction="";form&&(submitAction=form.after_submit);var submissionPromise=new Promise(((resolve,reject)=>{if(void 0!==useSubmitLock&&useSubmitLock){if(processSubmitLock)return logger("processSubmitLock"),reject(new Error("Submit lock is active")),!1;processSubmitLock=!0;var lockTimeout=setTimeout((function(){processSubmitLock=!1}),3e3),originalResolve=resolve,originalReject=reject;resolve=function(value){clearTimeout(lockTimeout),processSubmitLock=!1,originalResolve(value)},reject=function(error){clearTimeout(lockTimeout),processSubmitLock=!1,originalReject(error)}}else useSubmitLock=!1;checkReCaptchaOnSubmit(sobj).then((()=>checkCouponsOnSubmit(sobj))).then((function(){var skipSubmission=!1;if(using_form&&""===pref||using_form_thx&&"thx_"===pref||using_form_ep1&&"ep1_"===pref||using_form_ep2&&"ep2_"===pref||using_form_ep3&&"ep3_"===pref||using_form_ep4&&"ep4_"===pref||0===pref.indexOf("ep")){if(0===pref.indexOf("ep")){var pNum=DUTIL.getExtraPageNumberFromEPString(pref);if(!settings.hasOwnProperty("ep"+pNum+"layout")||!settings.hasOwnProperty("ep"+pNum+"_form")||!settings["ep"+pNum+"_form"].display)return void resolve(!0)}settings.hasOwnProperty(pref+"form")&&settings[pref+"form"].hasOwnProperty("override_integration")&&"other"===settings[pref+"form"].override_integration&&settings[pref+"form"].hasOwnProperty("override_integration_choices")&&settings[pref+"form"].override_integration_choices?(LBOX.INTEGRATION_MAP[LIGHTBOX_OR_VARIATION_GUID]=settings[pref+"form"].override_integration_choices+",override",logger("processSubmitObj: pref="+pref+", override_integration="+settings[pref+"form"].override_integration)):settings.hasOwnProperty(pref+"form")&&settings[pref+"form"].hasOwnProperty("override_integration")&&"skip"===settings[pref+"form"].override_integration||settings.hasOwnProperty(pref+"form")&&!settings[pref+"form"].hasOwnProperty("override_integration")&&DIGIOH_PRQ.USE&&DIGIOH_PRQ.isBoxPRQ()&&!DIGIOH_PRQ.isResultsPagePRQ(pref)?(LBOX.INTEGRATION_MAP[LIGHTBOX_OR_VARIATION_GUID]="0",skipSubmission=!0,logger("processSubmitObj: pref="+pref+", override_integration="+settings[pref+"form"].override_integration)):LBOX.INTEGRATION_MAP.hasOwnProperty(LIGHTBOX_OR_VARIATION_GUID)&&((LBOX.INTEGRATION_MAP[LIGHTBOX_OR_VARIATION_GUID].toString().indexOf("override")>=0||"0"===LBOX.INTEGRATION_MAP[LIGHTBOX_OR_VARIATION_GUID])&&delete LBOX.INTEGRATION_MAP[LIGHTBOX_OR_VARIATION_GUID],logger("processSubmitObj: pref="+pref+", override_integration=run_all")),DIGIOH_PRQ.isResultsPagePRQ(pref)&&LBOX.INTEGRATION_MAP.hasOwnProperty(LIGHTBOX_OR_VARIATION_GUID)&&LBOX.INTEGRATION_MAP[LIGHTBOX_OR_VARIATION_GUID].indexOf("[PRQ:")>=0&&(logger("replaceIntegrationMapMergeTagPRQ: "+LBOX.INTEGRATION_MAP[LIGHTBOX_OR_VARIATION_GUID]),LBOX.INTEGRATION_MAP[LIGHTBOX_OR_VARIATION_GUID]=DIGIOH_PRQ.replaceMergeTagsPRQ(LBOX.INTEGRATION_MAP[LIGHTBOX_OR_VARIATION_GUID]),logger("replaceIntegrationMapMergeTagPRQ: "+LBOX.INTEGRATION_MAP[LIGHTBOX_OR_VARIATION_GUID]));var data_with_validation="",data_only=validateForm({},pref,!0,!0),customJsResBeforeFormValidation=BOX_CUSTOM_JS.runCustomJsBeforeFormValidation(data_only);if("boolean"==typeof customJsResBeforeFormValidation&&!1===customJsResBeforeFormValidation)return reject(new Error("BeforeFormValidation Failed")),!1;if("string"==typeof customJsResBeforeFormValidation&&customJsResBeforeFormValidation.trim().length>0)return showError("","",customJsResBeforeFormValidation),reject(new Error("BeforeFormValidation Failed")),!1;if("boolean"==typeof(data_with_validation="object"==typeof customJsResBeforeFormValidation&&null!==customJsResBeforeFormValidation?customJsResBeforeFormValidation:validateForm({},pref,!1,!0))&&!1===data_with_validation)return void reject(new Error("Native Form Validation Failed"));if(logger("data_with_validation ==>"),logger(data_with_validation),"object"==typeof data_with_validation&&null!==data_with_validation){var customJsResAfterFormValidation=BOX_CUSTOM_JS.runCustomJsAfterFormValidation(data_with_validation);if(logger("customJsResAfterFormValidation ==>"),logger(customJsResAfterFormValidation),"boolean"==typeof customJsResAfterFormValidation&&!1===customJsResAfterFormValidation)return reject(new Error("AfterFormValidation Failed")),!1;if("string"==typeof customJsResAfterFormValidation&&customJsResAfterFormValidation.trim().length>0)return showError("","",customJsResAfterFormValidation),reject(new Error("AfterFormValidation Failed : "+customJsResAfterFormValidation)),!1;"object"==typeof customJsResAfterFormValidation&&null!==customJsResAfterFormValidation&&(data_with_validation=customJsResAfterFormValidation);var data=data_with_validation;"boolean"==typeof hideLoadingSpinner&&!1!==hideLoadingSpinner||showLoading(pref);var query="";try{for(var key in data)if(data.hasOwnProperty(key)){var dataVal=UTIL.getCleanQueryStringValue(data[key]);if(0===key.indexOf("custom_")){var propName=pref+"custom"+key.split("_")[1],keyName="_c"+key.split("_")[1];settings.hasOwnProperty(propName)&&settings[propName].display&&settings[propName].hasOwnProperty("label")&&""!==settings[propName].label?(query+=keyName.split("=").join("[*#*!]").split("&").join("[*#*$]").split("|").join("[*#*%]")+"=",query+=settings[propName].label.split("=").join("[*#*!]").split("&").join("[*#*$]").split("|").join("[*#*%]")+"|",query+=dataVal):(settings.hasOwnProperty(propName)&&settings[propName].display||"&"!==dataVal)&&(query+=keyName.split("=").join("[*#*!]").split("&").join("[*#*$]").split("|").join("[*#*%]")+"=",query+="Custom Field "+key.split("_")[1]+"|",query+=dataVal)}else if(key.indexOf("_custom_")>0&&(0===key.indexOf("main_")||0===key.indexOf("thx_")||0===key.indexOf("ep"))){var pr="",fr="";0===key.indexOf("main_")?(pr="",fr="Main Page"):0===key.indexOf("thx_")?(pr="thx_",fr="Thank You Page"):0===key.indexOf("ep")&&(pr="ep"+DUTIL.getExtraPageNumberFromEPString(key)+"_",fr="Extra Page "+DUTIL.getExtraPageNumberFromEPString(key));propName=pr+"custom"+key.split("_")[2],keyName="_"+key.split("_")[0]+"_"+key.split("_")[2];settings.hasOwnProperty(propName)&&settings[propName].display&&settings[propName].hasOwnProperty("label")&&""!==settings[propName].label?(query+=keyName.split("=").join("[*#*!]").split("&").join("[*#*$]").split("|").join("[*#*%]")+"=",query+=settings[propName].label.split("=").join("[*#*!]").split("&").join("[*#*$]").split("|").join("[*#*%]")+"|",query+=dataVal):(settings.hasOwnProperty(propName)&&settings[propName].display||"&"!==dataVal)&&(query+=keyName.split("=").join("[*#*!]").split("&").join("[*#*$]").split("|").join("[*#*%]")+"=",query+=fr+" Custom Field "+key.split("_")[2]+"|",query+=dataVal)}else{keyName=key;"email"==key?keyName="_e":"name"==key?keyName="_n":"first_name"==key?keyName="_fn":"last_name"==key?keyName="_ln":"phone"==key?keyName="_p":"opt_in"==key?keyName="_oi":(0===key.indexOf("main_")||0===key.indexOf("thx_")||0===key.indexOf("ep")&&key.indexOf("_")>0)&&(keyName="_"+key),query+=keyName.split("=").join("[*#*!]").split("&").join("[*#*$]").split("|").join("[*#*%]")+"=",query+=dataVal}}}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"processSubmitObj_query"),void reject(e)}var customJsResBeforeSubmit=BOX_CUSTOM_JS.runCustomJsBeforeSubmit(data);if("boolean"==typeof customJsResBeforeSubmit&&!1===customJsResBeforeSubmit)return reject(new Error("customJsBeforeSubmit false")),!1;if("string"==typeof customJsResBeforeSubmit&&customJsResBeforeSubmit.trim().length>0)return showError("","",customJsResBeforeSubmit),reject(new Error("customJsBeforeSubmit Failed")),!1;if("object"==typeof customJsResBeforeSubmit&&null!==customJsResBeforeSubmit&&(data=customJsResBeforeSubmit),skipSubmission?resolve():postSubmissionResolution.push({resolve:resolve,reject:reject}),""===pref)postMessageSubmit(data,query+="_pg=main",using_form,pref,skipSubmission);else if(pref.indexOf("_")>0){switch(query+="_pg="+pref.split("_")[0],pref){case"thx_":using_form=using_form_thx;break;case"ep1_":using_form=using_form_ep1;break;case"ep2_":using_form=using_form_ep2;break;case"ep3_":using_form=using_form_ep3;break;case"ep4_":using_form=using_form_ep4;break;default:if(0===pref.indexOf("ep")){let pNum=DUTIL.getExtraPageNumberFromEPString(pref);using_form=settings.hasOwnProperty("ep"+pNum+"layout")&&settings.hasOwnProperty("ep"+pNum+"_form")&&settings["ep"+pNum+"_form"].display}}void 0!==using_form&&postMessageSubmit(data,query,using_form,pref,skipSubmission)}else postMessageSubmit(data,query+="_pg="+pref,using_form,pref,skipSubmission);var customJsAfterSubmit=BOX_CUSTOM_JS.runCustomJsAfterSubmit(data);if("boolean"==typeof customJsAfterSubmit&&!1===customJsAfterSubmit)return reject(new Error("AfterFormSubmit Failed")),!1;sobj&&sobj.hasOwnProperty("resetBox")&&sobj.resetBox&&resetBox(),form&&"lightbox_open"==submitAction&&form.lightbox_open&&form.lightbox_open.length>0?window.setTimeout((function(){hideLoading();var prop={};prop.lightbox_open=form.lightbox_open,postMessageOpenAnotherBox(prop,"form")}),50):"redirect"!=submitAction&&afterSubmit(pref,overrideFormSubmitAction)}}else resolve("nothing to submit")})).catch((err=>{reject(err)}))}));return"redirect"===submitAction&&submissionPromise.then((result=>{afterSubmit(pref,overrideFormSubmitAction)})),submissionPromises.push(submissionPromise),submissionPromise.catch((err=>{if(DLOG.tryShowError(err))if("object"==typeof err&&null!==err)err.message="Submission failed due to ==> "+(err.message||JSON.stringify(err)),console.log(err.message);else{let errorMessage="Submission failed due to ==> "+err;console.log(errorMessage)}else DLOG.tryShowError("Submission failed due to ==> "+("object"==typeof err&&null!==err?err.message:err));BOX_CUSTOM_JS.logError(err,"submission failed")})),submissionPromise}function afterSubmit(pref,overrideFormSubmitAction){try{"string"!=typeof overrideFormSubmitAction&&(overrideFormSubmitAction="");var submitAction=settings[pref+"form"].after_submit;if(overrideFormSubmitAction.length>4&&(submitAction=overrideFormSubmitAction),logger("afterSubmit_submitAction: pref="+pref+", action="+submitAction),CURRENT_PAGE&&removeFocusFromButtonsOnPage(CURRENT_PAGE),"main_page"===submitAction)window.setTimeout((function(){hideLoading(),changePages("","form",settings.form,"form",!1)}),400);else if("thank_you_page"===submitAction)window.setTimeout((function(){hideLoading(),changePages("thx_",pref+"form",settings[pref+"form"],"form",!1)}),400);else if(0===submitAction.indexOf("extra_page_")){var pNum=submitAction.replace("extra_page_","");window.setTimeout((function(){hideLoading(),changePages("ep"+pNum+"_",pref+"form",settings[pref+"form"],"form",!1)}),300)}else if("next_page"===submitAction){var nextPagePref=getNextPage(pref);nextPagePref=DUTIL.getUnfriendlyPagePrefix(nextPagePref),window.setTimeout((function(){hideLoading(),nextPagePref&&changePages(nextPagePref,pref+"form",settings[pref+"form"],"form",!1)}),400)}else if("redirect"==submitAction&&settings[pref+"form"].redirect_url){hideLoading();var prop={};0===settings[pref+"form"].redirect_url.toLowerCase().trim().indexOf("http")||0===settings[pref+"form"].redirect_url.toLowerCase().trim().indexOf("mailto")?prop.url=settings[pref+"form"].redirect_url:prop.url="http://"+settings[pref+"form"].redirect_url,settings[pref+"form"].hasOwnProperty("redirect_type")&&settings[pref+"form"].redirect_type?prop.redirect_type=settings[pref+"form"].redirect_type:prop.redirect_type="current",postMessageRedirectParent(prop,"form")}else"close"==submitAction?window.setTimeout((function(){hideLoading(),postMessageCloseBox("form_submit")}),400):"nothing"==submitAction?window.setTimeout((function(){hideLoading()}),400):window.setTimeout((function(){hideLoading(),postMessageCloseBox("form_submit")}),400)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"afterSubmit")}}function changePages(pref,el_name,prop,ui_source,deselectButtons=!0){try{logger("changePages: "+pref);var isStayingOnSamePage=CURRENT_PAGE===pref||DUTIL.getPlainPref(CURRENT_PAGE)===DUTIL.getPlainPref(pref);if(DIGIOH_PRQ.USE&&DIGIOH_PRQ.isBoxPRQ()&&"branch"!==ui_source&&!isStayingOnSamePage&&prop&&"back"!==prop.action){var quizErr=DIGIOH_PRQ.checkRequiredAnswersPRQ(CURRENT_PAGE);if(quizErr)return void showError("","",quizErr)}if(settings[`${pref.replace("_","")}html50`]&&settings[`${pref.replace("_","")}html50`].custom_widget&&settings[`${pref.replace("_","")}html50`].custom_widget.widget_configuration&&settings[`${pref.replace("_","")}html50`].custom_widget.enabled&&loadWidget(settings[`${pref.replace("_","")}html50`].custom_widget.widget_configuration),"branch"!==ui_source&&prop&&"back"!==prop.action){var pageBranchAfterDisplay=getPageBranchingAction(CURRENT_PAGE,"eval_after");if("none"!==pageBranchAfterDisplay&&DUTIL.getPlainPref(pageBranchAfterDisplay)!=DUTIL.getPlainPref(pref))return logger("pageBranchAfterDisplay="+pageBranchAfterDisplay+", curr="+CURRENT_PAGE+", next="+pref),void changePages(pageBranchAfterDisplay,el_name,prop,"branch")}var pageBranchBeforeDisplay=getPageBranchingAction(pref,"eval_before");if("none"!==pageBranchBeforeDisplay&&DUTIL.getPlainPref(pageBranchBeforeDisplay)!=DUTIL.getPlainPref(pref)&&prop&&"back"!==prop.action)return logger("pageBranchBeforeDisplay="+pageBranchBeforeDisplay+", curr="+CURRENT_PAGE+", next="+pref),void changePages(pageBranchBeforeDisplay,el_name,prop,"branch");if(DIGIOH_PRQ.USE&&DIGIOH_PRQ.isBoxPRQ()){var is_prq_results_page=DIGIOH_PRQ.isResultsPagePRQ(pref);logger("changePages: is_prq_results_page="+is_prq_results_page),DIGIOH_PRQ.HasResultsLoaded||(DIGIOH_PRQ.HasResultsLoaded=!0,DIGIOH_PRQ.loadProductData()),is_prq_results_page?Promise.allSettled(quizPromises).then((()=>{changePagesMiddle(pref,el_name,prop,ui_source,is_prq_results_page,deselectButtons)})):changePagesMiddle(pref,el_name,prop,ui_source,is_prq_results_page,deselectButtons)}else logger("changePages: DIGIOH_PRQ.USE="+DIGIOH_PRQ.USE+", DIGIOH_PRQ.isBoxPRQ()="+DIGIOH_PRQ.isBoxPRQ()),changePagesMiddle(pref,el_name,prop,ui_source,!1)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"changePages")}}function changePagesMiddle(pref,el_name,prop,ui_source,is_prq_results_page,deselectButtons=!0){try{deselectButtons&&deselectButtonsOnPage(pref);var PageAnswersTemp=JSON.parse(JSON.stringify(PageAnswers));deselectButtons&&removeJumpedPagesFromPageAnswers(pref),logger("changePagesMiddle: "+pref),logger("is_prq_results_page: "+is_prq_results_page),logger("PageAnswers: "+JSON.stringify(PageAnswers));var outcomesResultsActionOverride={};if(DIGIOH_PRQ.USE&&DIGIOH_PRQ.isBoxPRQ()){var skip_calc_results=boxapi.getPageMetadata(pref,"skip_calc_results");if(skip_calc_results)logger("calcResultsPRQ: "+pref+" | skipping due to page metadata skip_calc_results="+skip_calc_results);else if(outcomesResultsActionOverride=DIGIOH_PRQ.calcResultsPRQ(),is_prq_results_page&&(localStorage.setItem("prq_results",JSON.stringify({page:DUTIL.getPlainPref(pref),answers:PageAnswers,pageview_sequence:PageViewSequence})),outcomesResultsActionOverride&&outcomesResultsActionOverride.action&&"extra_page"==outcomesResultsActionOverride.action&&outcomesResultsActionOverride.extra_page&&pref!=outcomesResultsActionOverride.extra_page))return logger("DIGIOH_PRQ.calcResultsPRQ() ==> action_override="+outcomesResultsActionOverride.extra_page+", curr="+CURRENT_PAGE+", next="+pref),void changePages(outcomesResultsActionOverride.extra_page,el_name,prop,"outcome.results.extra_page")}var customJsBeforeChangePages=BOX_CUSTOM_JS.runCustomJsBeforeChangePages(DUTIL.getFriendlyPagePrefix(CURRENT_PAGE),DUTIL.getFriendlyPagePrefix(pref),el_name,prop,ui_source);if("boolean"==typeof customJsBeforeChangePages&&!1===customJsBeforeChangePages)return PageAnswers=JSON.parse(JSON.stringify(PageAnswersTemp)),!1;"back_btn"!==ui_source&&PageViewSequence.length>0&&PageViewSequence[PageViewSequence.length-1]!==DUTIL.getPlainPref(pref)&&PageViewSequence.push(DUTIL.getPlainPref(pref)),0===CURRENT_WIDTH&&(CURRENT_WIDTH=settings.layout.width),0===CURRENT_HEIGHT&&(CURRENT_HEIGHT=settings.layout.height),DIGIOH_PRQ.USE&&DIGIOH_PRQ.isBoxPRQ()&&(DIGIOH_PRQ.trackPrqAnswer(CURRENT_PAGE),DIGIOH_PRQ.trackPrqPage(pref)),is_prq_results_page&&(DIGIOH_PRQ.trackPrqResult(pref),DIGIOH_PRQ.buildTextPRQ(pref),DIGIOH_PRQ.buildImagePRQ(pref),DIGIOH_PRQ.buildHTMLPRQ(pref),DIGIOH_PRQ.buildButtonPRQ(pref),DIGIOH_PRQ.buildFormPRQ(pref)),changePagesFinish(pref,el_name,prop,ui_source,is_prq_results_page,outcomesResultsActionOverride)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"changePagesMiddle")}}function changePagesFinish(pref,el_name,prop,ui_source,is_prq_results_page,outcomesResultsActionOverride){try{pref=DUTIL.getUnfriendlyPagePrefix(pref);var previous_page=CURRENT_PAGE,modal_width=0,modal_height=0;if("thx_"===pref&&settings.hasOwnProperty("thxlayout"))modal_width=settings.thxlayout.width,modal_height=settings.thxlayout.height,CURRENT_PAGE="thx",buildStyles("thx",!0),loadImages("thx",!0),loadExternalFonts("thx",!0),replaceSettingsObjFormMergeTagsAfterChangePages("thx");else if("ep1_"===pref&&settings.hasOwnProperty("ep1layout"))modal_width=settings.ep1layout.width,modal_height=settings.ep1layout.height,CURRENT_PAGE="ep1",buildStyles("ep1",!0),loadImages("ep1",!0),loadExternalFonts("ep1",!0),replaceSettingsObjFormMergeTagsAfterChangePages("ep1");else if("ep2_"===pref&&settings.hasOwnProperty("ep2layout"))modal_width=settings.ep2layout.width,modal_height=settings.ep2layout.height,CURRENT_PAGE="ep2",buildStyles("ep2",!0),loadImages("ep2",!0),loadExternalFonts("ep2",!0),replaceSettingsObjFormMergeTagsAfterChangePages("ep2");else if("ep3_"===pref&&settings.hasOwnProperty("ep3layout"))modal_width=settings.ep3layout.width,modal_height=settings.ep3layout.height,CURRENT_PAGE="ep3",buildStyles("ep3",!0),loadImages("ep3",!0),loadExternalFonts("ep3",!0),replaceSettingsObjFormMergeTagsAfterChangePages("ep3");else if("ep4_"===pref&&settings.hasOwnProperty("ep4layout"))modal_width=settings.ep4layout.width,modal_height=settings.ep4layout.height,CURRENT_PAGE="ep4",buildStyles("ep4",!0),loadImages("ep4",!0),loadExternalFonts("ep4",!0),replaceSettingsObjFormMergeTagsAfterChangePages("ep4");else if(0===pref.indexOf("ep")){var pNum=DUTIL.getExtraPageNumberFromEPString(pref);settings.hasOwnProperty("ep"+pNum+"layout")&&(modal_width=settings["ep"+pNum+"layout"].width,modal_height=settings["ep"+pNum+"layout"].height,CURRENT_PAGE="ep"+pNum,buildStyles("ep"+pNum,!0),loadImages("ep"+pNum,!0),loadExternalFonts("ep"+pNum,!0),replaceSettingsObjFormMergeTagsAfterChangePages("ep"+pNum))}else modal_width=settings.layout.width,modal_height=settings.layout.height,CURRENT_PAGE="main",buildStyles("",!0),loadImages("",!0),loadExternalFonts("",!0),replaceSettingsObjFormMergeTagsAfterChangePages("");let edgeToEdgeUse=settings.hasOwnProperty("edge_to_edge")&&settings.edge_to_edge.use||settings.hasOwnProperty("responsive")&&settings.responsive.use;edgeToEdgeUse||(CURRENT_WIDTH=modal_width,CURRENT_HEIGHT=modal_height);var edgeToEdge=edgeToEdgeUse;if("inline"===WIDGET_TYPE&&edgeToEdge&&postMessageChangePages(pref,modal_width,modal_height,CURRENT_WIDTH,CURRENT_HEIGHT,DUTIL.getFriendlyPagePrefix(previous_page),DUTIL.getFriendlyPagePrefix(pref),el_name,prop,ui_source),setTimeout((function(){if("inline"===WIDGET_TYPE&&edgeToEdge||postMessageChangePages(pref,modal_width,modal_height,CURRENT_WIDTH,CURRENT_HEIGHT,DUTIL.getFriendlyPagePrefix(previous_page),DUTIL.getFriendlyPagePrefix(pref),el_name,prop,ui_source),"thx_"===pref&&settings.hasOwnProperty("thxlayout")){if($("#layout").hide(),settings.hasOwnProperty("thxlayout")&&$("#thxlayout").length&&$("#thxlayout").show(),settings.hasOwnProperty("extra_pages"))for(var j=1;j<=100;j++)settings.extra_pages.length>=j&&settings.extra_pages[j-1]&&1===settings.extra_pages[j-1].on&&settings.hasOwnProperty("ep"+j+"layout")&&$("#ep"+j+"layout").length&&$("#ep"+j+"layout").hide();settings.hasOwnProperty("ep1layout")&&$("#ep1layout").length&&$("#ep1layout").hide(),settings.hasOwnProperty("ep2layout")&&$("#ep2layout").length&&$("#ep2layout").hide(),settings.hasOwnProperty("ep3layout")&&$("#ep3layout").length&&$("#ep3layout").hide(),settings.hasOwnProperty("ep4layout")&&$("#ep4layout").length&&$("#ep4layout").hide()}else if(0===pref.indexOf("ep")){var pNum=DUTIL.getExtraPageNumberFromEPString(pref);if(settings.hasOwnProperty("ep"+pNum+"layout")){if($("#layout").hide(),settings.hasOwnProperty("thxlayout")&&$("#thxlayout").length&&$("#thxlayout").hide(),settings.hasOwnProperty("extra_pages"))for(j=1;j<=100;j++)settings.extra_pages.length>=j&&settings.extra_pages[j-1]&&1===settings.extra_pages[j-1].on&&j.toString()!=pNum&&settings.hasOwnProperty("ep"+j+"layout")&&$("#ep"+j+"layout").length&&$("#ep"+j+"layout").hide();settings.hasOwnProperty("ep1layout")&&$("#ep1layout").length&&$("#ep1layout").hide(),settings.hasOwnProperty("ep2layout")&&$("#ep2layout").length&&$("#ep2layout").hide(),settings.hasOwnProperty("ep3layout")&&$("#ep3layout").length&&$("#ep3layout").hide(),settings.hasOwnProperty("ep4layout")&&$("#ep4layout").length&&$("#ep4layout").hide(),$("#ep"+pNum+"layout").show()}}else{if($("#layout").show(),settings.hasOwnProperty("thxlayout")&&$("#thxlayout").length&&$("#thxlayout").hide(),settings.hasOwnProperty("extra_pages"))for(j=1;j<=100;j++)settings.extra_pages.length>=j&&settings.extra_pages[j-1]&&1===settings.extra_pages[j-1].on&&settings.hasOwnProperty("ep"+j+"layout")&&$("#ep"+j+"layout").length&&$("#ep"+j+"layout").hide();settings.hasOwnProperty("ep1layout")&&$("#ep1layout").length&&$("#ep1layout").hide(),settings.hasOwnProperty("ep2layout")&&$("#ep2layout").length&&$("#ep2layout").hide(),settings.hasOwnProperty("ep3layout")&&$("#ep3layout").length&&$("#ep3layout").hide(),settings.hasOwnProperty("ep4layout")&&$("#ep4layout").length&&$("#ep4layout").hide()}}),100),is_prq_results_page){let outcomesResultsActionOverrideURL="";outcomesResultsActionOverride&&outcomesResultsActionOverride.action&&"redirect_url"==outcomesResultsActionOverride.action&&outcomesResultsActionOverride.redirect_url&&(outcomesResultsActionOverrideURL=DIGIOH_PRQ.replaceMergeTagsPRQ(outcomesResultsActionOverride.redirect_url,!0));let quizRedirectUrl="";outcomesResultsActionOverrideURL||(quizRedirectUrl=DIGIOH_PRQ.getQuizResultsURL());let form_autosubmit_md=boxapi.getPageMetadata(CURRENT_PAGE,"form_autosubmit"),isAutoSubmitAppInstalled=null!==form_autosubmit_md&&"false"!==form_autosubmit_md,bid=boxapi.getId().toString(),dl=DAPI.getDataLayer();"object"==typeof dl&&null!==dl||(dl={}),dl.hasOwnProperty(bid)&&dl[bid]||(dl[bid]={}),dl[bid].outcome=DIGIOH_PRQ.getOutcome(!0),localStorage.setItem("prq_form_data",LBOX.LZString.compressToBase64(JSON.stringify(dl)));var reset_box=!DIGIOH_PRQ.isResultsPreserved(CURRENT_PAGE);let performRedirect=function(){let redirectDelaySecs=getEffectsProp("effects.quiz.settings.ResultRedirectDelay");void 0!==typeof redirectDelaySecs&&""!==redirectDelaySecs||(redirectDelaySecs=1),redirectDelaySecs=parseInt(redirectDelaySecs);var prs=(boxapi.getWidgetMetadata("prq_results_spinner")||"").toLowerCase().trim();outcomesResultsActionOverrideURL?(logger("DIGIOH_PRQ.calcResultsPRQ() ==> action_override="+outcomesResultsActionOverrideURL+", curr="+CURRENT_PAGE+", next="+pref),"true"!=prs&&"1"!=prs&&"yes"!=prs&&"on"!=prs||showLoadingCustomOrDefault(),setTimeout((function(){(DAPI.DIGIOH_USE_FRAME_COMPATIBILITY?DAPI.DIGIOH_TOP_WINDOW_CONTEXT:window.top).location.href=outcomesResultsActionOverrideURL}),1e3*redirectDelaySecs)):quizRedirectUrl.length>10&&"Redirect_To_External_URL"==getEffectsProp("effects.quiz.settings.ResultsPageType")?("true"!=prs&&"1"!=prs&&"yes"!=prs&&"on"!=prs||showLoadingCustomOrDefault(),setTimeout((function(){DIGIOH_PRQ.redirectToQuizResults(quizRedirectUrl)}),1e3*redirectDelaySecs)):"Digioh_Results_Page"==getEffectsProp("effects.quiz.settings.ResultsPageType")&&("true"!=prs&&"1"!=prs&&"yes"!=prs&&"on"!=prs||showLoadingCustomOrDefault(),setTimeout((function(){DIGIOH_PRQ.displayQuizLocalResultsPage(null,!reset_box)}),1e3*redirectDelaySecs))};isAutoSubmitAppInstalled?logger("PRQ Core: skipping auto-submit in Core because form_autosubmit App is installed on Page = "+CURRENT_PAGE):(logger("PRQ Core: auto-submitting form on results Page = "+CURRENT_PAGE),processSubmitObj({pageName:CURRENT_PAGE,hideLoadingSpinner:!0,useSubmitLock:!1,resetBox:reset_box})),Promise.allSettled(submissionPromises).then((()=>{performRedirect()})).catch((error=>{BOX_CUSTOM_JS.logError(error,error.message)}))}BOX_CUSTOM_JS.runCustomJsAfterChangePages(DUTIL.getFriendlyPagePrefix(previous_page),DUTIL.getFriendlyPagePrefix(pref),el_name,prop,ui_source)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"changePagesFinish")}}function postMessageChangePages(pref,new_width,new_height,old_width,old_height,previous_page,new_page,el_name,prop,ui_source){sendMessageToParent({sender:"lightbox",child_action:"change_pages",lightbox_id:LIGHTBOX_OR_VARIATION_GUID,width:new_width,height:new_height,width_prev:old_width,height_prev:old_height,page_prefix:pref,previous_page:previous_page,new_page:new_page,el_name:el_name,ui_source:ui_source})}function postMessageCloseBox(trig){sendMessageToParent({sender:"lightbox",child_action:"close_lightbox",lightbox_id:LIGHTBOX_OR_VARIATION_GUID,trigger:trig});try{setTimeout((function(){boxapi.closeBox(),logger("postMessageCloseBox:  boxapi.closeBox()")}),150)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"postMessageCloseBox")}$(document).trigger("BOX_CLOSE",[boxapi.getId(),boxapi.getPageName(),trig])}function postMessageRedirectParent(prop,ui_source){var customJsBeforeRedirect=BOX_CUSTOM_JS.runCustomJsBeforeRedirect(prop,ui_source);if("boolean"==typeof customJsBeforeRedirect&&!1===customJsBeforeRedirect)return!1;sendMessageToParent({sender:"lightbox",child_action:"redirect_parent",lightbox_id:LIGHTBOX_OR_VARIATION_GUID,url:prop.url,ui_trigger:ui_source,redirect_type:prop.redirect_type});BOX_CUSTOM_JS.runCustomJsAfterRedirect(prop,ui_source)}function postMessageOpenAnotherBox(prop,ui_source){var customJsBeforeOpenAnotherBox=BOX_CUSTOM_JS.runCustomJsBeforeOpenAnotherBox(prop.lightbox_open,ui_source);if("boolean"==typeof customJsBeforeOpenAnotherBox&&!1===customJsBeforeOpenAnotherBox)return!1;sendMessageToParent({sender:"lightbox",child_action:"lightbox_open",lightbox_id:LIGHTBOX_OR_VARIATION_GUID,lightbox_open:prop.lightbox_open,ui_trigger:ui_source});BOX_CUSTOM_JS.runCustomJsAfterOpenAnotherBox(prop.lightbox_open,ui_source)}function postMessageSubmit(data,post_to_keen_query,pref_using_form,pref,skip_submit){var submit_data=LBOX.LZString.compressToBase64(JSON.stringify(data)),query_data=LBOX.LZString.compressToBase64(post_to_keen_query),extra_data={};if(DIGIOH_PRQ.USE&&DIGIOH_PRQ.isBoxPRQ()&&(extra_data=JSON.parse(JSON.stringify(DIGIOH_PRQ.getSubmissionData()))),extra_data.form=JSON.parse(JSON.stringify(data)),extra_data.analytics=JSON.parse(JSON.stringify(DAPI.GET_ANALYTICS().VARS)),DAPI.CONFIG.hasOwnProperty("NAMED_CUSTOM_FIELDS")&&DAPI.CONFIG.NAMED_CUSTOM_FIELDS.length>0){for(var ncfPayload={},f=0;f<DAPI.CONFIG.NAMED_CUSTOM_FIELDS.length;f++){var ncf=DAPI.CONFIG.NAMED_CUSTOM_FIELDS[f];try{ncf.Name&&0==ncf.Name.indexOf("custom_")&&ncf.Key&&data.hasOwnProperty(ncf.Name)&&""!==data[ncf.Name]&&null!==data[ncf.Name]&&("string"==ncf.Type?ncfPayload[ncf.Key]=data[ncf.Name].toString():"int"==ncf.Type?ncfPayload[ncf.Key]=parseInt(data[ncf.Name].toString()):"float"==ncf.Type?ncfPayload[ncf.Key]=parseFloat(data[ncf.Name].toString()):"bool"==ncf.Type?ncfPayload[ncf.Key]=!0===data[ncf.Name]||"true"===data[ncf.Name].toString().toLowerCase()||1===data[ncf.Name]||"yes"===data[ncf.Name].toString().toLowerCase()||"on"===data[ncf.Name].toString().toLowerCase():"array"==ncf.Type?ncfPayload[ncf.Key]=data[ncf.Name].toString().split(","):ncfPayload[ncf.Key]=data[ncf.Name])}catch(ncfEx){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+ncfEx.message,console.error(ncfEx)),BOX_CUSTOM_JS.logError(ncfEx,"postMessageSubmit => NAMED_CUSTOM_FIELDS")}}extra_data.named_custom_fields=ncfPayload}var quiz=getEffectsProp("effects.quiz");if("object"==typeof quiz&&null!=quiz){var quizResultsURL=DIGIOH_PRQ.getQuizResultsURL();let windowContext=DAPI.DIGIOH_USE_FRAME_COMPATIBILITY?DAPI.DIGIOH_TOP_WINDOW_CONTEXT:window.top;quiz.settings&&"Digioh_Results_Page"==quiz.settings.ResultsPageType&&(quizResultsURL=windowContext.location.href.indexOf("?")>0?windowContext.location.href+"&digioh_local_quiz_results="+LBOX.LZString.compressToBase64(quizResultsURL):windowContext.location.href+"?digioh_local_quiz_results="+LBOX.LZString.compressToBase64(quizResultsURL)),extra_data.hasOwnProperty("prq")&&"object"==typeof extra_data.prq&&null!=extra_data.prq&&(extra_data.prq.results_url=quizResultsURL)}sendMessageToParent({sender:"lightbox",child_action:"register_analytics_submit",lightbox_id:LIGHTBOX_OR_VARIATION_GUID,submission:submit_data,post_to_keen:query_data,form_display:pref_using_form,page_prefix:pref,skip_submit:skip_submit,extra:extra_data})}function postMessageCouponUsed(coupon_group_id,coupon_value,success_or_error,populate_on,code_section_trigger,code_section_response,pref){sendMessageToParent({sender:"lightbox",child_action:"coupon_used",lightbox_id:LIGHTBOX_OR_VARIATION_GUID,coupon_meta_data:{coupon_group_id:coupon_group_id,coupon_value:coupon_value,success_or_error:success_or_error,populate_on:populate_on,code_section_trigger:code_section_trigger,code_section_response:code_section_response,pref:pref}})}function processDownload(prop){sendMessageToParent({sender:"lightbox",child_action:"download_file",lightbox_id:LIGHTBOX_OR_VARIATION_GUID})}function setButtonMetaDataLayer(prop){try{if(prop.hasOwnProperty("metadata_kvps"))for(var k=0;k<prop.metadata_kvps.length;k++)prop.metadata_kvps[k].k&&prop.metadata_kvps[k].v&&0==prop.metadata_kvps[k].k.indexOf("[")&&prop.metadata_kvps[k].k.indexOf("]")>0&&(DAPI.setDataLayerValue(prop.metadata_kvps[k].k.split(" ").join("").replace("[","").replace("]","").toLowerCase(),prop.metadata_kvps[k].v),DAPI.setDataLayerValue(prop.metadata_kvps[k].k.split(" ").join("").replace("[","").replace("]","").toLowerCase(),prop.metadata_kvps[k].v,boxapi.getId()))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"setButtonMetaDataLayer")}}function removePageFromPageAnswers(pref){pref=DUTIL.getPlainPref(pref);var i=0,foundMatch=!1;for(i=0;i<PageAnswers.length;i++)if(PageAnswers[i].page==pref){foundMatch=!0;break}foundMatch&&PageAnswers.splice(i,1)}function addButtonToPageAnswers(pref,ptn){pref=DUTIL.getPlainPref(pref);var i=0,foundPageMatch=!1;for(i=0;i<PageAnswers.length;i++)if(PageAnswers[i].page==pref){foundPageMatch=!0;break}var btnNum=parseInt(ptn.split("utton")[1]),val="";if(settings.hasOwnProperty(ptn)&&settings[ptn].text&&(val=settings[ptn].text),foundPageMatch){var j=0,foundButtonMatch=!1;for(j=0;j<PageAnswers[i].entries.length;j++)if("button"==PageAnswers[i].entries[j].type&&PageAnswers[i].entries[j].num==btnNum){foundButtonMatch=!0;break}foundButtonMatch?(PageAnswers[i].entries[j].type="button",PageAnswers[i].entries[j].num=btnNum,PageAnswers[i].entries[j].value=val,PageAnswers[i].entries[j].src=pref+"button"+btnNum):PageAnswers[i].entries.push({type:"button",num:btnNum,value:val,src:pref+"button"+btnNum})}else PageAnswers.push({page:pref,entries:[{type:"button",num:btnNum,value:val,src:pref+"button"+btnNum}]})}function removeButtonFromPageAnswers(pref,ptn){pref=DUTIL.getPlainPref(pref);var btnNum=parseInt(ptn.split("utton")[1]),i=0;for(i=0;i<PageAnswers.length;i++)PageAnswers[i].page==pref&&(PageAnswers[i].entries=PageAnswers[i].entries.filter((obj=>"button"!==obj.type||obj.num!==btnNum)))}function resetPRQOrginalMergeTags(pref){try{if(boxapi.mergeTagOriginalsPRQ){if(boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals){let buttons=Object.keys(boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals);buttons.length&&buttons.forEach((function(button){if("all"===pref||button.split("button")[0]===DUTIL.getPlainPref(pref)){let buttonAttrs=Object.keys(boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[button]);buttonAttrs.length&&buttonAttrs.forEach((function(buttonAttr){if("text"==buttonAttr&&boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[button].hasOwnProperty("text")&&(settings[button].text=boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[button].text,$("#"+button).length&&$("#"+button).html(boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[button].text)),"url"==buttonAttr&&boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[button].hasOwnProperty("url")&&(settings[button].url=boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[button].url),"selected_value"==buttonAttr&&boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[button].hasOwnProperty("selected_value")&&(settings[button].selected_value=boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[button].selected_value),"metadata_kvps"==buttonAttr&&boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[button].hasOwnProperty("metadata_kvps")&&boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[button].metadata_kvps.length==settings[button].metadata_kvps.length){for(var i=0;i<settings[button].metadata_kvps.length;i++)if($("#"+button).length&&(settings[button].metadata_kvps[i].k!=boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[button].metadata_kvps[i].k||settings[button].metadata_kvps[i].v!=boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[button].metadata_kvps[i].v))try{$("#"+button).removeAttr(settings[button].metadata_kvps[i].k)}catch(err){}settings[button].metadata_kvps=JSON.parse(JSON.stringify(boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[button].metadata_kvps))}}))}}))}if(boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals){let HTMLs=Object.keys(boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals);HTMLs.length&&HTMLs.forEach((function(HTML){if("all"===pref||HTML.split("html")[0]===DUTIL.getPlainPref(pref)){Object.keys(boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[HTML]).forEach((function(HTMLAttr){if("html"==HTMLAttr&&boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[HTML].hasOwnProperty("html")&&(settings[HTML].html=boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[HTML].html,$("#"+HTML).length&&$("#"+HTML).html(boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[HTML].html),"metadata_kvps"==HTMLAttr&&boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[HTML].hasOwnProperty("metadata_kvps")&&boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[HTML].metadata_kvps.length==settings[HTML].metadata_kvps.length)){for(var i=0;i<settings[HTML].metadata_kvps.length;i++)if($("#"+HTML).length&&(settings[HTML].metadata_kvps[i].k!=boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[HTML].metadata_kvps[i].k||settings[HTML].metadata_kvps[i].v!=boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[HTML].metadata_kvps[i].v))try{$("#"+HTML).removeAttr(settings[HTML].metadata_kvps[i].k)}catch(err){}settings[HTML].metadata_kvps=JSON.parse(JSON.stringify(boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[HTML].metadata_kvps))}}))}}))}if(boxapi.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals){let texts=Object.keys(boxapi.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals);texts.length&&texts.forEach((function(text){if("all"===pref||text.split("text")[0]===DUTIL.getPlainPref(pref)){let textAttrs=Object.keys(boxapi.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals[text]);textAttrs.length&&textAttrs.forEach((function(textAttr){if("metadata_kvps"==textAttr&&boxapi.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals[text].hasOwnProperty("metadata_kvps")&&boxapi.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals[text].metadata_kvps.length==settings[text].metadata_kvps.length){for(var i=0;i<settings[text].metadata_kvps.length;i++)if($("#"+text).length&&(settings[text].metadata_kvps[i].k!=boxapi.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals[text].metadata_kvps[i].k||settings[text].metadata_kvps[i].v!=boxapi.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals[text].metadata_kvps[i].v))try{$("#"+text).removeAttr(settings[text].metadata_kvps[i].k)}catch(err){}settings[text].metadata_kvps=JSON.parse(JSON.stringify(boxapi.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals[text].metadata_kvps))}}))}}))}if(boxapi.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals){let images=Object.keys(boxapi.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals);images.length&&images.forEach((function(image){if("all"===pref||image.split("image")[0]===DUTIL.getPlainPref(pref)){let imageAttrs=Object.keys(boxapi.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals[image]);imageAttrs.length&&imageAttrs.forEach((function(imageAttr){if("metadata_kvps"==imageAttr&&boxapi.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals[image].hasOwnProperty("metadata_kvps")&&boxapi.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals[image].metadata_kvps.length==settings[image].metadata_kvps.length){for(var i=0;i<settings[image].metadata_kvps.length;i++)if($("#"+image).length&&(settings[image].metadata_kvps[i].k!=boxapi.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals[image].metadata_kvps[i].k||settings[image].metadata_kvps[i].v!=boxapi.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals[image].metadata_kvps[i].v))try{$("#"+image).removeAttr(settings[image].metadata_kvps[i].k)}catch(err){}settings[image].metadata_kvps=JSON.parse(JSON.stringify(boxapi.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals[image].metadata_kvps))}}))}}))}if(boxapi.mergeTagOriginalsPRQ.formAttrsMergeTagOriginals){let forms=Object.keys(boxapi.mergeTagOriginalsPRQ.formAttrsMergeTagOriginals);forms.length&&forms.forEach((function(form){if("all"===pref||form.split("form")[0]===DUTIL.getUnfriendlyPagePrefix(pref)){let formAttrs=Object.keys(boxapi.mergeTagOriginalsPRQ.formAttrsMergeTagOriginals[form]);formAttrs.length&&formAttrs.forEach((function(formAttr){"redirect_url"==formAttr&&boxapi.mergeTagOriginalsPRQ.formAttrsMergeTagOriginals[form].hasOwnProperty("redirect_url")&&(settings[form].redirect_url=boxapi.mergeTagOriginalsPRQ.formAttrsMergeTagOriginals[form].redirect_url)}))}}))}boxapi.mergeTagOriginalsPRQ={buttonAttrsMergeTagOriginals:{},HTMLAttrsMergeTagOriginals:{},textAttrsMergeTagOriginals:{},imageAttrsMergeTagOriginals:{},formAttrsMergeTagOriginals:{}}}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"resetPRQOrginalMergeTags")}}function addCustomFieldToPageAnswers(pref,ptn,val,src){logger("addCustomFieldToPageAnswers: pref="+pref+", ptn="+ptn+", val="+val+", src="+src),pref=DUTIL.getPlainPref(pref);var i=0,foundPageMatch=!1;for(i=0;i<PageAnswers.length;i++)if(PageAnswers[i].page==pref){foundPageMatch=!0;break}var customNum=parseInt(ptn.split("ustom")[1].split("_").join(""));if(foundPageMatch){var j=0,foundFieldMatch=!1;for(j=0;j<PageAnswers[i].entries.length;j++)if("custom"==PageAnswers[i].entries[j].type&&PageAnswers[i].entries[j].num==customNum){foundFieldMatch=!0;break}foundFieldMatch?(PageAnswers[i].entries[j].type="custom",PageAnswers[i].entries[j].num=customNum,PageAnswers[i].entries[j].value=val,PageAnswers[i].entries[j].src=src):PageAnswers[i].entries.push({type:"custom",num:customNum,value:val,src:src})}else PageAnswers.push({page:pref,entries:[{type:"custom",num:customNum,value:val,src:src}]})}function removeCustomFieldFromPageAnswers(pref,ptn,src){pref=DUTIL.getPlainPref(pref),void 0===src&&(src="");for(var customNum=parseInt(ptn.split("ustom")[1].split("_").join("")),i=0;i<PageAnswers.length;i++)PageAnswers[i].page==pref&&(PageAnswers[i].entries=PageAnswers[i].entries.filter((obj=>"custom"!==obj.type||obj.num!==customNum||src&&obj.src!==src)))}function removeJumpedPagesFromPageAnswers(pref){pref=DUTIL.getPlainPref(pref);for(var i=0;i<PageAnswers.length;i++)if(PageAnswers[i].page==pref){PageAnswers.length=i;break}}function getPageBranchingAction(pref,before_or_after){if(pref=DUTIL.getPlainPref(pref),!settings.hasOwnProperty(pref+"branching_logic")||0==settings[pref+"branching_logic"].length)return"none";for(var foundBranches=!1,z=0;z<settings[pref+"branching_logic"].length;z++){var branch_n=settings[pref+"branching_logic"][z];if(branch_n.hasOwnProperty("branch")&&branch_n.hasOwnProperty("action")&&branch_n.hasOwnProperty("evaluated")&&branch_n.evaluated===before_or_after){foundBranches=!0,logger("branching_start: "+(pref||"main")+" (Branch "+(z+1).toString()+")");for(var branching_logic=branch_n.branch,x=0;x<branching_logic.length;x++){logger("branching_block: "+(pref||"main")+" (OR Block "+(x+1).toString()+")");for(var foundBranchBlockMatch=!0,y=0;y<branching_logic[x].length;y++){logger("branching_block: "+(pref||"main")+" (AND Block "+(y+1).toString()+")");var condition=branching_logic[x][y];if(logger("branching_condition_eval: "+(pref||"main")+" ("+(foundBranchBlockMatch=isBranchingConditionTrue(pref,condition))+") for Condition: "+JSON.stringify(condition)),!foundBranchBlockMatch)break}if(foundBranchBlockMatch)return logger("branching_end: "+(pref||"main")+" (true) for Branch "+(z+1).toString()+" ("+before_or_after+") (action="+branch_n.action+")"),branch_n.action}}}return foundBranches&&logger("branching_end: "+(pref||"main")+" (false) for all "+settings[pref+"branching_logic"].length.toString()+" Branches"),"none"}function isBranchingConditionTrue(pref,condition){var i=0,j=0,answers=[],foundPage=!1;for(i=0;i<PageAnswers.length;i++)if(DUTIL.getPlainPref(PageAnswers[i].page)==DUTIL.getPlainPref(condition.q)){for(j=0;j<PageAnswers[i].entries.length;j++)"string"==typeof PageAnswers[i].entries[j].value&&("button"!=PageAnswers[i].entries[j].type||UTIL.stringOrArrayContains(answers,"b"+PageAnswers[i].entries[j].num)?"custom"!=PageAnswers[i].entries[j].type||UTIL.stringOrArrayContains(answers,PageAnswers[i].entries[j].value.toString().toLowerCase().trim())||answers.push(PageAnswers[i].entries[j].value.toString().toLowerCase().trim()):answers.push("b"+PageAnswers[i].entries[j].num));foundPage=!0;break}if(!foundPage)return logger("branching_answers_found: (page="+(condition.q||"main")+") ==> No answers found for page, so setting page condition eval to false."),!1;if(logger("branching_answers_found: (page="+(condition.q||"main")+") ==> "+JSON.stringify(answers)),"contains_all"==condition.o){if(0==condition.a.length)return!1;for(i=0;i<condition.a.length;i++)if(!UTIL.stringOrArrayContains(answers,condition.a[i].toString().toLowerCase().trim()))return!1;return!0}if("contains_only"==condition.o){if(0==condition.a.length)return!1;var conditionAnswersSortedArr=JSON.parse(JSON.stringify(condition.a));for(i=0;i<conditionAnswersSortedArr.length;i++)conditionAnswersSortedArr[i]=conditionAnswersSortedArr[i].toString().toLowerCase().trim();return conditionAnswersSortedArr.sort().join(",")===answers.sort().join(",")}if("contains_any"==condition.o){for(i=0;i<condition.a.length;i++)if(UTIL.stringOrArrayContains(answers,condition.a[i].toString().toLowerCase().trim()))return!0;return!1}if("not_contains_any"==condition.o){if(0==condition.a.length)return!1;for(i=0;i<condition.a.length;i++)if(UTIL.stringOrArrayContains(answers,condition.a[i].toString().toLowerCase().trim()))return!1;return!0}}function getCustomFieldNamesForPage(pageName){try{pageName||(pageName="main"),pageName.indexOf("thank_you")>=0&&(pageName="thx"),pageName.indexOf("extra_page_")>=0&&(pageName="ep"+pageName.split("_")[2]),pageName.indexOf("_")>=0&&(pageName=pageName.replace("_",""));const buttonSettingsKeyPrefix="main"==pageName?"":pageName,dataLayerDetailKeyPrefix=pageName+"_",settingsFieldMatchRx=new RegExp("^"+("main"==pageName?"":pageName+"_")+"custom(\\d\\d?)"),settingsButtonMatchRx=new RegExp("^"+buttonSettingsKeyPrefix+"button(\\d\\d?)"),metadataFieldMatchRx=/CUSTOM_(\d\d?)\]/,customFields=[];for(const settingsKey of Object.keys(settings)){const fieldMatch=settingsKey.match(settingsFieldMatchRx);if(fieldMatch&&settings[settingsKey].display){const fieldNum=fieldMatch[1];customFields.push("custom_"+fieldNum),customFields.push(dataLayerDetailKeyPrefix+"custom_"+fieldNum);continue}if(settingsKey.match(settingsButtonMatchRx)){const buttonSettings=settings[settingsKey];if(buttonSettings.display){if(buttonSettings.hasOwnProperty("selected_field")&&buttonSettings.hasOwnProperty("selected_value")&&buttonSettings.selected_field&&buttonSettings.selected_value.trim().length>0){const fieldNum=buttonSettings.selected_field;customFields.push("custom_"+fieldNum),customFields.push(dataLayerDetailKeyPrefix+"custom_"+fieldNum)}const buttonMdKvps=buttonSettings.metadata_kvps||[];for(const mdKvp of buttonMdKvps){const dlSetMatch=(mdKvp.k||"").match(metadataFieldMatchRx);if(dlSetMatch){const fieldNum=dlSetMatch[1];customFields.push("custom_"+fieldNum)}}}}}return customFields}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"getCustomFieldNamesForPage"),[]}}function clearFieldsSetByPage(pageName){try{const fields=getCustomFieldNamesForPage(pageName);for(const field of fields)DAPI.removeDataLayerValue(field),DAPI.removeDataLayerValue(field,boxapi.getId()),logger("clearFieldsSetByPage("+pageName+") - "+field)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"clearFieldsSetByPage")}}function clearButtonValuesSetByPage(pageName){try{const fields=getCustomFieldNamesForPage(pageName);for(const field of fields)SELECTED_BUTTON_FORM_VALUES.hasOwnProperty(field)&&delete SELECTED_BUTTON_FORM_VALUES[field]}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"clearButtonValuesSetByPage")}}function fInvertButtonColors(elem){let textColor=elem.css("color"),bgColor=elem.css("background-color");elem.css("background-color",textColor),elem.css("color",bgColor)}function addButtonData(pref,prop,elName){if(prop.hasOwnProperty("selected_field")&&prop.selected_field&&prop.hasOwnProperty("selected_value")&&prop.selected_value.length>0){var base_selected_field="custom_"+prop.selected_field,pref_selected_field=boxapi.getPageName()+"_custom_"+prop.selected_field;SELECTED_BUTTON_FORM_VALUES.hasOwnProperty(pref_selected_field)?$.inArray(prop.selected_value,SELECTED_BUTTON_FORM_VALUES[pref_selected_field])<0&&SELECTED_BUTTON_FORM_VALUES[pref_selected_field].push(prop.selected_value):SELECTED_BUTTON_FORM_VALUES[pref_selected_field]=[prop.selected_value],DAPI.setDataLayerValue(base_selected_field,SELECTED_BUTTON_FORM_VALUES[pref_selected_field].join(",")),DAPI.setDataLayerValue(pref_selected_field,SELECTED_BUTTON_FORM_VALUES[pref_selected_field].join(",")),DAPI.setDataLayerValue(base_selected_field,SELECTED_BUTTON_FORM_VALUES[pref_selected_field].join(","),LIGHTBOX_SHORT_ID),DAPI.setDataLayerValue(pref_selected_field,SELECTED_BUTTON_FORM_VALUES[pref_selected_field].join(","),LIGHTBOX_SHORT_ID),addCustomFieldToPageAnswers(pref,pref_selected_field,SELECTED_BUTTON_FORM_VALUES[pref_selected_field].join(","),elName)}}function removeButtonData(pref,prop){if(prop.hasOwnProperty("selected_field")&&prop.selected_field&&prop.hasOwnProperty("selected_value")&&prop.selected_value.length>0){var base_selected_field="custom_"+prop.selected_field,pref_selected_field=boxapi.getPageName()+"_custom_"+prop.selected_field;SELECTED_BUTTON_FORM_VALUES.hasOwnProperty(pref_selected_field)&&$.inArray(prop.selected_value,SELECTED_BUTTON_FORM_VALUES[pref_selected_field])>=0&&(SELECTED_BUTTON_FORM_VALUES[pref_selected_field]=UTIL.removeFromStringOrArray(SELECTED_BUTTON_FORM_VALUES[pref_selected_field],prop.selected_value),DAPI.setDataLayerValue(base_selected_field,SELECTED_BUTTON_FORM_VALUES[pref_selected_field].join(",")),DAPI.setDataLayerValue(pref_selected_field,SELECTED_BUTTON_FORM_VALUES[pref_selected_field].join(",")),DAPI.setDataLayerValue(base_selected_field,SELECTED_BUTTON_FORM_VALUES[pref_selected_field].join(","),LIGHTBOX_SHORT_ID),DAPI.setDataLayerValue(pref_selected_field,SELECTED_BUTTON_FORM_VALUES[pref_selected_field].join(","),LIGHTBOX_SHORT_ID)),removeCustomFieldFromPageAnswers(pref,pref_selected_field)}}function buildAssetUrl(assetBase){var assetSrc=/^\/vendors\/[^\/]+\/uploads\//i.test(assetBase)?assetBase:`/vendors/${VENDOR_GUID}/uploads/${assetBase}`;return`${S3_BASE_URL}${assetSrc}`}function buildButtonN(el,elWrapper,elName,prop,pref){try{if(prop.display)if(el.html(prop.text),IS_MOBILE||el.hover((function(){$(this).addClass(elName+"_hover"),$(document).trigger("BOX_BUTTON_HOVER_IN",[DUTIL.getFriendlyPagePrefix(pref),elName,prop])}),(function(){$(this).removeClass(elName+"_hover"),$(document).trigger("BOX_BUTTON_HOVER_OUT",[DUTIL.getFriendlyPagePrefix(pref),elName,prop])})),"download"==prop.action&&prop.file&&prop.file.length>7){var src=S3_BASE_URL+"/vendors/"+VENDOR_GUID+"/uploads/"+prop.file;el.wrap('<a style="border: none;" target="_blank" href="'+src+'"></a>'),el.parent().on(IS_MOBILE?"click":"mousedown",(function(e){$(document).trigger("BOX_BUTTON_CLICK",[DUTIL.getFriendlyPagePrefix(pref),elName,prop]),e.stopPropagation(),setButtonMetaDataLayer(prop);var customJsResBeforeDownload=BOX_CUSTOM_JS.runCustomJsBeforeDownload(DUTIL.getFriendlyPagePrefix(pref),elName,prop);if("boolean"==typeof customJsResBeforeDownload&&!1===customJsResBeforeDownload)return e.preventDefault(),!1;processDownload(prop);BOX_CUSTOM_JS.runCustomJsAfterDownload(DUTIL.getFriendlyPagePrefix(pref),elName,prop);return!0})),el.on(IS_MOBILE?"touchstart":"mousedown",(function(){$(this).addClass(elName+"_focus")})).on(IS_MOBILE?"touchend":"mouseup",(function(){$(this).removeClass(elName+"_focus"),$(document).trigger("BOX_BUTTON_RELEASE",[DUTIL.getFriendlyPagePrefix(pref),elName,prop])}))}else{if(el.on("focus",(function(e){"submit"==prop.action?$(this).addClass("button_focus_tab_submit"):"close"==prop.action?$(this).addClass("button_focus_tab_close"):"url"==prop.action&&prop.url?$(this).addClass("button_focus_tab_redirect"):"lightbox_open"==prop.action&&prop.lightbox_open&&prop.lightbox_open.length>0?$(this).addClass("button_focus_tab_lightbox_open"):prop.action.indexOf("_page")>0&&$(this).addClass("button_focus_tab_change_pages")})).on("blur",(function(e){$(this).hasClass("button_focus_tab_submit")&&$(this).removeClass("button_focus_tab_submit"),$(this).hasClass("button_focus_tab_close")&&$(this).removeClass("button_focus_tab_close"),$(this).hasClass("button_focus_tab_redirect")&&$(this).removeClass("button_focus_tab_redirect"),$(this).hasClass("button_focus_tab_lightbox_open")&&$(this).removeClass("button_focus_tab_lightbox_open"),$(this).hasClass("button_focus_tab_change_pages")&&$(this).removeClass("button_focus_tab_change_pages")})),prop.action&&"nothing"!==prop.action){let elID=el[0].id;el.on(IS_MOBILE?"click":"mousedown",(function(e){$(document).trigger("BOX_BUTTON_CLICK",[DUTIL.getFriendlyPagePrefix(pref),elName,prop]),e.stopPropagation(),setButtonMetaDataLayer(prop);let buttonElement=$(this).closest("#"+elID);if(buttonElement.addClass(elName+"_focus"),"submit"===prop.action||"select"===prop.action&&!buttonElement.hasClass(elName+"_selected")||"main_page"===prop.action||"next_page"===prop.action||"thank_you_page"===prop.action||0===prop.action.indexOf("extra_page_")){var skipPageReset=boxapi.getWidgetMetadata("skip_page_reset");"select"===prop.action||""===prop.selected_value||""===prop.selected_field||!DIGIOH_PRQ.isBoxPRQ()||"true"!=skipPageReset&&1!=skipPageReset||(removePageFromPageAnswers(CURRENT_PAGE),clearFieldsSetByPage(CURRENT_PAGE),clearButtonValuesSetByPage(CURRENT_PAGE)),addButtonToPageAnswers(pref,elName),prop.hasOwnProperty("integration_id")&&prop.integration_id&&boxapi.addBoxIntegration(prop.integration_id)}else"select"===prop.action&&buttonElement.hasClass(elName+"_selected")&&(removeButtonFromPageAnswers(pref,elName),prop.hasOwnProperty("integration_id")&&prop.integration_id&&boxapi.removeBoxIntegration(prop.integration_id));if(prop.action.indexOf("[PRQ:")>=0)if(prop.hasOwnProperty("prq_is_results_button")&&prop.prq_is_results_button)if(0==prop.action.indexOf("Redirect to [PRQ:")){var headerName="PRQ:"+(mergeTag=prop.action.replace("Redirect to ","")).replace("[","").replace("]","").split(":")[1],rowRank=mergeTag.split(":").length>2?parseInt(mergeTag.split(":")[2].replace("]","")):1,url=DIGIOH_PRQ.getResultCellValuePRQ(headerName,rowRank);prop.url=url,prop.action="url"}else if(0==prop.action.indexOf("Shopify")||0==prop.action.indexOf("Magento")||0==prop.action.indexOf("VTEX")){var mergeTag,ecommName=prop.action.split(" ")[0],sku=(headerName="PRQ:"+(mergeTag=prop.action.replace(ecommName+" Add to Cart ","")).replace("[","").replace("]","").split(":")[1],rowRank=mergeTag.split(":").length>2?parseInt(mergeTag.split(":")[2].replace("]","")):1,DIGIOH_PRQ.getResultCellValuePRQ(headerName,rowRank)),addToCartUrl="",goToCartUrl="";"Shopify"==ecommName?(addToCartUrl="/cart/add?id="+sku+"&quantity=1",goToCartUrl="/cart"):"Magento"==ecommName?(addToCartUrl="/cart?product="+sku+"&qty=1&headless=true",goToCartUrl="/checkout/cart"):"VTEX"==ecommName&&(addToCartUrl="/checkout/cart/add?sc=1&sku="+sku+"&qty=1&seller=1",goToCartUrl="/checkout/#/cart"),showLoading(CURRENT_PAGE),LBOX.JQUERY_DIGIOH("body").append('<iframe src="'+addToCartUrl+'" style="display:none;"/>'),el.off(),setTimeout((()=>{el.text("GO TO CART"),fInvertButtonColors(el),boxapi.hideLoading()}),1500),el.click((function(){(DAPI.DIGIOH_USE_FRAME_COMPATIBILITY?DAPI.DIGIOH_TOP_WINDOW_CONTEXT:window.parent).location.href=goToCartUrl})),addButtonData(pref,prop,elName)}else prop.action="submit";else prop.action="submit";if("retake_quiz"==prop.action){let quiz_start_page="main";prop.quiz_retake_start_page&&prop.quiz_retake_start_page.length>0&&/^main$|^thx$|^ep\d\d?$/.test(prop.quiz_retake_start_page)&&(quiz_start_page=prop.quiz_retake_start_page),localStorage.removeItem("prq_results"),resetPRQOrginalMergeTags("all"),resetBox(),boxapi.showPage(quiz_start_page),resetBox()}else if("back"==prop.action){if(addButtonData(pref,prop,elName),PageViewSequence.length>1){var currPg=PageViewSequence.pop(),prevPg=PageViewSequence[PageViewSequence.length-1];resetPage(currPg,!1),resetPage(prevPg,!1),changePages(prevPg,elName,prop,"back_btn",!1)}}else if("submit"===prop.action)addButtonData(pref,prop,elName),prop.hasOwnProperty("override_form_submit_action")&&prop.override_form_submit_action?processSubmitObj({pageName:pref,overrideFormSubmitAction:prop.override_form_submit_action}):processSubmit(pref,!1,!1,!0);else if("select"===prop.action)buttonElement.hasClass(elName+"_selected")?buttonElement.hasClass(elName+"_selected")&&(buttonElement.removeClass(elName+"_selected"),buttonElement.hasClass("button_selected")&&buttonElement.removeClass("button_selected"),removeButtonData(pref,prop)):(buttonElement.addClass(elName+"_selected"),buttonElement.hasClass("button_selected")||buttonElement.addClass("button_selected"),addButtonData(pref,prop,elName));else if("close"===prop.action)addButtonData(pref,prop,elName),IS_MOBILE?setTimeout((function(){postMessageCloseBox("button_click")}),150):setTimeout((function(){postMessageCloseBox("button_click")}),10);else if("url"===prop.action&&prop.url)addButtonData(pref,prop,elName),0!==prop.url.toLowerCase().trim().indexOf("http")&&0!==prop.url.toLowerCase().trim().indexOf("mailto")&&(prop.url="http://"+prop.url),prop.hasOwnProperty("redirect_type")&&prop.redirect_type||(prop.redirect_type="current"),postMessageRedirectParent(prop,"button");else if("lightbox_open"===prop.action&&prop.lightbox_open&&prop.lightbox_open.length>0)addButtonData(pref,prop,elName),IS_MOBILE?setTimeout((function(){postMessageOpenAnotherBox(prop,"button")}),150):setTimeout((function(){postMessageOpenAnotherBox(prop,"button")}),10);else if("copy"===prop.action&&prop.copy_text&&prop.copy_text.length>0)addButtonData(pref,prop,elName),$("#"+prop.copy_text).length&&$("#"+prop.copy_text).text()&&$("#"+prop.copy_text).text().length&&(UTIL.copyToClipboard($("#"+prop.copy_text).text(),document),showSuccess("Copied to Clipboard: "+$("#"+prop.copy_text).text()));else if("main_page"===prop.action||"thank_you_page"===prop.action||0===prop.action.indexOf("extra_page_")){addButtonData(pref,prop,elName);var changePagePref="";"thank_you_page"===prop.action?changePagePref="thx_":prop.action.indexOf("extra_page_")>=0&&(changePagePref="ep"+prop.action.split("_")[2]+"_"),IS_MOBILE?setTimeout((function(){changePages(changePagePref,elName,prop,"button",!1)}),150):changePages(changePagePref,elName,prop,"button",!1)}else if("next_page"===prop.action){addButtonData(pref,prop,elName);var nextPagePref=getNextPage(pref);if(nextPagePref=DUTIL.getUnfriendlyPagePrefix(nextPagePref)){setTimeout((()=>{changePages(nextPagePref,elName,prop,"button",!1)}),IS_MOBILE?150:0)}}else"nothing"===prop.action&&setButtonMetaDataLayer(prop)}))}else el.on(IS_MOBILE?"click":"mousedown",(function(e){addButtonData(pref,prop,elName),$(document).trigger("BOX_BUTTON_CLICK",[DUTIL.getFriendlyPagePrefix(pref),elName,prop]),e.stopPropagation()}));el.on(IS_MOBILE?"touchstart":"mousedown",(function(){$(this).addClass(elName+"_focus")})).on(IS_MOBILE?"touchend":"mouseup",(function(){$(this).removeClass(elName+"_focus"),$(document).trigger("BOX_BUTTON_RELEASE",[DUTIL.getFriendlyPagePrefix(pref),elName,prop])}))}else el.hide(),elWrapper.hide()}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"buildButtonN")}}function getNextPage(pref){if("object"!=typeof settings||!settings)return"";let currentPage=DUTIL.getPlainPref(pref),displayedPages=Object.keys(settings).filter((key=>key.endsWith("layout")&&"layout"!==key)).map((key=>key.replace("layout",""))).sort(((a,b)=>{if("thx"===a)return 1;if("thx"===b)return-1;return(parseInt(a.replace("ep",""))||0)-(parseInt(b.replace("ep",""))||0)}));settings.sortOrder=settings.sortOrder.concat(displayedPages.filter((page=>!settings.sortOrder.includes(page))));let pages=Array.isArray(settings.sortOrder)?["main",...settings.sortOrder.map((v=>DUTIL.getPlainPref(v.replace("accordion_",""))))]:["main",...displayedPages],nextPage=pages.slice(pages.indexOf(""==currentPage?"main":currentPage)+1).find((p=>"object"==typeof settings[p+"layout"]));return nextPage?DUTIL.getPlainPref(nextPage):null}function deselectButtonsOnPage(pref){try{pref=DUTIL.getPlainPref(pref),$("#"+pref+"layout button").each((function(){var $t=$(this);if($t.hasClass("button_selected")){var bid=$t.attr("id");bid&&$t.hasClass(bid+"_selected")&&($t.removeClass(bid+"_selected"),$t.removeClass("button_selected"))}}))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"deselectButtonsOnPage")}}function removeFocusFromButtonsOnPage(pref){try{pref=DUTIL.getPlainPref(pref),$("#"+pref+"layout button").each((function(){var $t=$(this),bid=$t.attr("id");bid&&$t.hasClass(bid+"_focus")&&$t.removeClass(bid+"_focus")}))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"removeFocusFromButtonsOnPage")}}function loadImages(pref,force){try{if("string"==typeof pref&&"main"!==pref||(pref=""),UTIL.stringOrArrayContains(pref,"_")&&(pref=pref.split("_")[0]),!force)if(""===pref||LoadedPageImages.hasOwnProperty(pref)){if(LoadedPageImages.hasOwnProperty(pref)&&!0===LoadedPageImages[pref])return}else LoadedPageImages[pref]=!0;logger("loadImages(pref="+pref+", force="+force+")");for(var isResultsPRQ=DIGIOH_PRQ.isResultsPagePRQ(pref),x=1;x<=50;x++)settings.hasOwnProperty(pref+"image"+x)&&(isResultsPRQ&&settings[pref+"image"+x].hasOwnProperty("prq_is_results_image")&&settings[pref+"image"+x].prq_is_results_image&&settings[pref+"image"+x].prq_results_src||loadImageN(pref+"image"+x,force))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"loadImages")}}function loadImageN(prop_name,force){try{var attr=$("#"+prop_name).attr("src"),hasPRQAppsResultsAttr=attributeNameMatches($("#"+prop_name),"starts_with","prq_result")||attributeNameMatches($("#"+prop_name),"starts_with","bgimg_replace")||attributeNameMatches($("#"+prop_name),"starts_with","img_dynamic");ImageSrcMap.hasOwnProperty(prop_name)&&(void 0===attr||!1===attr||!attr||force)&&ImageSrcMap[prop_name].img_src.indexOf("[PRQ:")<0&&!hasPRQAppsResultsAttr&&(ImageSrcMap.hasOwnProperty(prop_name+"_dynamic")&&ImageSrcMap[prop_name+"_dynamic"].img_src&&ImageSrcMap[prop_name+"_dynamic"].img_src.indexOf("[PRQ:")<0?(logger("loadImageN: "+ImageSrcMap[prop_name+"_dynamic"].img_src),ImageSrcMap[prop_name].img_element.attr("src",ImageSrcMap[prop_name+"_dynamic"].img_src),ImageSrcMap[prop_name].img_obj.src=ImageSrcMap[prop_name+"_dynamic"].img_src):(logger("loadImageN: "+ImageSrcMap[prop_name].img_src),ImageSrcMap[prop_name].img_element.attr("src",ImageSrcMap[prop_name].img_src),ImageSrcMap[prop_name].img_obj.src=ImageSrcMap[prop_name].img_src))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"loadImageN")}}function attributeNameMatches(ele,operator,text){try{var foundMatch=!1;return ele.each((function(){$.each(this.attributes,(function(){this.specified&&"starts_with"==operator&&0==this.name.indexOf(text)&&(logger("attributeNameMatches: "+this.name+", "+this.value),foundMatch=!0)}))})),foundMatch}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"attributeNameMatches"),!1}}function buildImages(){try{for(var pr="",j=1;j<=102;j++){if(1==j)pr="";else if(2==j)pr="thx";else if(j>=3&&j<=6)pr="ep"+(j-2);else if(j>=7&&(pr="ep"+(j-2),!settings.hasOwnProperty("extra_pages")||settings.extra_pages.length<=j-3||!settings.extra_pages[j-3]||1!==settings.extra_pages[j-3].on))continue;for(var x=1;x<=50;x++)if(settings.hasOwnProperty(pr+"image"+x)&&settings[pr+"image"+x].display){if(image_dims.hasOwnProperty(pr+"image"+x)||(image_dims[pr+"image"+x]={width:100,height:100}),settings[pr+"image"+x].hasOwnProperty("metadata_kvps"))for(var k=0;k<settings[pr+"image"+x].metadata_kvps.length;k++)settings[pr+"image"+x].metadata_kvps[k].k&&settings[pr+"image"+x].metadata_kvps[k].v&&UTIL.trySetAttribute(pr+"image"+x,settings[pr+"image"+x].metadata_kvps[k],$);buildImageN(image_dims[pr+"image"+x],$("#"+pr+"image"+x+"_wrapper"),$("#"+pr+"image"+x),pr+"image"+x,settings[pr+"image"+x])}}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"buildImages")}}function buildImageN(el_dims,el_wrapper,el,prop_name,prop){try{if(prop.display&&prop.src&&"none"!==prop.src&&prop.src.length>5){var src=S3_BASE_URL+"/vendors/"+VENDOR_GUID+"/uploads/"+prop.src,img=new Image;img.onload=function(){el_dims.width=this.width,el_dims.height=this.height,resizeImage(el_dims,el_wrapper,el,prop_name,prop.width,prop.height,!1),el_wrapper.show()},ImageSrcMap[prop_name]={img_obj:img,img_src:src,img_element:el}}else el_wrapper.hide()}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"buildImageN")}}function resizeImage(el_dims,el_wrapper,el,prop_name,wrapperWidth,wrapperHeight,isDynamic){try{var prop=settings[prop_name];if(prop.constrain){let width,height;if(el_dims.width>=el_dims.height?(width=wrapperWidth-2*prop.border.width-2*prop.padding,"none"!==prop.border.style&&"0"!==prop.border.width&&0!==prop.border.width||(width=wrapperWidth-2*prop.padding),height=el_dims.height*(width/el_dims.width)):(height=wrapperHeight-2*prop.border.width-2*prop.padding,"none"!==prop.border.style&&"0"!==prop.border.width&&0!==prop.border.width||(height=wrapperHeight-2*prop.padding),width=el_dims.width*(height/el_dims.height)),isDynamic&&height<wrapperHeight-2*prop.padding-10){const margin=(wrapperHeight-2*prop.padding-height)/2;el.css({height:Math.round(height)+"px","margin-top":Math.round(margin)+"px"})}else el.css({height:Math.round(height)+"px"});el.width(Math.floor(width))}else{var width=wrapperWidth-2*prop.border.width-2*prop.padding,height=wrapperHeight-2*prop.border.width-2*prop.padding;"none"!==prop.border.style&&"0"!==prop.border.width&&0!==prop.border.width||(width=wrapperWidth-2*prop.padding),"none"!==prop.border.style&&"0"!==prop.border.width&&0!==prop.border.width||(height=wrapperHeight-2*prop.padding),el.width(Math.floor(width)),el.height(Math.floor(height))}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"resizeImage")}}function getBorderStyle(propBorder){var str="";return void 0===propBorder.style||null===propBorder.style||"none"===propBorder.style||"0"===propBorder.width||0===propBorder.width?(str+="border-style: none;",str+="border-width: 0px;"):(str+="border-color: "+propBorder.color+";",str+="border-style: "+propBorder.style+";",str+="border-width: "+propBorder.width+"px;",propBorder.use_radius_vals&&"radius_vals"in propBorder?str+=` border-radius: ${propBorder.radius_vals.topleft}px ${propBorder.radius_vals.topright}px ${propBorder.radius_vals.bottomright}px ${propBorder.radius_vals.bottomleft}px;`:str+="border-radius: "+propBorder.radius+"px;"),str}function getPaddingStyle(propPadding){var str="";return propPadding?str=propPadding.use_all?` padding: ${propPadding.all}px;`:` padding: ${propPadding.top}px ${propPadding.right}px ${propPadding.bottom}px ${propPadding.left}px;`:str}function getBackgroundStyle(propBackground,eleName){var runImgSrcReplacement=!0;"string"==typeof eleName&&(eleName.indexOf("button")>=0||eleName.indexOf("layout")>=0)&&$("#"+eleName).length&&(attributeNameMatches($("#"+eleName),"starts_with","prq_result")||attributeNameMatches($("#"+eleName),"starts_with","bgimg_replace")||attributeNameMatches($("#"+eleName),"starts_with","img_dynamic"))&&(runImgSrcReplacement=!1);var str="";if(propBackground.use_image&&propBackground.image.length>3&&"none"!=propBackground.image){var bgSrc=buildAssetUrl(propBackground.image);if(propBackground.image.startsWith("[PRQ")){var headerName="PRQ:"+propBackground.image.replace("[","").replace("]","").split(":")[1],rowRank=propBackground.image.split(":").length>2?parseInt(propBackground.image.split(":")[2].replace("]","")):1,tempSrc=DIGIOH_PRQ.getResultCellValuePRQ(headerName,rowRank);logger("getBackgroundStyle=="+propBackground.image+", headerName="+headerName+", rowIdx="+rowRank+", getResultCellValuePRQ="+tempSrc),tempSrc&&0==tempSrc.indexOf("http")&&(bgSrc=tempSrc,str+="background-size: contain !important;")}runImgSrcReplacement&&(settings.fullscreen&&settings.fullscreen.use&&eleName.indexOf("layout")>=0?"full"===settings.fullscreen.backgroundType&&(str+="background-image: url("+bgSrc+");"):str+="background-image: url("+bgSrc+");"),str+="background-position: "+propBackground.position+";",str+="background-color: "+propBackground.color+";","stretch"===propBackground.repeat?(str+="-webkit-background-size: cover;",str+="-moz-background-size: cover;",str+="-o-background-size: cover;",str+="background-size: cover;"):"contain"===propBackground.repeat?(str+="-webkit-background-size: contain;",str+="-moz-background-size: contain;",str+="-o-background-size: contain;",str+="background-size: contain;",str+="background-repeat: no-repeat;"):str+="background-repeat: "+propBackground.repeat+";"}else!IS_IE_9_OR_LESS&&propBackground.use_gradient&&propBackground.gradient.length>3?(str+="background: -webkit-gradient(linear, left top, left bottom, from("+propBackground.color+"),to("+propBackground.gradient+"));",str+="background: -webkit-linear-gradient(top, "+propBackground.color+","+propBackground.gradient+");",str+="background: -o-linear-gradient(top, "+propBackground.color+","+propBackground.gradient+");",str+="background: -moz-linear-gradient(top, "+propBackground.color+","+propBackground.gradient+");",str+="background: -ms-linear-gradient(top, "+propBackground.color+","+propBackground.gradient+");",str+="background: linear-gradient(to bottom,"+propBackground.color+","+propBackground.gradient+");"):str+="background: "+propBackground.color+";";return str}function getFontStyle(propFont){var str="",gweight="";if(propFont.family.indexOf("__google__")>=0){var gfam=propFont.family.replace("__google__","");gfam.indexOf(":")>0?(gweight=gfam.split(":")[1].split("'")[0],str+="font-family: "+(gfam=gfam.split(":")[0])+"';"):str+="font-family: "+gfam+";"}else propFont.family.indexOf("__custom__")>=0?str+="font-family: "+propFont.family.split("||||")[1]+";":str+="font-family: "+propFont.family+";";return gweight?("Black"==gweight&&(str+="font-weight: 900;"),"ExtraBold"==gweight&&(str+="font-weight: 800;"),"Bold"==gweight&&(str+="font-weight: 700;"),"Light"==gweight&&(str+="font-weight: 300;"),"ExtraLight"==gweight&&(str+="font-weight: 200;"),"Thin"==gweight&&(str+="font-weight: 100;")):str+="font-weight: "+(propFont.bold?"bold":"normal")+";",str+="font-style:  "+(propFont.italic?"italic":"normal")+";",str+="text-decoration: "+(propFont.underline?"underline":"none")+";",str+="text-transform: "+(propFont.uppercase?"uppercase":"none")+";",str+="text-align: "+propFont.align+";",str+="font-size: "+propFont.size+"px;",str+="color: "+propFont.color+";",propFont.hasOwnProperty("vspace")&&null!==propFont.vspace&&""!==propFont.vspace&&"0"!==propFont.vspace&&0!==propFont.vspace&&(str+="line-height: "+propFont.vspace+"px;"),"letter_spacing"in propFont&&""!=propFont.letter_spacing&&"0"!=propFont.letter_spacing&&(str+=` letter-spacing: ${propFont.letter_spacing}px;`),str}function getWidthStyle(width){var str="";return str+="width: "+width+"px;"}function getWidthPercentStyle(width){var str="";return str+="width: "+width+"%;"}function getHeightStyle(height){var str="";return str+="height: "+height+"px;"}function getHeightPercentStyle(height){var str="";return str+="height: "+height+"%;"}function getLineHeightStyle(lineHeight){var str="";return str+="line-height: "+lineHeight+"px;"}function getTextAlignStyle(align){var str="";return str+="text-align: "+align+";"}function getDisplayStyle(display){var str="";return str+="display: "+(display?"block":"none")+";"}function getOverflowHiddenStyle(){return"overflow: hidden;"}function getOverflowVisibleStyle(){return"overflow: visible;"}function getFloatLeftStyle(){return"float: left;"}function getFloatRightStyle(){return"float: right;"}function getPositionAbsoluteStyle(){return"position: absolute;"}function getGeneralStyle(propName,propVal){var str="";return str+=propName.split("'").join("")+": "+propVal.split("'").join('"').split(";").join("")+";"}function getLeftStyle(left){var str="";return str+="left: "+left+"px;"}function getTopStyle(top){var str="";return str+="top: "+top+"px;"}function getLeftTopWidthHeightStyle(prop){var str="";return str+="left: "+prop.x+"px;",str+="top: "+prop.y+"px;",str+="width: "+prop.width+"px;",str+="height: "+prop.height+"px;"}function getTextElementLeftTopWidthHeightStyle(prop){var str="";return str+="left: "+prop.x+"px;",str+="top: "+prop.y+"px;",str+="width: "+(prop.width+5)+"px;",str+="height: "+prop.height+"px;"}function getZindexStyle(zindex){var str="";return str+="z-index: "+zindex+";"}function getCursorStyle(curse){var str="";return str+="cursor: "+curse+";"}function centerWrapperLayout(pref){var styles="",left=0;if(["full","split_top","split_bottom"].includes(settings.fullscreen?.backgroundType))left=(window.innerWidth-settings[pref+"layout"].width)/2;else{styles+="display: grid;",styles+="grid-area: "+("split_left"===settings.fullscreen.backgroundType?"1 / 2":"1 / 1")+";",styles+="grid-column :"+("split_left"===settings.fullscreen.backgroundType?"2":"1")+";",styles+="grid-row:1;";var backgroundWidth=parseInt(settings.fullscreen.backgroundWidth.replace("vw","")),layoutWidth=settings[pref+"layout"].width,remainingPercentage=100-backgroundWidth;(left=(window.innerWidth*remainingPercentage/100-layoutWidth)/2)<0&&(left=0)}var top;if(left<0&&(left=0),settings[pref+"layout"].height>window.innerHeight?(top=(settings[pref+"layout"].height-window.innerHeight)/2,window.innerHeight<600&&(top=10)):top=(window.innerHeight-settings[pref+"layout"].height)/2,styles+="position:absolute;",styles+="left:"+left+"px;","split_top"===settings.fullscreen?.backgroundType?styles+="bottom:0px !important;":"split_bottom"===settings.fullscreen?.backgroundType?styles+="top:0px !important;":["full","split_left","split_right"].includes(settings.fullscreen?.backgroundType)?styles+="top:"+(top=`calc(50vh - ${settings[pref+"layout"].height/2}px)`)+";":styles+="top:"+top+"px;","full"!==settings.fullscreen?.backgroundType){let extractWidthNum=settings.fullscreen?.backgroundWidth?100-parseInt(settings.fullscreen?.backgroundWidth.replace("vw","")):50;0===extractWidthNum&&(extractWidthNum=100),styles+="width: "+extractWidthNum+"vw;",styles+="height: 100%;",styles+="box-sizing: border-box;"}if(["split_top","split_bottom"].includes(settings.fullscreen?.backgroundType)){let extractHeightNum=settings.fullscreen?.backgroundHeight?100-parseInt(settings.fullscreen?.backgroundHeight.replace("vw","")):50;extractHeightNum>0&&(styles+="height:"+extractHeightNum+"% !important;")}return styles}function wrapLayoutContent(pref){var wrapperId=pref+"layout-wrapper",$layout=$("#"+pref+"layout"),$layoutWrapper=$('<div id="'+wrapperId+'"></div>');if($("#"+wrapperId).length>0)return void $("#"+wrapperId).attr("style",centerWrapperLayout(pref));if($layout.children().appendTo($layoutWrapper),$layout.append($layoutWrapper),settings[pref+"layout"].background.use_image&&"full"!==settings.fullscreen?.backgroundType){var $layoutBackground=$('<div id="'+pref+'layout-background"></div>'),imageUrl=S3_BASE_URL+"/vendors/"+VENDOR_GUID+"/uploads/"+settings[pref+"layout"].background.image;$layout.append($layoutBackground),$layout.parent().css("display","grid"),$layoutBackground.css({display:"grid","background-image":"url("+imageUrl+")","background-size":"stretch"===settings[pref+"layout"].background.repeat||"contain"===settings[pref+"layout"].background.repeat?"stretch"==settings[pref+"layout"].background.repeat?"cover":settings[pref+"layout"].background.repeat:"","background-position":settings[pref+"layout"].background.position,"background-repeat":"stretch"!==settings[pref+"layout"].background.repeat&&"contain"!==settings[pref+"layout"].background.repeat?settings[pref+"layout"].background.repeat:"no-repeat",height:settings.fullscreen?.backgroundHeight,width:settings.fullscreen?.backgroundWidth,"grid-column":"split_left"===settings.fullscreen?.backgroundType?"1":"2","grid-row":"1","grid-area":"split_right"===settings.fullscreen?.backgroundType?"1/3":"1"}),"split_top"===settings.fullscreen?.backgroundType?$layoutBackground.css({top:"0px",position:"absolute"}):"split_bottom"===settings.fullscreen?.backgroundType&&$layoutBackground.css({bottom:"0px",position:"absolute"}),"split_bottom"!==settings.fullscreen?.backgroundType&&"split_top"!==settings.fullscreen?.backgroundType||parseInt(settings.fullscreen?.backgroundHeight.replace("vh",""))>60&&$layout.css("overflow-y","auto"),$layout.css({"background-image":"none !important",display:"grid","grid-template-columns":"split_left"===settings.fullscreen?.backgroundType?"0fr 1fr":"1fr 1fr"})}$layoutWrapper.attr("style",centerWrapperLayout(pref));let bubbleContainer=document.getElementById("bubble_container");bubbleContainer&&(bubbleContainer.style.width="100vw")}function buildStyles(pref,force_run){try{var str="";if("string"==typeof pref&&"main"!==pref||(pref=""),UTIL.stringOrArrayContains(pref,"_")&&(pref=pref.split("_")[0]),""===pref||BuiltExtraPageStyles.hasOwnProperty(pref)){if(BuiltExtraPageStyles.hasOwnProperty(pref)&&!0===BuiltExtraPageStyles[pref]&&!force_run)return}else BuiltExtraPageStyles[pref]=!0;if(""===pref?$("#element_styles").remove():$("#element_styles_"+pref).remove(),logger("buildStyles("+pref+")"),""===pref&&(str+=".float_left {",str+=getFloatLeftStyle(),str+="} ",str+=".float_right {",str+=getFloatRightStyle(),str+="} "),str+="#"+pref+"layout {",str+=getBorderStyle(settings[pref+"layout"].border),str+=getBackgroundStyle(settings[pref+"layout"].background,pref+"layout"),settings[pref+"layout"].hasOwnProperty("width")&&settings[pref+"layout"].hasOwnProperty("height"))if("none"===settings[pref+"layout"].border.style||"0"===settings[pref+"layout"].border.width||0===settings[pref+"layout"].border.width)if(settings.hasOwnProperty("fullscreen")&&settings.fullscreen.use)(window.innerHeight-settings[pref+"layout"].height)/2<0&&(str+="overflow-y:auto !important;"),str+="width:100vw !important;",str+="height:100vh !important;",str+="position:relative;",str+="box-sizing: border-box;",settings[pref+"layout"].background.use_image&&"full"===settings.fullscreen.backgroundType?(str+="background-size:cover !important; ",str+="background-repeat:no-repeat !important;"):(str+="background-size: "+settings[pref+"layout"].background.repeat=="stretch"||"contain"===settings[pref+"layout"].background.repeat?"stretch"==settings[pref+"layout"].background.repeat?"cover":settings[pref+"layout"].background.repeat:";",str+="background-repeat:"+settings[pref+"layout"].background.repeat!="stretch"&&"contain"!==settings[pref+"layout"].background.repeat?settings[pref+"layout"].background.repeat:"no-repeat;"),wrapLayoutContent(pref);else str+=getWidthStyle(settings[pref+"layout"].width),str+=getHeightStyle(settings[pref+"layout"].height);else if(settings.hasOwnProperty("fullscreen")&&settings.fullscreen.use)(window.innerHeight-settings[pref+"layout"].height)/2<0&&(str+="overflow-y:auto !important;"),str+="width:100vw !important;",str+="height:100vh !important;",str+="position:relative;",str+="box-sizing: border-box;",settings[pref+"layout"].background.use_image&&"full"===settings.fullscreen.backgroundType?(str+="background-size:cover !important; ",str+="background-repeat:no-repeat !important;"):(str+="background-size: "+settings[pref+"layout"].background.repeat=="stretch"||"contain"===settings[pref+"layout"].background.repeat?"stretch"==settings[pref+"layout"].background.repeat?"cover":settings[pref+"layout"].background.repeat:";",str+="background-repeat:"+settings[pref+"layout"].background.repeat!="stretch"&&"contain"!==settings[pref+"layout"].background.repeat?settings[pref+"layout"].background.repeat:"no-repeat;"),wrapLayoutContent(pref);else str+=getWidthStyle(settings[pref+"layout"].width-2*settings[pref+"layout"].border.width),str+=getHeightStyle(settings[pref+"layout"].height-2*settings[pref+"layout"].border.width);else"none"===settings.layout.border.style||"0"===settings.layout.border.width||0===settings.layout.border.width?(str+=getWidthStyle(settings.layout.width),str+=getHeightStyle(settings.layout.height)):(str+=getWidthStyle(settings.layout.width-2*settings.layout.border.width),str+=getHeightStyle(settings.layout.height-2*settings.layout.border.width));if(str+=getOverflowHiddenStyle(),str+=getGeneralStyle("margin","0"),str+=getGeneralStyle("padding","0"),settings[pref+"layout"].hasOwnProperty("css_kvps"))for(var k=0;k<settings[pref+"layout"].css_kvps.length;k++)settings[pref+"layout"].css_kvps[k].k&&settings[pref+"layout"].css_kvps[k].v&&(settings[pref+"layout"].css_kvps[k].v.indexOf("important")<0&&(settings[pref+"layout"].css_kvps[k].v+=" !important"),str+=getGeneralStyle(settings[pref+"layout"].css_kvps[k].k,settings[pref+"layout"].css_kvps[k].v));str+="} ",settings.hasOwnProperty("fullscreen")&&settings.fullscreen.use&&(str+="#"+pref+"layout-wrapper {",str+=centerWrapperLayout(pref),str+="}");for(var j=1;j<=50;j++){if(settings.hasOwnProperty(pref+"text"+j)&&settings[pref+"text"+j].display){if(str+="#"+pref+"text"+j+"_wrapper {",str+=getDisplayStyle(settings[pref+"text"+j].display),str+=getPositionAbsoluteStyle(),str+=getZindexStyle(4500),str+=getTextElementLeftTopWidthHeightStyle(settings[pref+"text"+j]),settings[pref+"text"+j].hasOwnProperty("wrapper_css_kvps"))for(k=0;k<settings[pref+"text"+j].wrapper_css_kvps.length;k++)settings[pref+"text"+j].wrapper_css_kvps[k].k&&settings[pref+"text"+j].wrapper_css_kvps[k].v&&(settings[pref+"text"+j].wrapper_css_kvps[k].v.indexOf("important")<0&&(settings[pref+"text"+j].wrapper_css_kvps[k].v+=" !important"),str+=getGeneralStyle(settings[pref+"text"+j].wrapper_css_kvps[k].k,settings[pref+"text"+j].wrapper_css_kvps[k].v));if(str+="} ",str+="#"+pref+"text"+j+" {",str+=getFontStyle(settings[pref+"text"+j].font),settings[pref+"text"+j].hasOwnProperty("css_kvps"))for(k=0;k<settings[pref+"text"+j].css_kvps.length;k++)settings[pref+"text"+j].css_kvps[k].k&&settings[pref+"text"+j].css_kvps[k].v&&(str+=getGeneralStyle(settings[pref+"text"+j].css_kvps[k].k,settings[pref+"text"+j].css_kvps[k].v));str+="} "}if(settings.hasOwnProperty(pref+"button"+j)&&settings[pref+"button"+j].display){if(str+="#"+pref+"button"+j+"_wrapper {",str+=getDisplayStyle(settings[pref+"button"+j].display),str+=getPositionAbsoluteStyle(),str+=getLeftTopWidthHeightStyle(settings[pref+"button"+j]),str+=getZindexStyle(9e3),settings[pref+"button"+j].hasOwnProperty("wrapper_css_kvps"))for(k=0;k<settings[pref+"button"+j].wrapper_css_kvps.length;k++)settings[pref+"button"+j].wrapper_css_kvps[k].k&&settings[pref+"button"+j].wrapper_css_kvps[k].v&&(settings[pref+"button"+j].wrapper_css_kvps[k].v.indexOf("important")<0&&(settings[pref+"button"+j].wrapper_css_kvps[k].v+=" !important"),str+=getGeneralStyle(settings[pref+"button"+j].wrapper_css_kvps[k].k,settings[pref+"button"+j].wrapper_css_kvps[k].v));if(str+="} ",str+="."+pref+"button"+j+" {",str+=getFontStyle(settings[pref+"button"+j].font),str+=getBorderStyle(settings[pref+"button"+j].border),str+=getPaddingStyle(settings[pref+"button"+j].padding),str+=getBackgroundStyle(settings[pref+"button"+j].background,pref+"button"+j),str+=getWidthPercentStyle(100),str+=getHeightPercentStyle(100),str+=getCursorStyle("pointer"),str+=getZindexStyle(9e3),str+=getGeneralStyle("position","relative"),settings[pref+"button"+j].hasOwnProperty("css_kvps"))for(k=0;k<settings[pref+"button"+j].css_kvps.length;k++)settings[pref+"button"+j].css_kvps[k].k&&settings[pref+"button"+j].css_kvps[k].v&&(str+=getGeneralStyle(settings[pref+"button"+j].css_kvps[k].k,settings[pref+"button"+j].css_kvps[k].v));if(str+="} ",str+="."+pref+"button"+j+"_hover {",str+=getFontStyle(settings[pref+"button"+j].font_hover),str+=getBorderStyle(settings[pref+"button"+j].border_hover),str+=getPaddingStyle(settings[pref+"button"+j].padding_hover),str+=getBackgroundStyle(settings[pref+"button"+j].background_hover,pref+"button"+j),str+=getCursorStyle("pointer"),settings[pref+"button"+j].hasOwnProperty("css_kvps_hover"))for(k=0;k<settings[pref+"button"+j].css_kvps_hover.length;k++)settings[pref+"button"+j].css_kvps_hover[k].k&&settings[pref+"button"+j].css_kvps_hover[k].v&&(str+=getGeneralStyle(settings[pref+"button"+j].css_kvps_hover[k].k,settings[pref+"button"+j].css_kvps_hover[k].v));if(str+="} ",settings.hasOwnProperty(pref+"button"+j)&&"select"===settings[pref+"button"+j].action){if(str+="."+pref+"button"+j+"_selected {",str+=getFontStyle(settings[pref+"button"+j].font_focus),str+=getBorderStyle(settings[pref+"button"+j].border_focus),str+=getPaddingStyle(settings[pref+"button"+j].padding_focus),str+=getBackgroundStyle(settings[pref+"button"+j].background_focus,pref+"button"+j),str+=getCursorStyle("pointer"),settings[pref+"button"+j].hasOwnProperty("css_kvps_focus"))for(k=0;k<settings[pref+"button"+j].css_kvps_focus.length;k++)settings[pref+"button"+j].css_kvps_focus[k].k&&settings[pref+"button"+j].css_kvps_focus[k].v&&(str+=getGeneralStyle(settings[pref+"button"+j].css_kvps_focus[k].k,settings[pref+"button"+j].css_kvps_focus[k].v));if(str+="} ",str+="."+pref+"button"+j+"_hover."+pref+"button"+j+"_selected {",settings[pref+"button"+j].hasOwnProperty("font_focus_hover")&&(str+=getFontStyle(settings[pref+"button"+j].font_focus_hover)),settings[pref+"button"+j].hasOwnProperty("border_focus_hover")&&(str+=getBorderStyle(settings[pref+"button"+j].border_focus_hover)),settings[pref+"button"+j].hasOwnProperty("padding_focus_hover")&&(str+=getPaddingStyle(settings[pref+"button"+j].padding_focus_hover)),settings[pref+"button"+j].hasOwnProperty("background_focus_hover")&&(str+=getBackgroundStyle(settings[pref+"button"+j].background_focus_hover,pref+"button"+j)),str+=getCursorStyle("pointer"),settings[pref+"button"+j].hasOwnProperty("css_kvps_focus_hover"))for(k=0;k<settings[pref+"button"+j].css_kvps_focus_hover.length;k++)settings[pref+"button"+j].css_kvps_focus_hover[k].k&&settings[pref+"button"+j].css_kvps_focus_hover[k].v&&(str+=getGeneralStyle(settings[pref+"button"+j].css_kvps_focus_hover[k].k,settings[pref+"button"+j].css_kvps_focus_hover[k].v));str+="} "}else{if(str+="."+pref+"button"+j+"_focus {",str+=getFontStyle(settings[pref+"button"+j].font_focus),str+=getBorderStyle(settings[pref+"button"+j].border_focus),str+=getBackgroundStyle(settings[pref+"button"+j].background_focus,pref+"button"+j),str+=getCursorStyle("pointer"),settings[pref+"button"+j].hasOwnProperty("css_kvps_focus"))for(k=0;k<settings[pref+"button"+j].css_kvps_focus.length;k++)settings[pref+"button"+j].css_kvps_focus[k].k&&settings[pref+"button"+j].css_kvps_focus[k].v&&(str+=getGeneralStyle(settings[pref+"button"+j].css_kvps_focus[k].k,settings[pref+"button"+j].css_kvps_focus[k].v));str+="} "}}if(settings.hasOwnProperty(pref+"image"+j)&&settings[pref+"image"+j].display){if(str+="#"+pref+"image"+j+"_wrapper {",str+=getDisplayStyle(settings[pref+"image"+j].display),str+=getPositionAbsoluteStyle(),str+=getZindexStyle(4500),str+=getLeftTopWidthHeightStyle(settings[pref+"image"+j]),str+=getTextAlignStyle("center"),settings[pref+"image"+j].hasOwnProperty("wrapper_css_kvps"))for(k=0;k<settings[pref+"image"+j].wrapper_css_kvps.length;k++)settings[pref+"image"+j].wrapper_css_kvps[k].k&&settings[pref+"image"+j].wrapper_css_kvps[k].v&&(settings[pref+"image"+j].wrapper_css_kvps[k].v.indexOf("important")<0&&(settings[pref+"image"+j].wrapper_css_kvps[k].v+=" !important"),str+=getGeneralStyle(settings[pref+"image"+j].wrapper_css_kvps[k].k,settings[pref+"image"+j].wrapper_css_kvps[k].v));if(str+="} ",str+="#"+pref+"image"+j+" {",str+=getBorderStyle(settings[pref+"image"+j].border),str+=getGeneralStyle("padding",settings[pref+"image"+j].padding+"px"),settings[pref+"image"+j].width>=settings[pref+"image"+j].height?(str+=getGeneralStyle("max-width",settings[pref+"image"+j].width+"px"),str+=getGeneralStyle("max-height",settings[pref+"image"+j].width+"px")):(str+=getGeneralStyle("max-width",settings[pref+"image"+j].height+"px"),str+=getGeneralStyle("max-height",settings[pref+"image"+j].height+"px")),settings[pref+"image"+j].hasOwnProperty("css_kvps"))for(k=0;k<settings[pref+"image"+j].css_kvps.length;k++)settings[pref+"image"+j].css_kvps[k].k&&settings[pref+"image"+j].css_kvps[k].v&&(str+=getGeneralStyle(settings[pref+"image"+j].css_kvps[k].k,settings[pref+"image"+j].css_kvps[k].v));str+="} "}if(settings.hasOwnProperty(pref+"html"+j)&&settings[pref+"html"+j].display){if(str+="#"+pref+"html"+j+"_wrapper {",str+=getDisplayStyle(settings[pref+"html"+j].display),str+=getPositionAbsoluteStyle(),str+=getZindexStyle(4500),str+=getLeftTopWidthHeightStyle(settings[pref+"html"+j]),settings[pref+"html"+j].hasOwnProperty("wrapper_css_kvps"))for(k=0;k<settings[pref+"html"+j].wrapper_css_kvps.length;k++)settings[pref+"html"+j].wrapper_css_kvps[k].k&&settings[pref+"html"+j].wrapper_css_kvps[k].v&&(settings[pref+"html"+j].wrapper_css_kvps[k].v.indexOf("important")<0&&(settings[pref+"html"+j].wrapper_css_kvps[k].v+=" !important"),str+=getGeneralStyle(settings[pref+"html"+j].wrapper_css_kvps[k].k,settings[pref+"html"+j].wrapper_css_kvps[k].v));if(str+="} ",str+="#"+pref+"html"+j+" {",settings[pref+"html"+j].hasOwnProperty("css_kvps"))for(k=0;k<settings[pref+"html"+j].css_kvps.length;k++)settings[pref+"html"+j].css_kvps[k].k&&settings[pref+"html"+j].css_kvps[k].v&&(str+=getGeneralStyle(settings[pref+"html"+j].css_kvps[k].k,settings[pref+"html"+j].css_kvps[k].v));str+="} "}}if(""!==pref&&(pref+="_"),settings.hasOwnProperty(pref+"form")){str+="#"+pref+"form_wrapper {",str+=getDisplayStyle(settings[pref+"form"].display),str+=getPositionAbsoluteStyle(),str+=getZindexStyle(4500),str+=getLeftTopWidthHeightStyle(settings[pref+"form"]),str+="} ",str+="."+pref+"form_spacing {",str+=getGeneralStyle("margin-top",settings[pref+"inputs"].spacing+"px"),str+="} ",str+="."+pref+"form_labels {",str+=getFontStyle(settings[pref+"labels"].font),str+=getOverflowHiddenStyle(),str+="} ",settings[pref+"labels"].hasOwnProperty("font_subtext")&&(str+="."+pref+"form_labels_subtext {",str+=getFontStyle(settings[pref+"labels"].font_subtext),str+=getOverflowHiddenStyle(),str+="} "),str+="."+pref+"form_labels_left {",str+=getFloatLeftStyle(),str+=getWidthPercentStyle(settings[pref+"labels"].width),str+=getHeightStyle(settings[pref+"inputs"].height),str+=getLineHeightStyle(settings[pref+"inputs"].height),str+="} ",str+="."+pref+"form_labels_above {",str+=getFloatRightStyle(),str+=getWidthPercentStyle(100),str+=getGeneralStyle("margin-bottom","5px"),str+="} ",str+="."+pref+"form_labels_hide {",str+=getDisplayStyle(!1),str+="} ",str+="."+pref+"form_labels_required {",str+=getGeneralStyle("color",settings[pref+"labels"].required.color),str+=getGeneralStyle("margin-left","3px"),str+=getGeneralStyle("font-size",("*"==settings[pref+"labels"].required.text?parseInt(settings[pref+"labels"].font.size):parseInt(settings[pref+"labels"].font.size)-2)+"px"),str+="} ",str+="."+pref+"form_inputs {",str+=getBorderStyle(settings[pref+"inputs"].border),str+=getBackgroundStyle(settings[pref+"inputs"].background,pref+"inputs"),str+=getFontStyle(settings[pref+"inputs"].font),str+=getWidthPercentStyle(100),str+=getHeightStyle(settings[pref+"inputs"].height),str+=getOverflowHiddenStyle(),str+=getGeneralStyle("-webkit-box-sizing","border-box"),str+=getGeneralStyle("-moz-box-sizing","border-box"),str+=getGeneralStyle("box-sizing","border-box"),str+=getGeneralStyle("padding-left","5px"),str+=getGeneralStyle("padding-right","5px"),settings[pref+"phone"]&&settings[pref+"phone"].display&&settings[pref+"phone"].enable_country_code&&(str+=getGeneralStyle("vertical-align","middle !important")),str+="} ",settings[pref+"inputs"].hasOwnProperty("placeholder_color")&&(str+="::placeholder {opacity: 1; color:"+settings[pref+"inputs"].placeholder_color+"} ",str+=":-ms-input-placeholder {color:"+settings[pref+"inputs"].placeholder_color+"} ",str+="::-ms-input-placeholder {color:"+settings[pref+"inputs"].placeholder_color+"} "),str+="."+pref+"form_inputs_hover {",str+=getBorderStyle(settings[pref+"inputs"].border_hover),str+=getBackgroundStyle(settings[pref+"inputs"].background_hover,pref+"inputs"),str+="} ",str+="."+pref+"form_inputs_focus {",str+=getBorderStyle(settings[pref+"inputs"].border_focus),str+=getBackgroundStyle(settings[pref+"inputs"].background_focus,pref+"inputs"),str+="} ",str+="."+pref+"form_inputs_error {",str+=getBorderStyle(settings[pref+"inputs"].border_error),str+=getBackgroundStyle(settings[pref+"inputs"].background_error,pref+"inputs"),str+="} ",str+="."+pref+"form_inputs_error_text {",str+=getDisplayStyle(!1),str+=getGeneralStyle("text-align","left"),str+=getGeneralStyle("color",settings[pref+"inputs"].border_error.color),str+=getGeneralStyle("font-family",settings[pref+"labels"].font.family),str+=getGeneralStyle("font-size","11px"),str+=getGeneralStyle("margin-top","2px"),str+=getGeneralStyle("margin-left","2px"),str+=getOverflowHiddenStyle(),str+=getWidthPercentStyle(100),str+="} ",str+="."+pref+"form_inputs_help {",str+=getGeneralStyle("text-align","left"),str+=getGeneralStyle("color",settings[pref+"labels"].font.color),str+=getGeneralStyle("font-family",settings[pref+"labels"].font.family),str+=getGeneralStyle("font-size","11px"),str+=getGeneralStyle("margin-top","2px"),str+=getGeneralStyle("margin-left","2px"),str+=getOverflowHiddenStyle(),str+=getWidthPercentStyle(100),str+="} ",str+="."+pref+"form_inputs_wrapper {",str+=getGeneralStyle("padding","0"),str+=getFloatRightStyle(),str+=getOverflowVisibleStyle(),str+=getWidthPercentStyle("left"==settings[pref+"labels"].position?100-settings[pref+"labels"].width-2:100),str+="} ",settings.hasOwnProperty(pref+"opt_in")&&settings[pref+"opt_in"].display&&(str+="#"+pref+"form_input_opt_in_wrapper  {",str+="inputs"==settings[pref+"opt_in"].align||"left"!=settings[pref+"labels"].position?getFloatRightStyle():getFloatLeftStyle(),str+=getWidthPercentStyle("inputs"==settings[pref+"opt_in"].align&&"left"==settings[pref+"labels"].position?100-settings[pref+"labels"].width-2:100),str+=getGeneralStyle("margin-top",settings[pref+"opt_in"].margin+"px"),str+="} ",str+="#"+pref+"form_input_opt_in {",str+=getFloatLeftStyle(),str+=getGeneralStyle("margin","0"),str+="} ",str+="#"+pref+"form_input_opt_in_text {",str+=getGeneralStyle("margin","0"),str+=getFontStyle(settings[pref+"opt_in"].font),str+=getLineHeightStyle(0===settings[pref+"opt_in"].font.vspace||"0"===settings[pref+"opt_in"].font.vspace||void 0===settings[pref+"opt_in"].font.vspace?settings[pref+"opt_in"].font.size:settings[pref+"opt_in"].font.vspace),str+="} ");for(var checkboxCnt=0,checkboxSequentialFloatMatchCtr=0,previousCbPropName="",n=1;n<=customFieldsLimit;n++){var propName=pref+"custom"+n;if(settings.hasOwnProperty(propName)&&settings[propName].display&&settings[propName].hasOwnProperty("field_type")&&"radio"===settings[propName].field_type&&settings[propName].radio)str+="."+pref+"form_custom"+n+"_radio_labels {",str+=getLineHeightStyle(0===settings[propName].radio.font.vspace||"0"===settings[propName].radio.font.vspace||void 0===settings[propName].radio.font.vspace?settings[propName].radio.font.size:settings[propName].radio.font.vspace),str+=getFontStyle(settings[propName].radio.font),str+=getGeneralStyle("margin-left","5px"),str+="} ",str+="."+pref+"form_custom"+n+"_radio_inputs {",str+=getGeneralStyle("width",settings[propName].radio.size+"px"),str+=getGeneralStyle("height",settings[propName].radio.size+"px"),str+=getGeneralStyle("margin-top","-3px"),str+=getGeneralStyle("vertical-align","middle"),str+="} ";else if(settings.hasOwnProperty(propName)&&settings[propName].display&&settings[propName].hasOwnProperty("field_type")&&"checkbox"===settings[propName].field_type&&settings[propName].checkbox){if(checkboxCnt++,str+="#"+pref+"form_input_custom"+n+"_checkbox_wrapper {","inputs"==settings[propName].checkbox.align||"form"==settings[propName].checkbox.align&&"left"!=settings[pref+"labels"].position)if(checkboxSequentialFloatMatchCtr=0,str+=getFloatRightStyle(),"inputs"==settings[propName].checkbox.align&&"left"==settings[pref+"labels"].position)str+=getWidthStyle(Math.floor(settings[pref+"form"].width*(100-settings[pref+"labels"].width)/100)-7);else str+=getWidthStyle(settings[pref+"form"].width-2);else if("form"==settings[propName].checkbox.align&&"left"==settings[pref+"labels"].position)checkboxSequentialFloatMatchCtr=0,str+=getFloatLeftStyle(),str+=getWidthStyle(settings[pref+"form"].width-2);else if("float2col"==settings[propName].checkbox.align){checkboxSequentialFloatMatchCtr++,str+=getFloatLeftStyle();var spacing=settings[pref+"inputs"].spacing;spacing<10&&(spacing=10),spacing>30&&(spacing=30),checkboxSequentialFloatMatchCtr%2==1&&(str+=getGeneralStyle("margin-right",spacing+"px")),str+=getWidthStyle(Math.floor((settings[pref+"form"].width-spacing-4)/2))}settings[pref+"inputs"].hasOwnProperty("checkboxes_margin")&&settings[pref+"inputs"].checkboxes_margin&&(1==checkboxCnt||2==checkboxCnt&&"float2col"==settings[propName].checkbox.align&&"float2col"==settings[previousCbPropName].checkbox.align)?str+=getGeneralStyle("margin-top",settings[pref+"inputs"].spacing+settings[pref+"inputs"].checkboxes_margin+"px"):str+=getGeneralStyle("margin-top",settings[pref+"inputs"].spacing+"px"),str+="} ",str+="#"+pref+"form_input_custom"+n+" {",str+=getFloatLeftStyle(),str+=getGeneralStyle("margin","0"),str+="} ",str+="#"+pref+"form_input_custom"+n+"_checkbox_text {",str+=getGeneralStyle("margin","0"),str+=getLineHeightStyle(0===settings[propName].checkbox.font.vspace||"0"===settings[propName].checkbox.font.vspace||void 0===settings[propName].checkbox.font.vspace?settings[propName].checkbox.font.size:settings[propName].checkbox.font.vspace),str+=getFontStyle(settings[propName].checkbox.font),str+="} ",previousCbPropName=propName}else!settings.hasOwnProperty(propName)||!settings[propName].display||settings[propName].hasOwnProperty("field_type")&&"hidden"===settings[propName].field_type||(checkboxSequentialFloatMatchCtr=0,logger("(BOX #"+LIGHTBOX_SHORT_ID+") - "+propName+" checkbox not found."))}settings[pref+"form"].hasOwnProperty("css")&&settings[pref+"form"].css&&(str+=settings[pref+"form"].css)}UTIL.stringOrArrayContains(pref,"_")&&(pref=pref.split("_")[0]),""===pref?$("head").append('<style id="element_styles" type="text/css">'+str+"</style>"):($("head").append('<style id="element_styles_'+pref+'" type="text/css">'+str+"</style>"),buildDynamicItems())}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"buildStyles")}}function buildFormName(pref,form_ele){if(""!==pref&&-1===pref.indexOf("_")&&(pref+="_"),settings.hasOwnProperty(pref+"name")&&settings[pref+"name"].display){var style="";if("hidden"===settings[pref+"name"].hidden&&(style="display: none;"),form_ele.append("<div id='"+pref+"form_label_name' class='"+pref+"form_labels' style='"+style+"'>"+settings[pref+"name"].label+"<span id='"+pref+"form_label_name_required' class='"+pref+"form_labels_required'></span></div>"),settings[pref+"name"].require&&settings[pref+"labels"].required.text.length>0&&$("#"+pref+"form_label_name_required").text(settings[pref+"labels"].required.text),settings[pref+"name"].hasOwnProperty("label_subtext")&&settings[pref+"name"].label_subtext&&$("#"+pref+"form_label_name").after("<div id='"+pref+"form_label_subtext_name' class='"+pref+"form_labels' style='"+style+"'>"+settings[pref+"name"].label_subtext+"</div>"),"left"==settings[pref+"labels"].position?($("#"+pref+"form_label_name").addClass(pref+"form_labels_left"),$("#"+pref+"form_label_subtext_name").addClass(pref+"form_labels_hide").addClass(pref+"form_labels_subtext").hide()):"above"==settings[pref+"labels"].position?($("#"+pref+"form_label_name").addClass(pref+"form_labels_above"),$("#"+pref+"form_label_subtext_name").addClass(pref+"form_labels_above").addClass(pref+"form_labels_subtext"),UTIL.isNullOrWhitespace(settings[pref+"name"].label)&&$("#"+pref+"form_label_name").css({height:"0px"}),UTIL.isNullOrWhitespace(settings[pref+"name"].label_subtext)&&$("#"+pref+"form_label_subtext_name").css({height:"0px"})):($("#"+pref+"form_label_name").addClass(pref+"form_labels_hide"),$("#"+pref+"form_label_subtext_name").addClass(pref+"form_labels_hide").addClass(pref+"form_labels_subtext")),"full"==settings[pref+"name"].mode?("hidden"!==settings[pref+"name"].hidden&&form_ele.append("<label id='"+pref+"form_input_name_ada_label' for='"+pref+"form_input_full_name' style='border: 0;clip: rect(0 0 0 0);height: 1px;width: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;'>"+settings[pref+"name"].label+"</label>"),form_ele.append("<div id='"+pref+"form_input_full_name_wrapper' class='"+pref+"form_inputs_wrapper' style='"+style+"'><input type='text' id='"+pref+"form_input_full_name' class='"+pref+"form_inputs' /><div id='"+pref+"form_input_full_name_help' class='"+pref+"form_inputs_help'></div><div id='"+pref+"form_input_name_error_text' class='"+pref+"form_inputs_error_text'></div></div><div style='float: none; clear: both;'></div>"),settings[pref+"name"].default_full&&$("#"+pref+"form_input_full_name").val(settings[pref+"name"].default_full),settings[pref+"name"].placeholder_full&&$("#"+pref+"form_input_full_name").attr("placeholder",settings[pref+"name"].placeholder_full),settings[pref+"name"].display_help?$("#"+pref+"form_input_full_name_help").text(settings[pref+"name"].help_full):$("#"+pref+"form_input_full_name_help").hide(),IS_MOBILE||$("#"+pref+"form_input_full_name").hover((function(){$(this).addClass(pref+"form_inputs_hover")}),(function(){$(this).removeClass(pref+"form_inputs_hover")})),$("#"+pref+"form_input_full_name").focus((function(){$(this).addClass(pref+"form_inputs_focus")})).blur((function(){$(this).removeClass(pref+"form_inputs_focus")})),$("#"+pref+"form_input_full_name").keypress((function(e){13==e.which&&(e.preventDefault(),processSubmit(pref,!1,!1,!0))}))):"first"==settings[pref+"name"].mode?("hidden"!==settings[pref+"name"].hidden&&form_ele.append("<label id='"+pref+"form_input_name_ada_label' for='"+pref+"form_input_first_name' style='border: 0;clip: rect(0 0 0 0);height: 1px;width: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;'>"+settings[pref+"name"].label+"</label>"),form_ele.append("<div id='"+pref+"form_input_first_name_wrapper' class='"+pref+"form_inputs_wrapper' style='"+style+"'><input type='text' id='"+pref+"form_input_first_name' class='"+pref+"form_inputs' /><div id='"+pref+"form_input_first_name_help' class='"+pref+"form_inputs_help'></div><div id='"+pref+"form_input_name_error_text' class='"+pref+"form_inputs_error_text'></div></div><div style='float: none; clear: both;'></div>"),settings[pref+"name"].default_first&&$("#"+pref+"form_input_first_name").val(settings[pref+"name"].default_first),settings[pref+"name"].placeholder_first&&$("#"+pref+"form_input_first_name").attr("placeholder",settings[pref+"name"].placeholder_first),settings[pref+"name"].display_help?$("#"+pref+"form_input_first_name_help").text(settings[pref+"name"].help_first):$("#"+pref+"form_input_first_name_help").hide(),IS_MOBILE||$("#"+pref+"form_input_first_name").hover((function(){$(this).addClass(pref+"form_inputs_hover")}),(function(){$(this).removeClass(pref+"form_inputs_hover")})),$("#"+pref+"form_input_first_name").focus((function(){$(this).addClass(pref+"form_inputs_focus")})).blur((function(){$(this).removeClass(pref+"form_inputs_focus")})),$("#"+pref+"form_input_first_name").keypress((function(e){13==e.which&&(e.preventDefault(),processSubmit(pref,!1,!1,!0))}))):"both"==settings[pref+"name"].mode&&("hidden"!==settings[pref+"name"].hidden&&form_ele.append("<label id='"+pref+"form_input_name_ada_label' for='"+pref+"form_input_first_name' style='border: 0;clip: rect(0 0 0 0);height: 1px;width: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;'>"+settings[pref+"name"].label+"</label>"),"horizontal"==settings[pref+"name"].arrange?(form_ele.append("<div id='"+pref+"form_input_first_and_last_name_wrapper' class='"+pref+"form_inputs_wrapper' style='"+style+"'>  <div id='"+pref+"form_input_first_name_wrapper'><input type='text' id='"+pref+"form_input_first_name' class='"+pref+"form_inputs' /><div id='"+pref+"form_input_first_name_help' class='"+pref+"form_inputs_help'></div></div>  <div id='"+pref+"form_input_last_name_wrapper'><input type='text' id='"+pref+"form_input_last_name' class='"+pref+"form_inputs' /><div id='"+pref+"form_input_last_name_help' class='"+pref+"form_inputs_help'></div></div>  <div id='"+pref+"form_input_name_error_text' class='"+pref+"form_inputs_error_text'></div>  </div>  <div style='float: none; clear: both;'></div>"),$("#"+pref+"form_input_last_name_wrapper").css({float:"right",width:"48%"}),$("#"+pref+"form_input_first_name_wrapper").css({float:"left",width:"48%"})):(form_ele.append("<div id='"+pref+"form_input_first_and_last_name_wrapper' class='"+pref+"form_inputs_wrapper' style='"+style+"'>  <div id='"+pref+"form_input_first_name_wrapper'><input type='text' id='"+pref+"form_input_first_name' class='"+pref+"form_inputs' /><div id='"+pref+"form_input_first_name_help' class='"+pref+"form_inputs_help'></div></div>  <div id='"+pref+"form_input_last_name_wrapper'><input type='text' id='"+pref+"form_input_last_name' class='"+pref+"form_inputs' /><div id='"+pref+"form_input_last_name_help' class='"+pref+"form_inputs_help'></div></div>  <div id='"+pref+"form_input_name_error_text' class='"+pref+"form_inputs_error_text'></div>  </div>  <div style='float: none; clear: both;'></div>"),$("#"+pref+"form_input_last_name_wrapper").css({float:"right",width:"100%","margin-top":settings[pref+"inputs"].spacing+"px"}),$("#"+pref+"form_input_first_name_wrapper").css({float:"right",width:"100%"})),settings[pref+"name"].default_last&&$("#"+pref+"form_input_last_name").val(settings[pref+"name"].default_last),settings[pref+"name"].default_first&&$("#"+pref+"form_input_first_name").val(settings[pref+"name"].default_first),settings[pref+"name"].placeholder_last&&$("#"+pref+"form_input_last_name").attr("placeholder",settings[pref+"name"].placeholder_last),settings[pref+"name"].placeholder_first&&$("#"+pref+"form_input_first_name").attr("placeholder",settings[pref+"name"].placeholder_first),settings[pref+"name"].display_help?$("#"+pref+"form_input_last_name_help").text(settings[pref+"name"].help_last):$("#"+pref+"form_input_last_name_help").hide(),settings[pref+"name"].display_help?$("#"+pref+"form_input_first_name_help").text(settings[pref+"name"].help_first):$("#"+pref+"form_input_first_name_help").hide(),IS_MOBILE||$("#"+pref+"form_input_last_name").hover((function(){$(this).addClass(pref+"form_inputs_hover")}),(function(){$(this).removeClass(pref+"form_inputs_hover")})),$("#"+pref+"form_input_last_name").focus((function(){$(this).addClass(pref+"form_inputs_focus")})).blur((function(){$(this).removeClass(pref+"form_inputs_focus")})),IS_MOBILE||$("#"+pref+"form_input_first_name").hover((function(){$(this).addClass(pref+"form_inputs_hover")}),(function(){$(this).removeClass(pref+"form_inputs_hover")})),$("#"+pref+"form_input_first_name").focus((function(){$(this).addClass(pref+"form_inputs_focus")})).blur((function(){$(this).removeClass(pref+"form_inputs_focus")})),$("#"+pref+"form_input_last_name").keypress((function(e){13==e.which&&(e.preventDefault(),processSubmit(pref,!1,!1,!0))})),$("#"+pref+"form_input_first_name").keypress((function(e){13==e.which&&(e.preventDefault(),processSubmit(pref,!1,!1,!0))}))),settings[pref+"name"].hasOwnProperty("metadata_kvps"))for(var k=0;k<settings[pref+"name"].metadata_kvps.length;k++)settings[pref+"name"].metadata_kvps[k].k&&settings[pref+"name"].metadata_kvps[k].v&&($("#"+pref+"form_input_full_name").length&&UTIL.trySetAttribute(pref+"form_input_full_name",settings[pref+"name"].metadata_kvps[k],$),$("#"+pref+"form_input_first_name").length&&UTIL.trySetAttribute(pref+"form_input_first_name",settings[pref+"name"].metadata_kvps[k],$),$("#"+pref+"form_input_last_name").length&&UTIL.trySetAttribute(pref+"form_input_last_name",settings[pref+"name"].metadata_kvps[k],$))}}function buildFormEmail(pref,form_ele){if(""!==pref&&(pref+="_"),settings.hasOwnProperty(pref+"email")&&settings[pref+"email"].display){var style="";"hidden"===settings[pref+"email"].hidden&&(style="display: none;");var emailContainer=form_ele;if(settings.hasOwnProperty(pref+"inputs")&&settings[pref+"inputs"].hasOwnProperty("email_phone_align")&&"h"==settings[pref+"inputs"].email_phone_align&&settings.hasOwnProperty(pref+"phone")&&settings[pref+"phone"].display&&(form_ele.append("<div id='"+pref+"form_float_email' style=''></div>"),emailContainer=$("#"+pref+"form_float_email")),"hidden"!==settings[pref+"email"].hidden&&emailContainer.append("<label id='"+pref+"form_input_email_ada_label' for='"+pref+"form_input_email' style='border: 0;clip: rect(0 0 0 0);height: 1px;width: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;'>"+settings[pref+"email"].label+"</label>"),emailContainer.append("<div id='"+pref+"form_label_email' class='"+pref+"form_labels "+pref+"form_spacing' style='"+style+"'>"+settings[pref+"email"].label+"<span id='"+pref+"form_label_email_required' class='"+pref+"form_labels_required'></span></div>"),emailContainer.append("<div id='"+pref+"form_input_email_wrapper' class='"+pref+"form_inputs_wrapper' style='"+style+"'><input type='text' id='"+pref+"form_input_email' class='"+pref+"form_inputs' /><div id='"+pref+"form_input_email_help' class='"+pref+"form_inputs_help'></div><div id='"+pref+"form_input_email_error_text' class='"+pref+"form_inputs_error_text'></div></div><div style='float: none; clear: both;'></div>"),settings[pref+"email"].require&&settings[pref+"labels"].required.text.length>0&&$("#"+pref+"form_label_email_required").text(settings[pref+"labels"].required.text),settings[pref+"email"].hasOwnProperty("label_subtext")&&settings[pref+"email"].label_subtext&&emailContainer.find("#"+pref+"form_label_email").after("<div id='"+pref+"form_label_subtext_email' class='"+pref+"form_labels' style='"+style+"'>"+settings[pref+"email"].label_subtext+"</div>"),"left"==settings[pref+"labels"].position?($("#"+pref+"form_label_email").addClass(pref+"form_labels_left"),$("#"+pref+"form_input_email_wrapper").addClass(pref+"form_spacing"),$("#"+pref+"form_label_subtext_email").addClass(pref+"form_labels_hide").addClass(pref+"form_labels_subtext").hide()):"above"==settings[pref+"labels"].position?($("#"+pref+"form_label_email").addClass(pref+"form_labels_above"),$("#"+pref+"form_label_subtext_email").addClass(pref+"form_labels_above").addClass(pref+"form_labels_subtext"),UTIL.isNullOrWhitespace(settings[pref+"email"].label)&&$("#"+pref+"form_label_email").css({height:"0px"}),UTIL.isNullOrWhitespace(settings[pref+"email"].label_subtext)&&$("#"+pref+"form_label_subtext_email").css({height:"0px"})):($("#"+pref+"form_label_email").addClass(pref+"form_labels_hide"),$("#"+pref+"form_input_email_wrapper").addClass(pref+"form_spacing"),$("#"+pref+"form_label_subtext_email").addClass(pref+"form_labels_hide").addClass(pref+"form_labels_subtext")),settings[pref+"email"].default&&$("#"+pref+"form_input_email").val(settings[pref+"email"].default),settings[pref+"email"].placeholder&&$("#"+pref+"form_input_email").attr("placeholder",settings[pref+"email"].placeholder),settings[pref+"email"].display_help?$("#"+pref+"form_input_email_help").text(settings[pref+"email"].help):$("#"+pref+"form_input_email_help").hide(),IS_MOBILE||$("#"+pref+"form_input_email").hover((function(){$(this).addClass(pref+"form_inputs_hover")}),(function(){$(this).removeClass(pref+"form_inputs_hover")})),$("#"+pref+"form_input_email").focus((function(){$(this).addClass(pref+"form_inputs_focus")})).blur((function(){$(this).removeClass(pref+"form_inputs_focus")})),$("#"+pref+"form_input_email").keypress((function(e){13==e.which&&(e.preventDefault(),processSubmit(pref,!1,!1,!0))})),$("#"+pref+"form_input_email").length&&settings[pref+"email"].hasOwnProperty("metadata_kvps"))for(var k=0;k<settings[pref+"email"].metadata_kvps.length;k++)settings[pref+"email"].metadata_kvps[k].k&&settings[pref+"email"].metadata_kvps[k].v&&UTIL.trySetAttribute(pref+"form_input_email",settings[pref+"email"].metadata_kvps[k],$)}}function buildFormPhone(pref,form_ele){if(""!==pref&&(pref+="_"),settings.hasOwnProperty(pref+"phone")&&settings[pref+"phone"].display){var style="";"hidden"===settings[pref+"phone"].hidden&&(style="display: none;");var isHorizontalAlign=settings.hasOwnProperty(pref+"inputs")&&settings[pref+"inputs"].hasOwnProperty("email_phone_align")&&"h"==settings[pref+"inputs"].email_phone_align&&settings.hasOwnProperty(pref+"email")&&settings[pref+"email"].display,phoneContainer=form_ele;isHorizontalAlign&&(form_ele.append("<div id='"+pref+"form_float_phone' style=''></div>"),phoneContainer=$("#"+pref+"form_float_phone")),"hidden"!==settings[pref+"phone"].hidden&&phoneContainer.append("<label id='"+pref+"form_input_phone_ada_label' for='"+pref+"form_input_phone' style='border: 0;clip: rect(0 0 0 0);height: 1px;width: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;'>"+settings[pref+"phone"].label+"</label>"),phoneContainer.append("<div id='"+pref+"form_label_phone' class='"+pref+"form_labels "+pref+"form_spacing' style='"+style+"'>"+settings[pref+"phone"].label+"<span id='"+pref+"form_label_phone_required' class='"+pref+"form_labels_required'></span></div>");var phoneFieldHtml="<div id='"+pref+"form_input_phone_wrapper' class='"+pref+"form_inputs_wrapper' style='"+style+"'>";if(settings[pref+"phone"].enable_country_code&&settings[pref+"phone"].country_code){var countryCodeOptions=settings[pref+"phone"].country_code.split(",");(countryCodeOptions=countryCodeOptions.filter((function(code){return"all"!==code.trim()}))).sort((function(a,b){return parseInt(a.trim().substring(1))-parseInt(b.trim().substring(1))}));var countryCodeDropdown="<select id='"+pref+"form_input_country_code' class='"+pref+"form_inputs' style='width: 25%; border-right: none;'>";countryCodeOptions.forEach((function(code){countryCodeDropdown+="<option value='"+code.trim()+"'>"+code.trim()+"</option>"})),phoneFieldHtml+=countryCodeDropdown+="</select>"}if(phoneFieldHtml+="<input type='text' id='"+pref+"form_input_phone' class='"+pref+"form_inputs' autocomplete='"+(settings[pref+"phone"].enable_country_code?"tel-national":"tel")+"' inputmode='tel' style='width: "+(settings[pref+"phone"].enable_country_code?"75%":"100%")+"; "+(settings[pref+"phone"].enable_country_code?"border-left: none;":"")+"' "+(settings[pref+"phone"].hasOwnProperty("display_format")&&settings[pref+"phone"].display_format?"":"oninput='this.value = this.value.replace(/[^0-9+\\-().\\s]/g, \"\")'")+" />",phoneFieldHtml+="<div id='"+pref+"form_input_phone_help' class='"+pref+"form_inputs_help'></div></div><div style='float: none; clear: both;'></div><div id='"+pref+"form_input_phone_error_text' class='"+pref+"form_inputs_error_text'></div></div><div style='float: none; clear: both;'></div>",phoneContainer.append(phoneFieldHtml),settings[pref+"phone"].enable_country_code&&settings[pref+"phone"].country_code){let phoneFieldElement=$("#"+pref+"form_input_phone."+pref+"form_inputs")[0],countryCodeFieldElement=$("#"+pref+"form_input_country_code."+pref+"form_inputs")[0];if(phoneFieldElement&&countryCodeFieldElement){let borderStyle=settings[pref+"inputs"]&&settings[pref+"inputs"].border?getBorderStyle(settings[pref+"inputs"].border):null;if(borderStyle){let borderRadiusMatch=borderStyle.match(/border-radius:\s*([\dpx\s]+)/),phoneBorderRadius=borderRadiusMatch?borderRadiusMatch[1].trim():null;phoneBorderRadius&&(phoneFieldElement.style.borderRadius=`0px ${phoneBorderRadius} ${phoneBorderRadius} 0px`,countryCodeFieldElement.style.borderRadius=`${phoneBorderRadius} 0px 0px ${phoneBorderRadius}`)}}}if(settings[pref+"phone"].require&&settings[pref+"labels"].required.text.length>0&&$("#"+pref+"form_label_phone_required").text(settings[pref+"labels"].required.text),settings[pref+"phone"].hasOwnProperty("label_subtext")&&settings[pref+"phone"].label_subtext&&phoneContainer.find("#"+pref+"form_label_phone").after("<div id='"+pref+"form_label_subtext_phone' class='"+pref+"form_labels' style='"+style+"'>"+settings[pref+"phone"].label_subtext+"</div>"),"left"==settings[pref+"labels"].position?($("#"+pref+"form_label_phone").addClass(pref+"form_labels_left"),$("#"+pref+"form_input_phone_wrapper").addClass(pref+"form_spacing"),$("#"+pref+"form_label_subtext_phone").addClass(pref+"form_labels_hide").addClass(pref+"form_labels_subtext").hide()):"above"==settings[pref+"labels"].position?($("#"+pref+"form_label_phone").addClass(pref+"form_labels_above"),$("#"+pref+"form_label_subtext_phone").addClass(pref+"form_labels_above").addClass(pref+"form_labels_subtext"),UTIL.isNullOrWhitespace(settings[pref+"phone"].label)&&$("#"+pref+"form_label_phone").css({height:"0px"}),UTIL.isNullOrWhitespace(settings[pref+"phone"].label_subtext)&&$("#"+pref+"form_label_subtext_phone").css({height:"0px"}).addClass(pref+"form_labels_subtext")):($("#"+pref+"form_label_phone").addClass(pref+"form_labels_hide"),$("#"+pref+"form_input_phone_wrapper").addClass(pref+"form_spacing"),$("#"+pref+"form_label_subtext_phone").addClass(pref+"form_labels_hide").addClass(pref+"form_labels_subtext")),settings[pref+"phone"].default&&$("#"+pref+"form_input_phone").val(settings[pref+"phone"].default),settings[pref+"phone"].placeholder&&$("#"+pref+"form_input_phone").attr("placeholder",settings[pref+"phone"].placeholder),settings[pref+"phone"].display_help?$("#"+pref+"form_input_phone_help").text(settings[pref+"phone"].help):$("#"+pref+"form_input_phone_help").hide(),IS_MOBILE||$("#"+pref+"form_input_phone").hover((function(){$(this).addClass(pref+"form_inputs_hover")}),(function(){$(this).removeClass(pref+"form_inputs_hover")})),$("#"+pref+"form_input_phone").focus((function(){$(this).addClass(pref+"form_inputs_focus")})).blur((function(){$(this).removeClass(pref+"form_inputs_focus")})),$("#"+pref+"form_input_phone").keypress((function(e){13==e.which&&(e.preventDefault(),processSubmit(pref,!1,!1,!0))})),settings[pref+"phone"].enable_country_code&&settings[pref+"phone"].country_code?$("#"+pref+"form_input_phone").on("input",(function(event){let maxLength,phoneValue=$(this).val().replace(/\D/g,""),countryCode=$("#"+pref+"form_input_country_code").val().replace(/\D/g,"");if(settings[pref+"phone"].submit_format){maxLength=(settings[pref+"phone"].submit_format.startsWith("+1")||settings[pref+"phone"].submit_format.startsWith("1")?settings[pref+"phone"].submit_format.replace(/^(\+1|1)/,"x"):settings[pref+"phone"].submit_format).split("x").length-1}else maxLength=15;phoneValue.length+countryCode.length>maxLength&&(phoneValue=phoneValue.slice(0,maxLength-countryCode.length)),"1"!==countryCode?$(this).val(phoneValue):formatPhoneDisplay($(this),"(xxx) xxx-xxxx",pref)})):$("#"+pref+"form_input_phone").length&&!boxapi.getFieldMetadata(pref,"phone","phone_display")&&settings[pref+"phone"].hasOwnProperty("display_format")&&settings[pref+"phone"].display_format&&$("#"+pref+"form_input_phone").on("input",(function(event){formatPhoneDisplay($(this),settings[pref+"phone"].display_format,pref)})),$("#"+pref+"form_input_phone").length&&settings[pref+"phone"].hasOwnProperty("metadata_kvps"))for(var k=0;k<settings[pref+"phone"].metadata_kvps.length;k++)settings[pref+"phone"].metadata_kvps[k].k&&settings[pref+"phone"].metadata_kvps[k].v&&UTIL.trySetAttribute(pref+"form_input_phone",settings[pref+"phone"].metadata_kvps[k],$);if(isHorizontalAlign&&settings.hasOwnProperty(pref+"email")&&settings[pref+"email"].display){var fieldWidth=settings[pref+"form"].width/2-1*settings[pref+"inputs"].spacing/2;$("#"+pref+"form_float_email").length&&$("#"+pref+"form_float_email").css({width:fieldWidth+"px",float:"left"}),$("#"+pref+"form_float_phone").length&&($("#"+pref+"form_float_phone").css({width:fieldWidth+"px",float:"left","margin-left":settings[pref+"inputs"].spacing+"px"}),$("#"+pref+"form_float_phone").after("<div id='"+pref+"form_float_email_phone_clear' style='float:none;clear:both;'></div>"))}}}function buildFormOptIn(pref,form_ele){if(""!==pref&&(pref+="_"),settings.hasOwnProperty(pref+"opt_in")&&settings[pref+"opt_in"].display){var style="";if("hidden"===settings[pref+"opt_in"].hidden&&(style="display: none;"),form_ele.append("<label id='"+pref+"form_input_opt_in_ada_label' for='"+pref+"form_input_opt_in' style='border: 0;clip: rect(0 0 0 0);height: 1px;width: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;'>"+settings[pref+"opt_in"].text+"</label>"),form_ele.append("<div id='"+pref+"form_input_opt_in_wrapper' style='"+style+"'><input type='checkbox' id='"+pref+"form_input_opt_in' /><p id='"+pref+"form_input_opt_in_text'>"+settings[pref+"opt_in"].text+"</p> <div style='float: none; clear: both;'></div> <div id='"+pref+"form_input_opt_in_error_text' class='"+pref+"form_inputs_error_text'></div></div>"),settings[pref+"opt_in"].font.size<=10?$("#"+pref+"form_input_opt_in_text").css({"margin-top":"2px","margin-left":"20px"}):settings[pref+"opt_in"].font.size>10&&settings[pref+"opt_in"].font.size<14?$("#"+pref+"form_input_opt_in_text").css({"margin-top":"1px","margin-left":"20px"}):settings[pref+"opt_in"].font.size>=14&&$("#"+pref+"form_input_opt_in_text").css({"margin-top":"-1px","margin-left":"20px"}),settings[pref+"opt_in"].hasOwnProperty("default")&&"on"===settings[pref+"opt_in"].default&&$("#"+pref+"form_input_opt_in").prop("checked",!0).attr("checked","checked"),$("#"+pref+"form_input_opt_in").keypress((function(e){13==(e.keyCode?e.keyCode:e.which)&&$(this).trigger("click")})),$("#"+pref+"form_input_opt_in").change((function(){this.checked?$(this).attr("checked","checked"):$(this).removeAttr("checked")})),$("#"+pref+"form_input_opt_in").length&&settings[pref+"opt_in"].hasOwnProperty("metadata_kvps"))for(var k=0;k<settings[pref+"opt_in"].metadata_kvps.length;k++)settings[pref+"opt_in"].metadata_kvps[k].k&&settings[pref+"opt_in"].metadata_kvps[k].v&&UTIL.trySetAttribute(pref+"form_input_opt_in",settings[pref+"opt_in"].metadata_kvps[k],$)}}function buildFormCustomN(pref,propName,form_ele){pref&&""!==pref&&-1===pref.indexOf("_")&&(pref+="_");var customN=propName;propName.indexOf("_")>0&&propName.indexOf("custom")>0&&(customN=propName.split("_")[1]);var n=propName.split("custom")[1];if(settings.hasOwnProperty(propName)&&settings[propName].display){if(settings[propName].hasOwnProperty("align")&&"h"==settings[propName].align&&settings[propName].hasOwnProperty("field_type")&&"radio"!==settings[propName].field_type&&"checkbox"!==settings[propName].field_type&&"hidden"!==settings[propName].field_type){form_ele.append("<div id='"+pref+"form_float_"+customN+"' style=''></div>"),form_ele=$("#"+pref+"form_float_"+customN);for(var consecutiveCnt=1,w=n-1;w>0&&(settings.hasOwnProperty(pref+"custom"+w)&&settings[pref+"custom"+w].display&&settings[pref+"custom"+w].hasOwnProperty("align")&&"h"==settings[pref+"custom"+w].align&&settings[pref+"custom"+w].hasOwnProperty("field_type")&&"radio"!==settings[pref+"custom"+w].field_type&&"checkbox"!==settings[pref+"custom"+w].field_type&&"hidden"!==settings[pref+"custom"+w].field_type);w--)consecutiveCnt++;if(consecutiveCnt>1){var fieldWidth=settings[pref+"form"].width/consecutiveCnt-settings[pref+"inputs"].spacing*(consecutiveCnt-1)/consecutiveCnt;for(w=n;w>n-consecutiveCnt;w--)$("#"+pref+"form_float_custom"+w).css({width:fieldWidth+"px",float:"left"}),w>n-consecutiveCnt+1&&($("#"+pref+"form_float_custom"+w).css({"margin-left":settings[pref+"inputs"].spacing+"px"}),$("#"+pref+"form_float_custom"+w+"_clear").length&&$("#"+pref+"form_float_custom"+w+"_clear").remove());form_ele.after("<div id='"+pref+"form_float_"+customN+"_clear' style='float:none;clear:both;'></div>")}}if(settings[propName].hasOwnProperty("field_type")&&"hidden"!==settings[propName].field_type&&"checkbox"!==settings[propName].field_type&&"radio"!==settings[propName].field_type&&!UTIL.isNullOrWhitespace(settings[propName].label)&&form_ele.append("<label id='"+pref+"form_input_"+customN+"_ada_label' for='"+pref+"form_input_"+customN+"' style='border: 0;clip: rect(0 0 0 0);height: 1px;width: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;'>"+settings[propName].label+"</label>"),settings[propName].hasOwnProperty("field_type")&&"textbox"!=settings[propName].field_type)if("textarea"==settings[propName].field_type)form_ele.append("<div id='"+pref+"form_label_"+customN+"' class='"+pref+"form_labels "+pref+"form_spacing'>"+settings[propName].label+"<span id='"+pref+"form_label_"+customN+"_required' class='"+pref+"form_labels_required'></span></div>"),form_ele.append("<div id='"+pref+"form_input_"+customN+"_wrapper' class='"+pref+"form_inputs_wrapper'><textarea id='"+pref+"form_input_"+customN+"' class='"+pref+"form_inputs' style='height: "+settings[propName].textarea_height+"px; margin-bottom: 0px;'></textarea><div id='"+pref+"form_input_"+customN+"_help' class='"+pref+"form_inputs_help' style='margin-top: 0px;'></div><div id='"+pref+"form_input_"+customN+"_error_text' class='"+pref+"form_inputs_error_text'></div></div><div style='float: none; clear: both;'></div>"),settings[propName].placeholder&&$("#"+pref+"form_input_"+customN).attr("placeholder",settings[propName].placeholder),settings[propName].default&&$("#"+pref+"form_input_"+customN).val(settings[propName].default);else if("datepicker"==settings[propName].field_type&&settings[propName].datepicker)form_ele.append("<div id='"+pref+"form_label_"+customN+"' class='"+pref+"form_labels "+pref+"form_spacing'>"+settings[propName].label+"<span id='"+pref+"form_label_"+customN+"_required' class='"+pref+"form_labels_required'></span></div>"),form_ele.append("<div id='"+pref+"form_input_"+customN+"_wrapper' class='"+pref+"form_inputs_wrapper'><input type='text' id='"+pref+"form_input_"+customN+"' class='"+pref+"form_inputs' /><div id='"+pref+"form_input_"+customN+"_help' class='"+pref+"form_inputs_help'></div><div id='"+pref+"form_input_"+customN+"_error_text' class='"+pref+"form_inputs_error_text'></div></div><div style='float: none; clear: both;'></div>"),UTIL.isNullOrWhitespace(settings[propName].placeholder)||$("#"+pref+"form_input_"+customN).attr("placeholder",settings[propName].placeholder),initDatepicker(pref,propName,customN);else if("datedrop"==settings[propName].field_type&&settings[propName].datedrop){if(form_ele.append("<div id='"+pref+"form_label_"+customN+"' class='"+pref+"form_labels "+pref+"form_spacing'>"+settings[propName].label+"<span id='"+pref+"form_label_"+customN+"_required' class='"+pref+"form_labels_required'></span></div>"),"MM-dd-yyyy"==settings[propName].datedrop.display_format||""==settings[propName].datedrop.display_format){var append_html="<div id='"+pref+"form_input_"+customN+"_wrapper' class='"+pref+"form_inputs_wrapper'>";append_html+="<div id='"+pref+"form_input_"+customN+"_datedrop_mm_wrapper'><select id='"+pref+"form_input_"+customN+"_datedrop_mm' class='"+pref+"form_inputs'><option value='MM'>MM</option></select><div id='"+pref+"form_input_"+customN+"_datedrop_mm_help' class='"+pref+"form_inputs_help'></div></div>",append_html+="<div id='"+pref+"form_input_"+customN+"_datedrop_dd_wrapper'><select id='"+pref+"form_input_"+customN+"_datedrop_dd' class='"+pref+"form_inputs'><option value='dd'>DD</option></select><div id='"+pref+"form_input_"+customN+"_datedrop_dd_help' class='"+pref+"form_inputs_help'></div></div>",append_html+="<div id='"+pref+"form_input_"+customN+"_datedrop_yyyy_wrapper'><select id='"+pref+"form_input_"+customN+"_datedrop_yyyy' class='"+pref+"form_inputs'><option value='yyyy'>YYYY</option></select><div id='"+pref+"form_input_"+customN+"_datedrop_yyyy_help' class='"+pref+"form_inputs_help'></div></div>",append_html+="<div id='"+pref+"form_input_"+customN+"_help' class='"+pref+"form_inputs_help'></div><div id='"+pref+"form_input_"+customN+"_error_text' class='"+pref+"form_inputs_error_text'></div>",append_html+="</div>",append_html+="<div style='float: none; clear: both;'></div>",form_ele.append(append_html),$("#"+pref+"form_input_"+customN+"_datedrop_yyyy_wrapper").css({float:"right",width:"38%"}),$("#"+pref+"form_input_"+customN+"_datedrop_mm_wrapper").css({float:"left",width:"28%","margin-right":"3%"}),$("#"+pref+"form_input_"+customN+"_datedrop_dd_wrapper").css({float:"left",width:"28%"})}else if("dd-MM-yyyy"==settings[propName].datedrop.display_format){append_html="<div id='"+pref+"form_input_"+customN+"_wrapper' class='"+pref+"form_inputs_wrapper'>";append_html+="<div id='"+pref+"form_input_"+customN+"_datedrop_dd_wrapper'><select id='"+pref+"form_input_"+customN+"_datedrop_dd' class='"+pref+"form_inputs'><option value='dd'>DD</option></select><div id='"+pref+"form_input_"+customN+"_datedrop_dd_help' class='"+pref+"form_inputs_help'></div></div>",append_html+="<div id='"+pref+"form_input_"+customN+"_datedrop_mm_wrapper'><select id='"+pref+"form_input_"+customN+"_datedrop_mm' class='"+pref+"form_inputs'><option value='MM'>MM</option></select><div id='"+pref+"form_input_"+customN+"_datedrop_mm_help' class='"+pref+"form_inputs_help'></div></div>",append_html+="<div id='"+pref+"form_input_"+customN+"_datedrop_yyyy_wrapper'><select id='"+pref+"form_input_"+customN+"_datedrop_yyyy' class='"+pref+"form_inputs'><option value='yyyy'>YYYY</option></select><div id='"+pref+"form_input_"+customN+"_datedrop_yyyy_help' class='"+pref+"form_inputs_help'></div></div>",append_html+="<div id='"+pref+"form_input_"+customN+"_help' class='"+pref+"form_inputs_help'></div><div id='"+pref+"form_input_"+customN+"_error_text' class='"+pref+"form_inputs_error_text'></div>",append_html+="</div>",append_html+="<div style='float: none; clear: both;'></div>",form_ele.append(append_html),$("#"+pref+"form_input_"+customN+"_datedrop_yyyy_wrapper").css({float:"right",width:"38%"}),$("#"+pref+"form_input_"+customN+"_datedrop_dd_wrapper").css({float:"left",width:"28%","margin-right":"3%"}),$("#"+pref+"form_input_"+customN+"_datedrop_mm_wrapper").css({float:"left",width:"28%"})}else if("yyyy-MM-dd"==settings[propName].datedrop.display_format){append_html="<div id='"+pref+"form_input_"+customN+"_wrapper' class='"+pref+"form_inputs_wrapper'>";append_html+="<div id='"+pref+"form_input_"+customN+"_datedrop_yyyy_wrapper'><select id='"+pref+"form_input_"+customN+"_datedrop_yyyy' class='"+pref+"form_inputs'><option value='yyyy'>YYYY</option></select><div id='"+pref+"form_input_"+customN+"_datedrop_yyyy_help' class='"+pref+"form_inputs_help'></div></div>",append_html+="<div id='"+pref+"form_input_"+customN+"_datedrop_dd_wrapper'><select id='"+pref+"form_input_"+customN+"_datedrop_dd' class='"+pref+"form_inputs'><option value='dd'>DD</option></select><div id='"+pref+"form_input_"+customN+"_datedrop_dd_help' class='"+pref+"form_inputs_help'></div></div>",append_html+="<div id='"+pref+"form_input_"+customN+"_datedrop_mm_wrapper'><select id='"+pref+"form_input_"+customN+"_datedrop_mm' class='"+pref+"form_inputs'><option value='MM'>MM</option></select><div id='"+pref+"form_input_"+customN+"_datedrop_mm_help' class='"+pref+"form_inputs_help'></div></div>",append_html+="<div id='"+pref+"form_input_"+customN+"_help' class='"+pref+"form_inputs_help'></div><div id='"+pref+"form_input_"+customN+"_error_text' class='"+pref+"form_inputs_error_text'></div>",append_html+="</div>",append_html+="<div style='float: none; clear: both;'></div>",form_ele.append(append_html),$("#"+pref+"form_input_"+customN+"_datedrop_yyyy_wrapper").css({float:"left",width:"38%"}),$("#"+pref+"form_input_"+customN+"_datedrop_dd_wrapper").css({float:"right",width:"28%"}),$("#"+pref+"form_input_"+customN+"_datedrop_mm_wrapper").css({float:"right",width:"28%","margin-right":"3%"})}var dropdown_yyyy=$("#"+pref+"form_input_"+customN+"_datedrop_yyyy"),dropdown_mm=$("#"+pref+"form_input_"+customN+"_datedrop_mm"),dropdown_dd=$("#"+pref+"form_input_"+customN+"_datedrop_dd"),min_date=settings[propName].datedrop.min_date,max_date=settings[propName].datedrop.max_date,default_date=settings[propName].datedrop.default_date,foundSelected=!1,yyyy_min=1900;min_date&&3==min_date.split("/").length&&4==min_date.split("/")[2].trim().length&&(yyyy_min=parseInt(min_date.split("/")[2].trim()));var yyyy_max=(new Date).getFullYear();max_date&&3==max_date.split("/").length&&4==max_date.split("/")[2].trim().length&&(yyyy_max=parseInt(max_date.split("/")[2].trim()));var yyyy_default="";default_date&&3==default_date.split("/").length&&4==default_date.split("/")[2].trim().length&&(yyyy_default=parseInt(default_date.split("/")[2].trim()));var mm_default="";default_date&&3==default_date.split("/").length&&2==default_date.split("/")[0].trim().length&&(mm_default=parseInt(default_date.split("/")[0].trim()));var dd_default="";default_date&&3==default_date.split("/").length&&2==default_date.split("/")[1].trim().length&&(dd_default=parseInt(default_date.split("/")[1].trim()));for(var i=yyyy_max;i>=yyyy_min;i--)foundSelected||i!==yyyy_default?dropdown_yyyy.append("<option value='"+i+"'>"+i+"</option>"):(dropdown_yyyy.append("<option selected value='"+i+"'>"+i+"</option>"),foundSelected=!0);foundSelected=!1;var mm_disp="";for(i=1;i<=12;i++)mm_disp=i<10?"0"+i:i,foundSelected||i!==mm_default?dropdown_mm.append("<option value='"+i+"'>"+mm_disp+"</option>"):(dropdown_mm.append("<option selected value='"+i+"'>"+mm_disp+"</option>"),foundSelected=!0);foundSelected=!1;var dd_disp="";for(i=1;i<=31;i++)dd_disp=i<10?"0"+i:i,foundSelected||i!==dd_default?dropdown_dd.append("<option value='"+i+"'>"+dd_disp+"</option>"):(dropdown_dd.append("<option selected value='"+i+"'>"+dd_disp+"</option>"),foundSelected=!0)}else if("dropdown"==settings[propName].field_type)if(form_ele.append("<div id='"+pref+"form_label_"+customN+"' class='"+pref+"form_labels "+pref+"form_spacing'>"+settings[propName].label+"<span id='"+pref+"form_label_"+customN+"_required' class='"+pref+"form_labels_required'></span></div>"),form_ele.append("<div id='"+pref+"form_input_"+customN+"_wrapper' class='"+pref+"form_inputs_wrapper'><select id='"+pref+"form_input_"+customN+"' class='"+pref+"form_inputs'></select><div id='"+pref+"form_input_"+customN+"_help' class='"+pref+"form_inputs_help'></div><div id='"+pref+"form_input_"+customN+"_error_text' class='"+pref+"form_inputs_error_text'></div></div><div style='float: none; clear: both;'></div>"),settings[propName].dropdown_kvps.length>0){var dropdown=$("#"+pref+"form_input_"+customN),kvps=settings[propName].dropdown_kvps;foundSelected=!1;settings[propName].placeholder&&!settings[propName].default&&(dropdown.append("<option value='' disabled selected>"+settings[propName].placeholder+"</option>"),foundSelected=!0);for(i=0;i<kvps.length;i++)foundSelected||!settings[propName].default||kvps[i].k!=settings[propName].default&&kvps[i].v!=settings[propName].default?dropdown.append(new Option(kvps[i].v,kvps[i].k)):(dropdown.append(new Option(kvps[i].v,kvps[i].k,!0,!0)),foundSelected=!0)}else{dropdown=$("#"+pref+"form_input_"+customN);settings[propName].placeholder&&dropdown.append("<option value='' disabled selected>"+settings[propName].placeholder+"</option>")}else if("radio"==settings[propName].field_type){settings[propName].hasOwnProperty("hide_label")&&"show"===settings[propName].hide_label&&form_ele.append("<div id='"+pref+"form_label_"+customN+"' class='"+pref+"form_labels "+pref+"form_spacing'>"+settings[propName].label+"<span id='"+pref+"form_label_"+customN+"_required' class='"+pref+"form_labels_required'></span></div>");var radioWrapperId=pref+"form_input_"+customN+"_radio_wrapper";if(form_ele.append("<div id='"+radioWrapperId+"'></div>"),settings[propName].radio.kvps.length>0){var radioGroup=$("#"+radioWrapperId),radioMargin=(kvps=settings[propName].radio.kvps,10);"number"==typeof settings[propName].radio.margin&&(radioMargin=settings[propName].radio.margin);for(foundSelected=!1,i=0;i<kvps.length;i++)foundSelected||!settings[propName].radio.default||kvps[i].k!=settings[propName].radio.default&&kvps[i].v!=settings[propName].radio.default?radioGroup.append("<div class='"+pref+"form_"+customN+"_radio_line_item' style='margin-bottom:"+radioMargin+"px;'><input type='radio' class='"+pref+"form_"+customN+"_radio_inputs' id='"+pref+"form_input_"+customN+"_"+i+"' name='"+pref+"form_input_"+customN+"'><label class='"+pref+"form_"+customN+"_radio_labels' id='"+pref+"form_label_"+customN+"_"+i+"' for='"+pref+"form_input_"+customN+"_"+i+"'></label></div>"):radioGroup.append("<div class='"+pref+"form_"+customN+"_radio_line_item' style='margin-bottom:"+radioMargin+"px;'><input checked type='radio' class='"+pref+"form_"+customN+"_radio_inputs' id='"+pref+"form_input_"+customN+"_"+i+"' name='"+pref+"form_input_"+customN+"'><label class='"+pref+"form_"+customN+"_radio_labels' id='"+pref+"form_label_"+customN+"_"+i+"' for='"+pref+"form_input_"+customN+"_"+i+"'></label></div>"),$("#"+pref+"form_input_"+customN+"_"+i).val(kvps[i].k),$("#"+pref+"form_label_"+customN+"_"+i).html(kvps[i].v);var inputsSpacing=settings[pref+"inputs"].spacing;if(inputsSpacing>radioMargin&&(radioMargin=inputsSpacing),$("#"+radioWrapperId).css({"margin-top":radioMargin+"px"}),radioGroup.append("<div id='"+pref+"form_input_"+customN+"_error_text' class='"+pref+"form_inputs_error_text'></div>"),"h"==settings[propName].radio.align&&($("."+pref+"form_"+customN+"_radio_line_item").css({float:"left","margin-right":"15px"}),radioGroup.append("<div style='float:none;clear:both;'></div>")),settings[propName].hasOwnProperty("hide_label")&&"show"===settings[propName].hide_label&&"left"==settings[pref+"labels"].position){var radioGroupHeight=radioGroup.height();$("#"+pref+"form_label_"+customN).height()<radioGroupHeight&&$("#"+pref+"form_label_"+customN).height(radioGroupHeight),setTimeout((function(){var radioGroupHeight=radioGroup.height();$("#"+pref+"form_label_"+customN).height()<radioGroupHeight&&$("#"+pref+"form_label_"+customN).height(radioGroupHeight)}),1e3)}}}else if("checkbox"==settings[propName].field_type){if(form_ele.append("<label id='"+pref+"form_input_"+customN+"_ada_label' for='"+pref+"form_input_"+customN+"' style='border: 0;clip: rect(0 0 0 0);height: 1px;width: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;'>"+settings[propName].checkbox.text+"</label>"),settings[propName].hasOwnProperty("hide_label")&&"show"===settings[propName].hide_label){var labelMargin=-1*settings[pref+"inputs"].spacing+5;"left"!==settings[pref+"labels"].position?form_ele.append("<div id='"+pref+"form_label_"+customN+"' class='"+pref+"form_labels "+pref+"form_spacing' style='margin-bottom: "+labelMargin+"px;'>"+settings[propName].label+"<span id='"+pref+"form_label_"+customN+"_required' class='"+pref+"form_labels_required'></span></div>"):form_ele.append("<div id='"+pref+"form_label_"+customN+"' class='"+pref+"form_labels "+pref+"form_spacing'>"+settings[propName].label+"<span id='"+pref+"form_label_"+customN+"_required' class='"+pref+"form_labels_required'></span></div>")}if(form_ele.append("<div id='"+pref+"form_input_"+customN+"_checkbox_wrapper'><input type='checkbox' id='"+pref+"form_input_"+customN+"' /><p id='"+pref+"form_input_"+customN+"_checkbox_text'>"+settings[propName].checkbox.text+"</p> <div style='float: none; clear: both;'></div> <div id='"+pref+"form_input_"+customN+"_error_text' class='"+pref+"form_inputs_error_text'></div> </div>"),settings[propName].checkbox.font.size<=10)$("#"+pref+"form_input_"+customN+"_checkbox_text").css({"margin-top":"1px","margin-left":"18px"});else if(settings[propName].checkbox.font.size<=12)$("#"+pref+"form_input_"+customN+"_checkbox_text").css({"margin-top":"0px","margin-left":"18px"});else if(settings[propName].checkbox.font.size<=14)$("#"+pref+"form_input_"+customN+"_checkbox_text").css({"margin-top":"-1px","margin-left":"18px"});else{var mt=14-settings[propName].checkbox.font.size+"px";$("#"+pref+"form_input_"+customN+"_checkbox_text").css({"margin-top":mt,"margin-left":"18px"})}settings[propName].checkbox.hasOwnProperty("default")&&"on"===settings[propName].checkbox.default&&$("#"+pref+"form_input_"+customN).prop("checked",!0).attr("checked","checked");var nInt=parseInt(n),nextPropName=propName.split("custom")[0]+"custom"+(nInt+1).toString();(nInt+1).toString();(nInt===customFieldsLimit||settings.hasOwnProperty(nextPropName)&&!settings[nextPropName].hasOwnProperty("field_type")||settings.hasOwnProperty(nextPropName)&&settings[nextPropName].hasOwnProperty("field_type")&&"checkbox"!==settings[nextPropName].field_type||settings.hasOwnProperty(nextPropName)&&settings[nextPropName].hasOwnProperty("field_type")&&"checkbox"===settings[nextPropName].field_type&&!(settings[propName].checkbox.align.indexOf("float")>=0&&settings[nextPropName].checkbox.align.indexOf("float")>=0))&&form_ele.append("<div style='float:none;clear:both;height:1px;width:"+settings[pref+"form"].width+"px;' id='"+pref+"form_input_"+customN+"_checkbox_float_clear' class='checkbox_float_clear'></div>"),$("#"+pref+"form_input_"+customN).keypress((function(e){13==(e.keyCode?e.keyCode:e.which)&&$(this).trigger("click")})),$("#"+pref+"form_input_"+customN).change((function(){this.checked?$(this).attr("checked","checked"):$(this).removeAttr("checked")}))}else"hidden"==settings[propName].field_type&&(form_ele.append("<input type='hidden' id='"+pref+"form_input_"+customN+"' class='"+pref+"form_inputs' />"),settings[propName].default&&$("#"+pref+"form_input_"+customN).val(settings[propName].default));else form_ele.append("<div id='"+pref+"form_label_"+customN+"' class='"+pref+"form_labels "+pref+"form_spacing'>"+settings[propName].label+"<span id='"+pref+"form_label_"+customN+"_required' class='"+pref+"form_labels_required'></span></div>"),form_ele.append("<div id='"+pref+"form_input_"+customN+"_wrapper' class='"+pref+"form_inputs_wrapper'><input type='text' id='"+pref+"form_input_"+customN+"' class='"+pref+"form_inputs' /><div id='"+pref+"form_input_"+customN+"_help' class='"+pref+"form_inputs_help'></div><div id='"+pref+"form_input_"+customN+"_error_text' class='"+pref+"form_inputs_error_text'></div></div><div style='float: none; clear: both;'></div>"),settings[propName].placeholder&&$("#"+pref+"form_input_"+customN).attr("placeholder",settings[propName].placeholder),settings[propName].default&&$("#"+pref+"form_input_"+customN).val(settings[propName].default);settings[propName].hasOwnProperty("field_type")&&"hidden"===settings[propName].field_type||(settings[propName].require&&settings[pref+"labels"].required.text.length>0&&$("#"+pref+"form_label_"+customN+"_required").text(settings[pref+"labels"].required.text),settings[propName].hasOwnProperty("label_subtext")&&settings[propName].label_subtext&&$("#"+pref+"form_label_"+customN).after("<div id='"+pref+"form_label_subtext_"+customN+"' class='"+pref+"form_labels' style=''>"+settings[propName].label_subtext+"</div>"),"left"==settings[pref+"labels"].position?($("#"+pref+"form_label_"+customN).addClass(pref+"form_labels_left"),$("#"+pref+"form_input_"+customN+"_wrapper").addClass(pref+"form_spacing"),$("#"+pref+"form_label_subtext_"+customN).addClass(pref+"form_labels_hide").addClass(pref+"form_labels_subtext").hide()):"above"==settings[pref+"labels"].position||settings[propName].hasOwnProperty("hide_label")&&"show"===settings[propName].hide_label?($("#"+pref+"form_label_"+customN).addClass(pref+"form_labels_above"),$("#"+pref+"form_label_subtext_"+customN).addClass(pref+"form_labels_above").addClass(pref+"form_labels_subtext"),UTIL.isNullOrWhitespace(settings[propName].label)&&$("#"+pref+"form_label_"+customN).css({height:"0px"}),UTIL.isNullOrWhitespace(settings[propName].label_subtext)&&$("#"+pref+"form_label_subtext_"+customN).css({height:"0px"})):($("#"+pref+"form_label_"+customN).addClass(pref+"form_labels_hide"),$("#"+pref+"form_input_"+customN+"_wrapper").addClass(pref+"form_spacing"),$("#"+pref+"form_label_subtext_"+customN).addClass(pref+"form_labels_hide").addClass(pref+"form_labels_subtext")),settings[propName].display_help?$("#"+pref+"form_input_"+customN+"_help").text(settings[propName].help):$("#"+pref+"form_input_"+customN+"_help").hide(),IS_MOBILE||$("#"+pref+"form_input_"+customN).hover((function(){$(this).addClass(pref+"form_inputs_hover")}),(function(){$(this).removeClass(pref+"form_inputs_hover")})),$("#"+pref+"form_input_"+customN).focus((function(){$(this).addClass(pref+"form_inputs_focus")})).blur((function(){$(this).removeClass(pref+"form_inputs_focus")})),settings[propName].hasOwnProperty("field_type")&&"textbox"!=settings[propName].field_type&&"dropdown"!=settings[propName].field_type||$("#"+pref+"form_input_"+customN).keypress((function(e){13==e.which&&(e.preventDefault(),processSubmit(pref,!1,!1,!0))})))}else settings.hasOwnProperty(propName)&&form_ele.append("<input type='hidden' id='"+pref+"form_input_"+customN+"' class='"+pref+"form_inputs' />");if($("#"+pref+"form_input_"+customN).length&&settings[propName].hasOwnProperty("metadata_kvps"))for(var k=0;k<settings[propName].metadata_kvps.length;k++)settings[propName].metadata_kvps[k].k&&settings[propName].metadata_kvps[k].v&&UTIL.trySetAttribute(pref+"form_input_"+customN,settings[propName].metadata_kvps[k],$)}function initDatepicker(pref,propName,customN){try{if(IsDatepickerScriptLoaded){var dp=settings[propName].datepicker,splitChar="",format="MM/DD/YYYY";!UTIL.isNullOrWhitespace(dp.format)&&(dp.format.indexOf("/")>0||dp.format.indexOf("-")>0||dp.format.indexOf(".")>0||dp.format.indexOf(",")>0||dp.format.indexOf(" ")>0)&&(format=dp.format.trim().toUpperCase()),format.indexOf("/")>0?splitChar="/":format.indexOf("-")>0?splitChar="-":format.indexOf(".")>0?splitChar=".":format.indexOf(",")>0?splitChar=",":format.indexOf("_")>0?splitChar="_":format.indexOf("|")>0?splitChar="|":format.indexOf(" ")>0&&(splitChar=" ");var picker=new Pikaday({field:document.getElementById(pref+"form_input_"+customN),yearRange:[1900,2050],toString:function(date,formatInternal){try{for(var day=date.getDate(),month=date.getMonth()+1,year=date.getFullYear(),strOut="",formatParts=format.split(splitChar),i=0;i<formatParts.length;i++)formatParts[i].indexOf("D")>=0?strOut+=day+splitChar:formatParts[i].indexOf("M")>=0?strOut+=month+splitChar:formatParts[i].indexOf("Y")>=0&&(strOut+=year+splitChar);return strOut&&(strOut=strOut.substr(0,strOut.length-1)),strOut}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"initDatepicker_1");var td=new Date;return td.getMonth()+1+splitChar+td.getDate()+splitChar+td.getFullYear()}},parse:function(dateString,formatInternal){try{var dateParts=dateString.split(splitChar),formatParts=format.split(splitChar);if(dateParts.length!==formatParts.length||0===dateParts.length)return new Date;for(var day=-1,month=-1,year=-1,i=0;i<formatParts.length;i++)formatParts[i].indexOf("D")>=0?day=parseInt(dateParts[i],10):formatParts[i].indexOf("M")>=0?month=parseInt(dateParts[i]-1,10):formatParts[i].indexOf("Y")>=0&&(year=parseInt(dateParts[i],10));return-1===day||-1===month||-1===year?new Date:new Date(year,month,day)}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"initDatepicker_2"),new Date}},onSelect:function(){DAPI.log(this.toString(format))}});if(!UTIL.isNullOrWhitespace(settings[propName].default)){var df=settings[propName].default.trim();df&&(df.indexOf("/")>0||df.indexOf("-")>0||df.indexOf(".")>0||df.indexOf(",")>0||df.indexOf(" ")>0)&&picker.setDate(df,!0)}boxapi.hasOwnProperty("pikaday")||(boxapi.pikaday={}),boxapi.pikaday.hasOwnProperty(pref+customN)||(boxapi.pikaday[pref+customN]=picker)}else{if(!IsDatepickerScriptLoading){IsDatepickerScriptLoading=!0;var themeUrl="";settings[propName].datepicker.theme&&"dark"===settings[propName].datepicker.theme&&(themeUrl=BOX_BASE_URL+"/static/pikaday_dark.css");var h=document.head||document.getElementsByTagName("head")[0],l=(document.getElementsByTagName("body")[0],document.createElement("link"));if(l.type="text/css",l.rel="stylesheet",l.media="screen",l.href=BOX_BASE_URL+"/static/pikaday.css",h.appendChild(l),themeUrl){var lt=document.createElement("link");lt.type="text/css",lt.rel="stylesheet",lt.media="screen",lt.href=themeUrl,h.appendChild(lt)}var script=document.createElement("script");script.type="text/javascript",script.src=BOX_BASE_URL+"/static/pikaday.js",h.appendChild(script)}"undefined"!=typeof Pikaday?(IsDatepickerScriptLoaded=!0,initDatepicker(pref,propName,customN)):setTimeout((function(){initDatepicker(pref,propName,customN)}),50)}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"initDatepicker_3")}}
/*@preserve [#######CUSTOM_JS_APPS_BOX_EMBED#######] */
/*@preserve [#######CUSTOM_JS_BOX_EMBED#######] */function getCustomJsGuidsToRun(event_trigger,params_obj){for(var customJsGuidsToRun=[],i=0;i<CUSTOM_JS_GUIDS_ARR.length;i++)if(CUSTOM_JS_BOX_EMBED.hasOwnProperty(CUSTOM_JS_GUIDS_ARR[i])&&CUSTOM_JS_BOX_EMBED[CUSTOM_JS_GUIDS_ARR[i]].trigger===event_trigger){var skip_exclude_filter=!1,skip_include_exclude_function=!1,ev=CUSTOM_JS_BOX_EMBED[CUSTOM_JS_GUIDS_ARR[i]];if("string"==typeof ev.include_filter&&ev.include_filter.trim().length>0){var include_filter_parts=ev.include_filter.split(",");if(include_filter_parts.length>0){skip_exclude_filter=!0,skip_include_exclude_function=!0;for(var j=0;j<include_filter_parts.length;j++)(IS_VARIATION&&VARIATION_GUID.trim().toLowerCase()===include_filter_parts[j].trim().toLowerCase()&&-1===$.inArray(CUSTOM_JS_GUIDS_ARR[i],customJsGuidsToRun)||IS_VARIATION&&VARIATION_SHORT_ID.trim().toLowerCase()===include_filter_parts[j].trim().toLowerCase()&&-1===$.inArray(CUSTOM_JS_GUIDS_ARR[i],customJsGuidsToRun)||LIGHTBOX_GUID.trim().toLowerCase()===include_filter_parts[j].trim().toLowerCase()&&-1===$.inArray(CUSTOM_JS_GUIDS_ARR[i],customJsGuidsToRun)||LIGHTBOX_SHORT_ID.trim().toLowerCase()===include_filter_parts[j].trim().toLowerCase()&&-1===$.inArray(CUSTOM_JS_GUIDS_ARR[i],customJsGuidsToRun))&&customJsGuidsToRun.push(CUSTOM_JS_GUIDS_ARR[i])}else-1===$.inArray(CUSTOM_JS_GUIDS_ARR[i],customJsGuidsToRun)&&customJsGuidsToRun.push(CUSTOM_JS_GUIDS_ARR[i])}else-1===$.inArray(CUSTOM_JS_GUIDS_ARR[i],customJsGuidsToRun)&&customJsGuidsToRun.push(CUSTOM_JS_GUIDS_ARR[i]);if(!skip_exclude_filter&&"string"==typeof ev.exclude_filter&&ev.exclude_filter.trim().length>0){var exclude_filter_parts=ev.exclude_filter.split(",");if(exclude_filter_parts.length>0)for(j=0;j<exclude_filter_parts.length;j++){if(IS_VARIATION&&VARIATION_GUID.trim().toLowerCase()===exclude_filter_parts[j].trim().toLowerCase()){if(-1!==$.inArray(CUSTOM_JS_GUIDS_ARR[i],customJsGuidsToRun)){var index=$.inArray(CUSTOM_JS_GUIDS_ARR[i],customJsGuidsToRun);customJsGuidsToRun.splice(index,1)}skip_include_exclude_function=!0;break}if(IS_VARIATION&&VARIATION_SHORT_ID.trim().toLowerCase()===exclude_filter_parts[j].trim().toLowerCase()){if(-1!==$.inArray(CUSTOM_JS_GUIDS_ARR[i],customJsGuidsToRun)){index=$.inArray(CUSTOM_JS_GUIDS_ARR[i],customJsGuidsToRun);customJsGuidsToRun.splice(index,1)}skip_include_exclude_function=!0;break}if(LIGHTBOX_GUID.trim().toLowerCase()===exclude_filter_parts[j].trim().toLowerCase()){if(-1!==$.inArray(CUSTOM_JS_GUIDS_ARR[i],customJsGuidsToRun)){index=$.inArray(CUSTOM_JS_GUIDS_ARR[i],customJsGuidsToRun);customJsGuidsToRun.splice(index,1)}skip_include_exclude_function=!0;break}if(LIGHTBOX_SHORT_ID.trim().toLowerCase()===exclude_filter_parts[j].trim().toLowerCase()){if(-1!==$.inArray(CUSTOM_JS_GUIDS_ARR[i],customJsGuidsToRun)){index=$.inArray(CUSTOM_JS_GUIDS_ARR[i],customJsGuidsToRun);customJsGuidsToRun.splice(index,1)}skip_include_exclude_function=!0;break}}}if(skip_include_exclude_function||"function"!=typeof ev.include_exclude_function)skip_include_exclude_function||"function"==typeof ev.include_exclude_function||-1===$.inArray(CUSTOM_JS_GUIDS_ARR[i],customJsGuidsToRun)&&customJsGuidsToRun.push(CUSTOM_JS_GUIDS_ARR[i]);else{var ief_res=ev.include_exclude_function(DAPI,STANDARD_OBJ,params_obj);if("boolean"==typeof ief_res&&!0===ief_res)-1===$.inArray(CUSTOM_JS_GUIDS_ARR[i],customJsGuidsToRun)&&customJsGuidsToRun.push(CUSTOM_JS_GUIDS_ARR[i]);else if(-1!==$.inArray(CUSTOM_JS_GUIDS_ARR[i],customJsGuidsToRun)){index=$.inArray(CUSTOM_JS_GUIDS_ARR[i],customJsGuidsToRun);customJsGuidsToRun.splice(index,1)}}}return customJsGuidsToRun.length,customJsGuidsToRun}function calculateCustomJsResponses(res,res_final,calling_fctn_name){return null==res?"temp"===res_final&&(res_final=!0):"boolean"==typeof res?!1!==res||"runCustomJsBeforeFormValidation"!=calling_fctn_name&&"runCustomJsAfterFormValidation"!=calling_fctn_name&&"runCustomJsBeforeSubmit"!=calling_fctn_name&&"runCustomJsAfterSubmit"!=calling_fctn_name?"temp"===res_final?res_final=res:"boolean"!=typeof res_final&&"number"!=typeof res_final||(res_final=res_final&&res):res_final="short_circuit_break":"number"==typeof res?"temp"===res_final?res_final=res:"number"==typeof res_final&&(res_final+=res):"string"==typeof res?"temp"===res_final||"string"!=typeof res_final?res_final=res:res_final+=res:"object"==typeof res&&("temp"===res_final?res_final=res:"object"==typeof res_final&&(res_final=UTIL.mergeObjectData(res_final,res))),res_final}function runCustomJsSnippetsSync(calling_fctn_name,cjs_apps_trigger,custom_js_guids_to_run,params_obj,return_type){var res_final="temp";try{if(null!=CJSAPPS_BOXES&&null!=CJSAPPS_ARR&&CJSAPPS_ARR.length>0)for(var i=0;i<CJSAPPS_ARR.length;i++){var appId=CJSAPPS_ARR[i];if(CJSAPPS_BOXES.hasOwnProperty(appId)&&CJSAPPS_BOXES[appId].hasOwnProperty(cjs_apps_trigger)&&"function"==typeof CJSAPPS_BOXES[appId][cjs_apps_trigger])if(logger("RUNNER: runCustomJsSnippetsSync(LINKED APP #"+appId+" - "+cjs_apps_trigger+", "+return_type+", BOX_ID="+boxapi.getId()+")"),"void"===return_type||""===return_type)CJSAPPS_BOXES[appId][cjs_apps_trigger](DAPI,STANDARD_OBJ,params_obj);else if("string"==typeof(res_final=calculateCustomJsResponses(CJSAPPS_BOXES[appId][cjs_apps_trigger](DAPI,STANDARD_OBJ,params_obj),res_final,calling_fctn_name))&&"short_circuit_break"===res_final)return!1}if(custom_js_guids_to_run.length>0)for(i=0;i<custom_js_guids_to_run.length;i++){if("function"==typeof CUSTOM_JS_BOX_EMBED[custom_js_guids_to_run[i]].code)if(logger("RUNNER: runCustomJsSnippetsSync("+calling_fctn_name+", "+return_type+")"),"void"===return_type||""===return_type)CUSTOM_JS_BOX_EMBED[custom_js_guids_to_run[i]].code(DAPI,STANDARD_OBJ,params_obj);else if("string"==typeof(res_final=calculateCustomJsResponses(CUSTOM_JS_BOX_EMBED[custom_js_guids_to_run[i]].code(DAPI,STANDARD_OBJ,params_obj),res_final,calling_fctn_name))&&"short_circuit_break"===res_final)return!1}return"temp"===res_final||"void"===return_type||""===return_type||-1===return_type.indexOf(typeof res_final)?void 0:res_final}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsSnippetsSync"),"temp"===res_final||"void"===return_type||""===return_type||-1===return_type.indexOf(typeof res_final)?void 0:res_final}}window.jQuery=function(selector){return LBOX.JQUERY_DIGIOH(selector,document)},jQuery=LBOX.JQUERY_DIGIOH.extend(jQuery,LBOX.JQUERY_DIGIOH),window.$=window.jQuery,$=jQuery,String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),Date.prototype.addDays=function(days){var dat=new Date(this.valueOf());return dat.setDate(dat.getDate()+days),dat},BOX_CUSTOM_JS={runCustomJsBeforeDOMReady:function(){try{return runCustomJsSnippetsSync("runCustomJsBeforeDOMReady","Before DOM Ready",getCustomJsGuidsToRun("Before DOM Ready",{}),{},"boolean")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsBeforeDOMReady"),!0}},runCustomJsAfterDOMReady:function(){try{clearFormData();runCustomJsSnippetsSync("runCustomJsAfterDOMReady","After DOM Ready",getCustomJsGuidsToRun("After DOM Ready",{}),{},"boolean")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsAfterDOMReady"),!0}},runCustomJsBeforeDisplay:function(){try{return runCustomJsSnippetsSync("runCustomJsBeforeDisplay","Before Display",getCustomJsGuidsToRun("Before Display",{}),{},"boolean")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsBeforeDisplay"),!0}},runCustomJsAfterDisplay:function(){try{clearFormData();runCustomJsSnippetsSync("runCustomJsAfterDisplay","After Display",getCustomJsGuidsToRun("After Display",{}),{},"boolean")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsAfterDisplay"),!0}},runCustomJsBeforeFormValidation:function(form){try{return runCustomJsSnippetsSync("runCustomJsBeforeFormValidation","Before Form Validation",getCustomJsGuidsToRun("Before Form Validation",form),form,"boolean,string,object")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsBeforeFormValidation"),!0}},runCustomJsAfterFormValidation:function(form){try{return runCustomJsSnippetsSync("runCustomJsAfterFormValidation","After Form Validation",getCustomJsGuidsToRun("After Form Validation",form),form,"boolean,string,object")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsAfterFormValidation"),!0}},runCustomJsBeforeSubmit:function(form){try{return runCustomJsSnippetsSync("runCustomJsBeforeSubmit","Before Submit",getCustomJsGuidsToRun("Before Submit",form),form,"boolean,string,object")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsBeforeSubmit"),!0}},runCustomJsAfterSubmit:function(form){try{return runCustomJsSnippetsSync("runCustomJsAfterSubmit","After Submit",getCustomJsGuidsToRun("After Submit",form),form,"boolean")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsAfterSubmit"),!0}},runCustomJsBeforeRedirect:function(element,trigger){try{return runCustomJsSnippetsSync("runCustomJsBeforeRedirect","Before Redirect",getCustomJsGuidsToRun("Before Redirect",{element:element,trigger:trigger}),{element:element,trigger:trigger},"boolean")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsBeforeRedirect"),!0}},runCustomJsAfterRedirect:function(element,trigger){try{return runCustomJsSnippetsSync("runCustomJsAfterRedirect","After Redirect",getCustomJsGuidsToRun("After Redirect",{element:element,trigger:trigger}),{element:element,trigger:trigger},"void")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),void BOX_CUSTOM_JS.logError(e,"runCustomJsAfterRedirect")}},runCustomJsBeforeDownload:function(page,name,element){try{return runCustomJsSnippetsSync("runCustomJsBeforeDownload","Before Download",getCustomJsGuidsToRun("Before Download",{page:page,name:name,element:element}),{page:page,name:name,element:element},"boolean")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsBeforeDownload"),!0}},runCustomJsAfterDownload:function(page,name,element){try{return runCustomJsSnippetsSync("runCustomJsAfterDownload","After Download",getCustomJsGuidsToRun("After Download",{page:page,name:name,element:element}),{page:page,name:name,element:element},"void")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),void BOX_CUSTOM_JS.logError(e,"runCustomJsAfterDownload")}},runCustomJsBeforeOpenAnotherBox:function(target_lightbox_guid,trigger){try{return runCustomJsSnippetsSync("runCustomJsBeforeOpenAnotherBox","Before Open Another Box",getCustomJsGuidsToRun("Before Open Another Box",{target_lightbox_guid:target_lightbox_guid,trigger:trigger}),{target_lightbox_guid:target_lightbox_guid,trigger:trigger},"boolean")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsBeforeOpenAnotherBox"),!0}},runCustomJsAfterOpenAnotherBox:function(target_lightbox_guid,trigger){try{return runCustomJsSnippetsSync("runCustomJsAfterOpenAnotherBox","After Open Another Box",getCustomJsGuidsToRun("After Open Another Box",{target_lightbox_guid:target_lightbox_guid,trigger:trigger}),{target_lightbox_guid:target_lightbox_guid,trigger:trigger},"void")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),void BOX_CUSTOM_JS.logError(e,"runCustomJsAfterOpenAnotherBox")}},runCustomJsBeforeChangePages:function(old_page,new_page,name,element,trigger){try{return clearFormData(),runCustomJsSnippetsSync("runCustomJsBeforeChangePages","Before Change Pages",getCustomJsGuidsToRun("Before Change Pages",{old_page:old_page,new_page:new_page,name:name,element:element,trigger:trigger}),{old_page:old_page,new_page:new_page,name:name,element:element,trigger:trigger},"boolean")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"runCustomJsBeforeChangePages"),!0}},runCustomJsAfterChangePages:function(old_page,new_page,name,element,trigger){try{return runCustomJsSnippetsSync("runCustomJsAfterChangePages","After Change Pages",getCustomJsGuidsToRun("After Change Pages",{old_page:old_page,new_page:new_page,name:name,element:element,trigger:trigger}),{old_page:old_page,new_page:new_page,name:name,element:element,trigger:trigger},"void")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),void BOX_CUSTOM_JS.logError(e,"runCustomJsAfterChangePages")}},runCustomJsBeforeClose:function(){try{runCustomJsSnippetsSync("runCustomJsBeforeClose","Before Close",getCustomJsGuidsToRun("Before Close",{}),{},"void")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),void BOX_CUSTOM_JS.logError(e,"runCustomJsBeforeClose")}},runCustomJsAfterClose:function(){try{runCustomJsSnippetsSync("runCustomJsAfterClose","After Close",getCustomJsGuidsToRun("After Close",{}),{},"void")}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),void BOX_CUSTOM_JS.logError(e,"runCustomJsAfterClose")}},log:function(msg){try{DAPI.log(msg,"CUSTOM_JS_BOXES (BoxID="+boxapi.getId()+")")}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e))}},logError:function(e,msg){try{DAPI.log(e.message,"CUSTOM_JS_BOXES."+msg+" (BoxID="+boxapi.getId()+")"),DLOG.logErrorFromBox(e,msg)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e))}}};
function createDigiohPrqModule(dependencies){const DEFAULT_MAX_RESULTS=10,DAPI=dependencies.DAPI||{},WINDOW_JQUERY_DIGIOH=dependencies.WINDOW_JQUERY_DIGIOH,BOX_JQUERY_DIGIOH=dependencies.BOX_JQUERY_DIGIOH,UTIL=dependencies.UTIL,DUTIL=dependencies.DUTIL,DLOG=dependencies.DLOG,boxapi=dependencies.boxapi,getEffectsProp=dependencies.getEffectsProp,existsEffectsProp=dependencies.existsEffectsProp,getPageAnswers=dependencies.getPageAnswers,setPageAnswers=dependencies.setPageAnswers,setPageViewSequence=dependencies.setPageViewSequence,boxLogError=dependencies.boxLogError,quizPromises=dependencies.quizPromises;var USE=DAPI.LIGHTBOX.USE_PRQ;const logger=function(msg){DAPI.log(msg,"DIGIOH_PRQ")};var DATA={answers:[],results:[]},PRQKeywordsMap={},PRQObjects={},PRQHeaders=[],PRQRows=[],PRQColId=0,HasInitRun=!1,HasResultsLoaded=!1,AnswersTracked={},IsBoxPRQ=!1,GSheetURL="",ArrayFilePRQURL="",OutcomesOutput="",Outcome=!1,QuizSettings={},QuizQuestions={},QuizMappings=[];const MAX_TRACK_BURST_EVENTS=10;function init(){USE&&(HasInitRun||(HasInitRun=!0,(IsBoxPRQ=!!getEffectsProp("effects.quiz.enabled"))&&(QuizSettings=getEffectsProp("effects.quiz.settings"),QuizQuestions=getEffectsProp("effects.quiz.questions"),QuizMappings=getEffectsProp("effects.quiz.mappings")),trackPrqPage("main"),logger("DIGIOH_PRQ ==> init() ==> IsBoxPRQ = "+IsBoxPRQ+", LIGHTBOX_SHORT_ID = "+LIGHTBOX_SHORT_ID)))}function isOutcomesLogicMode(){return"outcomes"===QuizSettings.LogicMode}function getQuizQuestions(){return QuizQuestions}function getQuizMappings(){return QuizMappings}function getQuestionIdFromMapping(boxSetting){if(!QuizMappings)return"";const mapping=QuizMappings.find((m=>m.box_setting===boxSetting));if(!mapping)return"";const match=mapping.quiz_item.match(/^questions\.([^.]+)/);return match?match[1]:""}function getAnswerIdFromMapping(boxSetting){if(!QuizMappings)return"";const mapping=QuizMappings.find((m=>m.box_setting===boxSetting));if(!mapping)return"";const match=mapping.quiz_item.match(/\.answers\.([^.]+)/);return match?match[1]:""}function getNumConfiguredAnswersForPage(pref){if(!QuizMappings)return 0;pref=DUTIL.getPlainPref(pref);const pattern=/^questions\.[^.]+\.answers\.[^.]+$/;return QuizMappings.filter((m=>0===m.box_setting.indexOf(`${pref}button`)&&pattern.test(m.quiz_item))).length}function checkRequiredAnswersPRQ(pref){if(!QuizQuestions)return"";if(0===getNumConfiguredAnswersForPage(pref))return"";logger("getNumConfiguredAnswersForPage: "+getNumConfiguredAnswersForPage(pref));var questionId=getQuestionIdFromMapping(`${pref=DUTIL.getPlainPref(pref)}layout`);if(settings.hasOwnProperty(`${pref}layout`)&&settings[`${pref}layout`]&&questionId&&QuizQuestions.hasOwnProperty(questionId)){var question=QuizQuestions[questionId];if(question.type&&"multiple"==question.type&&0==question.min_answers&&0==question.max_answers)return"";if(question.type&&"single"==question.type&&!question.required)return"";var minAnswers=-1,maxAnswers=100;question.type&&"single"==question.type?(minAnswers=1,maxAnswers=1):question.type&&"multiple"==question.type&&(minAnswers=question.min_answers,maxAnswers=0==question.max_answers?100:question.max_answers),maxAnswers<minAnswers&&(maxAnswers=minAnswers);const PageAnswers=getPageAnswers();for(var answers=[],i=0;i<PageAnswers.length;i++)if(DUTIL.getPlainPref(PageAnswers[i].page)==pref){for(var j=0;j<PageAnswers[i].entries.length;j++)if("string"==typeof PageAnswers[i].entries[j].value&&"button"==PageAnswers[i].entries[j].type){var answerButton=`${pref}button${PageAnswers[i].entries[j].num}`,elementQuestionId=getQuestionIdFromMapping(answerButton),elementAnswerId=getAnswerIdFromMapping(answerButton);!UTIL.stringOrArrayContains(answers,answerButton)&&settings.hasOwnProperty(answerButton)&&elementQuestionId&&elementAnswerId&&elementQuestionId==questionId&&answers.push(answerButton)}break}if(answers.length<minAnswers)return`Please select at least ${minAnswers} answer${minAnswers>1?"s":""} for this question.`;if(answers.length>maxAnswers)return`Please select no more than ${maxAnswers} answer${maxAnswers>1?"s":""} for this question.`}return""}function getProductFileURL(){try{var arrURL=QuizSettings.ProductsArrayURLOptimized;boxapi.isPreview()?arrURL=arrURL.replace(".json","_preview.json"):boxapi.isQaMode()&&(arrURL=arrURL.replace(".json","_qa.json")),ArrayFilePRQURL=arrURL,logger("getProductFileURL: "+arrURL)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),boxLogError(e,"getArrayFilePRQURL")}return ArrayFilePRQURL}function loadProductData(){let quizPromise=new Promise(((resolve,reject)=>{var url=getProductFileURL(),useDirectCSV="true"===boxapi.getWidgetMetadata("use_direct_product_csv_url");useDirectCSV&&(url=QuizSettings.ProductCSVURL),$.ajax({url:url+"?cb="+DIGIOH_CACHE_VERSION,success:function(arr){useDirectCSV?parseCSV(arr):parseArrayFilePRQ(arr),resolve()},error:function(xhr){logger("parseArrayFilePRQ:failure: "+url+"?cb="+DIGIOH_CACHE_VERSION),logger("Array File Fetch Ajax Error: "+xhr.status+" "+xhr.statusText),reject("PRQ loadProductData Array File Fetch Ajax Error: "+xhr.status+" "+xhr.statusText)}})}));return quizPromises.push(quizPromise),quizPromise}function parseCSV(csv){var rows=WINDOW_JQUERY_DIGIOH.csv.toArrays(csv);processFileData(rows,rows[0])}function parseArrayFilePRQ(arr){processFileData(arr,arr[0])}function processFileData(rows,headers){for(var i=0;i<headers.length;i++){void 0!==headers[i]&&null!=headers[i]||(headers[i]="");for(var j=0;j<rows.length;j++)rows[j].length>i&&(void 0!==rows[j][i]&&null!=rows[j][i]||(rows[j][i]=""));"prq:id"==headers[i].toLowerCase().trim()?PRQColId=i:"prq:available"==headers[i].toLowerCase().trim()?PRQColAvailable=i:"prq:type"==headers[i].toLowerCase().trim()&&(PRQColType=i)}var weightedKeywordsArr=[],headerToKeywordIndexMap={},keywordMapKeyDups={};if(!isOutcomesLogicMode()){var weights=getEffectsProp("effects.quiz.weights");weights&&""!=weights||(weights=[]);for(i=0;i<weights.length;i++)weights[i].hasOwnProperty("keyword_weights")&&(weightedKeywordsArr=weightedKeywordsArr.concat(weights[i].keyword_weights));for(i=0;i<weightedKeywordsArr.length;i++){var col=weightedKeywordsArr[i].column,txt=weightedKeywordsArr[i].text;if(col&&0!=col.trim().length&&!keywordMapKeyDups.hasOwnProperty(col+"____"+txt))if(keywordMapKeyDups[col+"____"+txt]=!0,"any"==col.toLowerCase())headerToKeywordIndexMap.hasOwnProperty("any")||(headerToKeywordIndexMap.any=[]),headerToKeywordIndexMap.any.push(i);else for(j=0;j<headers.length;j++)if(col==headers[j]){headerToKeywordIndexMap.hasOwnProperty(col)||(headerToKeywordIndexMap[col]=[]),headerToKeywordIndexMap[col].push(i);break}}}for(var x=0;x<rows.length;x++)if(rows[x][PRQColId].toString().indexOf("PRQ:")<0){PRQObjects[rows[x][PRQColId]]={id:rows[x][PRQColId]};for(i=0;i<headers.length;i++)if(rows[x].length>i){if(PRQObjects[rows[x][PRQColId]][headers[i].toString().toLowerCase().replace("prq:","")]=rows[x][i],headerToKeywordIndexMap.hasOwnProperty(headers[i]))for(j=0;j<headerToKeywordIndexMap[headers[i]].length;j++){var keyword_column=weightedKeywordsArr[headerToKeywordIndexMap[headers[i]][j]].column,keyword_text=weightedKeywordsArr[headerToKeywordIndexMap[headers[i]][j]].text,keyword_operator="contains";if(weightedKeywordsArr[headerToKeywordIndexMap[headers[i]][j]].hasOwnProperty("operator")&&(keyword_operator=weightedKeywordsArr[headerToKeywordIndexMap[headers[i]][j]].operator),keyword_column&&keyword_text&&keyword_operator){var keywordMapKey=keyword_column+"____"+keyword_operator+"____"+keyword_text,foundMatch=!1;("contains"==keyword_operator&&rows[x][i].toString().toLowerCase().indexOf(keyword_text.toString().toLowerCase().trim())>=0||"equals"==keyword_operator&&rows[x][i].toString().toLowerCase().trim()===keyword_text.toString().toLowerCase().trim()||"whole_word"==keyword_operator&&new RegExp("\\b"+keyword_text.toString().toLowerCase()+"\\b").test(rows[x][i].toString().toLowerCase())||"regex"==keyword_operator&&new RegExp(keyword_text,"i").test(rows[x][i].toString()))&&(foundMatch=!0),foundMatch&&(PRQKeywordsMap.hasOwnProperty(keywordMapKey)||(PRQKeywordsMap[keywordMapKey]=[]),PRQKeywordsMap[keywordMapKey].push(rows[x][PRQColId]))}}if(headerToKeywordIndexMap.hasOwnProperty("any"))if("PRQ:ID"==headers[i]||"PRQ:Available"==headers[i]||"PRQ:ProductId"==headers[i]||"PRQ:URL"==headers[i]||"PRQ:Image"==headers[i]||"PRQ:CollectionIds"==headers[i]);else for(j=0;j<headerToKeywordIndexMap.any.length;j++){keyword_column=weightedKeywordsArr[headerToKeywordIndexMap.any[j]].column,keyword_text=weightedKeywordsArr[headerToKeywordIndexMap.any[j]].text,keyword_operator="contains";if(weightedKeywordsArr[headerToKeywordIndexMap.any[j]].hasOwnProperty("operator")&&(keyword_operator=weightedKeywordsArr[headerToKeywordIndexMap.any[j]].operator),keyword_column&&keyword_text&&keyword_operator){keywordMapKey=keyword_column+"____"+keyword_operator+"____"+keyword_text,foundMatch=!1;("contains"==keyword_operator&&rows[x][i].toString().toLowerCase().indexOf(keyword_text.toString().toLowerCase().trim())>=0||"equals"==keyword_operator&&rows[x][i].toString().toLowerCase().trim()===keyword_text.toString().toLowerCase().trim()||"whole_word"==keyword_operator&&new RegExp("\\b"+keyword_text.toString().toLowerCase()+"\\b").test(rows[x][i].toString().toLowerCase())||"regex"==keyword_operator&&new RegExp(keyword_text,"i").test(rows[x][i].toString()))&&(foundMatch=!0),foundMatch&&(PRQKeywordsMap.hasOwnProperty(keywordMapKey)||(PRQKeywordsMap[keywordMapKey]=[]),PRQKeywordsMap[keywordMapKey].push(rows[x][PRQColId]))}}}else PRQObjects[rows[x][PRQColId]][headers[i].toString().toLowerCase().replace("prq:","")]=""}for(var prop in PRQKeywordsMap)PRQKeywordsMap.hasOwnProperty(prop)&&(PRQKeywordsMap[prop]=[...new Set(PRQKeywordsMap[prop])]);PRQHeaders=headers,PRQRows=rows,logger("processFileData:complete"),logger("PRQHeaders"),logger(PRQHeaders),logger("PRQObjects"),logger(PRQObjects),logger("PRQKeywordsMap"),logger(PRQKeywordsMap)}function evalOutcomeRule(rule_prop,rule_operator,rule_set,rule_val){var res={};res.rule_prop=rule_prop,res.rule_operator=rule_operator,res.rule_val=rule_val,res.rule_set=rule_set,res.rule_message="",res.rule_result=!1;try{var i=0,j=0,answers=[];const PageAnswers=getPageAnswers();var foundPage=!1;for(i=0;i<PageAnswers.length;i++)if(DUTIL.getPlainPref(PageAnswers[i].page)==DUTIL.getPlainPref(rule_prop)){for(j=0;j<PageAnswers[i].entries.length;j++)"string"==typeof PageAnswers[i].entries[j].value&&("button"!=PageAnswers[i].entries[j].type||UTIL.stringOrArrayContains(answers,"b"+PageAnswers[i].entries[j].num)?"custom"!=PageAnswers[i].entries[j].type||UTIL.stringOrArrayContains(answers,PageAnswers[i].entries[j].value.toString().toLowerCase().trim())||answers.push(PageAnswers[i].entries[j].value.toString().toLowerCase().trim()):answers.push("b"+PageAnswers[i].entries[j].num));foundPage=!0;break}if(!foundPage)return res.rule_message="(page="+(rule_prop||"main")+") ==> No answers found in PageAnswers for page, so setting page rule eval to false.",res.rule_result=!1,res;if(res.rule_message="(page="+(rule_prop||"main")+") ==> found in PageAnswers for page ==> "+JSON.stringify(answers),"contains"==rule_operator)return 0!=rule_val.length&&UTIL.stringOrArrayContains(answers,rule_val.toString().toLowerCase().trim())?(res.rule_result=!0,res):(res.rule_result=!1,res);if("does_not_contain"==rule_operator)return 0==rule_val.length||UTIL.stringOrArrayContains(answers,rule_val.toString().toLowerCase().trim())?(res.rule_result=!1,res):(res.rule_result=!0,res);if("in_set_contains"==rule_operator){for(i=0;i<rule_set.length;i++)if(rule_set[i].toString().trim().length>0&&UTIL.stringOrArrayContains(answers,rule_set[i].toString().toLowerCase().trim()))return res.rule_result=!0,res;return res.rule_result=!1,res}if("not_in_set_contains"==rule_operator){for(i=0;i<rule_set.length;i++)if(rule_set[i].toString().trim().length>0&&UTIL.stringOrArrayContains(answers,rule_set[i].toString().toLowerCase().trim()))return res.rule_result=!1,res;return res.rule_result=!0,res}if("exact_in_set_contains"==rule_operator){if(0==rule_set.length)return res.rule_result=!1,res;for(i=0;i<rule_set.length;i++)if(0==rule_set[i].toString().trim().length||!UTIL.stringOrArrayContains(answers,rule_set[i].toString().toLowerCase().trim()))return res.rule_result=!1,res;return res.rule_result=!0,res}}catch(e){res.rule_error=!0,res.rule_error_message=e.message,DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),boxLogError(e,"evalOutcomeRule")}return res}function evalOutcomeConditions(outcome){var conditions=outcome.conditions,or_blocks=[],or_block_json=[],json_rule={};try{for(var x=0;x<conditions.length;x++){or_blocks[x]=!0,or_block_json[x]=[];for(var y=0;y<conditions[x].length;y++)if(json_rule=evalOutcomeRule(conditions[x][y].p,conditions[x][y].o,conditions[x][y].s,conditions[x][y].v),or_block_json[x].push(json_rule),!json_rule.rule_result){or_blocks[x]=!1;break}if(!0===or_blocks[x])return OutcomesOutput+="---------------------------------\n",OutcomesOutput+="Box #"+LIGHTBOX_SHORT_ID+", Quiz Outcome #"+outcome.id+" "+outcome.name+" -- RULES_SUCCEEDED\n",OutcomesOutput+=JSON.stringify(or_block_json,null,2)+"\n",OutcomesOutput+="---------------------------------\n",!0}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: user.js -- "+e.message,console.error(e)),logError(e,"evalOutcomeConditions")}return OutcomesOutput+="---------------------------------\n",OutcomesOutput+="Box #"+LIGHTBOX_SHORT_ID+", Quiz Outcome #"+outcome.id+" "+outcome.name+" -- RULES_FAILED\n",OutcomesOutput+=JSON.stringify(or_block_json,null,2)+"\n",OutcomesOutput+="---------------------------------\n",!1}function calcOutcomesPRQ(){try{OutcomesOutput="---------------------------------\n",OutcomesOutput+="calcOutcomesPRQ\n",OutcomesOutput+="---------------------------------\n";var outcomes=getEffectsProp("effects.quiz.outcomes");if(outcomes.length>0)for(var i=0;i<outcomes.length;i++)if(evalOutcomeConditions(outcomes[i]))return printOutcomesOutput(),outcomes[i]}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),boxLogError(e,"calcOutcomesPRQ")}return printOutcomesOutput(),null}function printOutcomesOutput(){try{console.log(OutcomesOutput)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),boxLogError(e,"calcOutcomesPRQ")}}function calcResultsPRQ(useFullResults){try{if(!USE)return;const PageAnswers=getPageAnswers();var res={},x=0,y=0,r=0,actionOverride="",isWeightBasedLogic=!isOutcomesLogicMode(),displayNegativeWeightResults="|true|1|yes|on|".indexOf("|"+(boxapi.getWidgetMetadata("display_negative_weight_results")||"false").toLowerCase()+"|")>=0;logger("PRQHeaders"),logger(PRQHeaders),logger("PRQRows"),logger(PRQRows);var isTestMode=boxapi.isPreview()||boxapi.isQaMode()||"true"==UTIL.getUrlParam("quiz_test_mode"),quizResultsURL=QuizSettings.ResultsPageUrlFull||boxapi.getWidgetMetadata("results_redirect_url_shopify")||"",suppressOutOfStock=!0;(quizResultsURL&&quizResultsURL.indexOf("hide_oos=false")>0||QuizSettings.hasOwnProperty("HideOutOfStock")&&!1===QuizSettings.HideOutOfStock)&&(suppressOutOfStock=!1),isTestMode&&isWeightBasedLogic&&!DAPI.hasOwnProperty("rerunExpandedCalcResultsPRQ")&&(DAPI.rerunExpandedCalcResultsPRQ=function(){DIGIOH_PRQ.calcResultsPRQ(!0)}),logger("calcResultsPRQ: ---------------------------------------------------------"),logger("calcResultsPRQ: START"),logger("calcResultsPRQ: ---------------------------------------------------------");for(var productWeightsByPage=[],i=0;i<PageAnswers.length;i++){var pref=PageAnswers[i].page,pageWeights={page:(pref||"main").toUpperCase(),page_answers:[],cumulative_weights:[]};for(settings.hasOwnProperty(pref+"layout")&&settings[pref+"layout"].hasOwnProperty("page_name")&&settings[pref+"layout"].page_name?(pageWeights.page=settings[pref+"layout"].page_name+" ("+pageWeights.page.toUpperCase()+")",settings[pref+"layout"].page_name.replace(/[^a-zA-Z0-9 ]/g,"").trim().split(" ").join("_").toLowerCase(),PageAnswers[i].page_name=settings[pref+"layout"].page_name):("question_page_"+pageWeights.page.toLowerCase(),PageAnswers[i].page_name=""),x=0;x<PageAnswers[i].entries.length;x++){var type=PageAnswers[i].entries[x].type,val=PageAnswers[i].entries[x].value,num=PageAnswers[i].entries[x].num;if(isWeightBasedLogic){var ptn="";if("button"==type)ptn=pref+type+num;else if("custom"==type){ptn=(""==pref?"":pref+"_")+type+num}if("custom"==type&&settings[ptn].hasOwnProperty("prq_weights")&&settings[ptn].prq_weights.length>0)for(var w=0;w<settings[ptn].prq_weights.length;w++)if(checkCustomFieldConditionsPRQ(settings[ptn].prq_weights[w].operator,settings[ptn].prq_weights[w].value,val)){if(settings[ptn].prq_weights[w].kvps)for(y=0;y<settings[ptn].prq_weights[w].kvps.length;y++){calcResultsPRQAddProductWeights(res,pageWeights,ptn,val,prodId=(kvp=settings[ptn].prq_weights[w].kvps[y]).p,kvp.w,"","custom","single",suppressOutOfStock,quizResultsURL)}if(settings[ptn].prq_weights[w].keywords)for(y=0;y<settings[ptn].prq_weights[w].keywords.length;y++){var keyword_column=(item=settings[ptn].prq_weights[w].keywords[y]).column,keyword_text=item.text,keyword_operator="contains";item.hasOwnProperty("operator")&&(keyword_operator=item.operator);var keywordMapKey=keyword_column+"____"+keyword_operator+"____"+keyword_text;if(item.column&&item.text&&item.weight&&PRQKeywordsMap.hasOwnProperty(keywordMapKey))for(r=0;r<PRQKeywordsMap[keywordMapKey].length;r++){calcResultsPRQAddProductWeights(res,pageWeights,ptn,val,prodId=PRQKeywordsMap[keywordMapKey][r],item.weight,item.text,"custom","keyword",suppressOutOfStock,quizResultsURL)}}}if("button"==type&&settings.hasOwnProperty(ptn)&&settings[ptn].hasOwnProperty("prq_kvps"))for(y=0;y<settings[ptn].prq_kvps.length;y++){var kvp;calcResultsPRQAddProductWeights(res,pageWeights,ptn,val,prodId=(kvp=settings[ptn].prq_kvps[y]).p,kvp.w,"","button","single",suppressOutOfStock,quizResultsURL)}if("button"==type&&settings.hasOwnProperty(ptn)&&settings[ptn].hasOwnProperty("prq_keywords"))for(y=0;y<settings[ptn].prq_keywords.length;y++){keyword_column=(item=settings[ptn].prq_keywords[y]).column,keyword_text=item.text,keyword_operator="contains";item.hasOwnProperty("operator")&&(keyword_operator=item.operator);keywordMapKey=keyword_column+"____"+keyword_operator+"____"+keyword_text;if(item.column&&item.text&&item.weight&&PRQKeywordsMap.hasOwnProperty(keywordMapKey))for(r=0;r<PRQKeywordsMap[keywordMapKey].length;r++){calcResultsPRQAddProductWeights(res,pageWeights,ptn,val,prodId=PRQKeywordsMap[keywordMapKey][r],item.weight,item.text,"button","keyword",suppressOutOfStock,quizResultsURL)}}}}if(isTestMode){for(var prop in res)if(res.hasOwnProperty(prop)&&PRQObjects.hasOwnProperty(prop)){var prodName=getCellValueByProductId(prop,"PRQ:Name");prodName=prodName?"Product #"+prop+" ("+prodName+")":"Product #"+prop,pageWeights.cumulative_weights.push({id:prop,weight:res[prop],title:prodName})}productWeightsByPage.push(pageWeights)}}isTestMode&&logger("calcResultsPRQ: cumulativeProductWeightsByPage ==>"+JSON.stringify(productWeightsByPage,void 0,2));var WeightedResults=[];if(isWeightBasedLogic){for(var prop in res)if(res.hasOwnProperty(prop)&&PRQObjects.hasOwnProperty(prop)&&(displayNegativeWeightResults||res[prop]>=0)){var obj={weight:res[prop],id:prop};WeightedResults.push(obj)}}else{if(Outcome=calcOutcomesPRQ(),applyCustomResultPageConfig(),QuizSettings&&QuizSettings.ResultPagesLimit&&QuizSettings.ResultPagesLimit>0&&printResultPageOutput(),logger("calcResultsPRQ: outcome ==> "),logger(Outcome),Outcome){if(Outcome.products)for(var o=0;o<Outcome.products.length;o++){var prodId=Outcome.products[o];if(PRQObjects.hasOwnProperty(prodId)){var prodAvailable=getCellValueByProductId(prodId,"PRQ:Available");if(suppressOutOfStock&&"false"==prodAvailable.toString().toLowerCase().trim())logger("suppressOutOfStock_productOutcomes: "+prodId.toString());else{obj={weight:1,id:prodId};WeightedResults.push(obj)}}}Outcome.results&&Outcome.results.action&&(actionOverride=Outcome.results)}logger("calcResultsPRQ: calcOutcomesPRQ: WeightedResults ==> "),logger(WeightedResults)}WeightedResults=sortResults(WeightedResults);for(WeightedResults.length>50&&(WeightedResults.length=50),w=0;w<WeightedResults.length;w++){var item=WeightedResults[w];for(var headerProp in PRQObjects[item.id])PRQObjects[item.id].hasOwnProperty(headerProp)&&"id"!=headerProp.toLowerCase()&&"weight"!=headerProp.toLowerCase()&&(item[headerProp]=PRQObjects[item.id][headerProp])}var productIdCol="",variantCol="";if(WeightedResults.length>1)for(var colName in WeightedResults[0])WeightedResults[0].hasOwnProperty(colName)&&("variant"==colName||"variation"==colName?variantCol=colName:"product_id"!=colName&&"productid"!=colName||(productIdCol=colName));if(productIdCol&&variantCol){var productIdsFound="",WeightedResultsFiltered=[];for(r=0;r<WeightedResults.length;r++)WeightedResults[r].hasOwnProperty(productIdCol)&&productIdsFound.indexOf("|"+WeightedResults[r][productIdCol]+"|")<0&&(WeightedResultsFiltered.push(WeightedResults[r]),productIdsFound+="|"+WeightedResults[r][productIdCol]+"|");WeightedResultsFiltered.length>0&&(WeightedResults=JSON.parse(JSON.stringify(WeightedResultsFiltered)))}if(logger("calcResultsPRQ: WeightedResults ==> "),logger(WeightedResults),DATA={answers:PageAnswers,results:WeightedResults},logger("calcResultsPRQ: DATA ==> "+JSON.stringify(DATA)),logger("calcResultsPRQ: ---------------------------------------------------------"),logger("calcResultsPRQ: END"),logger("calcResultsPRQ: ---------------------------------------------------------"),isTestMode&&isWeightBasedLogic){if(!WINDOW_JQUERY_DIGIOH("#quiz_test_results").length){WINDOW_JQUERY_DIGIOH("body").append('<div id="quiz_test_results" style="display: none; position: fixed; left: 0; top: 0; width: 100%; height: 100%; overflow-x: hidden; z-index: 999999999; background-color: white;"><table id="quiz_test_results_table" style="width:100%;"></table></div>'),WINDOW_JQUERY_DIGIOH("body").append("<button id=\"show_quiz_test_results_button\" style=\"position: fixed; right: 10px; top: 10px; z-index: 99999999;\" onclick=\"javascript:document.getElementById('quiz_test_results').style.display = 'block';\">Show Results Calculation <button id=\"dismiss_button\" style=\"position: fixed; right: 183px; top: 10px; z-index: 99999999;\" onclick=\"document.getElementById('show_quiz_test_results_button').style.display = 'none'; document.getElementById('dismiss_button').style.display = 'none';\">X</button> </div>"),WINDOW_JQUERY_DIGIOH("#quiz_test_results").append('<button id="close_quiz_test_results_button" style="position: fixed; bottom: 10px; left: 10px;" onclick="javascript:document.getElementById(\'quiz_test_results\').style.display = \'none\';">Close Results</button>'),WINDOW_JQUERY_DIGIOH("#quiz_test_results").append('<button id="save_quiz_test_results_button" style="position: fixed; bottom: 10px; left: 150px;" onclick="javascript:window.DIGIOH_API.downloadQuizResultsTable();">Download Results</button>'),WINDOW_JQUERY_DIGIOH("#quiz_test_results").append('<button id="save_quiz_test_results_button" style="position: fixed; bottom: 10px; left: 320px;" onclick="javascript:window.DIGIOH_API.rerunExpandedCalcResultsPRQ();">Full Results</button>');WINDOW_JQUERY_DIGIOH("head").append('<style id="quiz_test_styles" type="text/css">#quiz_test_results table td, #quiz_test_results table th { vertical-align: top; padding: 15px; border: 1px solid black; }#quiz_test_results #quiz_test_answers_table td, #quiz_test_results #quiz_test_answers_table th { vertical-align: top; padding: 5px; border: 1px solid black; }#quiz_test_results #quiz_test_cumulative_table td, #quiz_test_results #quiz_test_cumulative_table th { vertical-align: top; padding: 5px; border: 1px solid black; }</style>')}WINDOW_JQUERY_DIGIOH("#quiz_test_results_table").empty(),WINDOW_JQUERY_DIGIOH("#quiz_test_results_table").append("<tr><th>Step</th><th>Page</th><th>Answers</th><th>Cumulative Weights</th></tr>");var qtr="";for(x=0;x<productWeightsByPage.length;x++){var pa='<table id="quiz_test_answers_table">';pa+="<tr><th>Answer</th><th>Product</th><th>Weight</th><th>Matching</th></tr>";var prevAnswer="",prodMatchCnt=0;for(y=0;y<productWeightsByPage[x].page_answers.length;y++){var currAnswer=productWeightsByPage[x].page_answers[y].split("==>")[0].replace("Answered ",""),matchType="Single Product";if(productWeightsByPage[x].page_answers[y].indexOf("matched keyword:")>0&&(matchType="Keyword="+productWeightsByPage[x].page_answers[y].split("matched keyword:")[1].split(")")[0].trim()),pa+=y>0&&prevAnswer==currAnswer?"<tr><td></td><td>#"+productWeightsByPage[x].page_answers[y].split("==>")[1].split("weight added to ID #")[1].trim().split("(")[0].trim()+"</td><td>"+productWeightsByPage[x].page_answers[y].split("==>")[1].split("weight added to ID")[0].trim()+"</td><td>"+matchType+"</td></tr>":"<tr><td>"+currAnswer+"</td><td>#"+productWeightsByPage[x].page_answers[y].split("==>")[1].split("weight added to ID #")[1].trim().split("(")[0].trim()+"</td><td>"+productWeightsByPage[x].page_answers[y].split("==>")[1].split("weight added to ID")[0].trim()+"</td><td>"+matchType+"</td></tr>",prevAnswer=currAnswer,++prodMatchCnt>=20)break}pa+="</table>",0==productWeightsByPage[x].page_answers.length&&(pa="");var cwArr=sortResults(productWeightsByPage[x].cumulative_weights);if(!useFullResults&&cwArr.length>20&&(cwArr.length=20),!displayNegativeWeightResults){for(var cwArrFiltered=[],c=0;c<cwArr.length;c++)cwArr[c].weight>=0&&cwArrFiltered.push(cwArr[c]);cwArr=cwArrFiltered}var cw='<table id="quiz_test_cumulative_table">';for(cw+="<tr><th>Product</th><th>Weight</th></tr>",y=0;y<cwArr.length;y++){var extraAttrs="";QuizSettings.ResultsOrderFields&&QuizSettings.ResultsOrderFields.indexOf("PRQ:Quantity")>=0&&cwArr[y].id&&PRQObjects.hasOwnProperty(cwArr[y].id)&&PRQObjects[cwArr[y].id].hasOwnProperty("quantity")&&(extraAttrs+=" (QTY="+PRQObjects[cwArr[y].id].quantity+")"),QuizSettings.ResultsOrderFields&&QuizSettings.ResultsOrderFields.indexOf("PRQ:Price")>=0&&cwArr[y].id&&PRQObjects.hasOwnProperty(cwArr[y].id)&&PRQObjects[cwArr[y].id].hasOwnProperty("price")&&(extraAttrs+=" (Price="+PRQObjects[cwArr[y].id].price+")"),cw+="<tr><td>"+cwArr[y].title.replace("Product ","")+extraAttrs+"</td><td>"+cwArr[y].weight+"</td></tr>"}cw+="</table>",0==cwArr.length&&(cw=""),qtr+="<tr><td>"+(x+1).toString()+"</td><td>"+productWeightsByPage[x].page+"</td><td>"+pa+"</td><td>"+cw+"</td></tr>"}WINDOW_JQUERY_DIGIOH("#quiz_test_results_table").append(qtr)}return actionOverride}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),boxLogError(e,"calcResultsPRQ")}return""}function sortResults(results){let sortFields=[];if(QuizSettings.ResultsOrderFields)for(let field of QuizSettings.ResultsOrderFields.split(","))sortFields.push({field:field.replace(/(PRQ:|asc|desc)\b/gi,"").trim().toLowerCase(),dir:/\sdesc$/gi.test(field)?"DESC":"ASC"});return results.sort(((a,b)=>{if("weights"==QuizSettings.LogicMode&&a.weight!=b.weight)return b.weight-a.weight;if(!PRQObjects.hasOwnProperty(a.id)||!PRQObjects.hasOwnProperty(b.id)||0==sortFields.length)return 0;let productA=PRQObjects[a.id],productB=PRQObjects[b.id];for(let sortField of sortFields){if(!productA.hasOwnProperty(sortField.field)||!productB.hasOwnProperty(sortField.field))continue;let valA=productA[sortField.field],valB=productB[sortField.field],compareVal=0;if(valA!==valB&&(isNumber(valA)&&isNumber(valB)?compareVal=parseNumber(valA)-parseNumber(valB):valA<valB?compareVal=-1:valA>valB&&(compareVal=1)),"DESC"===sortField.dir&&(compareVal*=-1),0!=compareVal)return compareVal}return 0})),results}function isNumber(val){var str=val.toString().replace(/[$,]/g,"");return!isNaN(str)&&!isNaN(parseFloat(str))}function parseNumber(str){return parseFloat(str.toString().replace(/[$,]/g,""))}function calcResultsPRQAddProductWeights(res,pageWeights,ptn,val,prodId,weight,keyword,eleType,weightMatchType,suppressOutOfStock,shopifyResultsUrl){var lineItemOutput="";if(logger("calcResultsPRQAddProductWeights: "+ptn+", "+prodId+", "+weight),0==prodId.trim().length||prodId.indexOf("PRQ:")>=0||0==weight.trim().length||!UTIL.isNumeric(weight)||0===parseFloat(weight))logger("suppressInvalidProductIdOrWeight_productWeightsByPage: "+prodId.toString());else{var prodAvailable=getCellValueByProductId(prodId,"PRQ:Available");if(suppressOutOfStock&&"false"==prodAvailable.toString().toLowerCase().trim())logger("suppressOutOfStock_productWeightsByPage: "+prodId.toString());else{var prodType=getCellValueByProductId(prodId,"PRQ:Type")||"Product";if(shopifyResultsUrl&&shopifyResultsUrl.indexOf("http")>=0&&shopifyResultsUrl.indexOf("&collections=")<0&&"collection"==prodType.toString().toLowerCase().trim()){logger("calcResultsPRQAddProductWeights_collection: "+prodId);for(var collectionId=prodId.toString(),r2=0;r2<PRQRows.length;r2++)if(PRQRows[r2][PRQColId].toString()!==collectionId){var rowProductId=PRQRows[r2][PRQColId].toString(),rowProductType=getCellValueByProductId(rowProductId,"PRQ:Type"),rowProductCollectionIds=getCellValueByProductId(rowProductId,"PRQ:CollectionIds");("Product"==rowProductType||"Variant"==rowProductType)&&rowProductCollectionIds.length>0&&("|"+rowProductCollectionIds+"|").indexOf("|"+collectionId+"|")>=0?(logger("calcResultsPRQAddProductWeights_collection: "+prodId+", HIT, rowProductId="+rowProductId+", rowProductType="+rowProductType+", rowProductCollectionIds="+rowProductCollectionIds),res.hasOwnProperty(rowProductId)?res[rowProductId]+=parseFloat(weight):res[rowProductId]=parseFloat(weight),"button"==eleType&&"keyword"==weightMatchType?(lineItemOutput="Answered Button "+ptn.split("utton")[1]+" ("+UTIL.extractTextFromHTML(val,!0).trim()+") ==> "+weight+" weight added to ID #"+rowProductId+" ("+rowProductType+" associated Collection #"+collectionId+" matched keyword: "+keyword+")",pageWeights.page_answers.push(lineItemOutput),logger("calcResultsPRQ: "+lineItemOutput),logger("calcResultsPRQ: found CollectionId #"+collectionId+" in "+rowProductType+"Id #"+rowProductId)):"button"==eleType&&"single"==weightMatchType?(lineItemOutput="Answered Button "+ptn.split("utton")[1]+" ("+UTIL.extractTextFromHTML(val,!0).trim()+") ==> "+weight+" weight added to ID #"+rowProductId+" ("+rowProductType+" associated Collection #"+collectionId+")",pageWeights.page_answers.push(lineItemOutput),logger("calcResultsPRQ: "+lineItemOutput),logger("calcResultsPRQ: found CollectionId #"+collectionId+" in "+rowProductType+"Id #"+rowProductId)):"custom"==eleType&&"keyword"==weightMatchType?(lineItemOutput="Answered Custom Field "+ptn.split("ustom")[1].replace("_","")+" ("+UTIL.extractTextFromHTML(val,!0).trim()+") ==> "+weight+" weight added to ID #"+rowProductId+" ("+rowProductType+" associated Collection #"+collectionId+" matched keyword: "+keyword+")",pageWeights.page_answers.push(lineItemOutput),logger("calcResultsPRQ: "+lineItemOutput),logger("calcResultsPRQ: found CollectionId #"+collectionId+" in "+rowProductType+"Id #"+rowProductId)):"custom"==eleType&&"single"==weightMatchType?(lineItemOutput="Answered Custom Field "+ptn.split("ustom")[1].replace("_","")+" ("+UTIL.extractTextFromHTML(val,!0).trim()+") ==> "+weight+" weight added to ID #"+rowProductId+" ("+rowProductType+" associated Collection #"+collectionId+")",pageWeights.page_answers.push(lineItemOutput),logger("calcResultsPRQ: "+lineItemOutput),logger("calcResultsPRQ: found CollectionId #"+collectionId+" in "+rowProductType+"Id #"+rowProductId)):logger("calcResultsPRQAddProductWeights_collection: did not match on eleType or weightMatchType for rowProductId="+rowProductId)):"Product"!=rowProductType&&"Variant"!=rowProductType||logger("calcResultsPRQAddProductWeights_collection: "+prodId+", MISS, rowProductId="+rowProductId+", rowProductType="+rowProductType+", rowProductCollectionIds="+rowProductCollectionIds)}}else res.hasOwnProperty(prodId)?res[prodId]+=parseFloat(weight):res[prodId]=parseFloat(weight),"button"==eleType&&"keyword"==weightMatchType?(lineItemOutput="Answered Button "+ptn.split("utton")[1]+" ("+UTIL.extractTextFromHTML(val,!0).trim()+") ==> "+weight+" weight added to ID #"+prodId+" ("+prodType+" matched keyword: "+keyword+")",pageWeights.page_answers.push(lineItemOutput),logger("calcResultsPRQ: "+lineItemOutput)):"button"==eleType&&"single"==weightMatchType?(lineItemOutput="Answered Button "+ptn.split("utton")[1]+" ("+UTIL.extractTextFromHTML(val,!0).trim()+") ==> "+weight+" weight added to ID #"+prodId+" ("+prodType+")",pageWeights.page_answers.push(lineItemOutput),logger("calcResultsPRQ: "+lineItemOutput)):"custom"==eleType&&"keyword"==weightMatchType?(lineItemOutput="Answered Custom Field "+ptn.split("ustom")[1].replace("_","")+" ("+UTIL.extractTextFromHTML(val,!0).trim()+") ==> "+weight+" weight added to ID #"+prodId+" ("+prodType+" matched keyword: "+keyword+")",pageWeights.page_answers.push(lineItemOutput),logger("calcResultsPRQ: "+lineItemOutput)):"custom"==eleType&&"single"==weightMatchType?(lineItemOutput="Answered Custom Field "+ptn.split("ustom")[1].replace("_","")+" ("+UTIL.extractTextFromHTML(val,!0).trim()+") ==> "+weight+" weight added to ID #"+prodId+" ("+prodType+")",pageWeights.page_answers.push(lineItemOutput),logger("calcResultsPRQ: "+lineItemOutput)):logger("calcResultsPRQAddProductWeights_product: did not match on eleType or weightMatchType"+prodId)}}}function applyCustomResultPageConfig(){try{if(!(QuizSettings&&QuizSettings.ResultPagesLimit&&QuizSettings.ResultPagesLimit>0))return;if(!Outcome||!Outcome.resultPageId||"default"===Outcome.resultPageId)return;var resultPages=QuizSettings.ResultPages;if(!resultPages||!Array.isArray(resultPages))return;var customPage=resultPages.find((function(page){return page.Id===Outcome.resultPageId||page.id===Outcome.resultPageId}));if(!customPage)return void logger("applyCustomResultPageConfig: Custom page not found: "+Outcome.resultPageId);var pageType=customPage.ResultsPageType||customPage.resultsPageType;if(null!=pageType&&(QuizSettings.ResultsPageType=pageType),(customPage.MaxResults||customPage.maxResults)&&(QuizSettings.MaxResults=customPage.MaxResults||customPage.maxResults),(customPage.ResultsOrderFields||customPage.resultsOrderFields)&&(QuizSettings.ResultsOrderFields=customPage.ResultsOrderFields||customPage.resultsOrderFields),1===pageType||"Redirect_To_External_URL"===pageType){(customPage.ResultsPageUrlDomain||customPage.resultsPageUrlDomain)&&(QuizSettings.ResultsPageUrlDomain=customPage.ResultsPageUrlDomain||customPage.resultsPageUrlDomain),(customPage.ResultsPageUrlPath||customPage.resultsPageUrlPath)&&(QuizSettings.ResultsPageUrlPath=customPage.ResultsPageUrlPath||customPage.resultsPageUrlPath),(customPage.ResultsPageUrlQuery||customPage.resultsPageUrlQuery)&&(QuizSettings.ResultsPageUrlQuery=customPage.ResultsPageUrlQuery||customPage.resultsPageUrlQuery);var domain=(QuizSettings.ResultsPageUrlDomain||"").replace(/^https?:\/\//,"").replace(/\/$/,""),path=(QuizSettings.ResultsPageUrlPath||"").replace(/\?.*$/,"");path&&!path.startsWith("/")&&(path="/"+path);var baseUrl="https://"+domain+path;baseUrl=baseUrl.replace(/\/$/,"");var queryParams="max_products="+QuizSettings.MaxResults+"&rowlen="+QuizSettings.ItemsPerRow+"&hide_oos="+(QuizSettings.HideOutOfStock?"true":"false")+"&show_hero="+(QuizSettings.DisplayHeroProduct?"true":"false");if("Shopify"==QuizSettings.StoreType)0===(QuizSettings.ShopifyProductsType||"PRODUCTS").indexOf("VARIANTS")?queryParams+="&products=[HANDLES]&variants=[VARIANT_IDS]&ids=[IDS]":queryParams+="&products=[HANDLES]&ids=[IDS]";else queryParams+="&ids=[IDS]";QuizSettings.ResultsPageUrlQuery&&(queryParams+="&"+QuizSettings.ResultsPageUrlQuery.replace(/^[&?]/,"")),QuizSettings.ResultsPageUrlFull=baseUrl+"?"+queryParams,logger("applyCustomResultPageConfig: Rebuilt ResultsPageUrlFull = "+QuizSettings.ResultsPageUrlFull),(customPage.ItemsPerRow||customPage.itemsPerRow)&&(QuizSettings.ItemsPerRow=customPage.ItemsPerRow||customPage.itemsPerRow),void 0!==customPage.HideOutOfStock&&(QuizSettings.HideOutOfStock=void 0!==customPage.HideOutOfStock?customPage.HideOutOfStock:customPage.hideOutOfStock),(customPage.ResultsOutOfStockButtonText||customPage.resultsOutOfStockButtonText)&&(QuizSettings.ResultsOutOfStockButtonText=customPage.ResultsOutOfStockButtonText||customPage.resultsOutOfStockButtonText),void 0!==customPage.ResultRedirectDelay&&(QuizSettings.ResultRedirectDelay=void 0!==customPage.ResultRedirectDelay?customPage.ResultRedirectDelay:customPage.resultRedirectDelay)}}catch(e){logger("applyCustomResultPageConfig: Error: "+e.message)}}function printResultPageOutput(){try{if(!(QuizSettings&&QuizSettings.ResultPagesLimit&&QuizSettings.ResultPagesLimit>0))return void logger("printResultPageOutput: Multiple Result Pages feature is not enabled (ResultPagesLimit="+(QuizSettings&&QuizSettings.ResultPagesLimit||0)+")");if(!Outcome)return void logger("printResultPageOutput: No outcome has been determined yet. Run the quiz to see result page information.");var resultPageId=Outcome.resultPageId||"default",resultPageType="Default Results Page",resultPageName="Default";if("default"!==resultPageId&&QuizSettings.ResultPages&&Array.isArray(QuizSettings.ResultPages)){var customPage=QuizSettings.ResultPages.find((function(page){return page.Id===resultPageId||page.id===resultPageId}));if(customPage){var pageType=customPage.ResultsPageType||customPage.resultsPageType;resultPageType={1:"External URL",Redirect_To_External_URL:"External URL",2:"Extra Page",3:"Digioh Results Page",Digioh_Results_Page:"Digioh Results Page"}[pageType]||pageType,resultPageName=customPage.Name||customPage.name||resultPageId}}var outputLines=[];outputLines.push("=".repeat(60)),outputLines.push("RESULT PAGE INFO - Multiple Result Pages Feature"),outputLines.push("=".repeat(60)),outputLines.push("Winning Outcome ID: "+(Outcome.id||"N/A")),outputLines.push("Winning Outcome Name: "+(Outcome.name||"N/A")),outputLines.push("-".repeat(60)),outputLines.push("Result Page ID: "+resultPageId),outputLines.push("Result Page Type: "+resultPageType),outputLines.push("Result Page Name: "+resultPageName),outputLines.push("=".repeat(60)),logger(outputLines.join("\n"))}catch(e){}}function redirectToQuizResults(shopifyRedirectURL){try{let windowContext=DAPI.DIGIOH_USE_FRAME_COMPATIBILITY?DAPI.DIGIOH_TOP_WINDOW_CONTEXT:window.top;"string"==typeof shopifyRedirectURL&&shopifyRedirectURL.indexOf("http")>=0?windowContext.location.href=shopifyRedirectURL:windowContext.location.href=getQuizResultsURL()}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),boxLogError(e,"redirectToQuizResults")}}function getQuizResultsURL(){try{applyCustomResultPageConfig(),QuizSettings&&QuizSettings.ResultPagesLimit&&QuizSettings.ResultPagesLimit>0&&printResultPageOutput();var url=QuizSettings.ResultsPageUrlFull;if(!url)return logger("ResultsPageUrlFull is empty"),"";var obj={},results=getResults(),maxResults=getMaxResults();results.length<maxResults&&(maxResults=results.length),url=(url=(url=url.replace("[USER_ID]",DAPI.getAccountId())).replace("[BOX_ID]",boxapi.getId())).replace("[CACHE_BREAKER]",DAPI.getCacheBreaker());var resultsProductType="products";"Digioh_Results_Page"==QuizSettings.ResultsPageType&&"Shopify"==QuizSettings.StoreType?0==QuizSettings.ShopifyProductsType.indexOf("VARIANTS")&&(resultsProductType="variants"):url.indexOf("&variants=")>0?resultsProductType="variants":url.indexOf("&collections=")>0&&(resultsProductType="collections");for(var cnt=0,i=0;i<maxResults&&!(results.length<=i);i++){var itemId="";results[i].hasOwnProperty("id")&&results[i].id&&(itemId=results[i].id);var itemProductType="products";results[i].hasOwnProperty("type")&&results[i].type&&(itemProductType=results[i].type.toString().toLowerCase().trim()+"s");var itemAvailable=!0;if(results[i].hasOwnProperty("available")&&"false"==results[i].available.toString().toLowerCase().trim()&&(itemAvailable=!1),!QuizSettings.HideOutOfStock||itemAvailable)if(resultsProductType===itemProductType){if(cnt++,results[i].hasOwnProperty("id")&&results[i].id?obj["id_"+cnt]=results[i].id:obj["id_"+cnt]="",results[i].hasOwnProperty("handle")&&results[i].handle?obj["handle_"+cnt]=results[i].handle:obj["handle_"+cnt]="",results[i].hasOwnProperty("sku")&&results[i].sku?obj["sku_"+cnt]=results[i].sku:obj["sku_"+cnt]="",results[i].hasOwnProperty("type")&&results[i].type?(("Product"==results[i].type||"Variant"==results[i].type)&&results[i].hasOwnProperty("productid")&&results[i].productid?obj["product_id_"+cnt]=results[i].productid:obj["product_id_"+cnt]="","Variant"==results[i].type&&results[i].hasOwnProperty("id")&&results[i].id?obj["variant_id_"+cnt]=results[i].id:obj["variant_id_"+cnt]=""):(obj["product_id_"+cnt]="",obj["variant_id_"+cnt]=""),cnt>=maxResults)break}else logger("getQuizResultsURL: result "+i+" is of type "+itemProductType+", but we need only "+resultsProductType+", skipping..");else logger("getQuizResultsURL: product "+itemId+" is Out of Stock, skipping result "+i)}logger("getQuizResultsURL (obj):"),logger(obj);var handles=[],variant_ids=[],ids=[],product_ids=[],skus=[];for(i=1;i<=maxResults;i++)obj.hasOwnProperty("handle_"+i)&&obj["handle_"+i]&&handles.push(obj["handle_"+i]),obj.hasOwnProperty("variant_id_"+i)&&obj["variant_id_"+i]&&variant_ids.push(obj["variant_id_"+i]),obj.hasOwnProperty("id_"+i)&&obj["id_"+i]&&ids.push(obj["id_"+i]),obj.hasOwnProperty("product_id_"+i)&&obj["product_id_"+i]&&product_ids.push(obj["product_id_"+i]),obj.hasOwnProperty("sku_"+i)&&obj["sku_"+i]&&skus.push(obj["sku_"+i]);url=(url=(url=(url=(url=url.replace("[HANDLES]",handles.join(","))).replace("[IDS]",ids.join(","))).replace("[PRODUCT_IDS]",product_ids.join(","))).replace("[VARIANT_IDS]",variant_ids.join(","))).replace("[SKUS]",skus.join(","));let windowContext=DAPI.DIGIOH_USE_FRAME_COMPATIBILITY?DAPI.DIGIOH_TOP_WINDOW_CONTEXT:window.top;if(windowContext.location.href.indexOf("?")>0){var passThruQS=windowContext.location.href.split("?")[1];passThruQS.length>0&&passThruQS.length<1500&&(url=url+"&"+passThruQS)}url=replaceMergeTagsPRQ(url,!0),url+="&type="+(new Date).getTime();var isMultiResultPagesEnabled=QuizSettings&&QuizSettings.ResultPagesLimit&&QuizSettings.ResultPagesLimit>0;return isMultiResultPagesEnabled&&Outcome&&"object"==typeof Outcome&&Outcome.hasOwnProperty("resultPageId")&&Outcome.resultPageId?"default"!==Outcome.resultPageId?(url+="&result_page_id="+encodeURIComponent(Outcome.resultPageId),logger("getQuizResultsURL: Adding result_page_id="+Outcome.resultPageId+" (feature enabled, limit="+QuizSettings.ResultPagesLimit+")")):logger('getQuizResultsURL: resultPageId is "default" - using default result page (no parameter needed)'):logger(isMultiResultPagesEnabled?"getQuizResultsURL: No result_page_id - using default result page. Outcome="+(Outcome?JSON.stringify({id:Outcome.id,name:Outcome.name,hasResultPageId:Outcome.hasOwnProperty("resultPageId")}):"false/null"):"getQuizResultsURL: Multiple Result Pages feature is disabled (ResultPagesLimit="+(QuizSettings.ResultPagesLimit||0)+") - using default result page"),logger("getQuizResultsURL (w/domain/path): "+url),url}catch(e){return DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: module_digioh_.js -- "+e.message,console.error(e)),boxLogError(e,"getQuizResultsURL"),QuizSettings.ResultsPageUrlFull}}function displayQuizLocalResultsPage(overrideURL,preserveResultsPage=!0){DAPI.suppressBreakpoints=!0;var localResultsURL="";if(localResultsURL=overrideURL||DIGIOH_PRQ.getQuizResultsURL(),preserveResultsPage&&localStorage.setItem(`digioh_local_quiz_results_${boxapi.getId()}`,LBOX.LZString.compressToBase64(localResultsURL)),settings.hasOwnProperty("thxlayout")&&loadExternalFonts("thx",!0),settings.hasOwnProperty("extra_pages")&&settings.extra_pages)for(var x=1;x<=settings.extra_pages.length;x++)settings.extra_pages[x-1]&&1==settings.extra_pages[x-1].on&&settings.hasOwnProperty("ep"+x+"layout")&&loadExternalFonts("ep"+x,!0);let windowContext=DAPI.DIGIOH_USE_FRAME_COMPATIBILITY?DAPI.DIGIOH_TOP_WINDOW_CONTEXT:window.parent;try{const hst=windowContext.location.host;if(/^localhost:/.test(hst)?localResultsURL=localResultsURL.replace("hosted.lightboxcdn.com","localhost:7074"):/^account-dev\.digioh\.com$/.test(hst)?localResultsURL=localResultsURL.replace("hosted.lightboxcdn.com","hosted-dev.lightboxcdn.com"):/^account\.digioh\.com$/.test(hst)||/^hosted\.digioh\.com$/.test(hst)||!/^.*\.digioh\.com$/.test(hst)?(/^digioh-managed-store\.myshopify\.com$/.test(hst)||windowContext.location.href.indexOf("digioh_beta")>0)&&(localResultsURL=localResultsURL.replace("hosted.lightboxcdn.com","hosted-beta.lightboxcdn.com")):localResultsURL=localResultsURL.replace("hosted.lightboxcdn.com","hosted-beta.lightboxcdn.com"),/^.*\.digioh\.com$/.test(hst)){const ref=windowContext.document.referrer;ref&&ref.indexOf("digioh.com")>0&&ref.indexOf("account.digioh.com")<0&&(localResultsURL=localResultsURL.replace("hosted.lightboxcdn.com","hosted-beta.lightboxcdn.com"))}}catch(e){}localResultsURL=localResultsURL.replace("/Quiz/ShopifyResults","/Quiz/Results");var localResultsJSUrl=localResultsURL.replace(/^(https?:\/\/[^\/]+).*$/,"$1")+"/js/digioh_module_quiz_results.js?cb="+DAPI.getCacheBreaker(),jsContents="",pageContents="",jsPull=$.ajax({url:localResultsJSUrl,crossDomain:!0,dataType:"text"}).done((function(data){jsContents=data})),pagePull=$.ajax({url:localResultsURL,crossDomain:!0,beforeSend:function(xhr){xhr.setRequestHeader("X-Requested-With","XmlHttpRequest")}}).done((function(data){pageContents=data}));$.when(jsPull,pagePull).done((function(){$("body").html(pageContents),eval(jsContents)})),setInterval(resizeBoxOnDisplayQuizLocalResultsPage,200)}function resizeBoxOnDisplayQuizLocalResultsPage(){var outerHeight=LBOX.JQUERY_DIGIOH("iframe.box-"+boxapi.getId()).parent().height(),innerHeight=$("#results_page_content").height();(innerHeight>outerHeight||innerHeight<outerHeight&&outerHeight-innerHeight>100)&&(LBOX.JQUERY_DIGIOH("iframe.box-"+boxapi.getId()).parent().css({height:innerHeight+"px","max-height":innerHeight+"px","min-height":innerHeight+"px"}),LBOX.JQUERY_DIGIOH("iframe.box-"+boxapi.getId()).css({height:innerHeight+"px","max-height":innerHeight+"px","min-height":innerHeight+"px"}))}function isResultsPreserved(page){var preserveResults=!0;if(page){var results_pref=DUTIL.getPlainPref(page);if(settings.hasOwnProperty(results_pref+"layout")&&settings[results_pref+"layout"].hasOwnProperty("prq_preserve_results_page")){var preserve_value=settings[results_pref+"layout"].prq_preserve_results_page;"NO"!==preserve_value&&(preserve_value="YES"),preserveResults="YES"===preserve_value}}return preserveResults}function tryShowPreservedResultsPage(){try{var prq_results=localStorage.getItem("prq_results"),digioh_local_quiz_results=localStorage.getItem(`digioh_local_quiz_results_${boxapi.getId()}`)||DAPI.UTIL.getUrlParam("digioh_local_quiz_results");let preserveResults=!0;try{preserveResults=isResultsPreserved(void 0!==prq_results&&prq_results?JSON.parse(prq_results)?.page:void 0)}catch{}if(!preserveResults)return!1;if("Digioh_Results_Page"==QuizSettings.ResultsPageType){if(digioh_local_quiz_results&&digioh_local_quiz_results.length>10){var url=LBOX.LZString.decompressFromBase64(digioh_local_quiz_results);if(url&&0==url.indexOf("http")){if((url=(url=url.replace("[USER_ID]",DAPI.getAccountId())).replace("[BOX_ID]",boxapi.getId())).indexOf("[CACHE_BREAKER]")>0)url=url.replace("[CACHE_BREAKER]",DAPI.getCacheBreaker());else{for(var url_parts=url.split("&"),i=0;i<url_parts.length;i++)0==url_parts[i].indexOf("cb=")&&(url_parts[i]="cb="+DAPI.getCacheBreaker());url=url_parts.join("&")}("Shopify"!==QuizSettings.StoreType||"Shopify"==QuizSettings.StoreType&&0==QuizSettings.ShopifyProductsType.indexOf("VARIANTS")&&url.indexOf("&variants=")>0||"Shopify"==QuizSettings.StoreType&&QuizSettings.ShopifyProductsType.indexOf("VARIANTS")<0&&url.indexOf("&variants=")<0)&&(logger("tryShowPreservedResultsPage - digioh_local_quiz_results: "+url),trackPrqDisable(),displayQuizLocalResultsPage(url))}}}else prq_results&&(prq_results=JSON.parse(prq_results))&&prq_results.hasOwnProperty("page")&&prq_results.hasOwnProperty("answers")&&isResultsPagePRQ(prq_results.page)&&settings.hasOwnProperty(prq_results.page+"layout")&&settings[prq_results.page+"layout"].hasOwnProperty("prq_preserve_results_page")&&settings[prq_results.page+"layout"].prq_preserve_results_page&&(setPageAnswers(JSON.parse(JSON.stringify(prq_results.answers))),prq_results.hasOwnProperty("pageview_sequence")&&setPageViewSequence(JSON.parse(JSON.stringify(prq_results.pageview_sequence))),trackPrqDisable(),boxapi.showPage(prq_results.page))}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),boxLogError(e,"tryShowPreservedResultsPage")}}function getCellValueByProductId(id,headerName){try{if(PRQObjects.hasOwnProperty(id)&&PRQObjects[id].hasOwnProperty(headerName.toLowerCase().replace("prq:","")))return PRQObjects[id][headerName.toLowerCase().replace("prq:","")]}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),boxLogError(e,"getCellValueByProductId")}return""}function checkCustomFieldConditionsPRQ(prq_operator,prq_value,val){try{if(!prq_operator)return!0;if("equals"==prq_operator)return""===prq_value||prq_value==val;if("equals_any"==prq_operator){(parts=prq_value.split("|")).length<2&&(parts=prq_value.split(","));for(var p=0;p<parts.length;p++)if(parts[p]==val)return!0;return!1}if("not_equals"==prq_operator)return prq_value!=val;if("not_equals_any"==prq_operator){(parts=prq_value.split("|")).length<2&&(parts=prq_value.split(","));for(p=0;p<parts.length;p++)if(parts[p]==val)return!1;return!0}if("contains"==prq_operator)return""===prq_value||val.indexOf(prq_value)>=0;if("contains_any"==prq_operator){(parts=prq_value.split("|")).length<2&&(parts=prq_value.split(","));for(p=0;p<parts.length;p++)if(val.indexOf(parts[p])>=0)return!0;return!1}if("not_contains"==prq_operator)return val.indexOf(prq_value)<0;if("not_contains_any"==prq_operator){(parts=prq_value.split("|")).length<2&&(parts=prq_value.split(","));for(p=0;p<parts.length;p++)if(val.indexOf(parts[p])>=0)return!1;return!0}if("starts_with"==prq_operator)return val.startsWith(prq_value);if("starts_with_any"==prq_operator){(parts=prq_value.split("|")).length<2&&(parts=prq_value.split(","));for(p=0;p<parts.length;p++)if(val.startsWith(parts[p]))return!0;return!1}if("not_starts_with"==prq_operator)return!val.startsWith(prq_value);if("not_starts_with_any"==prq_operator){(parts=prq_value.split("|")).length<2&&(parts=prq_value.split(","));for(p=0;p<parts.length;p++)if(val.startsWith(parts[p]))return!1;return!0}if("ends_with"==prq_operator)return val.endsWith(prq_value);if("ends_with_any"==prq_operator){(parts=prq_value.split("|")).length<2&&(parts=prq_value.split(","));for(p=0;p<parts.length;p++)if(val.endsWith(parts[p]))return!0;return!1}if("not_ends_with"==prq_operator)return!val.endsWith(prq_value);if("not_ends_with_any"==prq_operator){(parts=prq_value.split("|")).length<2&&(parts=prq_value.split(","));for(p=0;p<parts.length;p++)if(val.endsWith(parts[p]))return!1;return!0}if("greater_than"==prq_operator)return parseFloat(val)>parseFloat(prq_value);if("less_than"==prq_operator)return parseFloat(val)<parseFloat(prq_value);if("in_range"==prq_operator){var parts=[];if(prq_value.indexOf("-")>0?parts=prq_value.split("-"):prq_value.indexOf(",")>0&&(parts=prq_value.split(",")),parts[0].trim().length>0&&parts[1].trim().length>0)return parseFloat(val)>=parseFloat(parts[0].trim())&&parseFloat(val)<=parseFloat(parts[1].trim())}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),boxLogError(e,"checkCustomFieldConditionsPRQ")}return!1}function getResultCellValuePRQ(headerName,rowRank){try{if(DATA.hasOwnProperty("results")&&DATA.results.length>=rowRank&&rowRank>0){for(var gSheetRowId=DATA.results[rowRank-1].id,headerIdIdx=0,headerNameIdx=0,rowIdx=0,foundHeaderNameMatch=!1,n=0;n<PRQHeaders.length;n++)PRQHeaders[n]==headerName&&(headerNameIdx=n,foundHeaderNameMatch=!0),"prq:id"==PRQHeaders[n].toLowerCase()&&(headerIdIdx=n);if(!foundHeaderNameMatch)return"";for(var r=1;r<PRQRows.length;r++)if(PRQRows[r][headerIdIdx]==gSheetRowId){rowIdx=r;break}return rowIdx<1?"":PRQRows[rowIdx][headerNameIdx]}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),boxLogError(e,"getResultCellValuePRQ")}return""}function buildTextPRQ(pr){try{if(pr=DUTIL.getPlainPref(pr),isValidPRQ()&&isResultsPagePRQ(pr)){logger("buildTextPRQ("+pr+")"),boxapi.mergeTagOriginalsPRQ=boxapi.mergeTagOriginalsPRQ||{buttonAttrsMergeTagOriginals:{},HTMLAttrsMergeTagOriginals:{},imageAttrsMergeTagOriginals:{},textAttrsMergeTagOriginals:{},formAttrsMergeTagOriginals:{}};for(var x=1;x<=50;x++)if(settings.hasOwnProperty(pr+"text"+x)&&settings[pr+"text"+x].display){var prop=settings[pr+"text"+x],propText=prop.text;if(boxapi.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals[pr+"text"+x]=boxapi.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals[pr+"text"+x]||{},prop.hasOwnProperty("prq_is_results_text")&&prop.prq_is_results_text&&prop.prq_results_text&&prop.prq_results_text.startsWith("PRQ:")){var headerName=prop.prq_results_text,rowRank=prop.prq_results_rank?parseInt(prop.prq_results_rank):1;logger("buildTextPRQ("+pr+") x="+x+", rowRank="+rowRank+", headerName="+headerName+", results.length="+DATA.results.length),propText=getResultCellValuePRQ(headerName,rowRank),(/<script/gi.test(propText)||/<\/script>/gi.test(propText))&&(propText=propText.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,"")),$("#"+pr+"text"+x).html(propText)}else propText.indexOf("[PRQ:")>=0&&(propText=replaceMergeTagsPRQ(propText),(/<script/gi.test(propText)||/<\/script>/gi.test(propText))&&(propText=propText.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,"")),$("#"+pr+"text"+x).html(propText));if(prop.hasOwnProperty("metadata_kvps")&&prop.metadata_kvps&&prop.metadata_kvps.length>0&&JSON.stringify(prop.metadata_kvps).indexOf("[PRQ:")>0){boxapi.mergeTagOriginalsPRQ.textAttrsMergeTagOriginals[pr+"text"+x].metadata_kvps=JSON.parse(JSON.stringify(prop.metadata_kvps));for(var i=0;i<prop.metadata_kvps.length;i++){var foundMatch=!1;prop.metadata_kvps[i].k.indexOf("[PRQ:")>=0&&(prop.metadata_kvps[i].k=replaceMergeTagsPRQ(prop.metadata_kvps[i].k),foundMatch=!0),prop.metadata_kvps[i].v.indexOf("[PRQ:")>=0&&(prop.metadata_kvps[i].v=replaceMergeTagsPRQ(prop.metadata_kvps[i].v),foundMatch=!0),foundMatch&&UTIL.trySetAttribute(pr+"text"+x,prop.metadata_kvps[i],BOX_JQUERY_DIGIOH)}}}}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),boxLogError(e,"buildTextPRQ")}}function buildImagePRQ(pr){try{if(pr=DUTIL.getPlainPref(pr),isValidPRQ()&&isResultsPagePRQ(pr)){logger("buildImagePRQ("+pr+")"),boxapi.mergeTagOriginalsPRQ=boxapi.mergeTagOriginalsPRQ||{buttonAttrsMergeTagOriginals:{},HTMLAttrsMergeTagOriginals:{},imageAttrsMergeTagOriginals:{},textAttrsMergeTagOriginals:{},formAttrsMergeTagOriginals:{}};for(var x=1;x<=50;x++)if(settings.hasOwnProperty(pr+"image"+x)&&settings[pr+"image"+x].display){var prop=settings[pr+"image"+x],propSrc=prop.src;if(boxapi.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals[pr+"image"+x]=boxapi.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals[pr+"image"+x]||{},prop.hasOwnProperty("prq_is_results_image")&&prop.prq_is_results_image&&prop.prq_results_src&&prop.prq_results_src.startsWith("PRQ:")){var headerName=prop.prq_results_src,rowRank=prop.prq_results_rank?parseInt(prop.prq_results_rank):1;propSrc=getResultCellValuePRQ(headerName,rowRank),logger("buildImagePRQ("+pr+") x="+x+", rowRank="+rowRank+", headerName="+headerName+", result="+propSrc),propSrc&&propSrc.startsWith("http")&&$("#"+pr+"image"+x).attr("src",propSrc)}if(prop.hasOwnProperty("metadata_kvps")&&prop.metadata_kvps&&prop.metadata_kvps.length>0&&JSON.stringify(prop.metadata_kvps).indexOf("[PRQ:")>0){boxapi.mergeTagOriginalsPRQ.imageAttrsMergeTagOriginals[pr+"image"+x].metadata_kvps=JSON.parse(JSON.stringify(prop.metadata_kvps));for(var i=0;i<prop.metadata_kvps.length;i++){var foundMatch=!1;prop.metadata_kvps[i].k.indexOf("[PRQ:")>=0&&(prop.metadata_kvps[i].k=replaceMergeTagsPRQ(prop.metadata_kvps[i].k),foundMatch=!0),prop.metadata_kvps[i].v.indexOf("[PRQ:")>=0&&(prop.metadata_kvps[i].v=replaceMergeTagsPRQ(prop.metadata_kvps[i].v),foundMatch=!0),foundMatch&&UTIL.trySetAttribute(pr+"image"+x,prop.metadata_kvps[i],BOX_JQUERY_DIGIOH)}}}}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),boxLogError(e,"buildImagePRQ")}}function buildHTMLPRQ(pr){try{if(pr=DUTIL.getPlainPref(pr),isValidPRQ()&&isResultsPagePRQ(pr)){logger("buildHTMLPRQ("+pr+")"),boxapi.mergeTagOriginalsPRQ=boxapi.mergeTagOriginalsPRQ||{buttonAttrsMergeTagOriginals:{},HTMLAttrsMergeTagOriginals:{},imageAttrsMergeTagOriginals:{},textAttrsMergeTagOriginals:{},formAttrsMergeTagOriginals:{}};for(var x=1;x<=50;x++)if(settings.hasOwnProperty(pr+"html"+x)&&settings[pr+"html"+x].display){var prop=settings[pr+"html"+x],propHTML=prop.html;if(boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[pr+"html"+x]=boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[pr+"html"+x]||{},prop.hasOwnProperty("prq_is_results_html")&&prop.prq_is_results_html&&propHTML.indexOf("[PRQ:")>=0&&(boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[pr+"html"+x].html=propHTML,propHTML=replaceMergeTagsPRQ(propHTML),$("#"+pr+"html"+x).html(propHTML)),prop.hasOwnProperty("metadata_kvps")&&prop.metadata_kvps&&prop.metadata_kvps.length>0&&JSON.stringify(prop.metadata_kvps).indexOf("[PRQ:")>0){boxapi.mergeTagOriginalsPRQ.HTMLAttrsMergeTagOriginals[pr+"html"+x].metadata_kvps=JSON.parse(JSON.stringify(prop.metadata_kvps));for(var i=0;i<prop.metadata_kvps.length;i++){var foundMatch=!1;prop.metadata_kvps[i].k.indexOf("[PRQ:")>=0&&(prop.metadata_kvps[i].k=replaceMergeTagsPRQ(prop.metadata_kvps[i].k),foundMatch=!0),prop.metadata_kvps[i].v.indexOf("[PRQ:")>=0&&(prop.metadata_kvps[i].v=replaceMergeTagsPRQ(prop.metadata_kvps[i].v),foundMatch=!0),foundMatch&&UTIL.trySetAttribute(pr+"html"+x,prop.metadata_kvps[i],BOX_JQUERY_DIGIOH)}}}}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),boxLogError(e,"buildHTMLPRQ")}}function buildButtonPRQ(pr){try{if(pr=DUTIL.getPlainPref(pr),isValidPRQ()&&isResultsPagePRQ(pr)){logger("buildButtonPRQ("+pr+")"),boxapi.mergeTagOriginalsPRQ=boxapi.mergeTagOriginalsPRQ||{buttonAttrsMergeTagOriginals:{},HTMLAttrsMergeTagOriginals:{},imageAttrsMergeTagOriginals:{},textAttrsMergeTagOriginals:{},formAttrsMergeTagOriginals:{}};for(var x=1;x<=50;x++)if(settings.hasOwnProperty(pr+"button"+x)&&settings[pr+"button"+x].display){var prop=settings[pr+"button"+x];if(boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[pr+"button"+x]=boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[pr+"button"+x]||{},prop.hasOwnProperty("prq_is_results_button")&&prop.prq_is_results_button){var buttonText=prop.text;buttonText.indexOf("[PRQ:")>=0&&(boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[pr+"button"+x].text=buttonText,buttonText=replaceMergeTagsPRQ(buttonText),$("#"+pr+"button"+x).html(buttonText));var buttonRedirectUrl=prop.url;buttonRedirectUrl.indexOf("[PRQ:")>=0&&(boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[pr+"button"+x].url=buttonRedirectUrl,buttonRedirectUrl=replaceMergeTagsPRQ(buttonRedirectUrl),settings[pr+"button"+x].url=buttonRedirectUrl);var buttonSelectedValue=prop.selected_value;buttonSelectedValue.indexOf("[PRQ:")>=0&&(boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[pr+"button"+x].selected_value=buttonSelectedValue,buttonSelectedValue=replaceMergeTagsPRQ(buttonSelectedValue),settings[pr+"button"+x].selected_value=buttonSelectedValue)}if(prop.hasOwnProperty("metadata_kvps")&&prop.metadata_kvps&&prop.metadata_kvps.length>0&&JSON.stringify(prop.metadata_kvps).indexOf("[PRQ:")>0){boxapi.mergeTagOriginalsPRQ.buttonAttrsMergeTagOriginals[pr+"button"+x].metadata_kvps=JSON.parse(JSON.stringify(prop.metadata_kvps));for(var i=0;i<prop.metadata_kvps.length;i++){var foundMatch=!1;prop.metadata_kvps[i].k.indexOf("[PRQ:")>=0&&(prop.metadata_kvps[i].k=replaceMergeTagsPRQ(prop.metadata_kvps[i].k),foundMatch=!0),prop.metadata_kvps[i].v.indexOf("[PRQ:")>=0&&(prop.metadata_kvps[i].v=replaceMergeTagsPRQ(prop.metadata_kvps[i].v),foundMatch=!0),foundMatch&&UTIL.trySetAttribute(pr+"button"+x,prop.metadata_kvps[i],BOX_JQUERY_DIGIOH)}}}}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),boxLogError(e,"buildButtonPRQ")}}function buildFormPRQ(pr){try{if(pr=DUTIL.getPlainPref(pr),isValidPRQ()&&isResultsPagePRQ(pr)&&(pr=DUTIL.getUnfriendlyPagePrefix(pr),logger("buildFormPRQ("+pr+")"),boxapi.mergeTagOriginalsPRQ=boxapi.mergeTagOriginalsPRQ||{buttonAttrsMergeTagOriginals:{},HTMLAttrsMergeTagOriginals:{},imageAttrsMergeTagOriginals:{},textAttrsMergeTagOriginals:{},formAttrsMergeTagOriginals:{}},settings.hasOwnProperty(pr+"form")&&settings[pr+"form"].display)){var prop=settings[pr+"form"];prop.hasOwnProperty("redirect_url")&&prop.redirect_url&&prop.redirect_url.indexOf("[PRQ:")>=0&&(boxapi.mergeTagOriginalsPRQ.formAttrsMergeTagOriginals[pr+"form"]=boxapi.mergeTagOriginalsPRQ.formAttrsMergeTagOriginals[pr+"form"]||{},boxapi.mergeTagOriginalsPRQ.formAttrsMergeTagOriginals[pr+"form"].redirect_url=prop.redirect_url,prop.redirect_url=replaceMergeTagsPRQ(prop.redirect_url))}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),boxLogError(e,"buildFormPRQ")}}function isResultsPagePRQ(pr){return pr=DUTIL.getPlainPref(pr),USE&&IsBoxPRQ&&settings.hasOwnProperty(pr+"layout")&&settings[pr+"layout"].hasOwnProperty("prq_is_results_page")&&settings[pr+"layout"].prq_is_results_page}function isValidPRQ(){return USE&&IsBoxPRQ&&PRQHeaders.length>0&&PRQRows.length>1}function isBoxPRQ(){return IsBoxPRQ}function replaceMergeTagsPRQ(val,urlEncode){try{void 0===urlEncode&&(urlEncode=!1);const dn=function(val,encodeIt){return"null"==val||"undefined"==val?"":!0===encodeIt?encodeURIComponent(val||""):val||""};let cfMatches=(val=(val=(val=(val=(val=(val=val.replace(/\[EMAIL\]/gi,dn(DAPI.getDataLayerValue("email"),urlEncode))).replace(/\[PHONE\]/gi,dn(DAPI.getDataLayerValue("phone"),urlEncode))).replace(/\[NAME\]/gi,dn(DAPI.getDataLayerValue("name"),urlEncode))).replace(/\[FIRST_NAME\]/gi,dn(DAPI.getDataLayerValue("first_name"),urlEncode))).replace(/\[LAST_NAME\]/gi,dn(DAPI.getDataLayerValue("last_name"),urlEncode))).replace(/\[OPT_IN\]/gi,dn(DAPI.getDataLayerValue("opt_in"),urlEncode))).matchAll(/\[CUSTOM_?(\d\d?)\]/gi);for(let match of cfMatches)val=val.replace(match[0],dn(DAPI.getDataLayerValue("custom_"+match[1]),urlEncode));let ecfMatches=val.matchAll(/\[EP?(\d\d?)\_CUSTOM_?(\d\d?)\]/gi);for(let match of ecfMatches)val=val.replace(match[0],dn(DAPI.getDataLayerValue("ep"+match[1]+"_custom_"+match[2]),urlEncode));let resultsMatches=val.matchAll(/\[PRQ:([\w\s-]+):(\d\d?)\]/gi);for(let match of resultsMatches){var resVal=getResultCellValuePRQ("PRQ:"+match[1],parseInt(match[2]));val=!0===urlEncode?val.replace(match[0],encodeURIComponent(resVal)):val.replace(match[0],resVal)}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),boxLogError(e,"replaceMergeTagsPRQ")}return val}function getResults(){return DATA.results}function setResults(obj){DATA.results=obj}function buildLightweightQuestionConfig(quizQuestions){try{var lightweightConfig={};for(var questionId in quizQuestions)quizQuestions.hasOwnProperty(questionId)&&(lightweightConfig[questionId]={data_key:quizQuestions[questionId].data_key||"",integration_enabled:quizQuestions[questionId].integration_enabled||!1,data_type:quizQuestions[questionId].data_type||"string"});return lightweightConfig}catch(e){return logger("DIGIOH_PRQ.buildLightweightQuestionConfig() error: "+e.message),{}}}function convertToDataType(value,type){if(!type||"string"===type)return value.toString();switch(type){case"int":var num=parseInt(value,10);return isNaN(num)?0:num;case"float":num=parseFloat(value);return isNaN(num)?0:num;case"bool":if("boolean"==typeof value)return value;var str=value.toString().toLowerCase();return"true"===str||"1"===str||"yes"===str;case"array":return value;default:return value.toString()}}function getSubmissionData(){var maxResults=getMaxResults(),prqData=JSON.parse(JSON.stringify(DATA));prqData.results.length>maxResults&&(prqData.results.length=maxResults);let returnObj={prq:prqData};if(QuizQuestions){for(var answers=[],answersObj={},i=0;i<PageAnswers.length;i++)for(var pref=DUTIL.getPlainPref(PageAnswers[i].page),j=0;j<PageAnswers[i].entries.length;j++)if("string"==typeof PageAnswers[i].entries[j].value&&"button"==PageAnswers[i].entries[j].type){var answerButton=`${pref}button${PageAnswers[i].entries[j].num}`,questionId=getQuestionIdFromMapping(answerButton),answerId=getAnswerIdFromMapping(answerButton);if(!UTIL.stringOrArrayContains(answers,answerButton)&&settings.hasOwnProperty(answerButton)&&questionId&&answerId&&QuizQuestions.hasOwnProperty(questionId)&&QuizQuestions[questionId].hasOwnProperty("answers")&&QuizQuestions[questionId].answers.hasOwnProperty(answerId)){var dataKey=QuizQuestions[questionId].data_key,dataType=QuizQuestions[questionId].data_type||"string",answerObj=QuizQuestions[questionId].answers[answerId];if(!answerObj)continue;var dataVal=answerObj.hasOwnProperty("data_val")?answerObj.data_val:answerObj.text||PageAnswers[i].entries[j].value;"string"!=typeof dataVal&&(dataVal=dataVal.toString()),"array"!==dataType&&(dataVal=dataVal.split(",").join(""));var convertedVal=convertToDataType(dataVal,dataType);dataKey.length>0&&(answersObj.hasOwnProperty(dataKey)?"array"===dataType||Array.isArray(answersObj[dataKey])?(Array.isArray(answersObj[dataKey])||(answersObj[dataKey]=[answersObj[dataKey]]),answersObj[dataKey].push(convertedVal)):"string"==typeof answersObj[dataKey]?answersObj[dataKey]+=","+convertedVal:answersObj[dataKey]=answersObj[dataKey].toString()+","+convertedVal.toString():answersObj[dataKey]="array"===dataType?[convertedVal]:convertedVal,answers.push(answerButton))}}returnObj.quiz_data=answersObj,returnObj.quiz_questions_config=buildLightweightQuestionConfig(QuizQuestions)}return logger("DIGIOH_PRQ.getSubmissionData() ==> "+JSON.stringify(returnObj)),returnObj}function getMaxResults(){return QuizSettings.MaxResults||DEFAULT_MAX_RESULTS}function isValInDataLayer(optionalBoxId,regexpTester){try{const boxId=optionalBoxId?optionalBoxId.toString():boxapi.getId().toString(),dl=DAPI.getDataLayer(boxId)||{};for(const fieldName in dl){let val=dl[fieldName];if("string"==typeof val&&regexpTester.test(val))return!0}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),boxLogError(e,"isValInDataLayer")}return!1}function isEmailInDataLayer(optionalBoxId){return isValInDataLayer(optionalBoxId,/\w+@\w+\.\w+/)}function isPhoneInDataLayer(optionalBoxId){return isValInDataLayer(optionalBoxId,/^(\+\d{1,2}\s)?\(?\d{3}\)?[\s.-]?\d{3}[\s.-]?\d{4}$/)}let _prqTrackDisabled=!1;function trackPrqDisable(){_prqTrackDisabled=!0}function trackEvent(eventName,eventProperties={}){eventName&&(_prqTrackDisabled?logger(`PRQ Tracking Disabled: ignoring event ${eventName}`):"function"==typeof boxapi.trackEvent?boxapi.trackEvent(eventName,eventProperties):(boxapi.trackEventQueue=boxapi.trackEventQueue||[],boxapi.trackEventQueue.push({eventName:eventName,propsObj:eventProperties})))}function trackPrqPage(pageName){try{if(!IsBoxPRQ)return;const pageExtract=/^ep(\d\d?)$/;let page=boxapi.getPageTitle(pageName);page||(!pageName||pageName.indexOf("main")>=0?page="p0":pageExtract.test(pageName)?page="p"+pageName.match(pageExtract)[1].replace("_",""):pageName.indexOf("extra_page_")>=0?page="p"+pageName.replace("extra_page_",""):pageName.indexOf("thx")>=0||pageName.indexOf("thank")>=0?page="thx":(page="unknown",trackEvent("digioh_quiz_error",{error_msg:msg,error_context:"Don't know how to log page "+pageName})));const trackObj={};trackObj.digioh_box_page=page,trackObj.digioh_quiz_question=page,trackEvent("digioh_quiz_funnel",trackObj)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),boxLogError(e,"trackPrqPage")}}function trackPrqAnswer(pageName){try{if(!IsBoxPRQ)return;pageName||(pageName=CURRENT_PAGE);const trackObj={},pageTitle=boxapi.getPageTitle(pageName),pr=DUTIL.getPlainPref(pageName),thisPageAnswers=getPageAnswers().filter((pa=>pa.page==pr))[0];if(!thisPageAnswers)return;AnswersTracked[pr]=AnswersTracked[pr]||{},trackObj.digioh_box_page=pageTitle,trackObj.digioh_quiz_question=trackObj.digioh_box_page;let nextPageButtonCount=0,answerButtonCount=0;const nextPageActions=["main_page","next_page","thank_you_page","extra_page"];if(!QuizQuestions){let allButtons=Object.keys(settings).filter((key=>key.startsWith(pr+"button")));for(const button of allButtons){let buttonAction=settings[button].action.replace(/_[0-9]+$/,"");if("back"!=buttonAction)if(nextPageActions.includes(buttonAction))nextPageButtonCount++;else if("submit"==buttonAction){let unPref=DUTIL.getUnfriendlyPagePrefix(pageName),form=settings[unPref+"form"],afterSubmit=form.hasOwnProperty("after_submit")?form.after_submit:"",afterSubmitAction=afterSubmit?afterSubmit.replace(/_[0-9]+$/,""):"";nextPageActions.includes(afterSubmitAction)?nextPageButtonCount++:answerButtonCount++}else answerButtonCount++}}for(const answerEntry of thisPageAnswers.entries){if("button"==answerEntry.type){let ptn=pr+"button"+answerEntry.num,buttonAction=settings[ptn].action.replace(/_[0-9]+$/,""),buttonText=settings[ptn].text,skipTracking=!1;if(QuizQuestions){var questionId=getQuestionIdFromMapping(ptn),answerId=getAnswerIdFromMapping(ptn);skipTracking=!questionId||!answerId}else"skip"==buttonText.toLowerCase().trim()?skipTracking=!0:answerButtonCount>=2&&(skipTracking=(nextPageActions.includes(buttonAction)||"submit"==buttonAction)&&nextPageButtonCount<answerButtonCount);if(skipTracking){logger("DIGIOH_PRQ.trackPrqAnswer: skipping "+ptn+" because it is not a quiz answer button.");continue}}if("custom"==answerEntry.type){if(thisPageAnswers.entries.filter((otherEntry=>otherEntry!==answerEntry&&otherEntry.src==answerEntry.src&&"button"==otherEntry.type)).length)continue}const answerVal=answerEntry.value;answerVal.length>0&&!AnswersTracked[pr][answerVal]&&(AnswersTracked[pr][answerVal]=!0,answerVal.indexOf("<")>=0&&answerVal.indexOf(">")>=0?trackObj.digioh_quiz_answer=UTIL.extractTextFromHTML(answerVal,!0):trackObj.digioh_quiz_answer=answerVal,trackEvent("digioh_quiz_answer",trackObj))}}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),boxLogError(e,"gaAnswer")}}function trackPrqResult(pageName){try{if(!IsBoxPRQ)return;let trackObj={};for(var results=getResults(),x=0;x<results.length;x++){if(x>=MAX_TRACK_BURST_EVENTS){logger("Truncating track log to "+MAX_TRACK_BURST_EVENTS+" events to avoid suppression");break}var resultText="",result=results[x];result.hasOwnProperty("id")&&(resultText+="("+result.id+") "),result.hasOwnProperty("name")?resultText+=result.name:result.hasOwnProperty("product")?resultText+=result.product:result.hasOwnProperty("sku")&&(resultText+=result.sku),trackObj["digioh_quiz_result_"+(x+1)]=resultText}trackEvent("digioh_quiz_result",trackObj)}catch(e){DLOG.tryShowError(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),boxLogError(e,"gaResult")}}function getOutcome(skipLocalStorage){if(!1===Outcome&&isOutcomesLogicMode()&&(void 0===skipLocalStorage||!skipLocalStorage)){var dataLayer=localStorage.getItem("prq_form_data");if(dataLayer&&(dataLayer=JSON.parse(LBOX.LZString.decompressFromBase64(dataLayer)))&&dataLayer.hasOwnProperty(boxapi.getId().toString())&&dataLayer[boxapi.getId().toString()].hasOwnProperty("outcome"))return dataLayer[boxapi.getId().toString()].outcome;logger("DIGIOH_PRQ.getOutcome: Outcome has not been set, Outcomes logic has not yet run.")}return Outcome}return{USE:USE,HasResultsLoaded:HasResultsLoaded,getQuizQuestions:getQuizQuestions,loadProductData:loadProductData,isBoxPRQ:isBoxPRQ,calcResultsPRQ:calcResultsPRQ,calcOutcomesPRQ:calcOutcomesPRQ,isOutcomesLogicMode:isOutcomesLogicMode,getOutcome:getOutcome,getQuizResultsURL:getQuizResultsURL,displayQuizLocalResultsPage:displayQuizLocalResultsPage,redirectToQuizResults:redirectToQuizResults,getResultCellValuePRQ:getResultCellValuePRQ,replaceMergeTagsPRQ:replaceMergeTagsPRQ,buildTextPRQ:buildTextPRQ,buildImagePRQ:buildImagePRQ,buildHTMLPRQ:buildHTMLPRQ,buildButtonPRQ:buildButtonPRQ,buildFormPRQ:buildFormPRQ,isResultsPagePRQ:isResultsPagePRQ,getResults:getResults,setResults:setResults,getSubmissionData:getSubmissionData,tryShowPreservedResultsPage:tryShowPreservedResultsPage,checkRequiredAnswersPRQ:checkRequiredAnswersPRQ,isResultsPreserved:isResultsPreserved,trackPrqPage:trackPrqPage,trackPrqAnswer:trackPrqAnswer,trackPrqResult:trackPrqResult,printResultPageOutput:printResultPageOutput,init:init}}"undefined"!=typeof module&&void 0!==module.exports&&(module.exports={createDigiohPrqModule:createDigiohPrqModule});
const DIGIOH_PRQ=createDigiohPrqModule({DAPI:DAPI,UTIL:UTIL,DUTIL:DUTIL,DLOG:DLOG,WINDOW_JQUERY_DIGIOH:LBOX.JQUERY_DIGIOH,BOX_JQUERY_DIGIOH:$,boxapi:boxapi,getEffectsProp:getEffectsProp,existsEffectsProp:existsEffectsProp,getPageAnswers:getPageAnswers,setPageAnswers:setPageAnswers,setPageViewSequence:setPageViewSequence,boxLogError:BOX_CUSTOM_JS.logError,quizPromises:quizPromises});
function addSdkBoxapiModule(boxapi,dependencies){const DAPI=dependencies.DAPI||{},DUTIL=dependencies.DUTIL||{},BOX_CUSTOM_JS=dependencies.BOX_CUSTOM_JS||{},STANDARD_OBJ=dependencies.STANDARD_OBJ||{},DIGIOH_PRQ=dependencies.DIGIOH_PRQ||{},DLOG=dependencies.DLOG||{},notImplemented=function(fName){return function(){throw new Error("Dependency function "+fName+" not implemented")}},getCurrentPage=dependencies.getCurrentPage||notImplemented("getCurrentPage"),changePages=dependencies.changePages||notImplemented("changePages"),getSettings=dependencies.getSettings||notImplemented("getSettings"),processSubmitObj=dependencies.processSubmitObj||notImplemented("processSubmitObj"),showLoading=dependencies.showLoading||notImplemented("showLoading"),hideLoading=dependencies.hideLoading||notImplemented("hideLoading"),showError=dependencies.showError||notImplemented("showError"),showSuccess=dependencies.showSuccess||notImplemented("showSuccess"),showWarning=dependencies.showWarning||notImplemented("showWarning"),showInlineError=dependencies.showInlineError||notImplemented("showInlineError"),resetBox=dependencies.resetBox||notImplemented("resetBox"),resetPage=dependencies.resetPage||notImplemented("resetPage"),handleException=function(e,fName){(function(e){try{return void 0!==e&&null!=e||(e={}),DLOG.tryShowError(e)}catch(e){console.log("ERROR_LOG",e)}})(e)&&(e.message="DIGIOH_ERROR: lightbox_builder.js -- "+e.message,console.error(e)),BOX_CUSTOM_JS.logError(e,"boxapi."+fName)};function scrollHandlerPreventDefault(e){e.preventDefault()}return boxapi.getName=function(){return STANDARD_OBJ.lightbox_name},boxapi.getId=function(){return STANDARD_OBJ.lightbox_short_id},boxapi.getBoxType=function(){return DAPI.getBoxType(STANDARD_OBJ.lightbox_id)},boxapi.getBoxFrameWrapper=function(){try{return DAPI.LIGHTBOX.JQUERY_DIGIOH("#"+DAPI.LIGHTBOX.getLightboxDomId(boxapi.getGuid()))}catch(e){return handleException(e,"getBoxFrameWrapper"),null}},boxapi.getBoxJQuery=function(){return $},boxapi.getAccountMetadata=function(key){return DAPI.getAccountMetadata(key)},boxapi.getWidgetMetadata=function(key){return DAPI.getWidgetMetadata(boxapi.getId().toString(),key)},boxapi.getPageMetadata=function(pageName,key){try{const settings=getSettings();if(pageName||(pageName=getCurrentPage()),"main"===pageName&&(pageName=""),pageName=DUTIL.getPlainPref(pageName),settings.hasOwnProperty(pageName+"layout")&&"object"==typeof settings[pageName+"layout"]&&settings[pageName+"layout"].hasOwnProperty("metadata_kvps")){if("string"!=typeof key||!key)return settings[pageName+"layout"].metadata_kvps;for(var i=0;i<settings[pageName+"layout"].metadata_kvps.length;i++)if(settings[pageName+"layout"].metadata_kvps[i].k===key)return settings[pageName+"layout"].metadata_kvps[i].v}}catch(e){handleException(e,"getPageMetadata")}return null},boxapi.getFieldMetadata=function(pageName,fieldName,key){try{const settings=getSettings();if(pageName||(pageName=getCurrentPage()),"main"===pageName&&(pageName=""),!fieldName)return null;if(pageName=DUTIL.getUnfriendlyPagePrefix(pageName),fieldName.indexOf("custom")>=0&&fieldName.indexOf("_")>=0&&(fieldName=fieldName.split("_").join("")),settings.hasOwnProperty(pageName+fieldName)&&"object"==typeof settings[pageName+fieldName]&&settings[pageName+fieldName].hasOwnProperty("metadata_kvps")){if("string"!=typeof key||!key)return settings[pageName+fieldName].metadata_kvps;for(var i=0;i<settings[pageName+fieldName].metadata_kvps.length;i++)if(settings[pageName+fieldName].metadata_kvps[i].k===key)return settings[pageName+fieldName].metadata_kvps[i].v}}catch(e){handleException(e,"getFieldMetadata")}return null},boxapi.getElementMetadata=function(pageName,elementName,key){try{const settings=getSettings();if(pageName||(pageName=getCurrentPage()),"main"===pageName&&(pageName=""),!elementName)return null;if(settings.hasOwnProperty(pageName+elementName)&&"object"==typeof settings[pageName+elementName]&&settings[pageName+elementName].hasOwnProperty("metadata_kvps")){if("string"!=typeof key||!key)return settings[pageName+elementName].metadata_kvps;for(var i=0;i<settings[pageName+elementName].metadata_kvps.length;i++)if(settings[pageName+elementName].metadata_kvps[i].k===key)return settings[pageName+elementName].metadata_kvps[i].v}}catch(e){handleException(e,"getElementMetadata")}return null},boxapi.showPage=function(pageName){try{getCurrentPage()!==pageName&&changePages(pageName,"",{},"api")}catch(e){handleException(e,"showPage")}},boxapi.changePages=boxapi.showPage,boxapi.changePage=boxapi.showPage,boxapi.showMainPage=function(){boxapi.showPage("main")},boxapi.showThankYouPage=function(){boxapi.showPage("thx")},boxapi.showExtraPage=function(pageNumber){boxapi.showPage("ep"+pageNumber)},boxapi.isMainPage=function(){return"main"===getCurrentPage()||""===getCurrentPage()},boxapi.isThankYouPage=function(){return"thx"===getCurrentPage()||"thx_"===getCurrentPage()},boxapi.isExtraPage=function(pageNumber){return getCurrentPage()==="ep"+pageNumber||getCurrentPage()==="ep"+pageNumber+"_"},boxapi.getPageName=function(){return(getCurrentPage()||"main").replace("_","")},boxapi.getPageTitle=function(pageName){try{const settings=getSettings();var pr=DUTIL.getPlainPref(pageName);if(settings.hasOwnProperty(pr+"layout")&&settings[pr+"layout"].hasOwnProperty("page_name")&&settings[pr+"layout"].page_name)return settings[pr+"layout"].page_name;if(""==pr)return"Main Page";if("thx"==pr)return"Thank You Page";if(pr.indexOf("ep")>=0)return"Extra Page "+pr.replace("ep","")}catch(e){handleException(e,"getPageTitle")}return""},boxapi.getPageJQuery=function(){try{return $("#"+("main"==getCurrentPage()?"":getCurrentPage())+"layout")}catch(e){handleException(e,"getPageJQuery")}return null},boxapi.processSubmit=function(obj){try{"object"==typeof obj&&null!==obj||(obj={}),processSubmitObj(obj)}catch(e){handleException(e,"processSubmit")}},boxapi.getFormData=function(){return DAPI.getFormData(STANDARD_OBJ.lightbox_short_id)},boxapi.setFormData=function(obj){try{if(!obj)return;DAPI.LIGHTBOX.hasOwnProperty("SINGLE_PAGE_FORM_DATA")&&DAPI.LIGHTBOX.SINGLE_PAGE_FORM_DATA||(DAPI.LIGHTBOX.SINGLE_PAGE_FORM_DATA={}),DAPI.LIGHTBOX.SINGLE_PAGE_FORM_DATA[STANDARD_OBJ.lightbox_short_id.toString()]=JSON.parse(JSON.stringify(obj))}catch(e){handleException(e,"setFormData")}},boxapi.showLoading=function(){showLoading(CURRENT_PAGE)},boxapi.hideLoading=function(){hideLoading()},boxapi.showError=function(errorMsg){showError(errorMsg)},boxapi.showSuccess=function(successMsg){showSuccess(successMsg)},boxapi.showWarning=function(warningMsg){showWarning(warningMsg)},boxapi.showInlineError=function(errorMsg,fieldName,obj){var pref=getCurrentPage();obj&&obj.hasOwnProperty("pageName")&&(pref=obj.pageName),showInlineError(pref,fieldName,errorMsg)},boxapi.addBoxIntegration=function(integrationId){DAPI.addBoxIntegration(STANDARD_OBJ.lightbox_id,integrationId)},boxapi.removeBoxIntegration=function(integrationId){DAPI.removeBoxIntegration(STANDARD_OBJ.lightbox_id,integrationId)},boxapi.resetBoxIntegrations=function(){DAPI.resetBoxIntegrations(STANDARD_OBJ.lightbox_id)},boxapi.trackManualRedirect=function(){DAPI.LIGHTBOX.registerAnalyticsManualRedirect(STANDARD_OBJ.lightbox_id)},boxapi.setFormFieldValue=function(fieldName,val,obj){try{const settings=getSettings();var pref=getCurrentPage();if(obj&&"object"==typeof obj&&obj.hasOwnProperty("pageName")&&(pref=obj.pageName),pref=DUTIL.getUnfriendlyPagePrefix(pref),fieldName.indexOf("custom")>=0&&fieldName.indexOf("_")>=0&&(fieldName=fieldName.split("_").join("")),"name"===fieldName){if($("#"+pref+"form_input_first_and_last_name_wrapper").length)if(val.indexOf(" ")>0){var fn=val.split(" ")[0];$("#"+pref+"form_input_first_name").val(fn),$("#"+pref+"form_input_last_name").val(val.substr(fn.length).trim())}else $("#"+pref+"form_input_first_name").val(val);$("#"+pref+"form_input_full_name_wrapper").length&&$("#"+pref+"form_input_full_name").val(val),$("#"+pref+"form_input_first_name_wrapper").length&&$("#"+pref+"form_input_first_name").val(val)}else if("opt_in"===fieldName)document.getElementById(pref+"form_input_opt_in").checked=!0===val||"1"===val||1===val||"on"===val||"yes"===val||"checked"===val||"selected"===val;else if("checkbox"===settings[pref+fieldName].field_type&&$("#"+pref+"form_input_"+fieldName+"_checkbox_wrapper").length)val==settings[pref+fieldName].checkbox.uncheckedval?document.getElementById(pref+"form_input_"+fieldName).checked=!1:val==settings[pref+fieldName].checkbox.checkedval||!0===val||"1"===val||1===val||"on"===val||"yes"===val||"checked"===val||"selected"===val?document.getElementById(pref+"form_input_"+fieldName).checked=!0:document.getElementById(pref+"form_input_"+fieldName).checked=!1;else if("radio"===settings[pref+fieldName].field_type&&$("#"+pref+"form_input_"+fieldName+"_radio_wrapper").length)$('input[name="'+pref+"form_input_"+fieldName+'"]').length&&$('input[name="'+pref+"form_input_"+fieldName+'"]').each((function(){$(this).attr("value")===val&&$(this).prop("checked",!0)}));else if("datedrop"===settings[pref+fieldName].field_type&&$("#"+pref+"form_input_"+fieldName+"_datedrop_mm").length){var parts=val.split("/");3===parts.length&&($("#"+pref+"form_input_"+fieldName+"_datedrop_mm").val(parts[0]),$("#"+pref+"form_input_"+fieldName+"_datedrop_dd").val(parts[1]),$("#"+pref+"form_input_"+fieldName+"_datedrop_yyyy").val(parts[2]))}else $("#"+pref+"form_input_"+fieldName).length&&$("#"+pref+"form_input_"+fieldName).val(val)}catch(e){handleException(e,"setFormFieldValue")}},boxapi.getFormFieldValue=function(fieldName,obj){try{const settings=getSettings();var pref=getCurrentPage();if(obj&&"object"==typeof obj&&obj.hasOwnProperty("pageName")&&(pref=obj.pageName),pref=DUTIL.getUnfriendlyPagePrefix(pref),fieldName.indexOf("custom")>=0&&fieldName.indexOf("_")>=0&&(fieldName=fieldName.split("_").join("")),"name"===fieldName){if($("#"+pref+"form_input_first_and_last_name_wrapper").length)return($("#"+pref+"form_input_first_name").val()+" "+$("#"+pref+"form_input_last_name").val()).trim();if($("#"+pref+"form_input_full_name_wrapper").length)return $("#"+pref+"form_input_full_name").val();if($("#"+pref+"form_input_first_name_wrapper").length)return $("#"+pref+"form_input_first_name").val()}else{if("opt_in"===fieldName)return document.getElementById(pref+"form_input_opt_in").checked?"1":"0";if("checkbox"===settings[pref+fieldName].field_type&&$("#"+pref+"form_input_"+fieldName+"_checkbox_wrapper").length)return document.getElementById(pref+"form_input_"+fieldName).checked?settings[pref+fieldName].checkbox.checkedval:settings[pref+fieldName].checkbox.uncheckedval;if("radio"===settings[pref+fieldName].field_type&&$("#"+pref+"form_input_"+fieldName+"_radio_wrapper").length)return $('input[name="'+pref+"form_input_"+fieldName+'"]:checked').length?$('input[name="'+pref+"form_input_"+fieldName+'"]:checked').val():"";if("datedrop"===settings[pref+fieldName].field_type&&$("#"+pref+"form_input_"+fieldName+"_datedrop_mm").length)return $("#"+pref+"form_input_"+fieldName+"_datedrop_mm").val()+"/"+$("#"+pref+"form_input_"+fieldName+"_datedrop_dd").val()+"/"+$("#"+pref+"form_input_"+fieldName+"_datedrop_yyyy").val();if($("#"+pref+"form_input_"+fieldName).length)return $("#"+pref+"form_input_"+fieldName).val()}}catch(e){handleException(e,"getFormFieldValue")}return""},boxapi.addDropdownOption=function(fieldName,submitVal,displayVal,obj){try{var pref=getCurrentPage();obj&&"object"==typeof obj&&obj.hasOwnProperty("pageName")&&(pref=obj.pageName),pref=DUTIL.getUnfriendlyPagePrefix(pref),fieldName.indexOf("custom")>=0&&fieldName.indexOf("_")>=0&&(fieldName=fieldName.split("_").join("")),$("#"+pref+"form_input_"+fieldName).length&&$("#"+pref+"form_input_"+fieldName).is("select")&&$("#"+pref+"form_input_"+fieldName).append(new Option(displayVal,submitVal))}catch(e){handleException(e,"addDropdownOption")}},boxapi.removeDropdownOption=function(fieldName,submitVal,obj){try{var pref=getCurrentPage();obj&&"object"==typeof obj&&obj.hasOwnProperty("pageName")&&(pref=obj.pageName),pref=DUTIL.getUnfriendlyPagePrefix(pref),fieldName.indexOf("custom")>=0&&fieldName.indexOf("_")>=0&&(fieldName=fieldName.split("_").join("")),$("#"+pref+"form_input_"+fieldName).length&&$("#"+pref+"form_input_"+fieldName).is("select")&&$("#"+pref+"form_input_"+fieldName+" option[value='"+submitVal+"']").each((function(){$(this).remove()}))}catch(e){handleException(e,"removeDropdownOption")}},boxapi.removeAllDropdownOptions=function(fieldName,obj){try{var pref=getCurrentPage();obj&&"object"==typeof obj&&obj.hasOwnProperty("pageName")&&(pref=obj.pageName),pref=DUTIL.getUnfriendlyPagePrefix(pref),fieldName.indexOf("custom")>=0&&fieldName.indexOf("_")>=0&&(fieldName=fieldName.split("_").join("")),$("#"+pref+"form_input_"+fieldName).length&&$("#"+pref+"form_input_"+fieldName).is("select")&&$("#"+pref+"form_input_"+fieldName+" option").each((function(){$(this).remove()}))}catch(e){handleException(e,"removeAllDropdownOptions")}},boxapi.hideFormField=function(fieldName,obj){try{const settings=getSettings();var pref=getCurrentPage();obj&&"object"==typeof obj&&obj.hasOwnProperty("pageName")&&(pref=obj.pageName),pref=DUTIL.getUnfriendlyPagePrefix(pref),fieldName.indexOf("custom")>=0&&fieldName.indexOf("_")>=0&&(fieldName=fieldName.split("_").join("")),"name"===fieldName||fieldName.indexOf("_name")>0?($("#"+pref+"form_input_first_and_last_name_wrapper").length&&$("#"+pref+"form_input_first_and_last_name_wrapper").hide(),$("#"+pref+"form_input_full_name_wrapper").length&&$("#"+pref+"form_input_full_name_wrapper").hide(),$("#"+pref+"form_input_first_name_wrapper").length&&$("#"+pref+"form_input_first_name_wrapper").hide()):"checkbox"===settings[pref+fieldName].field_type&&$("#"+pref+"form_input_"+fieldName+"_checkbox_wrapper").length?$("#"+pref+"form_input_"+fieldName+"_checkbox_wrapper").hide():"radio"===settings[pref+fieldName].field_type&&$("#"+pref+"form_input_"+fieldName+"_radio_wrapper").length?$("#"+pref+"form_input_"+fieldName+"_radio_wrapper").hide():$("#"+pref+"form_input_"+fieldName+"_wrapper").length&&$("#"+pref+"form_input_"+fieldName+"_wrapper").hide(),$("#"+pref+"form_label_"+fieldName).length&&$("#"+pref+"form_label_"+fieldName).hide(),settings[pref+fieldName].require&&(settings[pref+fieldName].require=!1)}catch(e){handleException(e,"hideFormField")}},boxapi.showFormField=function(fieldName,obj){try{const settings=getSettings();var pref=getCurrentPage();obj&&"object"==typeof obj&&obj.hasOwnProperty("pageName")&&(pref=obj.pageName),pref=DUTIL.getUnfriendlyPagePrefix(pref),fieldName.indexOf("custom")>=0&&fieldName.indexOf("_")>=0&&(fieldName=fieldName.split("_").join("")),"name"===fieldName||fieldName.indexOf("_name")>0?($("#"+pref+"form_input_first_and_last_name_wrapper").length&&$("#"+pref+"form_input_first_and_last_name_wrapper").show(),$("#"+pref+"form_input_full_name_wrapper").length&&$("#"+pref+"form_input_full_name_wrapper").show(),$("#"+pref+"form_input_first_name_wrapper").length&&$("#"+pref+"form_input_first_name_wrapper").show()):"checkbox"===settings[pref+fieldName].field_type&&$("#"+pref+"form_input_"+fieldName+"_checkbox_wrapper").length?$("#"+pref+"form_input_"+fieldName+"_checkbox_wrapper").show():"radio"===settings[pref+fieldName].field_type&&$("#"+pref+"form_input_"+fieldName+"_radio_wrapper").length?$("#"+pref+"form_input_"+fieldName+"_radio_wrapper").show():$("#"+pref+"form_input_"+fieldName+"_wrapper").length&&$("#"+pref+"form_input_"+fieldName+"_wrapper").show(),$("#"+pref+"form_label_"+fieldName).length&&$("#"+pref+"form_label_"+fieldName).show()}catch(e){handleException(e,"showFormField")}},boxapi.closeBox=function(){DAPI.closeBox(STANDARD_OBJ.lightbox_id)},boxapi.hideElement=function(elementName,pageName){try{if(pageName||(pageName=getCurrentPage()),"main"===pageName&&(pageName=""),!elementName)return;$("#"+pageName+elementName).hide()}catch(e){handleException(e,"hideElement")}},boxapi.showElement=function(elementName,pageName){try{if(pageName||(pageName=getCurrentPage()),"main"===pageName&&(pageName=""),!elementName)return;$("#"+pageName+elementName).show()}catch(e){handleException(e,"showElement")}},boxapi.reloadWebPage=function(obj){var delay=0;obj&&"object"==typeof obj&&obj.hasOwnProperty("delayMsecs")&&(delay=obj.delayMsecs),delay>0?setTimeout((function(){parent.location.reload()}),delay):parent.location.reload()},boxapi.disableScroll=function(){DAPI.isMobile()?parent.document.addEventListener("touchmove",scrollHandlerPreventDefault,{passive:!1}):parent.document.addEventListener("scroll",scrollHandlerPreventDefault,{passive:!1})},boxapi.enableScroll=function(){DAPI.isMobile()?parent.document.removeEventListener("touchmove",scrollHandlerPreventDefault,{passive:!1}):parent.document.removeEventListener("scroll",scrollHandlerPreventDefault,{passive:!1})},boxapi.resetBox=function(){resetBox()},boxapi.resetPage=function(pageName){resetPage(pageName)},boxapi.getQuizResults=function(){return DIGIOH_PRQ.getResults()},boxapi.setQuizResults=function(obj){return DIGIOH_PRQ.setResults(obj)},boxapi.isQuizResultsPage=function(page){return DIGIOH_PRQ.isResultsPagePRQ(page)},boxapi.isPreview=function(){return DAPI.isPreview()},boxapi.getGuid=function(){return STANDARD_OBJ.lightbox_guid},boxapi.isQaMode=function(){return 1==parent.sessionStorage.getItem("xdibx_boxqamode")||DAPI.getQueryString().indexOf("boxqamode")>-1},boxapi.warnNotify=function(html,closeSecs){},boxapi.errorNotify=function(html,closeSecs){},boxapi.successNotify=function(html,closeSecs){},boxapi.infoNotify=function(html,closeSecs){},boxapi.warnNotifyApp=function(html,closeSecs){},boxapi.errorNotifyApp=function(html,closeSecs){},boxapi.successNotifyApp=function(html,closeSecs){},boxapi.infoNotifyApp=function(html,closeSecs){},boxapi.initAppNotifications=function(appName,hideSuppressionMessage){return notifier={infoNotifyApp:boxapi.infoNotifyApp,warnNotify:boxapi.warnNotify,errorNotify:boxapi.errorNotify,successNotify:boxapi.successNotify,infoNotify:boxapi.infoNotify,warnNotifyApp:boxapi.warnNotifyApp,errorNotifyApp:boxapi.errorNotifyApp,successNotifyApp:boxapi.successNotifyApp}},boxapi}"undefined"!=typeof module&&void 0!==module.exports&&(module.exports={addSdkBoxapiModule:addSdkBoxapiModule});function loadScript(url,callback){var head=document.head,script=document.createElement("script");script.type="text/javascript",script.src=url,script.onreadystatechange=callback,script.onload=callback,head.appendChild(script)}async function loadUserScript(fileName,cacheValue){IS_QA?fileName=fileName.replace(/\.[^/.]+$/,"_qa.js"):IS_PREVIEW&&(fileName=fileName.replace(/\.[^/.]+$/,"_preview.js"));var scriptUrl=DAPI.CONFIG.BOX_BASE_URL+"/vendor/"+VENDOR_GUID+"/"+fileName;return void 0!==cacheValue&&(scriptUrl+="?cb="+cacheValue),new Promise(((resolve,reject)=>{loadScript(scriptUrl,(function(){resolve(scriptUrl+" loaded")}))}))}function getPlainPref(name){return name.replace("main_page","").replace("main","").replace("extra_page_","ep").replace("thank_you_page","thx").replace("thanks","thx").replace("_","")}async function loadWidgetScript(widgetScriptURL){return new Promise(((resolve,reject)=>{loadScript(widgetScriptURL,(function(){resolve(widgetScriptURL+" loaded")}))}))}function loadWidget(configurations){if(configurations&&configurations.WidgetSourcePath){const scriptFileName=configurations.WidgetSourcePath.split("/").pop();loadWidgetScript(`https://forms.allrecipes.com/w37htfhcq2/vendor/${DAPI.getAccountGuid()}/lightbox/${boxapi.getGuid()}/${scriptFileName}?cb=${DIGIOH_CACHE_VERSION}`).then((()=>{!async function(widgetConfig){var componentSplit=widgetConfig.ComponentName.split("_"),pageName=getPlainPref(componentSplit[0]),widgetContainerSelector=`#${pageName}${componentSplit[1]}`,currentPage=getPlainPref(void 0!==CURRENT_PAGE?CURRENT_PAGE:"undefined"!=typeof current_page_name?current_page_name:"");"undefined"!=typeof WidgetModule&&currentPage===pageName&&WidgetModule.name==widgetConfig.WidgetName&&await WidgetModule.init(widgetContainerSelector,widgetConfig)}(configurations)}))}}addSdkBoxapiModule(boxapi,{DAPI:DAPI,DUTIL:DUTIL,BOX_CUSTOM_JS:BOX_CUSTOM_JS,STANDARD_OBJ:STANDARD_OBJ,DIGIOH_PRQ:DIGIOH_PRQ,DLOG:DLOG,getCurrentPage:getCurrentPage,changePages:changePages,getSettings:getSettings,processSubmitObj:processSubmitObj,showLoading:showLoading,hideLoading:hideLoading,showError:showError,showSuccess:showSuccess,showWarning:showWarning,showInlineError:showInlineError,resetBox:resetBox,resetPage:resetPage});